Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Paralyzed Tiefling General
SetVisible(S_DEN_Tiefling005_ParalyzedSeat_54d5ccc0-e453-48f6-89d5-d02a6b884420, 0);
PROC_DEN_Tiefling5_Init();

TriggerRegisterForItems(S_DEN_Storage_SUB_28361464-314c-474e-96f2-cf56a9eb8afd);

DB_DialogMoneyTransfer(1,DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219,5,1);
DB_DialogMoneyTransfer(2,DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219,5,1);

DB_HasItemEvent((ITEM)S_DEN_Tiefling5Bag_d714d2fe-8344-4982-a110-f0bd2f3b2312,(FLAG)DEN_Tiefling5_State_HasBag_cac9d1d7-22fd-46c4-a5c1-93b4369d23b4);
DB_GiveItemToEvent((ITEM)S_DEN_Tiefling5Bag_d714d2fe-8344-4982-a110-f0bd2f3b2312,(FLAG)DEN_Tiefling5_Event_GaveBag_267db127-2fb3-4b8f-8bc7-dbbddb19741f);

DB_DEN_Paralyzed_AngeredFlags((FLAG)DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac);
DB_DEN_Paralyzed_AngeredFlags(DEN_Event_TieflingGuard5_Threatened_14c555a3-43a6-8494-400d-5be65ddc2760);

DB_GLO_Plague_Cures("Target_LesserRestoration",(FLAG)DEN_General_State_HasLesserRestoration_b9e84d98-54aa-d5a5-2505-d1ba61e1b296,(FLAG)DEN_General_Event_TryLesserRestoration_83bcd658-6ac9-8d03-c306-57428dcd0c9d,"DEN_Tiefling_005");

//END_REGION

//REGION Paralyzed Custom Crimes
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"MoveForbiddenItem",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"UseForbiddenItem",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"SneakUseForbiddenItem",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"Steal",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"PickPocketFailed",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"Vandalise",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);
DB_CrimeType_CustomWarning((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"ItemDestroy",(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219);

DB_TrespassTrigger(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,NULL_00000000-0000-0000-0000-000000000000,"DEN_StorageRoomTrespass");

DB_DEN_Tiefling5_TrespassEndFlags((FLAG)DEN_Tiefling5_Event_PersuadeSuccess_399baaf0-33a1-6ebd-a6a3-08dcc4fc67fe);
DB_DEN_Tiefling5_TrespassEndFlags(DEN_Event_TieflingGuard5_Threatened_14c555a3-43a6-8494-400d-5be65ddc2760);
DB_DEN_Tiefling5_TrespassEndFlags(DEN_TieflingGuard5_Event_CharlatanPersuade_8a5159be-f4d6-02f0-2142-08b561c88517);
//END_REGION

//REGION Curing Paralysis In Dialog

DB_GLO_Plague_CureFlags((FLAG)DEN_General_State_HasTiefling005Cure_0434ab65-b09e-c718-9aec-49cd2247f76a,(FLAG)DEN_General_State_PartyHasTiefling005Cure_efad0a21-a792-abe7-45b5-997bf8ef9bb4,"DEN_Tiefling_005");
DB_GLO_Plague_CureCheck((FLAG)DEN_General_Event_TryTiefling005Cure_52f69933-c121-449e-bfa9-10bff44392a7,(FLAG)DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,"DEN_Tiefling_005");

PROC_TriggerRegisterForPlayers(S_DEN_RatWander_Shack_683b9c3a-3568-4d8f-83e2-0de771b716d1);
//END_REGION
KBSECTION
//REGION Paralyzed Guard Setup

PROC
PROC_DEN_Tiefling5_Init()
THEN
PROC_CharacterDisableAllCrimes(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, 1); //only react to certain crimes (can't react to everything because paralyzed off start)
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"MoveForbiddenItem");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"UseForbiddenItem");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"SneakUseForbiddenItem");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"Steal");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"PickPocketFailed");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"Vandalise");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"ItemDestroy");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"DEN_StorageRoomTrespass");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"DEN_StorageRoomTrespass_CallForHelp");
PROC_CharacterEnableCrime(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"WaitingForCalledGuard");

//force remove paralysis when states advance far enough
PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _State)
AND
DB_State_Priority(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _State, _Priority)
AND
_Priority > 4000
THEN
PROC_DEN_Tiefling5_RemoveParalysis();

//END_REGION

//REGION Custom Paralyzed Crime Handling

PROC
PROC_CharacterRegisterCrime_Success(_, "DEN_StorageRoomTrespass",_,(TRIGGER)S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,_,_)
THEN
DB_DEN_Tiefling5_IgnoreOtherCharactersTrespassing(1);

IF
LeftTrigger(_Player, S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb)
AND
DB_DEN_Tiefling5_IgnoreOtherCharactersTrespassing(1)
AND
NOT QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb)
THEN
NOT DB_DEN_Tiefling5_IgnoreOtherCharactersTrespassing(1);

QRY
QRY_CRIME_BlockRegisterCrime(_Player, "DEN_StorageRoomTrespass", _, _, _)
AND
DB_DEN_Tiefling5_IgnoreOtherCharactersTrespassing(1)
THEN
DB_NOOP(1);


QRY
QRY_CRIME_BlockRegisterCrime(_Player, "DEN_StorageRoomTrespass", _, _, _)
AND
DB_Players(_Player)
AND
DB_DEN_Tiefling5_TrespassEndFlags(_Flag)
AND
DB_GlobalFlag(_Flag)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime(_Player, "DEN_StorageRoomTrespass", _, _, _)
AND
DB_Players(_Player)
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime(_Player, "DEN_StorageRoomTrespass_CallForHelp", _, _, _)
AND
DB_Players(_Player)
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockGenericInvestigation(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492)
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0)
THEN
SetEntityEvent(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "CRIME_StartLookingForInterrogationSuspects");

//Clear trespassing crime if state changes beyond default grove state
PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _State)
AND
NOT DB_DEN_DefaultStates(_State)
THEN
PROC_DEN_Tiefling5_ClearTrespassing();

PROC
PROC_DEN_Tiefling5_ClearTrespassing()
THEN
PROC_RemoveDBTrespassTrigger(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,NULL_00000000-0000-0000-0000-000000000000);
PROC_TriggerUnregisterForParty(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb);

// Distinguish between DEN_StorageRoomTrespass (-> generic dialog flow) and other crimes (-> custom crime dialog flow)
PROC
PROC_CrimeDialogSetupFlags((INTEGER)_CrimeID,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,(CHARACTER)_Criminal1,(CHARACTER)_Criminal2,(CHARACTER)_Criminal3,(CHARACTER)_Criminal4,(DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219)
AND
CrimeGetType(_CrimeID, "DEN_StorageRoomTrespass")
THEN
SetFlag((FLAG)DEN_State_TieflingGuard5_StorageRoomTrespass_6bbc0fb4-9ac5-4b32-bcbd-0e2cad946133,(CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);

IF
DialogEnded((DIALOGRESOURCE)DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219, _)
THEN
ClearFlag((FLAG)DEN_State_TieflingGuard5_StorageRoomTrespass_6bbc0fb4-9ac5-4b32-bcbd-0e2cad946133,(CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);
//END_REGION

//REGION Dialog Handling + Outcomes

IF
DialogEnded(DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219, _Id)
THEN
PROC_DEN_Tiefling5_DialogEnded(_Id);

PROC
PROC_DEN_Tiefling5_DialogEnded((INTEGER)_Id)
AND
GetFlag(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, 1)
AND
QRY_OnlyOnce("DEN_Tiefling5_TurnedHostile")
THEN
PROC_DEN_Tiefling5_HostileTrespassSetup();

PROC
PROC_DEN_Tiefling5_DialogEnded((INTEGER)_Id)
AND
DB_DEN_Tiefling5_TrespassEndFlags(_Flag)
AND
DB_GlobalFlag(_Flag)
AND
QRY_OnlyOnce("DEN_Tiefling5_NoMoreTrespass")
THEN
PROC_DEN_Tiefling5_ClearTrespassing();
PROC_DEN_Tiefling5_TrespassingEndExtras(_Id);

PROC
PROC_DEN_Tiefling5_TrespassingEndExtras((INTEGER)_Id)
AND
DB_GlobalFlag(DEN_Event_TieflingGuard5_Threatened_14c555a3-43a6-8494-400d-5be65ddc2760)
THEN
DB_DEN_Tiefling5_NewCrimeReactionsBlocked(1);
BlockNewCrimeReactions(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1); //guard won't react to any new crimes if threatened

PROC
PROC_DEN_Tiefling5_TrespassingEndExtras((INTEGER)_Id)
AND
DB_GlobalFlag(DEN_TieflingGuard5_Event_CharlatanPersuade_8a5159be-f4d6-02f0-2142-08b561c88517)
AND
DB_DialogPlayers(_Id,_Player,1)
THEN
PROC_ItemOwnership_SetNewTriggerOwner(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,(CHARACTER)_Player); //guard believes the player is supposed to be there

//END_REGION

//REGION Paralyzed Hostility

IF
AttackedBy((CHARACTER)S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,(CHARACTER)_Player,_,_,_,_,_)
AND
NOT DB_Defeated(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492)
AND
CanSee(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, _Player, 1)
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0)
THEN
PROC_DEN_Tiefling5_UnblockCrimeReactions();
SetFlag(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);

PROC
PROC_DEN_Tiefling5_UnblockCrimeReactions()
AND
DB_DEN_Tiefling5_NewCrimeReactionsBlocked(1)
THEN
NOT DB_DEN_Tiefling5_NewCrimeReactionsBlocked(1);
BlockNewCrimeReactions(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);

IF
FlagSet(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_)
AND
NOT DB_GlobalFlag(DEN_Tiefling5_Event_Warned_d75de198-ec1c-18bf-b981-aa1ad6baa63c)
THEN
SetFlag(DEN_Tiefling5_Event_Warned_d75de198-ec1c-18bf-b981-aa1ad6baa63c);

IF
FlagSet(_Flag, _, _)
AND
DB_DEN_Paralyzed_AngeredFlags(_Flag)
THEN
SetFlag(DEN_AttackOnDen_State_AngeredPandirnaBefore_55cb1d5b-4035-6241-5b1b-29ae7800944e);

//if turning hostile specifically outside of dialog (preventing overlap)
IF
FlagSet(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_)
AND
NOT QRY_DEN_Tiefling005_CheckDialog()
AND
QRY_OnlyOnce("DEN_Tiefling5_TurnedHostile")
THEN
PROC_DEN_Tiefling5_HostileTrespassSetup();

QRY
QRY_DEN_Tiefling005_CheckDialog()
AND
DB_DialogNPCs(_Id,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_)
AND
DB_DialogName(DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219,_Id)
THEN
DB_NOOP(1);

//reset trespassing trigger to use new crime that calls guards to area
PROC
PROC_DEN_Tiefling5_HostileTrespassSetup()
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0)
THEN
PROC_DEN_Tiefling5_ClearTrespassing();
DB_TrespassTrigger(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,NULL_00000000-0000-0000-0000-000000000000,"DEN_StorageRoomTrespass_CallForHelp");
PROC_ItemOwnership_SetNewTriggerOwner(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);

PROC
PROC_StateSet_Defeated(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492)
THEN
EndRepose(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
//BlockNewCrimeReactions(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1); //was using this because pickpocketing the KO body was throwing a crime during GP presentation, still needed?
SetHasDialog(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);

//END_REGION

//REGION Healing In+Out of Dialog

IF
DialogActorJoined(DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219,_ID,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_)
THEN
PROC_GLO_Plague_PartyCheckCure(_ID,"DEN_Tiefling_005");

PROC
PROC_DEN_Tiefling5_RemoveParalysis()
THEN
DB_DEN_Paralyzed_Healed(1);
SetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);
PROC_SelfHealing_Enable(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
PROC_DEN_Tiefling_005_HealedProcessing();

PROC
PROC_DEN_Tiefling5_RemoveParalysis()
AND
HasAppliedStatus(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "DEN_PANDIMA_PARALYZED", 1)
THEN
RemoveStatus(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "DEN_PANDIMA_PARALYZED");

//guard unparalyzed outside of dialog
IF
StatusRemoved(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "DEN_PANDIMA_PARALYZED", (CHARACTER)_Player, _)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("DEN_General_Tiefling5StandUp")
THEN
SetFlag(DEN_General_State_PotionTieflingHealer_428d007f-401c-538e-e018-7b72d42c7ff6,_Player,0);
ClearFlag(DEN_Tiefling5_HasMet_7f5af9c5-10a6-279b-fad9-35674b74b0b0,_Player);
PROC_DEN_Tiefling5_RemoveParalysis();
PROC_DEN_Tiefling5_TryRespondToHeal((CHARACTER)_Player, 0);

//0 == Non-hostile response
PROC
PROC_DEN_Tiefling5_TryRespondToHeal((CHARACTER)_Player, 0)
AND
NOT DB_CantTalk(_Player)
AND
QRY_StartDialog_Fixed(DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, _Player)
THEN
DB_NOOP(1);

//1 == hostile response
PROC
PROC_DEN_Tiefling5_TryRespondToHeal((CHARACTER)_Player, 1)
AND
NOT QRY_StartDialog_Fixed(DEN_General_TieflingGuard5_7d3ed8cb-6b82-ccdf-3030-9f97de65b219, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, _Player)
THEN
SetFlag(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
PROC_SetRelationTemporaryHostile(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_Player);

IF
StatusRemoved(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "DEN_PANDIMA_PARALYZED", (CHARACTER)_Player, _)
AND
NOT DB_Players(_Player)
AND
QRY_OnlyOnce("DEN_General_Tiefling5StandUp")
THEN
PROC_DEN_Tiefling5_RemoveParalysis();

//Player used healing spell that did not remove the status
IF
StatusApplied(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "HEAL", _Player, _ID)
AND
DB_Players((CHARACTER)_Player)
AND
HasActiveStatus(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "DEN_PANDIMA_PARALYZED", 1)
AND
DB_GlobalFlag(DEN_General_State_TieflingGuardWaitingForHeal_aba4b17f-42d3-437c-a018-0838f43c96ce)
AND
NOT DB_GlobalFlag(DEN_General_Event_WaitingForHealCastedNonHeal_ec79f887-8447-4f22-825c-fe337ada3aac)
THEN
SetFlag(DEN_General_Event_WaitingForHealCastedNonHeal_ec79f887-8447-4f22-825c-fe337ada3aac);
PROC_DEN_Tiefling5_TryRespondToHeal((CHARACTER)_Player, 0);

// Knocked tiefling shouldn't have the dialogue available

IF
StatusApplied(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"KNOCKED_DOWN",_,_)
THEN
SetHasDialog(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0);

//knocking the tiefling over while paralyzed will set the knocked_down status on them. when healed they should lose this if it was applied (if not considered defeated).
PROC
PROC_DEN_Tiefling_005_HealedProcessing()
AND
HasActiveStatus(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,"KNOCKED_DOWN",1)
AND
NOT DB_Defeated(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492)
THEN
RemoveStatus(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, "KNOCKED_DOWN");
SetHasDialog(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1);

//the forced trespassing custom crime is removed when the guard is healed in favor of the regular guard reactions via the crimes system
PROC
PROC_DEN_Tiefling_005_HealedProcessing()
THEN
PROC_DEN_Tiefling5_ClearTrespassing();

//clear the custom crime behaviors on healing
PROC
PROC_DEN_Tiefling_005_HealedProcessing()
AND
DB_CrimeType_CustomWarning(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_Crime,_Dialog)
THEN
NOT DB_CrimeType_CustomWarning(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_Crime,_Dialog);

PROC
PROC_DEN_Tiefling_005_HealedProcessing()
THEN
PROC_CharacterEnableAllCrimes(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
PROC_DEN_Tiefling5_UnblockCrimeReactions();
PROC_RemoveDBTrespassTrigger(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb,NULL_00000000-0000-0000-0000-000000000000);
PROC_SetCanFight(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1);
SetCanJoinCombat(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,1);


//healing the guard while she's 'hostile' to the party will result in her trying to attack right after
PROC
PROC_DEN_Tiefling_005_HealedProcessing()
AND
GetFlag(DEN_Tiefling5_State_TurnedHostile_4b77b883-d393-f092-61ab-36439f1c73ac, S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, 1)
AND
DB_Players(_Player)
AND
DB_InRegion(_Player,S_DEN_Storage_SUB_28361464-314c-474e-96f2-cf56a9eb8afd)
THEN
PROC_SetRelationTemporaryHostile(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,_Player);

IF
LeftTrigger(_Player, S_DEN_RatWander_Shack_683b9c3a-3568-4d8f-83e2-0de771b716d1)
AND
GetFlag(DEN_General_State_MadeParalyzedTieflingPay_7fb10f5d-f4a5-44e7-b53b-96978a866e7e, _Player, 1)
AND
GetFlag(DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab,S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492,0)
THEN
SetFlag(DEN_General_Event_PlayerLeftWithoutHealingTiefling_be102d36-bf07-4132-9c04-6a2f40ca7bcb);
PROC_DEN_Tiefling5_TryRespondToHeal((CHARACTER)_Player, 1);
//END_REGION

//REGION Debug

IF
TextEvent("curepandirna")
THEN
PROC_DEN_Tiefling5_RemoveParalysis();

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act1"
