Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Thiefling Hideout

//Starting Hideout Kids
DB_Dialogs(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db);
DB_Dialogs(S_DEN_TieflingKid_004_6644185d-385e-4dfc-973c-bb854cbfd540,DEN_Thieflings_HideoutGuard_002_3c985dd7-0ab8-4989-4dd1-7a6a70ac3d22);

DB_DEN_Thieflings_HideoutCrimes("DEN_HideoutKidAlarm_Investigate");
DB_DEN_Thieflings_HideoutCrimes("DEN_ThieflingHideoutTrespass");
DB_DEN_Thieflings_HideoutCrimes("DEN_WaitForMol");

//Trigger Setup
PROC_TriggerRegisterForPlayers(S_DEN_Hideout_DiscoveryArea_1a634c88-c2aa-47ba-b2d1-9c3dddb0869a);
PROC_TriggerRegisterForPlayers(S_DEN_Hideout_AbandonedADArea_5cf09039-e7fd-4d70-b001-1aced4695bc9);
TriggerRegisterForItems(S_DEN_Hideout_DiscoveryArea_1a634c88-c2aa-47ba-b2d1-9c3dddb0869a);
TriggerRegisterForCharacter(S_DEN_HideoutKidDenTarget_4a6db080-e49c-48c6-a175-20914fff76d7, S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_TieflingKid_004_6644185d-385e-4dfc-973c-bb854cbfd540);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_CharmedKid_3b92c689-6024-4446-a6c9-584e9e8d77ca);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_RobberKid_94e865e9-790d-4633-a378-8fb50832b5e9);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_Pickpocket_540ddc1f-42c6-4347-ba03-b3cf3d3942ab);
TriggerRegisterForCharacter(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4, S_DEN_PickpocketTrader_e1fda08b-45d4-41db-84b5-20e9931ba5af);

DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

//Stolen Item Exchange Gold Transfers
DB_DialogMoneyTransfer(1,DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db,40); //DEN_Thieflings_Hideout_PaySmall
DB_DialogMoneyTransfer(2,DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db,50); //DEN_Thieflings_Hideout_PayBig

//Guards alerted once hideout abandoned
DB_DEN_Thieflings_Hideout_CaveGuards((CHARACTER)S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17);
DB_DEN_Thieflings_Hideout_CaveGuards(S_GLO_IrritatedTiefling_65ad9da0-0efb-4cc3-bf82-c006f43dda6c);
DB_DEN_Thieflings_Hideout_CaveGuards(S_DEN_Tiefling_004_c9562174-44af-4ffa-9e5e-da58538f23d8);
DB_DEN_Thieflings_Hideout_CaveGuards(S_DEN_Tiefling_011_77439e86-3f60-4456-bd55-931e2f45654f);

//Hideout Object Setup
DB_DEN_Thieflings_LooseStash((ITEM)S_DEN_Thieflings_Stash_Shield_d705df85-f41e-404e-82a1-fa8858e5d08d);
DB_DEN_Thieflings_LooseStash(S_DEN_Thieflings_Stash_Cup_a8840bc3-f728-448b-97f4-d365103c3d1e);
DB_DEN_Thieflings_LooseStash(S_DEN_Thieflings_Stash_Bear_515f163b-7bbe-49c6-bb63-94a619f3a330);
DB_DEN_Thieflings_LooseStash(S_DEN_Thieflings_Stash_Bottle_00bcdaca-7174-409a-b22c-3003d1987d47);
DB_DEN_Thieflings_LooseStash(S_DEN_Thieflings_Stash_Plate_0d74a2ad-5314-407d-be23-37c9835513be);
DB_DEN_Thieflings_LooseStash(S_DEN_Thieflings_Stash_Pouch_5b5a68bd-4f54-48d7-a011-a4ea0f38cde2);

SetOnStage(S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, 0);
SetOnStage(S_DEN_Thieflings_MolNote_4702ee45-1876-4fe0-9d6a-81c66e4bab7b, 0);

//Countdown Flags
DB_DEN_Thieflings_CountdownFlags((FLAG)DEN_Hideout_Event_Count10_6dcb1260-5723-31ce-e919-9322eb0742f8);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count9_6e0662ca-065f-e8cf-c761-bebc56aec4d0);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count8_672fe091-89b4-43ce-1dcc-2ba3afe180a3);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count7_f50902a2-48b1-1fa3-ed94-4593cdee08e2);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count6_23181891-b691-a2e1-48d1-17171f4368c8);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count5_ffd33d5b-cdb6-9779-e64f-712552bdc8e1);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count4_77fa041b-2da0-21f1-02a3-ff1c5f251e8d);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count3_0b56eddb-6c21-a91e-35a2-f1228cdb3de2);
DB_DEN_Thieflings_CountdownFlags(DEN_Hideout_Event_Count2_ff3352ea-6a10-034b-cbbb-7cc121a12d42);

//Kids Setup
DB_DEN_Thieflings_HideoutKids((CHARACTER)S_DEN_TieflingKid_004_6644185d-385e-4dfc-973c-bb854cbfd540);
DB_DEN_Thieflings_HideoutKids((CHARACTER)S_DEN_RobberKid_94e865e9-790d-4633-a378-8fb50832b5e9);
DB_DEN_Thieflings_HideoutKids((CHARACTER)S_DEN_Pickpocket_540ddc1f-42c6-4347-ba03-b3cf3d3942ab);
DB_DEN_Thieflings_HideoutKids((CHARACTER)S_DEN_PickpocketTrader_e1fda08b-45d4-41db-84b5-20e9931ba5af);

DB_Children(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_Children(S_DEN_TieflingKid_004_6644185d-385e-4dfc-973c-bb854cbfd540);
DB_Children(S_DEN_RobberKid_94e865e9-790d-4633-a378-8fb50832b5e9);
DB_Children(S_DEN_Pickpocket_540ddc1f-42c6-4347-ba03-b3cf3d3942ab);
DB_Children(S_DEN_PickpocketTrader_e1fda08b-45d4-41db-84b5-20e9931ba5af);
DB_Children(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

DB_DEN_Thieflings_TotalValueOfStolenGoods(20);
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db, 20);

//Grunting Kid Entrance
SetVisible(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, 0);
SetOnStage(S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449, 0);
DB_DialogMoneyTransfer(1,(DIALOGRESOURCE)DEN_General_GruntingKid_37a3539d-3d6a-111b-8a76-283e6915248f,10);

//Druid Idol Steal Quest
DB_HasItemEvent((ITEM)S_DEN_SilvanusIdol_a841d36c-9a00-4a26-943e-c0af6895bb16,(FLAG)DEN_Thieflings_State_HasIdol_9b6a429f-3e24-4569-ba30-de7bf2b12ace);
DB_GiveItemToEvent((ITEM)S_DEN_SilvanusIdol_a841d36c-9a00-4a26-943e-c0af6895bb16,(FLAG)DEN_Thieflings_Event_TransferIdol_7c52b506-a746-463e-95f8-4b891cea3e7a);

// Can remain a dead event (is a child, can only die via story)
DB_DeadOnceFlag(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, DEN_Thieflings_State_MolIsDead_fc37dc09-e234-4b40-aa18-3287db01bec5);

PROC_DEN_Thieflings_SetupKidSpotting();
DB_ItemOwnerShipTriggers("WLD_Main_A", (TRIGGER)S_DEN_Hideout_DiscoveryArea_1a634c88-c2aa-47ba-b2d1-9c3dddb0869a, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
//END_REGION
KBSECTION
//REGION Control Hideout Crimes
PROC
PROC_DEN_Thieflings_SetupKidSpotting()
AND
DB_DEN_Thieflings_HideoutKids((CHARACTER)_Child)
THEN
DB_SpotPlayers(_Child, "DEN_Thieflings_HideoutKid", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(_Child, "DEN_Thieflings_HideoutKid");
DB_SpotPlayers_TargetIgnoreCantTalk(_Child, "DEN_Thieflings_HideoutKid");
DB_SpotPlayers_IncludeFollowers(_Child, "DEN_Thieflings_HideoutKid");
TriggerRegisterForCharacter((TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b, _Child);

IF
DB_DEN_Thieflings_HideoutKids((CHARACTER)_Child)
AND
NOT DB_InRegion(_Child, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
THEN
PROC_CharacterDisableCrime(_Child, "DEN_WaitForMol");

IF
DB_InRegion((CHARACTER)_Child, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterEnableCrime(_Child, "DEN_WaitForMol");

//Non-trespass Crimes were committed in Thiefling Crime Region
IF
CharacterOnCrimeSensibleActionNotification((CHARACTER)_Child, "S_DEN_Thieflings_HideoutCrimeRegion", _ID, _, _, (CHARACTER)_Player, _, _, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
CrimeGetType(_ID, _CrimeType)
AND
NOT DB_DEN_Thieflings_HideoutCrimes(_CrimeType)
THEN
PROC_GlobalSetFlagAndCache((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18);
PROC_GlobalSetFlagAndCache((FLAG)DEN_Thieflings_Event_HideoutCallForHelp_d653abaf-f717-344e-5b04-cc7853ee3ba8);
PROC_TryStartAD((DIALOGRESOURCE)DEN_Thieflings_AD_HideoutTrespass_ced07a44-4432-80c0-7394-b587e02d9d2e, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

//Disable Hideout crimes when friends
IF
FlagSet((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_WaitForMol");

IF
FlagSet((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7, _, _)
THEN
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

IF
UseStarted(_Party, S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1)
AND
DB_PartyMembers(_Party)
AND
GetFlag((FLAG)DEN_HideoutLeader_HasMet_d018a0dc-99de-2652-813c-19450c65a6a3, _Party, 1)
THEN
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);

IF
UseStarted(_Party, S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1)
AND
DB_PartyMembers(_Party)
AND
GetFlag((FLAG)DEN_HideoutLeader_HasMet_d018a0dc-99de-2652-813c-19450c65a6a3, _Party, 1)
THEN
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);

//Disable Hideout crimes when enemies
IF
FlagSet((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_HideoutKidAlarm_Investigate");
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_WaitForMol");

IF
FlagSet((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18, _, _)
THEN
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

//Disable Hideout Crimes during Countdown
IF
FlagSet((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_HideoutKidAlarm_Investigate");
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_WaitForMol");

IF
FlagSet((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a, _, _)
THEN
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

//Disable Hideout Crimes if not hostile or befriended, but given a warning
IF
FlagSet((FLAG)DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_HideoutKidAlarm_Investigate");
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_WaitForMol");

IF
FlagSet((FLAG)DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player, _)
THEN
PROC_CharacterDisableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

IF
FlagSet((FLAG)DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87, _, _)
THEN
PROC_CharacterDisableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

//Enable Hideout Crimes when rude to kids but not enemies
IF
FlagSet((FLAG)DEN_Thieflings_State_MessedWithMolsKids_017f7709-c709-acc6-663d-790b9f9da7ec, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
DB_InRegion(_Child, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
AND
NOT DB_GlobalFlag((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18)
THEN
ClearFlag((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7);
ClearFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310);
DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

IF
FlagSet((FLAG)DEN_Thieflings_State_MessedWithMolsKids_017f7709-c709-acc6-663d-790b9f9da7ec, _, _)
AND
NOT DB_GlobalFlag((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18)
THEN
ClearFlag((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7);
ClearFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310);
DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);


//Log all Players that Mol sees during her countdown
IF
Saw((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, _Player, 0)
AND
NOT DB_DEN_SpottedPlayerTrespassers(_Player)
AND
DB_PartyMembers(_Player)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
DB_DEN_SpottedPlayerTrespassers(_Player);

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_ThieflingSmallEntry_b15526ff-7498-4c78-8278-89a40a06008c)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310, _Player, 1)
THEN
PROC_CharacterEnableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310, _Player, 1)
THEN
PROC_CharacterEnableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_ThieflingSmallExit_de898878-dbd1-4616-b6af-74cf06ccae32)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87, _Player, 0)
THEN
PROC_CharacterEnableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87, _Player, 0)
THEN
PROC_CharacterEnableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, "KeepAnEyeOnMe", _, _, _)
AND
DB_InRegion(_Player, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
THEN
DB_NOOP(1);

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player, 1)
THEN
ClearFlag(DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player);

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_ThieflingSmallExit_de898878-dbd1-4616-b6af-74cf06ccae32)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player, 1)
THEN
ClearFlag(DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd, _Player);

IF
FlagSet((FLAG)DEN_Thieflings_Event_HideoutTrespassCrimeResolved_8778b66b-4219-878c-42ac-94b5656bf450, _, _)
THEN
PROC_CharacterDisableCrime((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "DEN_ThieflingHideoutTrespass");
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

IF
FlagSet((FLAG)DEN_Thieflings_Event_HideoutTrespassCrimeResolved_8778b66b-4219-878c-42ac-94b5656bf450, _, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
THEN
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_HideoutKidAlarm_Investigate");
PROC_CharacterDisableCrime((CHARACTER)_Child, "DEN_WaitForMol");
//END_REGION

//REGION Kids Spotting Players
PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Child, "DEN_Thieflings_HideoutKid", (CHARACTER)_Player)
AND
DB_Players(_Player)
AND
NOT DB_DEN_Thieflings_WaitingCrimeRegistered(_Player, _)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
DB_InRegion(_Child, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
AND
NOT DB_GlobalFlag((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7)
AND
NOT DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
SetDualEntityEvent(_Child, _Player, "DEN_Thieflings_Event_SpottedPlayer", 1);
PROC_CharacterRegisterCrime(_Player, "DEN_WaitForMol", NULL_00000000-0000-0000-0000-000000000000, _Child, 0);

PROC
PROC_CharacterRegisterCrime_Success((CHARACTER)_Player, "DEN_WaitForMol",(INTEGER)_StoryID,(GUIDSTRING)_Evidence,(CHARACTER)_Victim,(INTEGER)_CrimeID)
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
DB_InRegion(_Child, (TRIGGER)S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
AND
NOT DB_DEN_Thieflings_KidFollowing((CHARACTER)_Child, _Player)
THEN
DB_DEN_SpottedPlayerTrespassers(_Player);
DB_DEN_Thieflings_WaitingCrimeRegistered((CHARACTER)_Player, (INTEGER)_CrimeID);
PROC_CRIME_OsirisArrest(_Child, "WLD_Main_A_HIDEOUT", _CrimeID, "DEN_WaitForMol", (DIALOGRESOURCE)NULL_00000000-0000-0000-0000-000000000000, _Player, (CHARACTER)NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)NULL_00000000-0000-0000-0000-000000000000);
PROC_DEN_Thieflings_CheckSightCrime(_Child, _Player, _Victim, _CrimeID);

PROC
PROC_SpotPlayers_Unspotted((CHARACTER)_Child, "DEN_Thieflings_HideoutKid", (CHARACTER)_Player)
AND
DB_DEN_SpottedPlayerTrespassers(_Player)
AND
DB_DEN_Thieflings_WaitingCrimeRegistered(_Player, _CrimeID)
AND
DB_DEN_Thieflings_KidFollowing(_Child, _Player)
THEN
CharacterStopCrime(_Player, "DEN_WaitForMol", NULL_00000000-0000-0000-0000-000000000000);
SetEntityEvent(_Child, "DEN_Thielfings_Event_StopFollow", 1);
NOT DB_DEN_SpottedPlayerTrespassers(_Player);
NOT DB_DEN_Thieflings_WaitingCrimeRegistered(_Player, _CrimeID);
NOT DB_DEN_Thieflings_KidFollowing(_Child, _Player);
//END_REGION

//REGION Kids calling Mol
PROC
PROC_DEN_Thieflings_CheckSightCrime((CHARACTER)_Child, (CHARACTER)_Player, (CHARACTER)_Victim, (INTEGER)_CrimeID)
AND
DB_Sees(_Child, _Player)
AND
QRY_DEN_Thieflings_CanSeeVictim(_Child, _Victim)
AND
IsSummon(_Player, 0)
AND
NOT DB_DEN_Thieflings_KidFollowing(_Child, _)
AND
NOT DB_DEN_Thieflings_KidFollowing(_, _Player)
AND
NOT QRY_DEN_Thiefling_ShouldIgnorePlayer()
THEN
PROC_DEN_Thieflings_FollowIntruder(_Child, _Player);
PROC_CRIME_Guards_Call(_CrimeID, _Child, "Arrest");

QRY
QRY_DEN_Thieflings_CanSeeVictim((CHARACTER)_Eye, (CHARACTER)_Victim)
AND
DB_Sees(_Eye, _Victim)
THEN
DB_NOOP(1);

QRY
QRY_DEN_Thieflings_CanSeeVictim((CHARACTER)_Eye, (CHARACTER)_Victim)
AND
_Eye == _Victim
THEN
DB_NOOP(1);

PROC
PROC_DEN_Thieflings_FollowIntruder((CHARACTER)_Child, (CHARACTER)_Player)
AND
NOT DB_DEN_Thieflings_KidFollowing(_, _Player)
AND
NOT DB_DEN_Thieflings_KidFollowing(_Child, _)
THEN
PROC_TryStartAD(DEN_Thieflings_AD_Trespassing_f002f19f-e641-fb5d-750f-afad6c7938a4, _Child);
DB_DEN_Thieflings_KidFollowing(_Child, _Player);
SetDualEntityEvent(_Player, _Child, "DEN_thieflings_Event_Follow", 1);

QRY
QRY_DEN_Thiefling_ShouldIgnorePlayer()
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7)
THEN
DB_NOOP(1);

QRY
QRY_DEN_Thiefling_ShouldIgnorePlayer()
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
DB_NOOP(1);

QRY
QRY_DEN_Thiefling_ShouldIgnorePlayer()
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18)
THEN
DB_NOOP(1);

QRY
QRY_DEN_Thiefling_ShouldIgnorePlayer()
AND
DB_GlobalFlag((FLAG)DEN_Thieflings_Event_HideoutAbandoned_f3808740-25b9-4393-a947-7a1f7a88ebda)
THEN
DB_NOOP(1);

QRY
QRY_DEN_Thiefling_ShouldIgnorePlayer()
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_Guards_InvestigationRelocationPos((CHARACTER)_Guard, (CHARACTER)_Caller)
AND
_Guard == S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925
AND
DB_DEN_Thieflings_HideoutKids(_Caller)
THEN
DB_QRYRTN_CRIME_Guards_InvestigationRelocationPos(_Guard, (TRIGGER)S_DEN_Thieflings_LeaderHideoutPoint_03_81640fc3-8c81-4b10-9b7f-fd178ec45c88);

PROC
PROC_DisappearOutOfSightTo((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925,(TRIGGER)S_DEN_Thieflings_LeaderHideoutPoint_03_81640fc3-8c81-4b10-9b7f-fd178ec45c88,"Run",1,"CRIME_Guards_Relocated")
THEN
PROC_ClearStoryMove(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
PROC_CancelDisappearOutOfSight(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
CharacterMoveTo(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, S_DEN_Thieflings_LeaderHideoutPoint_03_81640fc3-8c81-4b10-9b7f-fd178ec45c88, "Run", "CRIME_Guards_Relocated", 0);
//END_REGION

//REGION Grunting Kid
//Remove kid from dialog, send into hideout entrance
IF
FlagSet(DEN_GruntingKid_Event_DisappearIntoWall_3c2644fa-05e4-c922-3949-69f3596760a8,_Player, _Id)
AND
DialogRemoveActorFromDialog(_Id, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,_)
THEN
PROC_ForceStopDialog(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
PROC_CharacterMoveTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,S_DEN_GruntingKidHatch_Target_d4a35eb8-4205-4235-8379-8c027cb97394,"Run","DEN_GruntingKid_TryEnterHideout");
ClearFlag(DEN_GruntingKid_Event_DisappearIntoWall_3c2644fa-05e4-c922-3949-69f3596760a8, _Player, _Id);
DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

IF
EntityEvent((CHARACTER)S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, "DEN_GruntingKid_TryEnterHideout")
THEN
TeleportTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingKid_Ladder_Target_492744e3-00a1-4463-9bd1-0ef8954912c9, "DEN_GruntingKid_EnterHideout", 0, 0, 1);
SetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

//move kid out of hideout on a long rest
PROC
PROC_LongRest_InLevel("WLD_Main_A")
AND
QRY_DEN_CheckPeaceState()
AND
GetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 1)
THEN
TeleportTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingKidHatch_Target_d4a35eb8-4205-4235-8379-8c027cb97394, "", 0, 0, 1);
ClearFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 0);
NOT DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

PROC
PROC_DEN_AllPlayersLeftDen()
AND
GetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 1)
AND
QRY_DEN_CheckPeaceState()
THEN
TeleportTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingKidHatch_Target_d4a35eb8-4205-4235-8379-8c027cb97394, "", 0, 0, 1);
ClearFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 0);
NOT DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

IF
FlagSet(DEN_HarpyMeal_Event_KidReturnHideout_8180a3b3-8db8-c60f-4df9-e8b95adb14f4,NULL_00000000-0000-0000-0000-000000000000,_)
AND
GetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 1)
THEN
PROC_CharacterMoveTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,S_DEN_GruntingKid_Ladder_Target_492744e3-00a1-4463-9bd1-0ef8954912c9,"Run","DEN_GruntingKid_TryLeaveHideout");

IF
FlagSet(DEN_Thieflings_Event_HideoutCallForHelp_d653abaf-f717-344e-5b04-cc7853ee3ba8, NULL_00000000-0000-0000-0000-000000000000, _)
THEN
PROC_DEN_GruntingKid_Abandon();

PROC
PROC_DEN_GruntingKid_Abandon()
AND
GetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, 1)
THEN
PROC_CharacterMoveTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,S_DEN_GruntingKid_Ladder_Target_492744e3-00a1-4463-9bd1-0ef8954912c9,"Run","DEN_GruntingKid_TryLeaveHideout");
ClearFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
NOT DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

PROC
PROC_DEN_GruntingKid_Abandon()
THEN
PROC_ForceStopDialog(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
ClearFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
NOT DB_DEN_Thieflings_HideoutKids(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

IF
EntityEvent(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, "DEN_GruntingKid_TryLeaveHideout")
THEN
ClearFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85, S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
TeleportTo(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingKidHatch_Target_d4a35eb8-4205-4235-8379-8c027cb97394, "", 0, 0, 1);

IF
UseStarted(_Player, S_DEN_GruntingKid_HatchPullRope_f37ea684-1179-4a62-a79e-c0df1d9d25e7)
AND
DB_Players(_Player)
THEN
SetFlag(DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
Unlocked(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1,_,_)
THEN
SetFlag(DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc, _, _)
THEN
SetFlag(DEN_GruntingKid_State_NoticedDoor_5e0abedc-87d2-230d-2b3b-748a8d1e9399, NULL_00000000-0000-0000-0000-000000000000, 0);
Unlock(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1);
SetCanInteract(S_DEN_GruntingKid_HatchPullRope_f37ea684-1179-4a62-a79e-c0df1d9d25e7, 0);
PROC_Foop(S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449);
SetVisible(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, 1);

IF
DB_GlobalFlag((FLAG)DEN_GruntingKid_State_NoticedDoor_5e0abedc-87d2-230d-2b3b-748a8d1e9399)//TODO: replace with new hatch asset and do swap as needed
AND
NOT DB_GlobalFlag((FLAG)DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc)
THEN
PROC_GlobalSetFlagAndCache((FLAG)DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc);

IF
UseStarted(_Player, S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_Players(_Player)
AND
IsInvisible(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, 0)
THEN
SetVisible(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, 1);
Unlock(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1);

QRY
QRY_SelectCustomDialog(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,_Char)
AND
DB_Dialogs(S_DEN_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, DEN_General_GruntingKid_37a3539d-3d6a-111b-8a76-283e6915248f)
AND
GetFlag(DEN_GruntingKid_State_InHideout_f90cdb76-bb4f-bf03-e1f1-4a228799ce85,S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,1)
THEN
DB_SelectedDialog(DEN_General_GruntingKid_Hideout_31f2c9e2-0fd7-9583-6a12-c531a58dff71,S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0,_Char);
//END_REGION

//REGION Stolen Goods Handling
IF
DB_DEN_Thieflings_StolenItems(_, _, _)
AND
NOT DB_GlobalFlag((FLAG)DEN_Thieflings_State_HoldingStolenGoods_b21939d8-362b-cafc-91ee-ad2fa26df511)
AND
NOT DB_GlobalFlag(DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18)
THEN
SetFlag((FLAG)DEN_Thieflings_State_HoldingStolenGoods_b21939d8-362b-cafc-91ee-ad2fa26df511, NULL_00000000-0000-0000-0000-000000000000, 0);

//Stolen Items tracking for extortion amount

PROC
PROC_DEN_Thieflings_TallyStolenTotalValue()
AND
DB_DEN_Thieflings_TalliedStealable((ITEM)_Item, _Value)
AND
DB_DEN_Thieflings_TotalValueOfStolenGoods(20)
AND
IntegerSum(0, _Value, _NewValue)
THEN
NOT DB_DEN_Thieflings_TotalValueOfStolenGoods(20);
DB_DEN_Thieflings_TotalValueOfStolenGoods(_NewValue);
NOT DB_DEN_Thieflings_TalliedStealable(_Item, _Value);

PROC
PROC_DEN_Thieflings_TallyStolenTotalValue()
AND
DB_DEN_Thieflings_TalliedStealable((ITEM)_Item, _Value)
AND
DB_DEN_Thieflings_TotalValueOfStolenGoods(_OldValue)
AND
IntegerSum(_OldValue, _Value, _NewValue)
THEN
NOT DB_DEN_Thieflings_TotalValueOfStolenGoods(_OldValue);
DB_DEN_Thieflings_TotalValueOfStolenGoods(_NewValue);
NOT DB_DEN_Thieflings_TalliedStealable(_Item, _Value);

IF
FlagCleared((FLAG)DEN_Thieflings_CarryingStolenItem_fa3c6306-8f42-49c6-9289-ef615670d65c, S_DEN_Pickpocket_540ddc1f-42c6-4347-ba03-b3cf3d3942ab, _)
AND
DB_DEN_Thieflings_TotalValueOfStolenGoods(_Value)
THEN
NOT DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db, 20);
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db, _Value);

IF
FlagSet((FLAG)DEN_Hideout_Event_PriceRaised_777af447-2072-a681-e541-d7269ebfdb46, _, _)
AND
DB_DEN_Thieflings_TotalValueOfStolenGoods(_OldValue)
AND
IntegerSum(_OldValue, 20, _NewValue)
THEN
NOT DB_DEN_Thieflings_TotalValueOfStolenGoods(_OldValue);
DB_DEN_Thieflings_TotalValueOfStolenGoods(_NewValue);
DB_DialogMoneyTransfer(2, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db, _NewValue);

//Stolen goods re-stolen by party
IF
CharacterStoleItem((CHARACTER)_Player, _Item, _, _, _, _, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (ITEM)S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, _, _)
AND
DB_PartyMembers(_Player)
AND
DB_DEN_Thieflings_LooseStash(_Item)
AND
DB_DEN_Thieflings_StolenItems((CHARACTER)_Entity, _Item, _Value)
AND
IsInInventoryOf(_Item, _Player, 1)
THEN
PROC_GLO_Backgrounds_CheckThieflingsStashGoal(_Player);
SetFlag((FLAG)DEN_Thieflings_State_StolenGoodsTamperedWith_63f06ca0-b207-bb74-9b95-b86636e65509);
NOT DB_DEN_Thieflings_LooseStash(_Item);
NOT DB_DEN_Thieflings_StolenItems(_Entity, _Item, _Value);

//Give players bag of goods
IF
FlagSet(DEN_Thieflings_Event_ReturnStolenGoods_7a5a798d-604d-9e91-aaaa-5323b53aa320, _, _)
AND
NOT DB_DEN_Thieflings_StolenItems(_, _, _)
THEN
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)NULL_00000000-0000-0000-0000-000000000000, (ITEM)NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_Thieflings_Event_ReturnStolenGoods_7a5a798d-604d-9e91-aaaa-5323b53aa320, _, _)
AND
DB_DEN_Thieflings_StolenItems(_Thief, _Item, _Gold)
THEN
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold);

//sort through items in the stash and return only the player's stolen items
PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
IsInInventoryOf(_Item, S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, 0)
THEN
SetFlag((FLAG)DEN_Thieflings_State_StolenGoodsTamperedWith_63f06ca0-b207-bb74-9b95-b86636e65509, NULL_00000000-0000-0000-0000-000000000000, 0);
NOT DB_DEN_Thieflings_StolenItems(_Thief, _Item, _Gold);

PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
GetGold((ITEM)S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, _tempGold)
AND
_tempGold < _Gold
THEN
SetFlag((FLAG)DEN_Thieflings_State_StolenGoodsTamperedWith_63f06ca0-b207-bb74-9b95-b86636e65509, NULL_00000000-0000-0000-0000-000000000000, 0);
NOT DB_DEN_Thieflings_StolenItems(_Thief, _Item, _Gold);

PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
IsInInventoryOf(_Item, ITEMGUID_S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, 1)
AND
_Item!=NULL_00000000-0000-0000-0000-000000000000
THEN
ToInventory((ITEM)_Item, (ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, 1, 0, 0);
NOT DB_DEN_Thieflings_StolenItems(_Thief, _Item, _Gold);

PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
GetGold((ITEM)S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, _tempGold)
AND
_Item==NULL_00000000-0000-0000-0000-000000000000
AND
_Gold!=0
AND
_tempGold >= _Gold
AND
IntegerProduct(-1, _Gold, _AntiGold)
THEN
AddGold((ITEM)S_DEN_HideoutKidStash_6a957f96-e910-4a3b-ad12-03359775c4b8, _AntiGold);
AddGold((ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, _Gold);
NOT DB_DEN_Thieflings_StolenItems(_Thief, _Item, _Gold);

PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
DB_GlobalFlag(DEN_Thieflings_State_StolenGoodsTamperedWith_63f06ca0-b207-bb74-9b95-b86636e65509)
THEN
PROC_ToInventoryAndOnStage((ITEM)S_DEN_Thieflings_MolNote_4702ee45-1876-4fe0-9d6a-81c66e4bab7b,(ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, 1, 0, 0);

//add gold to the returned goods bag if the player paid for return after already getting their goods back
PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
DB_GlobalFlag(DEN_Thieflings_State_StolenGoodsTamperedWith_63f06ca0-b207-bb74-9b95-b86636e65509)
AND
DB_GlobalFlag(DEN_Thieflings_Event_PaidForReturn_69559f4b-6b3d-dc1b-bd17-33112e289f66)
THEN
AddGold((ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, 50);

PROC
PROC_DEN_Thieflings_GivePlayerGoodsBag((CHARACTER)_Thief, (ITEM)_Item, (INTEGER)_Gold)
AND
QRY_IsEmptyDB("DB_DEN_Thieflings_StolenItems", 3)
AND
DB_DialogNPCs(_Id,S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925,_)
AND
DB_DialogPlayers(_Id,_Player,1)
THEN
PROC_ToInventoryAndOnStage((ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, (CHARACTER)_Player, 1, 0, 0);
ClearOwnership((ITEM)S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b);
ClearFlag((FLAG)DEN_Thieflings_State_HoldingStolenGoods_b21939d8-362b-cafc-91ee-ad2fa26df511, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
AddedTo(S_DEN_StolenGoodsBag_06b3d3ec-5cda-4384-bebd-0fe66008dd3b, (CHARACTER)_Player, _)
AND
DB_Players(_Player)
AND
QuestUpdateIsUnlocked(_Player, "DEN_Thieflings", "DoneTookGoods", 0)
THEN
QuestUpdate(_Player, "DEN_Thieflings", "DoneTookGoods");
//END_REGION

//REGION Abandon Hideout
//Halt Countdown if perp left
IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_ThieflingSmallExit_de898878-dbd1-4616-b6af-74cf06ccae32)
AND
DB_DEN_SpottedPlayerTrespassers(_Player)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
NOT DB_DEN_SpottedPlayerTrespassers(_Player);

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_ThieflingSmallExit_de898878-dbd1-4616-b6af-74cf06ccae32)
AND
DB_Players(_Player)
AND
NOT DB_DEN_SpottedPlayerTrespassers(_)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
PROC_ForceStopDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_Dialogs(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db);
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
ClearFlag(DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a);
ClearFlag(DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87);
ClearFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310);
ClearFlag(DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd);
PROC_DEN_ThieflingHideout_ClearSetCountdownFlags();

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_DEN_SpottedPlayerTrespassers(_Player)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
NOT DB_DEN_SpottedPlayerTrespassers(_Player);

IF
UseStarted((CHARACTER)_Player, (ITEM)S_DEN_GruntingKid_Ladder_8bc74024-f380-4fb4-8c1d-17ecf31a1449)
AND
DB_Players(_Player)
AND
NOT DB_DEN_SpottedPlayerTrespassers(_)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
PROC_ForceStopDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_Dialogs(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db);
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
ClearFlag(DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a);
ClearFlag(DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87);
ClearFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310);
ClearFlag(DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd);
PROC_DEN_ThieflingHideout_ClearSetCountdownFlags();

//Continue/Commence Countdown as ADs
IF
DialogEnded((DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db, _ID)
AND
DB_DialogSpeakers(_ID, _Player, 2)
AND
DB_DEN_Thieflings_WaitingCrimeRegistered((CHARACTER)_Player, (INTEGER)_CrimeID)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a)
THEN
CharacterStopCrimeWithID(_Player, _CrimeID);
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 0);
PROC_TryStartAD((DIALOGRESOURCE)DEN_Thieflings_AD_HideoutTrespass_ced07a44-4432-80c0-7394-b587e02d9d2e, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

IF
FlagSet((FLAG)DEN_Thieflings_Event_CountdownFinished_f1fe5d3f-69cb-d5d6-8fab-9181ccd2db7d, _, _)
AND
SysCount("DB_DEN_SpottedPlayerTrespassers", 1, _Count)
AND
_Count > 0
THEN
PROC_GlobalSetFlagAndCache((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18);

IF
FlagSet(_CountdownFlag, _, _)
AND
DB_DEN_Thieflings_CountdownFlags(_CountdownFlag)
AND
NOT DB_DEN_SpottedPlayerTrespassers(_)
THEN
PROC_ForceStopDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_TrespassTrigger((TRIGGER)S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144,NULL_00000000-0000-0000-0000-000000000000,"DEN_ThieflingHideoutTrespass", (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
ClearFlag(DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a);
ClearFlag(DEN_Thieflings_State_CanTrespassInHideout_55848ceb-564b-1831-e1ff-4c62808dcb87);
ClearFlag((FLAG)DEN_Hideout_State_GivenWarning_0abd66e5-6337-025e-6def-a5d456e5e310);
ClearFlag(DEN_Hideout_State_IgnoreTrespassTemporarily_34fca249-1ac2-45bf-829d-d212087813bd);
DB_Dialogs(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (DIALOGRESOURCE)DEN_Thieflings_HideoutKid_001_3bca0fee-d45c-a95f-2c45-200cb8c1f0db);
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
PROC_DEN_ThieflingHideout_ClearSetCountdownFlags();

IF
AutomatedDialogEnded((DIALOGRESOURCE)DEN_Thieflings_AD_HideoutTrespass_ced07a44-4432-80c0-7394-b587e02d9d2e, _)
AND
DB_GlobalFlag((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18)
THEN
ClearFlag((FLAG)DEN_Hideout_Event_LeaveCountdown_e51c07b5-b27b-0614-c38e-feebb0d28f2a);
SetFlag((FLAG)DEN_Thieflings_Event_Abandoning_883a6c02-9091-4b29-8bc3-99e070e3648b, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
PROC_DEN_Thieflings_CollectTreasures();

IF
AutomatedDialogEnded((DIALOGRESOURCE)DEN_Thieflings_AD_HideoutTrespass_ced07a44-4432-80c0-7394-b587e02d9d2e, _)
AND
DB_DEN_Thieflings_Hideout_CaveGuards((CHARACTER)_Guard)
THEN
DB_NOOP(1);

IF
FlagSet((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18, _, _)
AND
GetFlag((FLAG)DEN_Hideout_State_HostileThroughDialog_9e25b5c4-c818-0160-75cb-82f7640b37b3, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1)
THEN
SetFlag((FLAG)DEN_Thieflings_Event_Abandoning_883a6c02-9091-4b29-8bc3-99e070e3648b, S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

//Commence stolen item collection
IF
AutomatedDialogRequestFailed((DIALOGRESOURCE)DEN_Thieflings_AD_HideoutTrespass_ced07a44-4432-80c0-7394-b587e02d9d2e, _)
AND
SysCount("DB_DEN_SpottedPlayerTrespassers", 1, _Count)
AND
_Count > 0
THEN
PROC_DEN_Thieflings_CollectTreasures();

IF
FlagSet((FLAG)DEN_Hideout_Event_TurnedKidsHostile_17cfabeb-f1d7-9432-0e29-5aecfcef1a18, _, _)
AND
SysCount("DB_DEN_SpottedPlayerTrespassers", 1, _Count)
AND
_Count > 0
THEN
PROC_DEN_Thieflings_CollectTreasures();
PROC_DEN_ThieflingHideout_GiveKidItem();

PROC
PROC_DEN_Thieflings_CollectTreasures()
AND
DB_DEN_SpottedPlayerTrespassers((CHARACTER)_Player)
THEN
PROC_CharacterRegisterCrime(_Player, "DEN_HideoutKidAlarm", NULL_00000000-0000-0000-0000-000000000000, _Player, 0);


PROC
PROC_DEN_Thieflings_CollectTreasures()
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
GetHandlingCrimeID((CHARACTER)_Child, _CrimeID)
THEN
PROC_CRIME_StopForAllCriminals(_CrimeID);

PROC
PROC_DEN_Thieflings_CollectTreasures()
AND
DB_DEN_Thieflings_HideoutKids(_Child)
AND
_Child != S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0
AND
GetFlag((FLAG)DEN_Thieflings_State_AtHideoutPoint_5f768dc1-8294-49ee-b2d2-964fcb22f5ff, _Child, 1)
THEN
PROC_CharacterMoveTo((CHARACTER)_Child, S_DEN_Hideout_StashArea_11d74325-2323-4f77-8be8-24a9054a3573, "Run", "DEN_Thieflings_EmptyStash");
BlockNewCrimeReactions((CHARACTER)_Child,1);
PROC_TryStopDialogFor((CHARACTER)_Child);
SetHasDialog((CHARACTER)_Child, 0);
DB_DEN_ThieflingHideout_KidsForItems((CHARACTER)_Child);

PROC
PROC_DEN_ThieflingHideout_GiveKidItem()
AND
DB_DEN_ThieflingHideout_KidsForItems((CHARACTER)_Child)
AND
DB_DEN_Thieflings_LooseStash((ITEM)_Item)
THEN
ClearOwnership(_Item);
ToInventory(_Item, _Child);
NOT DB_DEN_ThieflingHideout_KidsForItems(_Child);
SetFlag((FLAG)DEN_Thieflings_Event_Abandoning_883a6c02-9091-4b29-8bc3-99e070e3648b, _Child);
SetEntityEvent(_Child, "DEN_Thieflings_AbandonedHideout", 1);

//Reset the Countdown if Perps left before end
PROC
PROC_DEN_ThieflingHideout_ClearSetCountdownFlags()
AND
DB_DEN_Thieflings_CountdownFlags((FLAG)_Flag)
AND
DB_GlobalFlag(_Flag)
THEN
ClearFlag(_Flag);

IF
FlagSet((FLAG)DEN_Thieflings_Event_HideoutTrespassCrimeResolved_8778b66b-4219-878c-42ac-94b5656bf450, _, _)
AND
DB_PartOfTheTeam(_Character)
THEN
CharacterStopCrime(_Character, "DEN_HideoutKidAlarm", NULL_00000000-0000-0000-0000-000000000000);

//END_REGION

//REGION Befriended state management
IF
FlagSet(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, NULL_00000000-0000-0000-0000-000000000000,_)
AND
NOT DB_GlobalFlag(DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7)
THEN
SetFlag(DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7,NULL_00000000-0000-0000-0000-000000000000);
//END_REGION

//REGION Attack On Den State
PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _State)
AND
NOT DB_DEN_DefaultStates(_State)
THEN
PROC_DEN_Thieflings_DeactivateHideout();

PROC
PROC_DEN_Thieflings_DeactivateHideout()
THEN
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);

PROC
PROC_DEN_Thieflings_DeactivateHideout()
AND
DB_DEN_Thieflings_HideoutKids(_Kid)
THEN
SetHasDialog(_Kid, 1);
PROC_CharacterDisableCrime((CHARACTER)_Kid,"DEN_ThieflingHideoutTrespass_Guard");

PROC
PROC_DEN_Thieflings_DeactivateHideout()
THEN
SetHasDialog(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
PROC_RemoveDBTrespassTrigger(S_DEN_Thieflings_HideoutCrimeRegion_5e96478b-d5df-41d3-a20e-4ae522f75144, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
//END_REGION

//REGION Jounral Updates
PROC
PROC_LevelLoadedOnce("SCL_Main_A")
AND
DB_Players(_Player)
AND
QuestIsClosed("DEN_Thieflings",0)
THEN
QuestUpdate(_Player, "DEN_Thieflings", "DoneLeftAct");

IF
EnteredTrigger(_Player, S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("DEN_Thieflings_EnteredHideoutFirstTime")
THEN
QuestUpdate(_Player, "DEN_Thieflings", "EnteredHideout");

IF
FlagSet(DEN_Hideout_Event_BefriendedThieflings_a1a932ee-f66a-08af-4bf0-bf77790052f7,_,_)
AND
DB_Players(_Player)
THEN
QuestUpdate(_Player, "HIDDEN_WLD_Boosters", "DEN_Thieflings_BefriendedMol");

//END_REGION

//REGION Stop crimes

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _State)
AND
NOT DB_DEN_DefaultStates(_State)
THEN
PROC_DEN_Thieflings_StopAllCrimesOnTransition();

PROC
PROC_DEN_Thieflings_StopAllCrimesOnTransition()
AND
DB_DEN_Thieflings_HideoutKids(_Kid)
THEN
CharacterStopCrime(_Kid, "DEN_WaitForMol", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_DEN_Thieflings_StopAllCrimesOnTransition()
THEN
SetFlag(DEN_Thieflings_Event_HideoutTrespassCrimeResolved_8778b66b-4219-878c-42ac-94b5656bf450, NULL_00000000-0000-0000-0000-000000000000, 0);

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act1"
