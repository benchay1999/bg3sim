Version 1
SubGoalCombiner SGC_AND
INITSECTION
SetFlag(GLO_Volo_State_AtDen_c1bb44ab-c358-46d1-a261-34356bf1d071, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_VoloSignBook((ITEMROOT)BOOK_Book_A_VoloGBG_49871a48-7f07-4310-84ef-e890983ea5c3,(ITEMROOT)BOOK_Book_A_VoloGBG_Signed_A_88b9f7e6-afc6-4e86-a31b-41e8dc5dfd1a);
DB_VoloSignBook((ITEMROOT)BOOK_Book_B_VoloCGBN_f5eb9707-169e-47ce-bb3d-5d25d6fa8aa6,(ITEMROOT)BOOK_Book_B_VoloCGBN_Signed_A_8c5f1f1a-1bd5-408f-a072-cd7c8991dd39);
DB_VoloSignBook((ITEMROOT)BOOK_Book_F_VoloGSS_14d9b664-b4e4-4e22-a83f-7fafd09f61f5,(ITEMROOT)BOOK_Book_F_VoloGSS_Signed_A_79c95480-dfc6-4b1e-953a-b269fb609c80);
DB_Dialogs(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa,DEN_VoloTravel_942e99d5-07ca-d6ed-3376-a30be6d22b54);

DB_GLO_CharacterCorpseDialog(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa,DEN_Volo_Dead_4329ba80-3504-e1dd-9f1e-25a2ea07cc93);
SetHasDialog(S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, 1);
KBSECTION
//REGION Quest
IF
FlagSet(GLO_Volo_State_PermaDefeated_90bacc1d-9755-4e24-adc3-9016698a7be6,NULL_00000000-0000-0000-0000-000000000000,0)
AND
DB_Players(_Char)
THEN
QuestUpdate(_Char,"DEN_VoloAdventure","VoloDead");

//Reached point of no return in Act 2
IF
FlagSet((FLAG)Act2_PointOfNoReturnReached_a3155f30-b8f3-4db5-ac21-d3036f4426e3,_,_)
AND
DB_Players(_Char)
AND
DB_QuestIsOpened("DEN_VoloAdventure")
THEN
PROC_DEN_VoloAdventure_UpdateLeft();

PROC
PROC_DEN_VoloAdventure_UpdateLeft()
AND
DB_GlobalFlag((FLAG)GOB_VoloBallad_State_VoloEscaped_13ae819f-b0b7-434d-9ebb-cee412b1a407)
THEN
// The quest is completed here in case players haven't talked to Volo after saving him in Act 1
QuestUpdate("DEN_VoloAdventure","VoloCamp");

PROC
PROC_DEN_VoloAdventure_UpdateLeft()
AND
NOT DB_GlobalFlag((FLAG)GOB_VoloBallad_State_VoloEscaped_13ae819f-b0b7-434d-9ebb-cee412b1a407)
THEN
QuestUpdate("DEN_VoloAdventure","NotSaved");

IF
DialogEnded((DIALOGRESOURCE)CAMP_VoloOperation_ba7c506d-c743-5dc9-7d98-eeea7b4ef2a2,_)
AND
DB_QuestIsOpened("DEN_VoloAdventure")
THEN
QuestUpdate("DEN_VoloAdventure","VoloCamp");
//END_REGION

IF
DB_GlobalFlag(GLO_Volo_HasMet_07ff1071-2535-f215-72d3-224e360af5f2)
AND
NOT DB_DEN_PlayerInDen(_)
AND
NOT DB_Defeated(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa)
AND
DB_GlobalFlag(GLO_Volo_State_AtDen_c1bb44ab-c358-46d1-a261-34356bf1d071)
THEN
SetOnStage(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa,0);
SetEntityEvent(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa,"DEN_NPC_LeftDen",1);

IF
EntityEvent(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa,"DEN_VoloLeft")
AND
DB_GlobalFlag(GLO_Volo_State_AtDen_c1bb44ab-c358-46d1-a261-34356bf1d071)
THEN
ClearFlag(GLO_Volo_State_AtDen_c1bb44ab-c358-46d1-a261-34356bf1d071, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_VoloSignBook(_Unsigned,_Signed)
THEN
DB_PlayerHasTemplateItem(_Unsigned,GLO_Volo_HasBook_5eb37dc3-96b4-41f5-a088-db1532bd3b8a);

IF
FlagSet(GLO_Volo_BookSigned_6f8b4dae-903d-44b5-b274-bac3f5346430, _Char, _)
AND
DB_VoloSignBook(_Unsigned,_Signed)
AND
QRY_ItemTemplateInMagicPockets((CHARACTER)_Char,_Unsigned)
THEN
TemplateRemoveFrom(_Unsigned,_Char,1);
TemplateAddTo(_Signed,_Char,1,1);
ClearFlag(GLO_Volo_BookSigned_6f8b4dae-903d-44b5-b274-bac3f5346430, _Char);

IF
FlagSet(GLO_Volo_GiveGSS_9ec63bb2-9e9b-4ab6-8986-2111ddd45c39, _Char, _)
AND
GetInventoryOwner(S_DEN_VoloGSS_30bf3988-8704-4e0d-88ec-be1eb6dd31c2,S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa)
THEN
RequestDelete(S_DEN_VoloGSS_30bf3988-8704-4e0d-88ec-be1eb6dd31c2);
TemplateAddTo(BOOK_Book_F_VoloGSS_Signed_A_79c95480-dfc6-4b1e-953a-b269fb609c80,_Char,1,1);
ClearFlag(GLO_Volo_GiveGSS_9ec63bb2-9e9b-4ab6-8986-2111ddd45c39, _Char);

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)DEN_VoloTravel_942e99d5-07ca-d6ed-3376-a30be6d22b54,(INTEGER)_ID)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a,S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa)
THEN
PROC_DialogAddSpeakingActor(_ID,S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a);

//VoloBear
QRY
QRY_SelectCustomDialog(S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, _Player)
AND
DB_GlobalFlag(GLO_Volo_State_AtDen_c1bb44ab-c358-46d1-a261-34356bf1d071)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa, S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a)
AND
NOT DB_GlobalFlag(DEN_DruidAttack_State_DruidSetup_96fc1420-fa07-4235-98c3-ecb34fcb6b0a)
AND
QRY_StartDialog_Fixed(DEN_VoloTravel_Bear_df897d41-901f-7865-31cf-4ff6ba89555b, S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, _Player, S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa)
THEN
DB_NOOP(1);

//If Volo is not available
QRY
QRY_SelectCustomDialog(S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, _Player)
AND
NOT DB_GlobalFlag(DEN_DruidAttack_State_DruidSetup_96fc1420-fa07-4235-98c3-ecb34fcb6b0a)
AND
QRY_StartDialog_Fixed(DEN_VoloTravel_Bear_df897d41-901f-7865-31cf-4ff6ba89555b, S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, _Player, NULL_00000000-0000-0000-0000-000000000000)
THEN
DB_NOOP(1);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act1"
