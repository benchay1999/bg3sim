Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_InRegionFlag(S_CRE_Creche_TopFloor_SUB_01f823fe-7363-4f8a-bea3-31755b318738, (FLAG)GLO_GithCreche_State_EverEnteredBefore_3ebdfeaa-4e83-4878-90db-01adb9fdf629);

//REGION One line dialogs
DB_Dialogs((CHARACTER)S_CRE_CrecheGuard01_5a5c5878-fd9f-41c0-9c8c-b74cea0e3fd9, (DIALOGRESOURCE)CRE_CrecheGuard01_5c37235c-70fc-9746-fe18-7a20d98a8e21);
DB_Dialogs((CHARACTER)S_CRE_CrecheGuard02_99439816-fcaa-4167-a20a-8f3dfff4e345, (DIALOGRESOURCE)CRE_CrecheGuard02_073fed4f-16c2-6ea8-5344-6b2d7f0aa0b3);
DB_Dialogs((CHARACTER)S_CRE_CrecheGuard04_d55e65a4-0663-46e5-8213-4ae5dd410e06, (DIALOGRESOURCE)CRE_CrecheGuard04_1010c686-4891-c61b-c196-30ebc4d030cf);
DB_Dialogs((CHARACTER)S_CRE_CrecheGuard05_00135309-731d-4782-bd43-c8b54cacec16, (DIALOGRESOURCE)CRE_CrecheGuard05_91ec8fa4-4373-699e-d053-6803b5c39d57);
DB_Dialogs((CHARACTER)S_CRE_CrecheTeenager01_8a7b36f5-378c-4a71-a593-e00ea01ab6ff, (DIALOGRESOURCE)CRE_CrecheTeenager01_439fd51a-4432-7c7a-da67-95d7d660a1f0);
DB_Dialogs((CHARACTER)S_CRE_CrecheTeenager02_c67ff924-036b-4259-8acc-9fc013fe2059, (DIALOGRESOURCE)CRE_CrecheTeenager02_7cb5d715-4070-c970-79d6-526fb793b553);
DB_Dialogs((CHARACTER)S_CRE_CrecheKid01_81845208-9721-4c58-8546-84f958a85d57, (DIALOGRESOURCE)CRE_CrecheKid01_dad26f1e-74a5-10f6-7129-068c8995e59e);
DB_Dialogs((CHARACTER)S_CRE_CrecheKid02_5d33ac06-faa7-48c3-8794-6cff79515ce5, (DIALOGRESOURCE)CRE_CrecheKid02_07bdc65f-6560-0c0a-ac9b-ec16b699fed6);
DB_Dialogs((CHARACTER)S_CRE_CrecheKid03_ba10db62-da84-4c7e-8867-0a98be775aa9, (DIALOGRESOURCE)CRE_CrecheKid03_38a05937-c75f-64c8-ecb6-b5b28b532d0c);
DB_Dialogs((CHARACTER)S_CRE_CrecheKid04_139392d5-d068-4445-b5a4-42ef9340b1b7, (DIALOGRESOURCE)CRE_CrecheKid04_48bf81fe-10db-6b24-3e99-59a835950015);
DB_Dialogs((CHARACTER)S_CRE_InfirmaryAmbushGuard01_2c0b5b3b-5e48-48e6-b10f-08a910ad07f5, (DIALOGRESOURCE)CRE_InfirmaryAmbushGuard01_e65d4547-6c1d-fbc2-e09b-cfca50413537);
DB_Dialogs((CHARACTER)S_CRE_InfirmaryAmbushGuard02_ecb4222c-22b9-49d6-88ed-62b5cba281fc, (DIALOGRESOURCE)CRE_InfirmaryAmbushGuard02_f2261932-32f2-e16c-6dec-ba9fb1f115fa);
DB_Dialogs((CHARACTER)S_CRE_InfirmaryAmbushGuard03_8f599eca-cf21-42d2-a9f8-56e92aa8624c, (DIALOGRESOURCE)CRE_InfirmaryAmbushGuard03_bc5cca90-6afc-f707-0f3a-32c1c69dfb22);
DB_Dialogs((CHARACTER)S_CRE_InfirmaryAmbushGuard04_3efd4f36-05d3-4a30-80e8-59fd14215fd5, (DIALOGRESOURCE)CRE_InfirmaryAmbushGuard04_0919d578-b056-1df3-1551-91ae56764116);
DB_Dialogs((CHARACTER)S_CRE_SecurityOfficer01_64445697-2adc-4784-883e-392bae899892, (DIALOGRESOURCE)CRE_SecurityOfficer01_69bcef0f-1b21-ef54-bfd7-fb4b75da59e2);
DB_Dialogs((CHARACTER)S_CRE_SecurityOfficer02_475367c4-aace-4884-af66-16097e2d2119, (DIALOGRESOURCE)CRE_SecurityOfficer02_96c01b5a-3e2c-a2e1-c790-e8fa220eb935);
DB_Dialogs(S_CRE_IntelligenceOfficer01_c76d7d19-3d46-44e5-a914-80efc8cac4ea, (DIALOGRESOURCE)CRE_IntelligenceOfficer01_30295d00-e676-5d7b-4a09-40c69abf7799);
DB_Dialogs(S_CRE_IntelligenceOfficer02_a17c356a-6e0c-4d2f-bcf6-58195d6c9edf, (DIALOGRESOURCE)CRE_IntelligenceOfficer02_0b1c7944-b6cb-387b-d9f8-84fca7efaf6e);
DB_Dialogs(S_CRE_IntelligenceOfficer03_266e49a3-83f8-40aa-baff-5ffe2a1a35db, (DIALOGRESOURCE)CRE_IntelligenceOfficer03_7be66ab4-0109-bc6f-bd5e-7af7d8a01ee3);
DB_Dialogs(S_CRE_IntelligenceOfficer04_f51854ec-5dbc-4686-bb4a-b2f8b4c5341b, (DIALOGRESOURCE)CRE_IntelligenceOfficer04_3628abf0-6ec6-4fcc-fe03-10f041ee96d5);
DB_Dialogs((CHARACTER)S_CRE_Quartermistress_ffb0ec61-5739-4b34-8d27-e61b1f4500ad,(DIALOGRESOURCE)CRE_Quartermistress_5576e41f-bf21-beee-fe44-bf28aff10cb1);

//END_REGION

//REGION Vlaakith Portrait Booster
DB_Dialogs(S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, (DIALOGRESOURCE)CRE_PortraitKid_a4aae191-fa9e-71df-bb1b-291ecbe0dc34);

DB_Inclusion_NPCDialog((DIALOGRESOURCE)CRE_General_VlaakithPortrait_291a6ebd-da9a-3f80-0eba-1f9c61d66b88, (CHARACTER)S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64);
DB_Inclusion_Object(S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, (FLAG)CRE_General_PortraitKid_StartInclusion_3b504bb6-0fe0-4ea1-855a-ee54fd09cab8, (FLAG)CRE_General_PortraitKid_EndInclusion_a81aaa25-9d0b-47e0-b971-1f21993caecd);

DB_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_VlaakithPortraitRuined_680dfd25-1e5e-4214-b697-a692be1df84d, (DIALOGRESOURCE)CRE_General_VlaakithPortrait_291a6ebd-da9a-3f80-0eba-1f9c61d66b88);
DB_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_VlaakithPortraitPlayerFailed_83b64d2b-48b4-4af8-ae69-912a21117fc3, (DIALOGRESOURCE)CRE_General_VlaakithPortrait_291a6ebd-da9a-3f80-0eba-1f9c61d66b88);

PROC_SetOnStage((ITEM)S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef, 0);
PROC_SetOnStage((ITEM)S_CRE_VlaakithPortrait_Vandalised_Failed_8d37dc16-6930-4950-9287-f383590304b2, 0);

//SceneManager ensuring the portrait can't be vanadlised if removed from its intended position
DB_SceneManager((CHARACTER)NULL_00000000-0000-0000-0000-000000000000,"CRE_PortraitScene");
DB_SceneTriggerManager("CRE_PortraitScene",S_CRE_VlaakithPortrait_SceneBounds_e5719f4b-6026-4c14-abfd-abe9a965cb69, 0);
DB_SceneAllowAllDisturbances("CRE_PortraitScene");
//END_REGION

//REGION Mage Hand Booster
DB_CRE_GithKids(S_CRE_CrecheKid01_81845208-9721-4c58-8546-84f958a85d57);
DB_CRE_GithKids(S_CRE_CrecheKid02_5d33ac06-faa7-48c3-8794-6cff79515ce5);
DB_CRE_GithKids(S_CRE_CrecheKid03_ba10db62-da84-4c7e-8867-0a98be775aa9);
DB_CRE_GithKids(S_CRE_CrecheKid04_139392d5-d068-4445-b5a4-42ef9340b1b7);
DB_CRE_GithKids(S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);
DB_CRE_GithKids(S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695);

PROC_CRE_MageHand_SceneSetup();

DB_Dialogs((CHARACTER)S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f, S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, (DIALOGRESOURCE)CRE_General_MageHandMain_b4b752e9-d4e9-185b-44e4-365550ac4e99);
DB_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_MageHandKidsMoveAside_d9c41f69-6996-4366-a5d6-2aa2abac1f08, (DIALOGRESOURCE)CRE_General_MageHandMain_b4b752e9-d4e9-185b-44e4-365550ac4e99);
DB_CRE_MageHandGremishka(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d);

DB_CRE_GremishkaFactions((FACTION)Act1B_CRE_Gremishkas_d376a9f5-1c31-4aa3-b758-c217d9237cea);
DB_HasItemEvent((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, (FLAG)CRE_General_State_HasMageHandBox_bc0b2be2-f3e4-4b7a-947b-4bb1bff4adc0);

DB_FlagReactionAfterDialog((FLAG)CRE_MageHandGame_Event_PlayerJoinsGame_d37b8034-0a34-48d1-9ae0-39ddf4f064cf, (DIALOGRESOURCE)CRE_General_MageHandMain_b4b752e9-d4e9-185b-44e4-365550ac4e99);
DB_FlagReactionAfterDialog((FLAG)CRE_MageHandGame_State_PlayerAskedToPlay_c0c02d22-70cb-4490-aebc-efe79b01f0f1, (DIALOGRESOURCE)CRE_General_MageHandMain_b4b752e9-d4e9-185b-44e4-365550ac4e99);

DB_CRE_GithBoys_MageHands((CHARACTER)S_CRE_MageHand01_750cd0fb-42ec-4570-adc7-c4508dabadda);
DB_CRE_GithBoys_MageHands((CHARACTER)S_CRE_MageHand02_80c883bd-8116-4d33-afcb-9032e9421209);

DB_SceneManager((CHARACTER)S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f, "CRE_MageHandKids");
DB_SceneManager((CHARACTER)S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695, "CRE_MageHandKids");
DB_SceneManager((CHARACTER)S_CRE_MageHand01_750cd0fb-42ec-4570-adc7-c4508dabadda, "CRE_MageHandKids");
DB_SceneManager((CHARACTER)S_CRE_MageHand02_80c883bd-8116-4d33-afcb-9032e9421209, "CRE_MageHandKids");

DB_SceneAllowAllDisturbances("CRE_MageHandKids");
DB_CRE_MageHandKids_BlockDisturbance("StartedDialog");

DB_PermaDefeatedFlag(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, CRE_MageHandGame_State_GremishkaDefeated_54b31861-3330-4a21-b3cd-c5a43b823bbe);
//END_REGION

//REGION Teens on Corridor Booster
//TODO: implement a better handling of the two speakers
DB_Dialogs(S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326,(CHARACTER)S_CRE_CorridorTeenager01_a99624a6-4bff-4d1f-9de5-7b3cd89cc669,(DIALOGRESOURCE)CRE_General_CorridorTeenagers_16cf2b21-1dd3-333b-45f9-79e3d4e7d9b1);
DB_SpotPlayers(S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326, "CRE_CorridorTeens_SpottedPlayer", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
//END_REGION

//REGION Items you get attacked for trying to sell to a Gith
DB_CRE_ForbiddenToSellItems(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202);
DB_CRE_ForbiddenToSellItems(S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef);
DB_CRE_ForbiddenToSellItems(S_CRE_GithyankiEgg_999b6dd7-2901-4604-8280-1931a5217a94);

DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_GuardsMonastery_625e1224-c1aa-490e-bcc4-75931c8aeaf4);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_CaptainsQuarters_27e5030c-794e-4270-8ad0-de541d9311b6);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_PatrollingGuards_8ad3e1d9-70d1-4fc8-a3eb-3dad72f765c2);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_SecurityOffice_6a8d9c32-b2ba-49e6-9ce8-8cc745bc015e);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_SecuirtyOffice_Dismissed_15dd6417-255c-4305-846a-e98984d72371);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_Infirmary_9aac625d-9738-4e1d-8dfa-d53f50846e08);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_TrainingRoom_fad2dd03-8af3-4697-a06c-71c7add7ce10);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_TrainingRoom_GithBoy_5fe66d36-13ef-4b30-8fd0-f45d58677b36);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_MainCheckpoint_a51f68a3-e53a-4784-ba02-8d465b781646);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_HiddenCheckpoint_5a532d4a-4eb5-4969-8fc8-9c12bf956c06);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_Hatchery_fead05db-8b13-4083-8c94-db015a8b61b4);
DB_CRE_GithFactions((FACTION)Act1B_CRE_Gith_QuarterMistress_daff735f-f0a6-4dc2-9382-d0538f56f9c1);
//END_REGION

//REGION Hanging coal baskets
DB_GLO_FireBowls(S_CRE_Hanging_Bowls_A_Gold_000_f291a95d-ffb1-4dd5-96cc-ab0e1463eefe,S_CRE_Chandelier_Hinge_A_Gold_000_271bd290-3a06-4edb-8504-c38170ffabbe);
DB_GLO_FireBowls(S_CRE_Hanging_Bowls_A_Gold_001_21e1e62c-9c32-4af7-ba88-78dc451ea9cd,S_CRE_Chandelier_Hinge_A_Gold_001_527ef17d-1000-4e4e-98f9-3551ceac5e3f);
DB_GLO_FireBowls(LTS_DUN_Chandelier_C_Gold_000_ab82482a-f8e6-45d4-85b4-07971e57a3b0,LTS_DUN_Chandelier_Hinge_A_Gold_001_355e940d-3e16-41c0-8738-3432f40ce001);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_D_053_7ec3d95c-fbf9-4c84-8473-de41dae4bd11,LTS_DUN_Hanging_Bowls_Hinge_A_027_bee7c010-cf72-4dfe-b34a-de3fe81ff32c);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_C_009_e4a1c53a-b60a-46bc-861f-d5988434bf24,LTS_DUN_Hanging_Bowls_Hinge_A_016_14731c0c-69dd-4ce1-b57b-54f456a4cfb9);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_C_010_4bc3ec10-8c75-4871-b8cf-8cdfe9b98329,LTS_DUN_Hanging_Bowls_Hinge_A_018_7a21e424-7451-4f6a-bd73-cfb885ddeabe);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_C_012_95366551-2c80-440a-9812-964bb725902e,LTS_DUN_Hanging_Bowls_Hinge_A_022_29ad1672-d244-41c4-b35a-48593b10ce9a);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_D_052_87b4fd28-b835-4749-b44b-1d22409a5012,LTS_DUN_Hanging_Bowls_Hinge_A_026_1e04710f-a5fd-481e-95f6-d03eda244e0d);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_D_051_e2e0e7af-1cf1-4fc4-9a0c-48743f231443,LTS_DUN_Hanging_Bowls_Hinge_A_025_0c1ee892-0220-4850-a81b-27569d7a17cf);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_B_Gold_001_53343b1e-1818-42fc-b77c-06b042c8c068,LTS_DUN_Hanging_Bowls_Hinge_A_020_1cf3a659-f7bf-433e-9c2b-2a6b62e3d1b1);
DB_GLO_FireBowls(LTS_DUN_Hanging_Bowls_D_021_0909fa72-f8a6-4e21-9766-db0e59e8d32b,LTS_DUN_Hanging_Bowls_Hinge_A_001_49deab6a-c7be-425b-858f-57817abca32d);


//END_REGION

//REGION Leazel/GITH reactivity to seeing/interacting with things
//Gith skeleton on the roof
DB_CRE_LootableCharacterVBs((CHARACTER)S_CRE_Roof_GithyankiSkeleton_5530b1fa-468a-4207-864a-9bf51039d453, (VOICEBARKRESOURCE)CRE_Monastery_VB_GithSkeletonComment_0864aa6c-a5f0-d622-5a12-da0f6e05a447);
//Hatchery
DB_OneShot_VoiceBarkTrigger((TRIGGER)S_CRE_Hatchery_CommentArea_8e63e84c-18e7-429a-bfaf-b0917409377a, (VOICEBARKRESOURCE)CRE_Hatchery_VB_HatcheryComment_74693886-7199-38f1-bea3-325a6e2d4ddd);
//Bedroom
DB_OneShot_VoiceBarkTrigger((TRIGGER)S_CRE_Dormitory_CommentArea_e3ed83e5-6a89-4c81-9daa-e998d9b2d437, (VOICEBARKRESOURCE)CRE_General_VB_DormitoryComment_a77fc5ef-85a0-14c6-d2e2-ed0e3208e486);
//Infirmary science tools
DB_CRE_ClickableItemVBs((ITEM)S_CRE_ScienceTools_01_c06c6150-7a2a-4928-a250-c48628467a30, (VOICEBARKRESOURCE)CRE_Infirmary_VB_ScienceComment_5580b99a-8bd9-31db-2e84-53118a7e9158);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_ScienceTools_02_df24a584-93a9-4db5-a300-d780e28ec03b, (VOICEBARKRESOURCE)CRE_Infirmary_VB_ScienceComment_5580b99a-8bd9-31db-2e84-53118a7e9158);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_ScienceTools_03_ac3aa8f6-c73a-41d2-a3ed-ee930163f63f, (VOICEBARKRESOURCE)CRE_Infirmary_VB_ScienceComment_5580b99a-8bd9-31db-2e84-53118a7e9158);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_ScienceTools_04_0374d145-0cf3-486f-94c0-75081a7abeab, (VOICEBARKRESOURCE)CRE_Infirmary_VB_ScienceComment_5580b99a-8bd9-31db-2e84-53118a7e9158);
//Classroom diagrams
DB_OneShot_VoiceBarkTrigger((TRIGGER)S_CRE_AnatomyCommentArea_ef5a6b19-dd7a-416c-b581-b1060af28e68, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_AnatomicalSketchesComment_9fea9cc0-806f-3e73-f770-6d1454591f92);
//Classroom training dummies
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy01_d5196b1a-771f-4ad3-9d06-131ee45901e6, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy02_09e60f88-c484-4da8-976e-84c78ea9febb, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy03_5038da3a-e874-4e9a-9e28-733aef4bae3b, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy04_cc7ac9a2-3265-4d14-9f5c-0f49da8b0b1a, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy05_b3d0529b-e02e-4393-9028-2c5c05f4a992, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy06_0181f86f-71ca-429f-93d6-5b478aa290c1, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_ClickableItemVBs((ITEM)S_CRE_TrainingDummy07_16248d0a-5b76-4a02-9657-414d34a34b01, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
//Attackable training dummies
DB_CRE_AttackableItemVBs((ITEM)SS_CRE_Training_Dummy_Mindflayer_A_01_86da9e9f-027f-4bf1-b4e6-aeb17da3e36d, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
DB_CRE_AttackableItemVBs((ITEM)S_CRE_Training_Dummy_Mindflayer_A_02_f59c071d-a071-465b-9e74-523c99825fbf, (VOICEBARKRESOURCE)CRE_YouthTraining_VB_TrainingDummyComment_045d785a-5d7d-98d4-7760-4c9050d49244);
//Dormitory rules poster - Now handled as a separate case
//DB_CRE_ClickableItemVBs((ITEM)S_CRE_Dormitory_Schedules_126d9846-51f4-4622-b73f-826667ef9c71, (VOICEBARKRESOURCE)CRE_General_VB_RulesPoster_ea0aac7b-5662-061e-d5f1-2f9cf4531baa);
//Apple crate in hallway
DB_CRE_ClickableItemVBs((ITEM)S_CRE_AppleCrate_7324ba09-bd6e-498d-9dc5-d26017f112b5, (VOICEBARKRESOURCE)CRE_General_VB_FoodComment_8f543d51-6d48-b3b1-e14e-68b69b7ce35c);
//Captain's map
DB_CRE_ClickableItemVBs((ITEM)S_CRE_CaptainMap_a7e650b8-4546-497f-82e2-f87fda12db3c, (VOICEBARKRESOURCE)CRE_ChainOfCommand_VB_CaptainsMapComment_774470ac-c602-9f2e-ed71-12020a933008);
//END_REGION

//REGION Ownership trigger

DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_MainEntrance_13ceb6b3-8b28-48f8-b5e1-0ab649741181, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Corridor_01_f7a48821-45ab-47dd-aeff-c22046439103, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Infirmary_deb1957d-9440-4cb0-8fda-a99809a3efdb, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Corridor_03_05f577dd-52ff-4c2c-968b-c2eabe42ba25, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Hatchery_984792e0-2a7d-4aa5-b17b-4a60debeba61, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Dorm_05bcae88-4bb8-4fed-878c-bce3b3eb1caa, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_YouthTraining_6a33db5b-0623-4c92-a7f4-4339ba1b39cd, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_Corridor_04_da32059a-201d-4258-9ba1-bfbb0027f457, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_CaptainsOffice_fec80d38-f06d-463c-9903-7fd423247f6a, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
DB_ItemOwnerShipTriggers("CRE_Main_A", S_CRE_Ownership_SecOffice_e5646070-eaf3-475a-b999-0e6229bff0fd, S_CRE_Templar_378ac93e-03a0-40b4-904c-f37989ac7a8c);
//END_REGION

//REGION BattleStations
//Captains office
DB_CRE_BattleStations((CHARACTER)S_CRE_CrecheCaptain_5093da9b-237a-491f-9402-4f9da73c1565, (TRIGGER)S_CRE_BattleStation_CrecheCaptain_7cb34834-eb70-48f0-9960-707a51986dff);
DB_CRE_BattleStations((CHARACTER)S_CRE_CaptainsBeast01_82736dcd-8648-4795-a296-21aa1bcaf096, (TRIGGER)S_CRE_BattleStation_CaptainsBeast01_425834b1-a762-4fc6-ac47-401577686ac3);
DB_CRE_BattleStations((CHARACTER)S_CRE_CaptainsBeast02_fcd64862-67ba-4358-9636-09ff9545177a, (TRIGGER)S_CRE_BattleStation_CaptainsBeast02_1a9d771c-2f7c-40c3-ae32-e1879b3f16cc);
DB_CRE_BattleStations((CHARACTER)S_CRE_IntelligenceOfficer01_c76d7d19-3d46-44e5-a914-80efc8cac4ea, (TRIGGER)S_CRE_BattleStation_IntelligenceOfficer01_637b4858-bdd4-4bba-a9f6-19c2c2e58ae0);
//Corridor
DB_CRE_BattleStations(S_CRE_CaptainGuard_ea4643de-cc2c-42f0-949d-4968201ad2c7,S_CRE_BattleStation_CaptainGuard_8c14f682-e60a-4b78-8424-910c49470223);
DB_CRE_BattleStations(S_CRE_PatrollingGuard02_00135309-731d-4782-bd43-c8b54cacec16,S_CRE_BattleStation_PatrollingGuard02_b21a812c-644a-4911-a0d6-af7d88fdcc86);
DB_CRE_BattleStations(S_CRE_CorridorTeenager01_a99624a6-4bff-4d1f-9de5-7b3cd89cc669,S_CRE_BattleStation_CorridorTeenager01_49bbc9ea-d3f2-4803-9849-8441199ac3dd);
DB_CRE_BattleStations(S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326,S_CRE_BattleStation_CorridorTeenager02_d25580e7-7e1f-42cf-a74a-99fadfaae510);
DB_CRE_BattleStations(S_CRE_PatrollingGuard01_d55e65a4-0663-46e5-8213-4ae5dd410e06,S_CRE_BattleStation_PatrollingGuard01_3492f227-1e81-42bc-b791-cd3053214876);
DB_CRE_BattleStations(S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64,S_CRE_BattleStation_PortraitKid_13073edd-5c2d-43e3-8881-421ee7fe0fc3);
//Hidden entrance
DB_CRE_BattleStations(S_CRE_Quartermistress_ffb0ec61-5739-4b34-8d27-e61b1f4500ad, S_CRE_BattleStation_QuarterMistress_b2d268be-b76e-4149-9178-a3316de2c191);
DB_CRE_BattleStations(S_CRE_HiddenCheckpointWarningGuard_970d10ed-8092-463b-8446-223fe4cf2d68, S_CRE_BattleStation_HiddenCheckpointWarningGuard_2d00d622-4140-4280-99b6-e8cb6af9bbfc);
DB_CRE_BattleStations(S_CRE_HiddenCheckpointMainGuard_3bcbf8fb-5a90-4439-bd81-d9113d74f27e, S_CRE_BattleStation_HiddenCheckpointMainGuard_cec1503a-6915-47ab-bb80-8ca150288e48);
DB_CRE_BattleStations(S_CRE_GithGuardMonastery01_fd348f90-dbc9-41a8-8abc-b6e212e9ff77, S_CRE_BattleStation_GithGuardMonastery01_5e05f0a6-22a5-4291-8bdc-61ba120d5343);
DB_CRE_BattleStations(S_CRE_GithGuardMonastery02_606c0555-d7c3-41a8-9018-14ede3d52e21, S_CRE_BattleStation_GithGuardMonastery02_755a0298-cd08-41e2-a5d0-6de367bbdd47);
//Main entrance
DB_CRE_BattleStations(S_CRE_CrecheGuard01_5a5c5878-fd9f-41c0-9c8c-b74cea0e3fd9, S_CRE_BattleStation_CrecheGuard01_bc18c6a9-fb08-4119-8006-f7cc71b675c5);
DB_CRE_BattleStations(S_CRE_MainCheckpointMainGuard_161701af-17b7-4def-b378-5f24e95d667f, S_CRE_BattleStation_MainCheckpointMainGuard_0ef75653-421a-4637-879c-2f9af7c5988e);
DB_CRE_BattleStations(S_CRE_CrecheGuard02_99439816-fcaa-4167-a20a-8f3dfff4e345, S_CRE_BattleStation_CrecheGuard02_2f53e72b-f3ca-4a72-83f4-7473b09d5516);
DB_CRE_BattleStations(S_CRE_MainCheckpointWarningGuard_a6c0d21e-ce59-4dbb-9f64-1ec80b95c838, S_CRE_BattleStation_MainCheckpointWarningGuard_c48289fe-9b0a-4376-b219-0faba61fd698);
//Dorms/infirmary
DB_CRE_BattleStations(S_CRE_CrecheTeenager01_8a7b36f5-378c-4a71-a593-e00ea01ab6ff, S_CRE_BattleStation_CrecheTeenager01_821842d7-87ba-4f35-b58d-671d28c646ff);
DB_CRE_BattleStations(S_CRE_CrecheTeenager02_c67ff924-036b-4259-8acc-9fc013fe2059, S_CRE_BattleStation_CrecheTeenager02_78c3968d-951c-4af1-bcb7-5a68ab3bf8a7);
DB_CRE_BattleStations(S_CRE_InfirmaryAmbushGuard04_3efd4f36-05d3-4a30-80e8-59fd14215fd5, S_CRE_BattleStation_InfirmaryAmbushGuard04_86259d40-1ee9-4955-b1f7-4c8586a2d566);
DB_CRE_BattleStations(S_CRE_InfirmaryAmbushGuard01_2c0b5b3b-5e48-48e6-b10f-08a910ad07f5, S_CRE_BattleStation_InfirmaryAmbushGuard01_f5296db7-40d8-488a-b0f8-3b13d56557d7);
DB_CRE_BattleStations(S_CRE_InfirmaryAmbushGuard03_8f599eca-cf21-42d2-a9f8-56e92aa8624c, S_CRE_BattleStation_InfirmaryAmbushGuard03_5254d27b-091f-4414-ba40-5d279d9cf43a);
DB_CRE_BattleStations(S_CRE_InfirmaryAmbushGuard02_ecb4222c-22b9-49d6-88ed-62b5cba281fc, S_CRE_BattleStation_InfirmaryAmbushGuard02_686325c7-032d-4aa6-9463-3243cefa5b3f);
DB_CRE_BattleStations(S_CRE_Doctor_c04c1977-d53f-4b5c-a29d-2e8d75024768, S_CRE_BattleStation_Doctor_c657824b-4bb3-4510-a233-bcb3c4d3a9bb);
//Hatchery
DB_CRE_BattleStations(S_CRE_CrecheGuard03_245be20a-c140-48b8-bea7-9ff44d9606b2, S_CRE_BattleStation_CrecheGuard03_22eacfbb-76fc-4027-908c-504ae6eba0e3);
DB_CRE_BattleStations(S_CRE_Caretaker_c61ac08e-addf-4f0e-8a0a-2fc026ec0224, S_CRE_BattleStation_Caretaker_34dc7bd3-2397-4bde-9df8-c7ee63fa8a4c);
DB_CRE_BattleStations(S_CRE_CrecheGuard06_09a52fd9-ff83-4594-857a-a1ab0b296dc6, S_CRE_BattleStation_CrecheGuard06_65050abc-1ac2-4329-bc93-bc2fb97561e1);
//Youth Training
DB_CRE_BattleStations(S_CRE_Teacher_60933e69-c642-46e0-92ee-0e4353fc2adf, S_CRE_BattleStation_Teacher_b7ef510a-ba60-4dba-8b1e-c8c86b25b5df);
DB_CRE_BattleStations(S_CRE_Student03_91223ba2-41d5-4cde-85b2-6b076e462e3b, S_CRE_BattleStation_Student03_6707178c-2463-4133-baf9-a6039a4dddbf);
DB_CRE_BattleStations(S_CRE_Student02_0d17add0-9e8d-4e6f-82e0-cd14645707d5, S_CRE_BattleStation_Student02_f44d0fbc-f60c-4495-8a8f-16c842da7c26);
DB_CRE_BattleStations(S_CRE_Student04_d3eb2b9a-ac8e-40dc-8596-70b05d08496b, S_CRE_BattleStation_Student04_f8883dab-961a-42bb-a62d-56bbf8e2afc6);
DB_CRE_BattleStations(S_CRE_Student01_82f7512c-3b1d-4af7-92cc-3fbe4e4d9c33, S_CRE_BattleStation_Student01_717f69d4-dc60-4f2b-998a-98a0ba28d824);
DB_CRE_BattleStations(S_CRE_IntelligenceOfficer02_a17c356a-6e0c-4d2f-bcf6-58195d6c9edf, S_CRE_BattleStation_IntelligenceOfficer02_f6c60a51-ed1d-4b16-b92a-4ecf35516605);

//Everyone gets new CombatGroups when they get to their battlestations
DB_CRE_BattleStations_NewCombatGroups(S_CRE_IntelligenceOfficer01_c76d7d19-3d46-44e5-a914-80efc8cac4ea, "CRE_BattleStations_Bridge");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheCaptain_5093da9b-237a-491f-9402-4f9da73c1565, "CRE_BattleStations_Bridge");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CaptainsBeast01_82736dcd-8648-4795-a296-21aa1bcaf096, "CRE_BattleStations_Bridge");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CaptainsBeast02_fcd64862-67ba-4358-9636-09ff9545177a, "CRE_BattleStations_Bridge");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CaptainGuard_ea4643de-cc2c-42f0-949d-4968201ad2c7, "CRE_BattleStations_Bridge");

DB_CRE_BattleStations_NewCombatGroups(S_CRE_Teacher_60933e69-c642-46e0-92ee-0e4353fc2adf, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_Student01_82f7512c-3b1d-4af7-92cc-3fbe4e4d9c33, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_Student02_0d17add0-9e8d-4e6f-82e0-cd14645707d5, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_Student03_91223ba2-41d5-4cde-85b2-6b076e462e3b, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_Student04_d3eb2b9a-ac8e-40dc-8596-70b05d08496b, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_IntelligenceOfficer02_a17c356a-6e0c-4d2f-bcf6-58195d6c9edf, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CorridorTeenager01_a99624a6-4bff-4d1f-9de5-7b3cd89cc669, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326, "CRE_BattleStations_Classroom");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, "CRE_BattleStations_Classroom");

DB_CRE_BattleStations_NewCombatGroups(S_CRE_MainCheckpointMainGuard_161701af-17b7-4def-b378-5f24e95d667f, "CRE_BattleStations_MainEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_MainCheckpointWarningGuard_a6c0d21e-ce59-4dbb-9f64-1ec80b95c838, "CRE_BattleStations_MainEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheGuard01_5a5c5878-fd9f-41c0-9c8c-b74cea0e3fd9, "CRE_BattleStations_MainEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheGuard02_99439816-fcaa-4167-a20a-8f3dfff4e345, "CRE_BattleStations_MainEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_PatrollingGuard01_d55e65a4-0663-46e5-8213-4ae5dd410e06, "CRE_BattleStations_MainEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_PatrollingGuard02_00135309-731d-4782-bd43-c8b54cacec16, "CRE_BattleStations_MainEntrance");

DB_CRE_BattleStations_NewCombatGroups(S_CRE_HiddenCheckpointMainGuard_3bcbf8fb-5a90-4439-bd81-d9113d74f27e, "CRE_BattleStations_SecretEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_HiddenCheckpointWarningGuard_970d10ed-8092-463b-8446-223fe4cf2d68, "CRE_BattleStations_SecretEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_Quartermistress_ffb0ec61-5739-4b34-8d27-e61b1f4500ad, "CRE_BattleStations_SecretEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_GithGuardMonastery01_fd348f90-dbc9-41a8-8abc-b6e212e9ff77, "CRE_BattleStations_SecretEntrance");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_GithGuardMonastery02_606c0555-d7c3-41a8-9018-14ede3d52e21, "CRE_BattleStations_SecretEntrance");

DB_CRE_BattleStations_NewCombatGroups(S_CRE_Doctor_c04c1977-d53f-4b5c-a29d-2e8d75024768, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_InfirmaryAmbushGuard01_2c0b5b3b-5e48-48e6-b10f-08a910ad07f5, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_InfirmaryAmbushGuard02_ecb4222c-22b9-49d6-88ed-62b5cba281fc, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_InfirmaryAmbushGuard04_3efd4f36-05d3-4a30-80e8-59fd14215fd5, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_InfirmaryAmbushGuard03_8f599eca-cf21-42d2-a9f8-56e92aa8624c, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheTeenager01_8a7b36f5-378c-4a71-a593-e00ea01ab6ff, "CRE_BattleStations_Dorm");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheTeenager02_c67ff924-036b-4259-8acc-9fc013fe2059, "CRE_BattleStations_Dorm");

DB_CRE_BattleStations_NewCombatGroups(S_CRE_Caretaker_c61ac08e-addf-4f0e-8a0a-2fc026ec0224, "CRE_BattleStations_Hatchery");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheGuard03_245be20a-c140-48b8-bea7-9ff44d9606b2, "CRE_BattleStations_Hatchery");
DB_CRE_BattleStations_NewCombatGroups(S_CRE_CrecheGuard06_09a52fd9-ff83-4594-857a-a1ab0b296dc6, "CRE_BattleStations_Hatchery");
//END_REGION
KBSECTION
//REGION deubug
IF
TextEvent("cre_giveportrait")
AND
GetHostCharacter(_Player)
THEN
ToInventory((ITEM)S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, _Player, 1, 1, 1);

IF
TextEvent("cre_OpenBoxSpecialAnim")
THEN
PlayAnimation(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, CUST_Spawn_Chest_01_938061ed-e661-47d2-a46e-c8e585d4a57a, "");
//Open(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30);
//SetAnimationEvent(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, "ISOpened");

IF
TextEvent("cre_SimpleOpenBox")
THEN
Open(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30);

IF
TextEvent("cre_SimpleCloseBox")
THEN
Close(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30);

IF
TextEvent("cre_BattleStations")
THEN
PROC_CRE_BattleStations();
//END_REGION


//REGION Vlaakith Portrait Booster
IF
UseFinished(_Player, (ITEM)S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, 1)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_VlaakithPortraitRuined_680dfd25-1e5e-4214-b697-a692be1df84d)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_VlaakithPortraitPlayerFailed_83b64d2b-48b4-4af8-ae69-912a21117fc3)
AND
NOT DB_CRE_VlaakithPortrait_NotInOriginalPosition(1)
AND
QRY_StartDialog_Fixed((DIALOGRESOURCE)CRE_General_VlaakithPortrait_291a6ebd-da9a-3f80-0eba-1f9c61d66b88, S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, _Player)
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_VlaakithPortraitRuined_680dfd25-1e5e-4214-b697-a692be1df84d)
THEN
PROC_CharacterMoveTo((CHARACTER)S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, S_CRE_PotraitBoyCleaningPos_3c3e59b5-16db-4d11-beea-317584a4083a, "Walk", "CRE_PortraitKid_GoToPortrait");
DB_ItemDialog_NarratorAD((ITEM)S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef, (DIALOGRESOURCE)CRE_General_AD_VlaakithPortraitVandalized_9a506f7a-a422-4ce8-51ea-5e0afee5c61b);
PROC_SetOnStage(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, 0);
PROC_SetOnStage(S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef, 1);
//TODO:Play cleaning animation on loop, when animation is finished.

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_VlaakithPortraitPlayerFailed_83b64d2b-48b4-4af8-ae69-912a21117fc3)
THEN
PROC_CharacterMoveTo((CHARACTER)S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, S_CRE_PotraitBoyCleaningPos_3c3e59b5-16db-4d11-beea-317584a4083a, "Run", "CRE_PortraitKid_GoToPortrait");
DB_ItemDialog_NarratorAD((ITEM)S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef, (DIALOGRESOURCE)CRE_General_AD_VlaakithPortraitVandalized_9a506f7a-a422-4ce8-51ea-5e0afee5c61b);
PROC_SetOnStage(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, 0);
PROC_SetOnStage(S_CRE_VlaakithPortrait_Vandalised_Failed_8d37dc16-6930-4950-9287-f383590304b2, 1);

IF
WentOnStage(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, 0)
THEN
DB_SceneManager((CHARACTER)NULL_00000000-0000-0000-0000-000000000000,"CRE_PortraitScene_Vandalised");
DB_SceneTriggerManager("CRE_PortraitScene_Vandalised",S_CRE_VlaakithPortrait_SceneBounds_e5719f4b-6026-4c14-abfd-abe9a965cb69, 0);
DB_SceneAllowAllDisturbances("CRE_PortraitScene_Vandalised");

IF
EntityEvent(S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, "CRE_PortraitKid_GoToPortrait")
AND
NOT DB_CRE_VandalisedVlaakithPortrait_NotInOriginalPosition(1)
THEN
LookAtEntity((CHARACTER)S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64, S_CRE_VlaakithPortrait_Vandalised_cb30aad6-74a4-40f0-84ca-1460632cc8ef, 3.0);
PROC_TryStartAD((DIALOGRESOURCE)CRE_General_AD_PortraitKidReaction_aa178484-b292-7c0a-83f6-a967f7a18ebc, S_CRE_PortraitKid_428056fd-37b5-49ff-92b1-d1f84b733b64);

IF
AutomatedDialogEnded(CRE_General_AD_PortraitKidReaction_aa178484-b292-7c0a-83f6-a967f7a18ebc, _)
THEN
SetFlag(CRE_General_State_PortraitKid_ShouldBeCleaning_bb83775f-db4f-49f6-b638-87aca9c14eb1);

IF
AutomatedDialogRequestFailed(CRE_General_AD_PortraitKidReaction_aa178484-b292-7c0a-83f6-a967f7a18ebc, _)
THEN
SetFlag(CRE_General_State_PortraitKid_ShouldBeCleaning_bb83775f-db4f-49f6-b638-87aca9c14eb1);

//SceneManager ensuring the portrait can't be vanadlised if removed from its intended position
PROC
PROC_SceneInterrupted(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, _, "CRE_PortraitScene", "LeftTrigger")
THEN
DB_CRE_VlaakithPortrait_NotInOriginalPosition(1);
PROC_SceneOver("CRE_PortraitScene");

PROC
PROC_SceneInterrupted(S_CRE_VlaakithPortrait_Original_5df3cd99-8125-4342-aaab-4b037931f202, _, "CRE_PortraitScene_Vandalised", "LeftTrigger")
THEN
DB_CRE_VandalisedVlaakithPortrait_NotInOriginalPosition(1);
ClearFlag(CRE_General_State_PortraitKid_ShouldBeCleaning_bb83775f-db4f-49f6-b638-87aca9c14eb1);
//END_REGION

//REGION Items you get attacked for trying to sell to a Gith
IF
AddedTo(_Object, _Trader, "")
AND
DB_CRE_ForbiddenToSellItems(_Object)
AND
GetFaction(_Trader, _Faction)
AND
DB_CRE_GithFactions(_Faction)
AND
GetClosestAlivePlayer(_Trader, _Player, _)
THEN
SetFlag((FLAG)CRE_QuarterMistress_Event_TriedSellingIllegalItem_6ea9cd72-9fe9-44cf-8648-a5dd21455e71);
PROC_SetHostileToIndivPlayerFaction(_Faction, _Player);
//END_REGION

//REGION Mage Hand Booster
PROC
PROC_CRE_MageHand_SceneSetup()
THEN
SetFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312); //Plays a repeated AD line from Anubis
SetFlag((FLAG)CRE_General_Event_MageHandKid_ActiveKid_96461d01-0ad2-4b0b-ba02-5ba65141a6ea, S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f); //Set to start the anubis behaviour.
PROC_SetOnStage((CHARACTER)S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, 0);

PROC
PROC_SceneInterrupted(_,_,"CRE_MageHandKids",_Reason)
AND
NOT DB_CRE_MageHandKids_BlockDisturbance(_Reason)
THEN
PROC_SceneOver("CRE_MageHandKids");
PROC_CRE_General_MagehandKidsCancel();


PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)CRE_General_State_MageHandKidsMoveAside_d9c41f69-6996-4366-a5d6-2aa2abac1f08)
THEN
PROC_CRE_General_MageHandKidsMoveAway();

PROC
PROC_StateSet_Defeated(_MageHand)
AND
DB_CRE_GithBoys_MageHands((CHARACTER)_MageHand)
THEN
PROC_CRE_General_MageHandKidsMoveAway();


PROC
PROC_CRE_General_MageHandKidsMoveAway()
AND
QRY_OnlyOnce("CRE_General_MageHandKidsMoveAway")
THEN
PROC_CharacterMoveTo((CHARACTER)S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f, (TRIGGER)S_CRE_MageHandKid01_MoveAsidePos_6d2cb9c9-7567-4b87-8655-db57729407ff, "Run", "CRE_General_MageHandKid01_ReachedPos");
PROC_CharacterMoveTo((CHARACTER)S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695, (TRIGGER)S_CRE_MageHandKid02_MoveAsidePos_475b2e88-a6d4-4b77-a01d-bb26d360c0bc, "Run", "CRE_General_MageHandKid02_ReachedPos");
PROC_CRE_General_MagehandKidsCancel();

PROC
PROC_CRE_General_MagehandKidsCancel()
THEN
PROC_SetOnStage((CHARACTER)S_CRE_MageHand01_750cd0fb-42ec-4570-adc7-c4508dabadda, 0);
PROC_SetOnStage((CHARACTER)S_CRE_MageHand02_80c883bd-8116-4d33-afcb-9032e9421209, 0);
PROC_RemoveDialog(S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);
PROC_RemoveDialog(S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695);
DB_Dialogs((CHARACTER)S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f, (DIALOGRESOURCE)CRE_MageHandKid01_da880028-0c40-5ee1-85de-b7650caf79d7);
DB_Dialogs((CHARACTER)S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695, (DIALOGRESOURCE)CRE_MageHandKid02_3b1578a3-a649-312f-c9d3-73c41b476287);
ClearFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312);
ClearFlag(CRE_General_Event_MageHandKid_ActiveKid_96461d01-0ad2-4b0b-ba02-5ba65141a6ea, S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);
ClearFlag(CRE_General_Event_MageHandKid_ActiveKid_96461d01-0ad2-4b0b-ba02-5ba65141a6ea, S_CRE_MageHandKid02_840d6525-88ba-462a-944c-a74975afa695);



//Gremishka chest
//If the chest is attacked by anyone, even if it deals 0 damage, the gremishka inside plays a cry
IF
AttackedBy(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _, _, _, _, _, _)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_MageHandBoxUnlocked_9a839662-ae6a-4420-bdce-45769bbe149b)
THEN
PROC_CRE_General_PlayGremishkaCry();

//The Gremishka inside would cry if the box is moved by the player
IF
Moved((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_MageHandBoxUnlocked_9a839662-ae6a-4420-bdce-45769bbe149b)
THEN
PROC_CRE_General_PlayGremishkaCry();

PROC
PROC_CRE_General_PlayGremishkaCry()
AND
NOT DB_DialogName((DIALOGRESOURCE)CRE_General_AD_MageHandGremishkaCries_5c4d789b-16ee-d3b1-6af3-ed30adbebffd, _)
THEN
PROC_TryStartAD((DIALOGRESOURCE)CRE_General_AD_MageHandGremishkaCries_5c4d789b-16ee-d3b1-6af3-ed30adbebffd, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30);

IF
Unlocked((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _, _)
THEN
PROC_CRE_General_SpawnMageHandGremishka();

//Status is applied by an Aura on characters who are 9m around the box
IF
StatusApplied(_Character, "CRE_MAGEHANDBOX_MAGICREACTION", _, _)
AND
NOT DB_CRE_MageHandBox_TrackCastingCharacter(_Character)
THEN
DB_CRE_MageHandBox_TrackCastingCharacter(_Character);

IF
StatusRemoved(_Character, "CRE_MAGEHANDBOX_MAGICREACTION", _, _)
AND
DB_CRE_MageHandBox_TrackCastingCharacter(_Character)
THEN
NOT DB_CRE_MageHandBox_TrackCastingCharacter(_Character);

//Tracking who has the box
IF
AddedTo(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _Holder, _)
AND
DB_CRE_MageHandBox_BoxHolder(_OldHolder)
THEN
NOT DB_CRE_MageHandBox_BoxHolder(_OldHolder);
DB_CRE_MageHandBox_BoxHolder(_Holder);

IF
AddedTo(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _Holder, _)
AND
NOT DB_CRE_MageHandBox_BoxHolder(_)
THEN
DB_CRE_MageHandBox_BoxHolder(_Holder);

IF
RemovedFrom(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _Holder)
AND
DB_CRE_MageHandBox_BoxHolder(_Holder)
THEN
NOT DB_CRE_MageHandBox_BoxHolder(_Holder);

//If anyone casts a spell near the box, the gremishka gets enlarged and destroys the box from the inside
IF
CastedSpell(_Caster, _Spell, _, _, _ID)
AND
DB_CRE_MageHandBox_TrackCastingCharacter(_Caster)
AND
NOT DB_CRE_MageHandBox_BoxHolder(_)
AND
NOT IsDestroyed(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, 1)
AND
SpellHasSpellFlag(_Spell, "IsSpell", 1)
AND
IntegerToString(_ID, _IDString)
THEN
DB_CRE_MageHandBox_WaitForTargetEvent(_ID);
TimerLaunch(_IDString, 500);

IF
CastedSpell(_Caster, _Spell, _, _, _ID)
AND
DB_CRE_MageHandBox_BoxHolder(_Caster)
AND
NOT IsDestroyed(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, 1)
AND
SpellHasSpellFlag(_Spell, "IsSpell", 1)
AND
IntegerToString(_ID, _IDString)
THEN
DB_CRE_MageHandBox_WaitForTargetEvent(_ID);
TimerLaunch(_IDString, 500);

//Exclude spellcasting in dialogs
IF
UsingSpellOnTarget(_Caster, _Target, _Spell, _, _, _ID)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
DB_DialogPlayers(_, _Caster, _)
THEN
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

IF
UsingSpellOnTarget(_Caster, _Target, _Spell, _, _, _ID)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
DB_DialogPlayers(_, _Target, _)
THEN
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

//Actually dealing damage
IF
UsingSpellOnTarget(_, _, _, _, _, _ID)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
NOT DB_CRE_MageHandBox_BoxHolder(_)
THEN
PROC_CRE_MageHandBox_DamageMageHandBox();
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

IF
TimerFinished(_TimerIDString)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
IntegerToString(_ID, _IDString)
AND
_TimerIDString == _IDString
AND
NOT DB_CRE_MageHandBox_BoxHolder(_)
THEN
PROC_CRE_MageHandBox_DamageMageHandBox();
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

PROC
PROC_CRE_MageHandBox_DamageMageHandBox()
THEN
SetFlag((FLAG)CRE_General_Event_MageHandBoxSpellCast_e0edda3d-97b9-4be8-a105-6f1da0e8241a); 
ApplyDamage((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, 6, "Bludgeoning", S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30);
PROC_CRE_General_PlayGremishkaCry();
PlayEffect(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30 ,VFX_Enemies_Gremishka_Spawn_BodyFX_01_ab3ff2fa-ae23-12a2-5a76-686bb609fffa, "", 4.0);

//If casted a spell with box in inventory
//If there's no valid position, nothing should happen
IF
UsingSpellOnTarget(_, _, _, _, _, _ID)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
DB_CRE_MageHandBox_BoxHolder(_Holder)
AND
GetPosition(_Holder, _SourceX, _SourceY, _SourceZ)
AND
FindValidPosition(_SourceX, _SourceY, _SourceZ, 3.0, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, 0, _ValidX, _ValidY, _ValidZ) 
THEN
DB_CRE_General_GremishkaBoxDropped(1);
DropTo((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _ValidX, _ValidY, _ValidZ);
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

IF
TimerFinished(_TimerIDString)
AND
DB_CRE_MageHandBox_WaitForTargetEvent(_ID)
AND
IntegerToString(_ID, _IDString)
AND
_TimerIDString == _IDString
AND
DB_CRE_MageHandBox_BoxHolder(_Holder)
AND
GetPosition(_Holder, _SourceX, _SourceY, _SourceZ)
AND
FindValidPosition(_SourceX, _SourceY, _SourceZ, 3.0, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, 0, _ValidX, _ValidY, _ValidZ) 
THEN
DB_CRE_General_GremishkaBoxDropped(1);
DropTo((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _ValidX, _ValidY, _ValidZ);
NOT DB_CRE_MageHandBox_WaitForTargetEvent(_ID);

IF
DroppedBy(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _)
AND
DB_CRE_General_GremishkaBoxDropped(1)
THEN
PROC_CRE_MageHandBox_DamageMageHandBox();
NOT DB_CRE_General_GremishkaBoxDropped(1);

//Change the kid's Anubis behaviour state while the box is in an inventory
IF
FlagSet((FLAG)CRE_General_State_HasMageHandBox_bc0b2be2-f3e4-4b7a-947b-4bb1bff4adc0, _Char, _)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_MageHandBoxUnlocked_9a839662-ae6a-4420-bdce-45769bbe149b)
THEN
ClearFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312);
SetFlag((FLAG)CRE_MageHandGame_State_BoxPickedUp_8976a026-db99-40fc-8d95-d59cc690c11b, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_CRE_General_MageHandKidsMoveAway();

//Restarts kids playing shove behaviour if box is brought out of inventory and kid's haven't been told to move aside
/*
IF
FlagCleared((FLAG)CRE_General_State_HasMageHandBox_bc0b2be2-f3e4-4b7a-947b-4bb1bff4adc0, _Char, _)
AND
NOT DB_CRE_MageHandBox_BoxHolder(_)
AND
NOT DB_GlobalFlag((FLAG)CRE_General_State_MageHandMoveAside_d9c41f69-6996-4366-a5d6-2aa2abac1f08)
THEN
SetFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312);
*/
IF
DestroyedBy((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, _, _, _)
THEN
PROC_CRE_General_SpawnMageHandGremishka();

PROC
PROC_CRE_General_SpawnMageHandGremishka()
AND
QRY_OnlyOnce("CRE_General_MageHandGremishkaSpawned")
THEN
PROC_CRE_General_MageHandKidsMoveAway(); //Only happens once
NOT DB_HasItemEvent((ITEM)S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, (FLAG)CRE_General_State_HasMageHandBox_bc0b2be2-f3e4-4b7a-947b-4bb1bff4adc0);
SetFlag((FLAG)CRE_General_State_MageHandBoxUnlocked_9a839662-ae6a-4420-bdce-45769bbe149b);
PROC_CRE_General_MageHandGremishkaAppears();
PROC_TryStartAD((DIALOGRESOURCE)CRE_General_AD_MageHandKidLaughingAtPlayer_b19f4f20-62b9-3253-2d87-a3e68e0bc901, S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);

PROC
PROC_CRE_General_MageHandGremishkaAppears()
THEN
PROC_SetOnStage((CHARACTER)S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, 1);
TeleportTo(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, "CRE_General_GremishkaIsSpawned", 0, 0, 0, 0, 1);
PlayAnimation(S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, CUST_Spawn_Chest_01_938061ed-e661-47d2-a46e-c8e585d4a57a, "");
PlayAnimation(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, CUST_Spawn_Chest_01_938061ed-e661-47d2-a46e-c8e585d4a57a, "");
//TODO: make sure the animation plays properly on the chest

PROC
PROC_CRE_General_MageHandGremishkaAppears()
AND
DB_GlobalFlag((FLAG)CRE_General_Event_MageHandBoxSpellCast_e0edda3d-97b9-4be8-a105-6f1da0e8241a)
THEN
UseSpell(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d ,"Shout_MagicAllergy_Enlarge", S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, NULL_00000000-0000-0000-0000-000000000000);

//Way to make chest gremishka aggro everything: If they see someone, become aggressive to their faction (exclude kobold faction).
IF
Saw(_Gremishka,_Enemy,_)
AND
GetFaction(_Gremishka,_GremishkaFaction)
AND
DB_CRE_GremishkaFactions(_GremishkaFaction)
AND
GetFaction(_Enemy,_EnemyFaction)
AND
NOT DB_CRE_GremishkaFactions(_EnemyFaction)
THEN 
PROC_SetRelationMutual((FACTION)Act1B_CRE_Gremishkas_d376a9f5-1c31-4aa3-b758-c217d9237cea,_EnemyFaction,0);

IF
EntityEvent(_Gremishka, "CRE_General_GremishkaIsSpawned")
AND
QRY_GetClosestAvailableCharacterTo(_Gremishka, 0, 0, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, 1) 
AND
DB_ClosestAvailableCharacterTo(_Player, _Gremishka, _Dist)
AND
_Dist <= 15.0
AND
QRY_StartDialogCustom((DIALOGRESOURCE)CRE_General_PAD_PlayerSurprisedAtGremishka_f8341280-c2af-c936-69b3-ac522e9f2d39, _Player, 0, 0, 0, 0)
THEN
DB_NOOP(1);

//The player joining the magehand game, getting shoved and told off with an AD
PROC
PROC_FlagReactionAfterDialog(_Player, (FLAG)CRE_MageHandGame_State_PlayerAskedToPlay_c0c02d22-70cb-4490-aebc-efe79b01f0f1)
THEN
PROC_CRE_PlayWithMageHandKids((CHARACTER)_Player);
PROC_TryStartAD((DIALOGRESOURCE)CRE_MageHandKids_AD_PlayerExpelledFromGame_30c196ef-156d-4542-a3cc-a0d034f4f099, S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);

IF
FlagSet((FLAG)CRE_MageHandGame_Event_PlayerInterferesWithGame_d37b8034-0a34-48d1-9ae0-39ddf4f064cf,_Player, _)
AND
NOT DB_DialogPlayers(_, _Player, _)
THEN
PROC_CRE_PlayWithMageHandKids((CHARACTER)_Player);
PROC_TryStartAD((DIALOGRESOURCE)CRE_MageHandKids_AD_PlayerIsShoved_daa7a20d-2132-634c-cb78-634c8eb895f4, S_CRE_MageHandKid01_67c5e825-c850-414f-8279-e1968a321d4f);

PROC
PROC_CRE_PlayWithMageHandKids((CHARACTER)_Player)
THEN
UseSpell(S_CRE_MageHand01_750cd0fb-42ec-4570-adc7-c4508dabadda, "Target_CRE_MageHand_AutoShove", _Player, _Player);
ClearFlag((FLAG)CRE_MageHandGame_Event_PlayerInterferesWithGame_d37b8034-0a34-48d1-9ae0-39ddf4f064cf, _Player, 0);

QRY
QRY_GLO_SkillCheck_CheckAdvantage(_MageHand, _, _)
AND
DB_CRE_GithBoys_MageHands(_MageHand)
THEN
DB_QRYRTN_GLO_Skillcheck_CheckAdvantage(2);

//IF the player interferes with the game by shoving the box via magehand or personally, get shoved, with a different AD
IF
UsingSpellOnTarget(_Caster, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, "Target_Shove_MageHand", _, _,_)
AND
NOT DB_CRE_GithBoys_MageHands((CHARACTER)_Caster)
AND
CharacterGetOwner(_Caster, _Owner)
AND
DB_GlobalFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312)
THEN
SetFlag((FLAG)CRE_MageHandGame_Event_PlayerInterferesWithGame_d37b8034-0a34-48d1-9ae0-39ddf4f064cf, _Owner, 0);

IF
UsingSpellOnTarget(_Caster, S_CRE_MageHandBox_49bc0f54-3bd2-4945-8785-cc1f813d8a30, "Target_Shove", _, _,_)
AND
DB_GlobalFlag((FLAG)CRE_General_State_MageHandKidsPlayingShove_a4da0c89-a3b5-47f0-a726-28c818c91312)
THEN
SetFlag((FLAG)CRE_MageHandGame_Event_PlayerInterferesWithGame_d37b8034-0a34-48d1-9ae0-39ddf4f064cf, _Caster, 0);
//END_REGION

//REGION Ellyka SwD
IF
DB_InRegion((CHARACTER)_Player,(TRIGGER)S_CRE_Creche_TopFloor_01f823fe-7363-4f8a-bea3-31755b318738)
AND
DB_Players(_Player)
AND 
NOT DB_PermaDefeated((CHARACTER)S_GLO_ChokepointScout_627e03ed-d23c-42fa-90c8-1e8d6f927fd6)
THEN
TeleportTo((CHARACTER)S_GLO_ChokepointScout_627e03ed-d23c-42fa-90c8-1e8d6f927fd6,(TRIGGER)CRE_POI_TieflingSwD_a017cb45-1433-401c-931c-ee9fc1542b12);
PROC_SetOnStage(S_PLA_ChokepointScout_627e03ed-d23c-42fa-90c8-1e8d6f927fd6, 1);
Die((CHARACTER)S_GLO_ChokepointScout_627e03ed-d23c-42fa-90c8-1e8d6f927fd6,DEATHTYPE.Physical,NULL_00000000-0000-0000-0000-000000000000,0,1,0.0);
DB_GLO_CharacterCorpseDialog((CHARACTER)S_GLO_ChokepointScout_627e03ed-d23c-42fa-90c8-1e8d6f927fd6, (DIALOGRESOURCE)CRE_Pilgrim_Dead_44139537-8686-5be5-c68b-468f58cdbc0b);
//END_REGION

//REGION Kids Escape
IF
DB_CRE_GithKids(_Kid)
THEN
DB_Children((CHARACTER)_Kid);

//If the kids are watching a combat with only the players and the gremishka from the mage hand Booster, they have a different cower behaviour
IF
EnteredCombat((CHARACTER)S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, _ID)
THEN
DB_CRE_MageHandGremishkaFight(_ID);
SetFlag(CRE_MageHandGame_State_GremishkaCombat_975dcfa7-759e-4bb4-b17e-60cd33b1d10f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_CRE_CheckAllCombatMembers(_ID);

PROC
PROC_CRE_CheckAllCombatMembers((GUIDSTRING)_ID)
AND
DB_Is_InCombat(_Combatant, _ID)
AND
IsCharacter(_Combatant, 1)
AND
NOT DB_CRE_MageHandGremishka(_Combatant)
AND
NOT DB_PartyMembers((CHARACTER)_Combatant)
THEN
ClearFlag(CRE_MageHandGame_State_GremishkaCombat_975dcfa7-759e-4bb4-b17e-60cd33b1d10f, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
CombatEnded(_ID)
AND
DB_CRE_MageHandGremishkaFight(_ID)
THEN
ClearFlag(CRE_MageHandGame_State_GremishkaCombat_975dcfa7-759e-4bb4-b17e-60cd33b1d10f, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
EnteredCombat(_Newcombatant, _ID)
AND
DB_CRE_MageHandGremishkaFight(_ID)
AND
IsCharacter(_Newcombatant, 1)
AND
NOT DB_CRE_MageHandGremishka(_Newcombatant)
AND
NOT DB_PartyMembers((CHARACTER)_Newcombatant)
AND
QRY_IsEnemyToAnyPlayerInCombat(_Newcombatant, _ID)
THEN
ClearFlag(CRE_MageHandGame_State_GremishkaCombat_975dcfa7-759e-4bb4-b17e-60cd33b1d10f, NULL_00000000-0000-0000-0000-000000000000, 0);

IF 
SwitchedCombat(S_CRE_MageHandGremishka_1358e104-c187-400e-b111-b2cf8581422d, _OldID, _NewID)
AND
DB_CRE_MageHandGremishkaFight(_OldID)
THEN
NOT DB_CRE_MageHandGremishkaFight(_OldID);
DB_CRE_MageHandGremishkaFight(_NewID);


IF
AnimationEvent(_Kid, "AnimationSetOffStage", 0)
AND
DB_CRE_GithKids(_Kid)
THEN
PROC_SetOnStage(_Kid,0);

//END_REGION

//REGION Teens on Corridor Booster
PROC
PROC_SpotPlayers_Spotted(S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326, "CRE_CorridorTeens_SpottedPlayer", _Player)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("CRE_CorridorTeens_ADStarted")
THEN
PROC_TryStartAD((DIALOGRESOURCE)CRE_General_AD_CorridorTeens_fc3950f6-7e66-be33-1e14-3e317f2cfb94, S_CRE_CorridorTeenager02_d6483496-2e6c-4cf2-9402-a06af68d5326,(CHARACTER)S_CRE_CorridorTeenager01_a99624a6-4bff-4d1f-9de5-7b3cd89cc669);
//END_REGION

//REGION Leazel/GITH reactivity to interacting with things / looting certain corpses
IF
UseFinished(_Player, _Item, _)
AND
DB_Players(_Player)
AND
DB_CRE_ClickableItemVBs(_Item, _VB)
THEN
StartVoiceBark(_VB, _Player);

//Dorm poster
IF
UseFinished(_Player, S_CRE_Dormitory_Schedules_126d9846-51f4-4622-b73f-826667ef9c71, _)
AND
NOT DB_CRE_SchedulemCommented(_Player)
THEN
StartVoiceBark(CRE_General_VB_RulesPoster_ea0aac7b-5662-061e-d5f1-2f9cf4531baa, _Player);
DB_CRE_SchedulemCommented(_Player);

IF
AttackedBy((ITEM)_Item, _, (CHARACTER)_Player, _, _, _, _)
AND
DB_Players(_Player)
AND
DB_CRE_AttackableItemVBs(_Item, _VB)
THEN
StartVoiceBark(_VB, _Player);
NOT DB_CRE_AttackableItemVBs(_Item, _VB);

IF
CharacterLootedCharacter(_Player, S_CRE_Roof_GithyankiSkeleton_5530b1fa-468a-4207-864a-9bf51039d453)
AND
DB_CRE_LootableCharacterVBs(S_CRE_Roof_GithyankiSkeleton_5530b1fa-468a-4207-864a-9bf51039d453, _VB)
THEN
StartVoiceBark(_VB, _Player);
NOT DB_CRE_LootableCharacterVBs(S_CRE_Roof_GithyankiSkeleton_5530b1fa-468a-4207-864a-9bf51039d453, _VB);
//END_REGION

//REGION Reactivity - creche is destroyed
IF
DB_GlobalFlag(ORI_Laezel_State_CrecheExploded_31ee1ed3-b163-4d1a-84f3-d37521900a87)
THEN
PROC_LockWaypointForAll("WAYP_CRE_Creche");
//END_REGION

//REGION Battlestations!
//Kids run away
PROC
PROC_CRE_BattleStations()
AND
DB_CRE_GithKids(_Kid)
THEN
SetFlag(CRE_General_State_KidEscape_88e294b3-111a-4e6b-877a-1cca3fa3fe08, _Kid, 0);

//Fighting Gith ready for combat
PROC
PROC_CRE_BattleStations()
AND
DB_CRE_BattleStations(_Gith, _Trigger)
THEN
PROC_CharacterMoveTo(_Gith, _Trigger, "Run", "CRE_BattleStations_InPosition");

IF
EntityEvent(_Gith, "CRE_BattleStations_InPosition")
AND
DB_CRE_BattleStations_NewCombatGroups(_Gith, _NewCombatGroup)
THEN
SetCombatGroupID(_Gith, _NewCombatGroup);

PROC
PROC_CRE_BattleStations()
AND
DB_CRE_BattleStations(_Gith, _)
THEN
PROC_SetAnubisConfig(_Gith, "CRE_BattleStations");

PROC
PROC_CRE_BattleStations()
AND
DB_CRE_BattleStations(_Gith, _)
THEN
SetWeaponUnsheathed(_Gith, 1, 0);

PROC
PROC_CRE_BattleStations()
THEN
TimerLaunch("CRE_BattleStations_ConfigReassignTimer", 5000);

IF
TimerFinished("CRE_BattleStations_ConfigReassignTimer")
AND
DB_CRE_BattleStations(_Gith,_BattlePos)
THEN
SetDualEntityEvent(_Gith,_BattlePos,"CrecheBattlePosition",1);

//Githboy disappearing
PROC
PROC_CRE_BattleStations()
AND
NOT DB_Defeated(S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187)
AND
NOT DB_GlobalFlag(CRE_YouthTraining_State_TeacherBeatingBoy_ccaa2ee8-654b-491f-9623-c8a9376d3c61)
THEN
PROC_DisappearOutOfSight(S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187, "Run", 0, "");

//Githboy dying
PROC
PROC_CRE_BattleStations()
AND
DB_GlobalFlag(CRE_YouthTraining_State_TeacherBeatingBoy_ccaa2ee8-654b-491f-9623-c8a9376d3c61)
THEN
NOT DB_PreventKnockedOutPermaDefeated((CHARACTER)S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187);
Attack((CHARACTER)S_CRE_Teacher_60933e69-c642-46e0-92ee-0e4353fc2adf, S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187, 1);
ClearFlag(CRE_YouthTraining_State_TeacherBeatingBoy_ccaa2ee8-654b-491f-9623-c8a9376d3c61);
DB_CRE_YouthTraining_TeacherKillingBoy(1);


PROC
PROC_CRE_BattleStations()
AND
DB_Defeated(S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187)
AND
NOT DB_Dead(S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187)
AND
NOT DB_OffStage(S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187)
THEN
NOT DB_PreventKnockedOutPermaDefeated((CHARACTER)S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187);
Attack((CHARACTER)S_CRE_Teacher_60933e69-c642-46e0-92ee-0e4353fc2adf, S_CRE_GithBoy_3e97baba-812b-4589-a7aa-454543aa3187, 1);
ClearFlag(CRE_YouthTraining_State_TeacherBeatingBoy_ccaa2ee8-654b-491f-9623-c8a9376d3c61);
DB_CRE_YouthTraining_TeacherKillingBoy(1);
//END_REGION

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act1b"
