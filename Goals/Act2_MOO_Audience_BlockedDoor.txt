Version 1
SubGoalCombiner SGC_AND
INITSECTION
SetOwner((ITEM)S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606, (CHARACTER)S_MOO_AccessCultist_7f0f8d11-9d1e-4210-bbcb-41aa05666d58);

KBSECTION
//REGION Player gets interrupted before going up.

//First player to go up attempts to do so without warning.
PROC
PROC_BlockUseOfItem(_Player, S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606)
AND
QRY_State_IsBeforeState(S_MOO_MoonriseTower_SUB_14187ad9-cf83-44f9-81bf-bb46cb4cd8e6, "MOO", "MOO_State_Outcast")
AND
NOT DB_GlobalFlag(MOO_Audience_State_GrantedPermission_ef5c0ad1-8aae-48b8-a438-5989b1778f9a)
AND
NOT DB_HiddenCharacters(_Player, _)
AND
NOT DB_CantTalk(S_MOO_AccessCultist_7f0f8d11-9d1e-4210-bbcb-41aa05666d58)
AND
GetFlag((FLAG)MOO_Audience_HasMet_AccessCultist_46449183-e8a2-7ac3-4c8e-ea386a80dc17, _Player, 0)
AND
QRY_StartDialog_Fixed(MOO_Audience_AccessCultist_49ad9a32-be79-4e30-ad8d-0de5c68a9c0e, S_MOO_AccessCultist_7f0f8d11-9d1e-4210-bbcb-41aa05666d58, _Player)
THEN
DB_CustomUseItemResponse(_Player, S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606, 0);

//Add players to dialog if they try to go up while warning is underway.
PROC
PROC_BlockUseOfItem(_Player, S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606)
AND
NOT DB_GlobalFlag(MOO_Audience_State_GrantedPermission_ef5c0ad1-8aae-48b8-a438-5989b1778f9a)
AND
DB_DialogName(MOO_Audience_AccessCultist_49ad9a32-be79-4e30-ad8d-0de5c68a9c0e, _ID)
AND
GetFlag((FLAG)MOO_Audience_HasMet_AccessCultist_46449183-e8a2-7ac3-4c8e-ea386a80dc17, _Player, 0)
THEN
SetFlag((FLAG)MOO_Audience_HasMet_AccessCultist_46449183-e8a2-7ac3-4c8e-ea386a80dc17, _Player, 0);
DialogAddActor(_ID, _Player);
DB_CustomUseItemResponse(_Player, S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606, 0);

IF
FlagSet(MOO_Audience_State_GrantedPermission_ef5c0ad1-8aae-48b8-a438-5989b1778f9a, _, _)
THEN
ClearOwnership(S_MOO_RoofAccessDoor_0eca4cd0-6fa5-421f-80e9-446c2b758606);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act2"
