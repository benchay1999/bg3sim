Version 1
SubGoalCombiner SGC_AND
INITSECTION
//shield cap
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Audience_Capacitor_02_b218cdb0-6b51-4c73-b6dc-39662529588e);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Audience_Capacitor_03_36e0b022-e77c-4579-bdc4-6758aaf17cf8);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Audience_Capacitor_04_f161836f-246d-42f3-b489-b7e7b57e744b);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Audience_Capacitor_06_8e5d5ea2-4b07-4d42-a407-5b345a8abd85);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Office_Capacitor_01_b64bce4d-9d2a-4dc3-9ac2-402cc66d4214);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Office_Capacitor_03_3012f3b9-79b8-452d-81d3-fc9c394e2952);
DB_WYR_Gortash_ShCap(S_WYR_PUZ_Gortash_Office_Capacitor_04_f389f0e5-3367-4545-a154-42fa1ef9c4d0);

//broken shield cap
DB_WYR_Gortash_ShCap_Broken(S_WYR_PUZ_Gortash_Audience_Capacitor_01_607a48c9-217b-4d31-bfae-c00814db8b94);
DB_WYR_Gortash_ShCap_Broken(S_WYR_PUZ_Gortash_Audience_Capacitor_05_d173d1d0-efb0-427a-b729-eeede5688a6d);
DB_WYR_Gortash_ShCap_Broken(S_WYR_PUZ_Gortash_Office_Capacitor_05_d3cc880f-abef-4d68-a354-312f120c29c0);
DB_WYR_Gortash_ShCap_Broken(S_WYR_PUZ_Gortash_Office_Capacitor_02_3ffb6da7-9feb-4152-8051-6d7b76060d98);

//incinerators
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_01_2d1e9231-6490-41ee-a54c-c6f2020882d1,S_WYR_PUZ_Gortash_Audience_Incinerator_01_Helper_8bddb5d8-ba11-4302-86fe-28fae81f4ca3);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_02_ea176fb3-4d09-493d-89a4-1429ce6d27ab,S_WYR_PUZ_Gortash_Audience_Incinerator_02_Helper_2f79c1be-6084-4baf-b8ad-06615da861b2);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_03_ebcc9074-d919-4c5f-966b-e0362c0f9dbb,S_WYR_PUZ_Gortash_Audience_Incinerator_03_Helper_49490f99-e1e9-4ffe-b25d-5af5adb64f77);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_04_dbf8275b-cf68-4321-8114-3b24150bfe54,S_WYR_PUZ_Gortash_Audience_Incinerator_04_Helper_d5660fa1-92ee-4e49-8389-19ff3e72d154);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_05_4fe55f3d-23fe-4259-a502-9d8916072151,S_WYR_PUZ_Gortash_Audience_Incinerator_05_Helper_a143c96f-b285-4b18-b93e-aa12f9054e6a);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_06_baa9a5ac-1b68-4dae-a6f2-8d1411a5a05b,S_WYR_PUZ_Gortash_Audience_Incinerator_06_Helper_5601bf94-e456-439e-abcb-66292f9fa684);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_07_10a18318-e3c5-4a7a-97d0-17640a263e26,S_WYR_PUZ_Gortash_Audience_Incinerator_07_Helper_e65cead2-b537-4b64-8b11-bf6995d2733a);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_08_ff4bd88d-2344-4e51-8052-12eef91f39ee,S_WYR_PUZ_Gortash_Audience_Incinerator_08_Helper_078904fd-df4b-4c88-b2b3-e14404ca1d0d);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_09_9b9859b7-769a-44e4-bd51-b19e2a19f837,S_WYR_PUZ_Gortash_Audience_Incinerator_09_Helper_3e2eab15-ee1b-49fb-a654-8b9b148cd039);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Audience_Incinerator_10_5ab295b8-96b2-4077-965f-92004fd67886,S_WYR_PUZ_Gortash_Audience_Incinerator_10_Helper_0e5ce90c-7623-4cf3-9d60-b7d0ae5c2fa2);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_01_624ca0bb-8b26-455c-b73b-73b593e01ebc,S_WYR_PUZ_Gortash_Office_Incinerator_01_Helper_6d95a757-0078-4e45-95df-6789fc7f9fcd);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_02_a1b177b1-3698-4b93-b176-62fe7032b135,S_WYR_PUZ_Gortash_Office_Incinerator_02_Helper_54b1e0fe-c760-461a-8fd0-6e6ab6863e8e);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_03_d7db71af-8dd9-43c7-a78a-28a64f5b4b3a,S_WYR_PUZ_Gortash_Office_Incinerator_03_Helper_01aac789-48ef-4dbd-b134-4e3afe9bd3ad);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_04_57135da9-189b-4900-a03d-f89e71722030,S_WYR_PUZ_Gortash_Office_Incinerator_04_Helper_dd02a4ec-0bd7-467c-9389-6b4abc6d4f35);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_05_81e83600-6dc8-49f3-b089-9e22fe005742,S_WYR_PUZ_Gortash_Office_Incinerator_05_Helper_721f5800-7158-43fe-a3a5-9e856ba167df);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_06_61be9767-0b4b-4bf5-941b-4908abe9342f,S_WYR_PUZ_Gortash_Office_Incinerator_06_Helper_21fcb274-3ba3-4751-8f95-290655f380ce);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_07_c4fd7857-a48d-4ce6-ae70-a10d83b67add,S_WYR_PUZ_Gortash_Office_Incinerator_07_Helper_a9e59e7b-a2e7-45c5-bb8e-c039d7a581ef);
DB_WYR_Gortash_Incinerators(S_WYR_PUZ_Gortash_Office_Incinerator_08_8da32daa-27e6-4b68-95ed-c9ad84b58fda,S_WYR_PUZ_Gortash_Office_Incinerator_08_Helper_5ae147c5-8998-43f0-9f40-4dfe20c0c6d6);

//gr launchers
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_01_a55f5753-cf06-4d0f-9e45-213e2364585d);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_02_d7ed0d20-285d-4bce-97d7-358dbf1d1492);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_03_b0e57ddd-5a4f-42fd-a59b-3dcef8e31e3b);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_04_a23f2e11-ebd3-40b4-a5f2-0ae61ae3bd96);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_05_14f90d1e-9802-468e-bf39-965d10266be4);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_06_60251776-563d-4785-97d5-e75151a9a67b);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_07_a003dce3-f241-4a51-adca-d8603f71bcab);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Audience_GrenadeLauncher_08_0ce68f85-5b79-4774-8a2b-2fe79973c6a5);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_01_22263578-2d5a-407d-9c6e-93deb0d641db);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_02_faf99f48-cf02-4f04-8b88-715ad721b31e);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_03_75b702cc-c022-4ec8-b75d-260d0f72d35c);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_04_262c62fc-4b04-4d2d-b66c-f215a8caba97);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_05_e7d64650-b855-4964-9d86-055f97236b02);
DB_WYR_Gortash_GrLaunchers(S_WYR_PUZ_Gortash_Office_GrenadeLauncher_06_d98f755a-9b21-4787-ac72-7abfff90767c);

//Bane Manifestation Helpers
DB_WYR_Gortash_BaneGhosts((CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_01_7251df6f-c71a-4b4f-8d86-adaf5efc6faa, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_02_4e0650d9-26db-4555-b2d4-53638351bf06, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_03_381c7fc8-2c19-4e58-bc88-42687255f4db, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_04_85bd96d5-e7ff-455c-a0ff-38523525f703, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_05_36dd19be-a7c7-4c8a-80ef-6d3e50935e96, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_06_e9fe5070-71d6-419f-85aa-d8d004298a15, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_07_d3b6bc21-10b6-4c97-a5aa-36ce4d3a5d87, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_08_0e8a9a6d-7180-4b3e-add6-503b77ea7b3d, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_09_13710c93-563b-425f-853e-449d143e24cb, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_10_7dd6e0b2-cf62-4567-960d-b625a9d2cf2e, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_11_da333ca9-7eb0-4deb-96a6-efaef1ff88fb, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_12_3d8cd464-7381-44ff-8ef4-66ead55842f2, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_13_9e031a86-879c-4d80-9d06-91b6a5d5c314, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_14_2df2d886-9f94-4880-a04b-2da4a72d0f82, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_15_b07ef2d3-ef38-44ee-9d00-a5ecd9edcfe9, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_16_32bc8d81-7cfb-40ec-84a3-1f8e07b37cb4, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_17_d4cf6978-f741-4d16-b7a8-3a2c7f2f0702, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_AudienceHall_BaneGhost_18_64ce21e8-ad27-435b-9edf-18f4c925e7f8, "WYR_WyrmRock_AudienceHall");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_01_beea882c-0f2c-4224-95a0-c275cde076d8, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_02_66db3397-7738-443b-b939-e0782c60be8c, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_03_582d2ef8-c7e0-41ce-b1c6-15b1a6562a84, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_04_cd474646-affe-4556-af1f-9c0982e6c9c4, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_05_12299094-7f38-4612-becb-a30c7493241d, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_06_7264b5d5-cbc4-4da0-a0be-34727c3049c7, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_07_1e816caf-42db-435a-87b3-b236bcdb68a6, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_08_027d8705-11bb-4697-8d3f-8918554ff45f, "WYR_WyrmRock_Office");
DB_WYR_Gortash_BaneGhosts(S_WYR_Gortash_Office_BaneGhost_09_cc1a0bb3-730d-4fcb-850e-000f3679b424, "WYR_WyrmRock_Office");

//REGION Manifestations in Audience Hall
// Current AD, Next Speaker, Next AD
DB_WYR_Gortash_BaneGhosts_AudienceHallADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_001_0d90200c-baf7-f1bb-8d8b-917dddb96ef9, (CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_08_0e8a9a6d-7180-4b3e-add6-503b77ea7b3d, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_002_8d78be96-ad36-f868-b2b9-fe52f4a384cc);
DB_WYR_Gortash_BaneGhosts_AudienceHallADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_002_8d78be96-ad36-f868-b2b9-fe52f4a384cc, (CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_15_b07ef2d3-ef38-44ee-9d00-a5ecd9edcfe9, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_003_5b640e68-d434-b863-f49f-37a0bbd23e2d);
DB_WYR_Gortash_BaneGhosts_AudienceHallADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_003_5b640e68-d434-b863-f49f-37a0bbd23e2d, (CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_12_3d8cd464-7381-44ff-8ef4-66ead55842f2, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_004_de730c3a-2ff1-484b-58b0-69e3799217f6);
DB_WYR_Gortash_BaneGhosts_AudienceHallADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_004_de730c3a-2ff1-484b-58b0-69e3799217f6, (CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_14_2df2d886-9f94-4880-a04b-2da4a72d0f82, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_005_e33ae970-3d09-b311-0a55-b09241b3753f);
DB_WYR_Gortash_BaneGhosts_AudienceHallADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_005_e33ae970-3d09-b311-0a55-b09241b3753f, (CHARACTER)S_WYR_Gortash_AudienceHall_BaneGhost_13_9e031a86-879c-4d80-9d06-91b6a5d5c314, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_006_cec9be96-d287-71aa-55de-8964462bb1db);
//END_REGION

//REGION Manifestations in Office
// Current AD, Next Speaker, Next AD
DB_WYR_Gortash_BaneGhosts_OfficeADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_001_0d90200c-baf7-f1bb-8d8b-917dddb96ef9, (CHARACTER)S_WYR_Gortash_Office_BaneGhost_02_66db3397-7738-443b-b939-e0782c60be8c, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_002_8d78be96-ad36-f868-b2b9-fe52f4a384cc);
DB_WYR_Gortash_BaneGhosts_OfficeADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_002_8d78be96-ad36-f868-b2b9-fe52f4a384cc, (CHARACTER)S_WYR_Gortash_Office_BaneGhost_03_582d2ef8-c7e0-41ce-b1c6-15b1a6562a84, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_003_5b640e68-d434-b863-f49f-37a0bbd23e2d);
DB_WYR_Gortash_BaneGhosts_OfficeADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_003_5b640e68-d434-b863-f49f-37a0bbd23e2d, (CHARACTER)S_WYR_Gortash_Office_BaneGhost_05_12299094-7f38-4612-becb-a30c7493241d, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_004_de730c3a-2ff1-484b-58b0-69e3799217f6);
DB_WYR_Gortash_BaneGhosts_OfficeADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_004_de730c3a-2ff1-484b-58b0-69e3799217f6, (CHARACTER)S_WYR_Gortash_Office_BaneGhost_06_7264b5d5-cbc4-4da0-a0be-34727c3049c7, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_005_e33ae970-3d09-b311-0a55-b09241b3753f);
DB_WYR_Gortash_BaneGhosts_OfficeADs((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_005_e33ae970-3d09-b311-0a55-b09241b3753f, (CHARACTER)S_WYR_Gortash_Office_BaneGhost_09_cc1a0bb3-730d-4fcb-850e-000f3679b424, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_006_cec9be96-d287-71aa-55de-8964462bb1db);
//END_REGION

//REGION Backup NPCs rounds for summoning
DB_WYR_Gortash_BackupSummonRound(3);
DB_WYR_Gortash_BackupSummonRound(4);
DB_WYR_Gortash_BackupSummonRound(5);

NOT DB_WYR_WyrmRock_MessHallBodyguards_ForCombat_Random((CHARACTER)NULL_00000000-0000-0000-0000-000000000000);
//END_REGION

//REGION Combat ADs for Gortash
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_001_Combat_4ac3f536-201f-06a0-3928-7065e801c4ac, 1);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_002_Combat_03bdb6b3-c01b-76a7-1b56-ca8965059842, 2);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_003_Combat_ff246e74-cf79-32a7-75ff-cb81bead66d8, 3);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_004_Combat_fab6cfea-93ae-e866-56a1-0023771d3d9f, 4);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_005_Combat_4174a32b-fbae-48b8-0074-2a5e2b0f52fe, 5);
//END_REGION
KBSECTION
IF
DB_WYR_Gortash_BaneGhosts(_BaneGhost, _)
THEN
SetOnStage(_BaneGhost,0);

//REGION Gortash's machines' active VFX
// Shield Capacitors are only active when in combat and Gortash is in the same combat
// Shield Capacitors have "Can Fight" set to false, so they aren't tracked via DB_Is_InCombat
IF
EnteredCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _CombatID)
AND
DB_WYR_Gortash_ShCap(_Item)
AND
IsInCombat(_Item, 1)
AND
CombatGetGuidFor(_Item, _CombatID)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR", 0)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR", -1.0);

IF
EnteredCombat(_Item, _CombatID)
AND
DB_WYR_Gortash_ShCap(_Item)
AND
DB_Is_InCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _CombatID)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR", 0)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR", -1.0);

IF
EnteredCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _CombatID)
AND
DB_WYR_Gortash_ShCap_Broken(_Item)
AND
IsInCombat(_Item, 1)
AND
CombatGetGuidFor(_Item, _CombatID)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING", 0)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING", -1.0);

IF
EnteredCombat(_Item, _CombatID)
AND
DB_WYR_Gortash_ShCap_Broken(_Item)
AND
DB_Is_InCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _CombatID)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING", 0)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING", -1.0);

// Incinerators are active when in combat (whether Gortash is in it or not)
IF
EnteredCombat(_Item, _)
AND
DB_WYR_Gortash_Incinerators(_Item, _)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_INCINERATOR", -1.0);

// Grenade Launchers are active when in combat (whether Gortash is in it or not)
// Grenade Launchers have "Can Fight" set to false, so they aren't tracked via DB_Is_InCombat
IF
EnteredCombat(_Item, _)
AND
DB_WYR_Gortash_GrLaunchers(_Item)
THEN
ApplyStatus(_Item, "WYR_GORTASH_ACTIVE_GRENADELAUNCHER", -1.0);

// Shield Capacitors leave combat when Gortash leaves combat
IF
LeftCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _)
AND
IsInCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 0)
AND
DB_WYR_Gortash_ShCap(_Item)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR", 1)
THEN
RemoveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR");

IF
LeftCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _)
AND
IsInCombat(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 0)
AND
DB_WYR_Gortash_ShCap_Broken(_Item)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING", 1)
THEN
RemoveStatus(_Item, "WYR_GORTASH_ACTIVE_SHIELDCAPACITOR_MALFUNCTIONING");

// incinerators become inactive after leaving combat
IF
LeftCombat(_Item, _)
AND
IsInCombat(_Item, 0)
AND
DB_WYR_Gortash_Incinerators(_Item, _)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_INCINERATOR", 1)
THEN
RemoveStatus(_Item, "WYR_GORTASH_ACTIVE_INCINERATOR");

// grenade launchers become inactive after leaving combat
IF
LeftCombat(_Item, _)
AND
IsInCombat(_Item, 0)
AND
DB_WYR_Gortash_GrLaunchers(_Item)
AND
HasActiveStatus(_Item, "WYR_GORTASH_ACTIVE_GRENADELAUNCHER", 1)
THEN
RemoveStatus(_Item, "WYR_GORTASH_ACTIVE_GRENADELAUNCHER");
//END_REGION

//REGION Gortash's incinerators' danger zones
IF
StatusApplied((ITEM)_Incinerator,"WYR_GORTASH_INCINERATOR_CHARGING",_,_)
AND
DB_WYR_Gortash_Incinerators(_Incinerator,_Helper)
THEN
ApplyStatus(_Helper,"WYR_GORTASH_INCINERATOR_DANGER_AURA",-1.0);
DebugText(_Helper,"Aura added!");

IF
StatusRemoved((ITEM)_Incinerator,"WYR_GORTASH_INCINERATOR_CHARGING",_,_)
AND
DB_WYR_Gortash_Incinerators(_Incinerator,_Helper)
THEN
RemoveStatus(_Helper,"WYR_GORTASH_INCINERATOR_DANGER_AURA");
DebugText(_Helper,"Aura removed!");
//END_REGION

//REGION set Manifestations on stage when Gort casts Bane Shout
IF
CastedSpell((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"Shout_WYR_CallForHelp_Bane_Gortash", _, _, _)
THEN
PROC_TryStartAD(WYR_Gortash_CallForHelp_80636bb3-181a-7d3b-019b-d497a8dbd62c, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
CastedSpell((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"Shout_WYR_CallForHelp_Bane_Gortash", _, _, _)
AND
QRY_WYR_KillDirectorGortash_SummonInOffice()
AND
DB_WYR_Gortash_BaneGhosts(_BaneGhost, "WYR_WyrmRock_Office")
THEN
PlayEffect(_BaneGhost,VFX_Enemies_Raphael_Summon_EternalDebtor_Impact_Textkey_01_903cae0a-6790-3cef-a69c-3f0803310852,"",1.0);
SetOnStage(_BaneGhost,1);
SetFlag((FLAG)GLO_State_NoCower_8180293e-4d0d-4e9b-9dfc-b195d4c67ddb,_BaneGhost);

IF
CastedSpell((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"Shout_WYR_CallForHelp_Bane_Gortash", _, _, _)
AND
NOT QRY_WYR_KillDirectorGortash_SummonInOffice()
AND
DB_WYR_Gortash_BaneGhosts(_BaneGhost, "WYR_WyrmRock_AudienceHall")
THEN
PlayEffect(_BaneGhost,VFX_Enemies_Raphael_Summon_EternalDebtor_Impact_Textkey_01_903cae0a-6790-3cef-a69c-3f0803310852,"",1.0);
SetOnStage(_BaneGhost,1);
SetFlag((FLAG)GLO_State_NoCower_8180293e-4d0d-4e9b-9dfc-b195d4c67ddb,_BaneGhost);

IF
HitpointsChanged(_BaneGhost,_)
AND
DB_WYR_Gortash_BaneGhosts((CHARACTER)_BaneGhost, _)
THEN
SetCanJoinCombat(_BaneGhost,1);

IF
Died(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
DB_WYR_Gortash_BaneGhosts(_BaneGhost, _)
THEN
SetOnStage(_BaneGhost,0);

QRY
QRY_WYR_KillDirectorGortash_SummonInOffice()
AND
IsInTrigger(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (TRIGGER)S_WYR_WyrmRock_RoofArea_6f590602-360a-4b7f-b936-f04f44a33dee, 1)
THEN
DB_NOOP(1);

QRY
QRY_WYR_KillDirectorGortash_SummonInOffice()
AND
DB_GlobalFlag((FLAG)WYR_KillDirectorGortash_State_InOffice_12233623-2dc3-4dbe-b493-b491fdf6321d)
THEN
DB_NOOP(1);

// start audience hall chanting
IF
WentOnStage(S_WYR_Gortash_AudienceHall_BaneGhost_07_d3b6bc21-10b6-4c97-a5aa-36ce4d3a5d87, 1)
THEN
DB_WYR_KillDirectorGortash_ChantingInAudienceHall(1);
RealtimeObjectTimerLaunch(S_WYR_Gortash_AudienceHall_BaneGhost_07_d3b6bc21-10b6-4c97-a5aa-36ce4d3a5d87, "WYR_KillDirectorGortash_ChantDelay", 1000);

// start office chanting
IF
WentOnStage(S_WYR_Gortash_Office_BaneGhost_01_beea882c-0f2c-4224-95a0-c275cde076d8, 1)
THEN
DB_WYR_KillDirectorGortash_ChantingInOffice(1);
RealtimeObjectTimerLaunch(S_WYR_Gortash_Office_BaneGhost_01_beea882c-0f2c-4224-95a0-c275cde076d8, "WYR_KillDirectorGortash_ChantDelay", 1000);

IF
ObjectTimerFinished(_BaneGhost, "WYR_KillDirectorGortash_ChantDelay")
THEN
PROC_TryStartAD((DIALOGRESOURCE)WYR_KillDirectorGortash_AD_ManifestationOfTyranny_001_0d90200c-baf7-f1bb-8d8b-917dddb96ef9, _BaneGhost);

// chain ADs in the Audience Hall
IF
AutomatedDialogEnded(_ManifestationOfTyrannyAD, _)
AND
DB_WYR_KillDirectorGortash_ChantingInAudienceHall(1)
AND
DB_WYR_Gortash_BaneGhosts_AudienceHallADs(_ManifestationOfTyrannyAD, _NextBaneGhost, _NextAD)
THEN
PROC_TryStartAD(_NextAD, _NextBaneGhost);

// chain ADs in the Office
IF
AutomatedDialogEnded(_ManifestationOfTyrannyAD, _)
AND
DB_WYR_KillDirectorGortash_ChantingInOffice(1)
AND
DB_WYR_Gortash_BaneGhosts_OfficeADs(_ManifestationOfTyrannyAD, _NextBaneGhost, _NextAD)
THEN
PROC_TryStartAD(_NextAD, _NextBaneGhost);
//END_REGION

/*IF 
TurnStarted(_Capacitor)
AND
DB_WYR_GortashCombat_Machines_ShieldCapacitors(_Capacitor)
THEN
UseSpell(_Capacitor,"Projectile_Fireball",(CHARACTER)Humans_Male_FlamingFist_Cleric_001_f275205a-ba57-49c2-8351-e23fe6080005);

IF
CastedSpell((ITEM)_Capacitor,_Action,_,_,_)
AND
DB_WYR_GortashCombat_Machines_ShieldCapacitors(_Capacitor)
THEN
EndTurn(_Capacitor);

IF 
TurnStarted(_Machine)
AND
DB_WYR_GortashCombat_Machines_Weapons(_Machine,_Action)
THEN
UseSpell(_Machine,_Action,_Machine);

IF
CastedSpell((ITEM)_Machine,_Action,_,_,_)
AND
DB_WYR_GortashCombat_Machines_Weapons(_Machine,_Action)
THEN
EndTurn(_Machine);
*/

//REGION Backup NPCs from the Mess Hall
IF
DB_WYR_WyrmRock_MessHallBodyguards(_MessHallBodyguard, _)
THEN
DB_WYR_WyrmRock_MessHallBodyguards_ForCombat((CHARACTER)_MessHallBodyguard);

// prevents assert db is defined, but never checked
IF
DB_WYR_WyrmRock_MessHallBodyguards_ForCombat((CHARACTER)_MessHallBodyguard)
THEN
DB_NOOP(1);

IF
EnteredCombat((CHARACTER)_NPC, _CombatID)
AND
DB_WYR_KillDirectorGortash_AudienceHallNPCs(_NPC, _, _, _, _)
AND
NOT DB_WYR_KillDirectorGortash_AudienceHallCombatID(_)
AND
GetRegion(_NPC, "BGO_Main_A") // Ravegnard & Gortash can leave BGO_Main_A
THEN
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID);

IF
EnteredCombat((CHARACTER)_NPC, _CombatID)
AND
DB_WYR_KillDirectorGortash_CeremonySteelWatchers(_NPC)
AND
NOT DB_WYR_KillDirectorGortash_AudienceHallCombatID(_)
THEN
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID);

IF
EnteredCombat((CHARACTER)_NPC, _CombatID)
AND
DB_WYR_WyrmRock_AudienceHallGuards(_NPC, _)
AND
NOT DB_WYR_KillDirectorGortash_AudienceHallCombatID(_)
THEN
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID);

IF
SwitchedCombat(_NPC, _CombatID, _NewCombatID)
AND
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID)
THEN
NOT DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID);
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_NewCombatID);

IF
CombatRoundStarted(_CombatID, _CombatRound)
AND
DB_WYR_KillDirectorGortash_AudienceHallCombatID(_CombatID)
AND
DB_WYR_Gortash_BackupSummonRound(_CombatRound)
THEN
PROC_WYR_Gortash_SummonRandomBodyguardToAudienceHall();
PROC_WYR_Gortash_SummonRandomBodyguardToAudienceHall();

PROC
PROC_WYR_Gortash_SummonRandomBodyguardToAudienceHall()
AND
QRY_GetRandom("DB_WYR_WyrmRock_MessHallBodyguards_ForCombat", 1, "DB_WYR_WyrmRock_MessHallBodyguards_ForCombat_Random")
AND
DB_WYR_WyrmRock_MessHallBodyguards_ForCombat_Random((CHARACTER)_Bodyguard)
THEN
NOT DB_WYR_WyrmRock_MessHallBodyguards_ForCombat(_Bodyguard);
SetFlag(WYR_KillDirectorGortash_State_ReinforcementsEngaged_d91b5175-9518-490e-85f8-f2365a5f2980, _Bodyguard, 0);
PROC_ForceStopDialog(_Bodyguard);
PROC_NotifyWhenReadyToMoveOn(_Bodyguard, "WYR_KillDirectorGortash_GoToAudienceHall");

PROC
PROC_ReadyToMoveOn(_Bodyguard, "WYR_KillDirectorGortash_GoToAudienceHall")
AND
DB_WYR_KillDirectorGortash_MessHallBodyguards(_Bodyguard, _BackupPos)
THEN
SetCombatGroupID(_Bodyguard, ""); // we need to avoid the situation where one bodyguards enter the Audience Hall and the rest of the bodyguards enter the fight while still in the Mess Hall
PROC_CharacterMoveTo(_Bodyguard, _BackupPos, "Run", "WYR_KillDirectorGortash_CameToAudienceHall");

// try to add to Steel Watchers combat group if any of them alive
// then try to add to guards combat group if any of them alive
// otherwise add to their initial cmb group one by one and rely on Anubis behavior to walk around and look for players
IF
EntityEvent(_BackupNPC, "WYR_KillDirectorGortash_CameToAudienceHall")
AND
NOT QRY_WYR_KillDirectorGortash_AddToCeremonySteelWatchersCombatGroup(_BackupNPC)
AND
NOT QRY_WYR_KillDirectorGortash_AddToCeremonyGuardsCombatGroup(_BackupNPC)
THEN
SetCombatGroupID(_BackupNPC, "WYR_WyrmRock_BodyguardsInAudienceHall"); // new CG, made in scripting, that's why we use a name

QRY
QRY_WYR_KillDirectorGortash_AddToCeremonySteelWatchersCombatGroup((GUIDSTRING)_BackupNPC)
AND
QRY_WYR_KillDirectorGortash_CeremonySteelWatchersAlive()
THEN
SetCombatGroupID(_BackupNPC, "e28dfc2c-b966-a0b7-fa93-5400f8e053c7"); // WYR_AudienceHall_SteelWatchers, existing CG, need to use UUID

QRY
QRY_WYR_KillDirectorGortash_AddToCeremonyGuardsCombatGroup((GUIDSTRING)_BackupNPC)
AND
QRY_WYR_KillDirectorGortash_CeremonyGuardsAlive()
THEN
SetCombatGroupID(_BackupNPC, "6cabaf7d-24c4-40f2-87b6-5572d740a01d"); // WYR_WyrmRock_AudienceHallGuards, existing CG, need to use UUID

QRY
QRY_WYR_KillDirectorGortash_CeremonySteelWatchersAlive()
AND
DB_WYR_KillDirectorGortash_CeremonySteelWatchers(_SW)
AND
NOT DB_Defeated(_SW)
THEN
DB_NOOP(1);

QRY
QRY_WYR_KillDirectorGortash_CeremonyGuardsAlive()
AND
NOT DB_GlobalFlag(WYR_WyrmRock_State_AudienceHallGuards_Defeated_b54a4637-0a52-4ac0-ae63-50fcbf801a7f)
THEN
DB_NOOP(1);
//END_REGION

//REGION Combat ADs
IF
FlagSet((FLAG)WYR_KillDirectorGortash_State_InOffice_12233623-2dc3-4dbe-b493-b491fdf6321d, _, _)
THEN
NOT DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_001_Combat_4ac3f536-201f-06a0-3928-7065e801c4ac, 1);
NOT DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_002_Combat_03bdb6b3-c01b-76a7-1b56-ca8965059842, 2);
NOT DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_003_Combat_ff246e74-cf79-32a7-75ff-cb81bead66d8, 3);
NOT DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_004_Combat_fab6cfea-93ae-e866-56a1-0023771d3d9f, 4);
NOT DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_005_Combat_4174a32b-fbae-48b8-0074-2a5e2b0f52fe, 5);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_002_Combat_03bdb6b3-c01b-76a7-1b56-ca8965059842, 1);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_003_Combat_ff246e74-cf79-32a7-75ff-cb81bead66d8, 2);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_004_Combat_fab6cfea-93ae-e866-56a1-0023771d3d9f, 3);
DB_CombatReact_AD_OnTurn((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (DIALOGRESOURCE)WYR_KillDirectorGortash_AD_TakingTurn_005_Combat_4174a32b-fbae-48b8-0074-2a5e2b0f52fe, 4);
//END_REGION

//REGION Goal Completion
IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _)
THEN
GoalCompleted;
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3"
