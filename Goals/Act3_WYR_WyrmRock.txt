Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Plaques
DB_ItemDialog_NarratorAD((ITEM)S_WYR_WyrmRock_Plaque_Barracks_2143fc46-029e-435d-a7e5-96258c744b62, (DIALOGRESOURCE)WYR_WyrmRock_AD_BarracksPlaque_37331d64-3e70-6c60-7b04-102c1d097a67);
//END_REGION Plaques

//REGION Bridges
// Bridge, Platform, RaisedPos, LoweredPos
DB_WYR_WyrmRock_Bridges((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 
	(LEVELTEMPLATE)S_WYR_WyrmRock_SouthBridge_Platform_e3e915b1-bc8c-4fcb-970d-37a3305508d2);

DB_WYR_WyrmRock_Bridges((ITEM)S_WYR_WyrmRock_NorthBridge_4f437ef7-6c97-4ad5-bb46-3e7ebbd872ac, 
	(LEVELTEMPLATE)S_WYR_WyrmRock_NorthBridge_Platform_68d8169c-5fd4-4471-abfc-8fdb14cc92f6);

TriggerRegisterForItems((TRIGGER)S_WYR_WyrmRock_SouthBridgeArea_9be3e92c-784e-457d-810f-d51a851f1ca0);
//END_REGION

//REGION South Bridge
DB_HasItemTemplateScriptFlag(1, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea, UNI_WYR_CoronationAccessPass_77cd8eaa-2cde-4a53-bc76-71fb48624406, 2);
DB_HasItemEvent(S_WYR_OpenHand_LowerCityPass_350eba29-7233-42df-be7b-0a0bd375c745, WYR_WyrmRock_SouthBridge_State_HasLowerCityPass_3d57a8de-76c2-4ce3-98bc-6cb6112ccec3);
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea, 20000); // Bribe

DB_Dialogs((CHARACTER)S_WYR_WyrmRock_SouthBridgeGuard_001_44b0baf1-84e8-4a67-bf45-81ee304bc731, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_SouthBridgeGuard_002_8d411482-4c7b-419a-ade1-00571a55cd25, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_002_d4e207ec-d849-354e-c2de-02ba89d0630e);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_SouthBridgeGuard_003_7a5a9b6d-2200-431e-a41f-bfddef7cd45c, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_003_36044804-743e-37f8-fb8a-69172114e96c);

PROC_TriggerRegisterForPlayers((TRIGGER)S_WYR_WyrmRock_SouthBridgePassArea_b05f4b57-73c4-4435-b1b0-c54d12fde02c);
DB_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_SouthBridge_State_GainedAccess_4002c43d-55f3-4d1c-b170-f0ffa1f6b5fd, (DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea);

DB_DefeatedStateFlag(S_WYR_WyrmRock_SouthBridgeGuard_001_44b0baf1-84e8-4a67-bf45-81ee304bc731, (FLAG)WYR_WyrmRock_SouthBridge_State_MainGuardDefeated_da8fac26-d8f8-4fe9-813f-3a2af1d630ad);

// Voice bark
DB_OneShot_VoiceBarkTrigger((TRIGGER)S_WYR_WyrmRock_SouthBridge_WyllComment_Trigger_51d0f771-d494-47c0-aed0-e8fdc5f5b7fc,(VOICEBARKRESOURCE)WYR_WyrmRock_SouthBridge_VB_WyllComment_abb9a297-f49e-598a-0566-ce7096af73c0);
//END_REGION South Bridge 

//REGION Armoury
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_Quartermaster_831fbc36-b0df-4248-9c39-50906b715d25, (DIALOGRESOURCE)WYR_WyrmRock_Quartermaster_7e22c89c-72fc-e2f5-ba50-8435f57be76d);
DB_DialogBlockTradeButton((DIALOGRESOURCE)WYR_WyrmRock_Quartermaster_7e22c89c-72fc-e2f5-ba50-8435f57be76d);
DB_DialogMoneyTransfer(1, WYR_WyrmRock_Quartermaster_7e22c89c-72fc-e2f5-ba50-8435f57be76d, 500); // Bribe

DB_TrespassTrigger((TRIGGER)S_WYR_WyrmRock_ArmouryTrespassingArea_ca855680-d3a0-46d3-a045-7bbced5bcdaa, S_WYR_WyrmRock_ArmouryOutPos_ea8629d1-355c-4385-9516-d2eb2e63c8d2, "WYR_WyrmRock_HighSecurityAreaTrespassing");
DB_ItemOwnerShipTriggers("BGO_Main_A", (TRIGGER)S_WYR_WyrmRock_ArmouryOwnershipArea_001_a61b3920-4f84-4839-9528-9de95222625f, (CHARACTER)S_WYR_WyrmRock_Quartermaster_831fbc36-b0df-4248-9c39-50906b715d25);
DB_ItemOwnerShipTriggers("BGO_Main_A", (TRIGGER)S_WYR_WyrmRock_ArmouryOwnershipArea_002_1e15e71d-724f-4c6f-b29e-8b001c7be811, (CHARACTER)S_WYR_WyrmRock_Quartermaster_831fbc36-b0df-4248-9c39-50906b715d25);
//END_REGION Armoury

//REGION Barracks
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_001_875fc0ad-5405-3866-cbe7-58ba8e7c091b);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_002_8d6215af-4a97-6626-92b2-26abe468aeab);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_004_fd3156a1-922a-406e-47e9-71150a57fb61);

DB_WYR_WyrmRock_SleepingBarrackGuards((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2, (ITEM)S_WYR_WyrmRock_BarracksBed_001_5debeee2-1110-470d-9850-57ba740299c8);
DB_WYR_WyrmRock_SleepingBarrackGuards((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b, (ITEM)S_WYR_WyrmRock_BarracksBed_002_900ef02e-9f92-4cd7-b194-ff92c5290dc2);
DB_WYR_WyrmRock_SleepingBarrackGuards((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, (ITEM)S_WYR_WyrmRock_BarracksBed_004_77d3ae7e-6a8c-47d5-ac60-43d815ee65d1);

DB_ItemOwnerShipTriggers("BGO_Main_A", (TRIGGER)S_WYR_WyrmRock_BarracksOwnershiptArea_096e5c50-e0db-4785-8d1e-0cdd323e8810, (CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2);

TriggerRegisterForItems(S_WYR_WyrmRock_CheckWeaponsZone_b6cee22d-ddb6-4121-9f33-a78b4e699a6a);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_001_875fc0ad-5405-3866-cbe7-58ba8e7c091b);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_002_8d6215af-4a97-6626-92b2-26abe468aeab);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_004_fd3156a1-922a-406e-47e9-71150a57fb61);
//END_REGION Barracks

//REGION Barracks - Flaming Fist Thief
DB_GLO_ExclusiveFlag("WYR_WyrmRock_FlamingFistThief", (FLAG)WYR_WyrmRock_FlamingFistThief_State_LockpickingChest_cd42d2db-19c3-4707-889f-84d8a6204549);
DB_GLO_ExclusiveFlag("WYR_WyrmRock_FlamingFistThief", (FLAG)WYR_WyrmRock_FlamingFistThief_State_SittingInChair_3bedc771-9f83-4b83-8e0c-ecc93e4669df); 
DB_GLO_ExclusiveFlag("WYR_WyrmRock_FlamingFistThief", (FLAG)WYR_WyrmRock_FlamingFistThief_Event_WalkAway_c2d2a419-d397-4053-9d90-afb6c66571db);
SetFlag(WYR_WyrmRock_State_FlamingFistThief_LockpickingChest_cd42d2db-19c3-4707-889f-84d8a6204549, NULL_00000000-0000-0000-0000-000000000000);

AddGold(S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, 300);
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc, 300, 2, 1); // player gives money to FF Thief
DB_DialogMoneyTransfer(2, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc, 50, 1, 1); // FF Thief gives money to Player

PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "Trespassing");
PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2, "WYR_WyrmRock_BarracksTrespassingFlamingFistThief");
PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b, "WYR_WyrmRock_BarracksTrespassingFlamingFistThief");
PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, "WYR_WyrmRock_BarracksTrespassingFlamingFistThief");
PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "WYR_WyrmRock_LowSecurityAreaTrespassing");
PROC_CharacterDisableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "KeepAnEyeOnMe");

DB_TrespassTrigger(S_WYR_WyrmRock_BarracksTrespassingAreaFFThief_9043a52c-7c43-4171-9db0-e0de26571b38, (TRIGGER)S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240, "WYR_WyrmRock_BarracksTrespassingFlamingFistThief");

DB_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_PlayerWakedUpBarracksGuards_5fbdef68-18ce-42d8-a206-572088d6a52a, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);
DB_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_FFWakedUpBarracksGuards_471a1fea-5800-481b-b27c-2f47204370df, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);
DB_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_FlamingFistThief_Event_WalksAway_c2d2a419-d397-4053-9d90-afb6c66571db, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);

DB_WYR_WyrmRock_InterrogationPositions((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2, S_WYR_WyrmRock_BarracksGuard_001_InterrogationPos_5182879c-1554-406a-bc7e-6c807fa9e132);
DB_WYR_WyrmRock_InterrogationPositions((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b, S_WYR_WyrmRock_BarracksGuard_002_InterrogationPos_3e734758-8be3-4766-bebd-3f151efb490e);
DB_WYR_WyrmRock_InterrogationPositions((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, S_WYR_WyrmRock_BarracksGuard_004_InterrogationPos_2f370bd2-81e3-402a-999e-201b93128eb7);

DB_DropMutingStatussesDialog((DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93);

PROC_SetOnStage(S_WYR_WyrmRock_FFThief_Stash_ff56c634-8009-4a7e-a995-924f1fde6786, 0);
DB_InvestigationSkillCheckADBlocked((ITEM)S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b);
DB_HasItemEvent((ITEM)S_WYR_WyrmRock_FFThief_StashNote_878bd0e7-b9f7-4508-92e0-fa0915fd5804, WYR_WyrmRock_FlamingFistThief_State_HasStashList_666e86b8-6519-4ea8-9e7b-79ba2ec66784);

DB_FlagReactionAfterDialog((FLAG)WYR_WyrmRock_FlamingFistThief_State_AgreedToGetImprisoned_85087840-8b6a-4ad9-8d36-e7e291180851, (DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93);
DB_FlagReactionAfterDialog((FLAG)WYR_WyrmRock_FlamingFistThief_State_AgreedToLeave_f076d26f-6dff-4319-88bb-adeb7a731c6a, (DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93);
DB_FlagReactionAfterDialog((FLAG)WYR_WyrmRock_FlamingFistThief_State_AgreedToLeave_f076d26f-6dff-4319-88bb-adeb7a731c6a, (DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc);
//END_REGION Barracks - Flaming Fist Thief

//REGION Flaming Fist Office Guard Room
DB_Dialogs(S_WYR_WyrmRock_FFOfficeGuard_001_536289ba-700c-4990-b0ac-e325011c174e, (DIALOGRESOURCE)WYR_WyrmRock_FFOfficeGuard_001_06f647ba-ad02-d4bd-93dd-ea25790ac012);
DB_Dialogs(S_WYR_WyrmRock_FFOfficeGuard_002_1dce766a-e26a-45f8-a7d5-618a3c7bf72c, (DIALOGRESOURCE)WYR_WyrmRock_FFOfficeGuard_002_aad02b9d-9d12-69dc-0f12-b862fd9cac1a);
DB_Dialogs(S_WYR_WyrmRock_FFOfficeGuard_003_b7f14bc2-5fa5-4072-9cd4-7fa9ad673dc0, (DIALOGRESOURCE)WYR_WyrmRock_FFOfficeGuard_003_a9deb44b-fe44-dc9f-fd51-0a7edb86a022);
DB_Dialogs(S_WYR_WyrmRock_FFOfficeGuard_004_7f023df7-03e0-4d65-96ef-984be7392ba2, (DIALOGRESOURCE)WYR_WyrmRock_FFOfficeGuard_004_6e756c69-bafe-283b-a2e5-a15b4d118a92);

DB_ItemOwnerShipTriggers("BGO_Main_A", S_WYR_WyrmRock_FFOfficeOwnershipArea_1b3cb058-169d-44bd-a746-dbb7d83bb762, (CHARACTER)S_WYR_WyrmRock_FFOfficeGuard_001_536289ba-700c-4990-b0ac-e325011c174e);
//END_REGION Flaming Fist Office Guard Room

//REGION North Bridge
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_NorthBridgeGuard_001_352d8f42-9588-4bce-b206-e031f4f3f36f, (DIALOGRESOURCE)WYR_WyrmRock_NorthBridgeGuard_001_3dbaff79-e4cc-6a61-b827-6a57e2b91abc);
//END_REGION North Bridge

//REGION Gortash Invitation
DB_DropMutingStatussesDialog((DIALOGRESOURCE)WYR_WyrmRock_SteelWatcherInvitation_b3b7e371-5ea7-9824-9ed8-4b2b153d0882);

DB_SpotPlayers((CHARACTER)S_WYR_WyrmRock_ArmourySteelWatcher_001_8dfc3747-560a-4811-945a-44f898cf0ed9, "WYR_WyrmRock_GortashInvitation", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers((CHARACTER)S_WYR_Fortress_SteelWatcher001_02a6e843-0fd5-41da-b59f-2824fad054d8, "WYR_WyrmRock_GortashInvitation", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_SouthBridgeSteelWatcher_001_84b90470-d957-4acd-9e43-98adfd29d0d2);
DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_SouthBridgeSteelWatcher_002_908a04ff-13c7-4dc1-b70f-1f7d6771f03b);
DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_SouthBridgeSteelWatcher_003_e5940d00-1ad1-4ed8-a222-fbb8862cce76);
DB_WYR_WyrmRockWatchers(S_WYR_Fortress_SteelWatcher001_02a6e843-0fd5-41da-b59f-2824fad054d8);
//DB_WYR_WyrmRockWatchers(S_WYR_Fortress_SteelWatcher002_0f2a2177-ef70-4c05-9777-78274031846e); // in the same room as S_WYR_Fortress_SteelWatcher001
DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_MessHallSteelWatcher_001_9754bb84-8146-4b9f-956e-855c079d47a8);
DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_ArmourySteelWatcher_001_8dfc3747-560a-4811-945a-44f898cf0ed9);
DB_WYR_WyrmRockWatchers(S_WYR_WyrmRock_NorthBridgeSteelWatcher_001_b3e4b592-b105-452c-bec1-052c7cd788c9);


//END_REGION Gortash Invitation

//REGION Mess Hall
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallGuard_001_bca3d3e3-3ddc-4ba2-8ad5-58afec936933, (DIALOGRESOURCE)WYR_WyrmRock_MessHallGuard_001_f3934217-effe-3106-357f-3b20cc46079e);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_001_2c553951-81ba-472e-98e3-7e688116c8c0, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_001_d15a8dd2-c12a-a7ab-af18-9470a42dd312);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_002_214fd102-81e0-4492-8bef-389c66dcd7dc, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_002_0098ad7e-298f-8d49-a62f-0f1549211d95);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_003_36078682-fde3-40cc-8f26-c238cb10c75e, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_003_cf7f2052-5741-0eae-dc9a-c39d552fed3f);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_004_80511a28-308f-486c-ac56-2c84e1c36f91, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_004_f5e48e6b-2540-59ca-6204-2665e018d0ec);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_005_ed5b7cbe-b4e3-4687-a4e5-d2b120720b97, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_005_5dff9d5d-d183-1760-d215-67b5a997c594);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_006_6e383e38-7cde-4180-8eeb-b406ea90e365, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_006_f6034ce7-153b-f5d4-15ed-04e7c484b9df);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_007_362acbc1-e8ce-44f7-8086-f01b7175070b, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_007_cf3f0cfc-8ba3-e374-1acd-1e35024045bf);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_008_c183baeb-2677-4340-8896-eccfb3ff2952, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_008_ce0960e0-4615-7f74-6094-dbad4fb45edf);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_009_ef4022b9-6a19-469a-a822-8fbea29bf727, (DIALOGRESOURCE)WYR_WyrmRock_MessHallBodyguard_009_e670692d-937e-a3c9-668f-3afa3ad6e3c2);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallCook_1ad44c05-4065-4c57-9b24-cab1378dca93, (DIALOGRESOURCE)WYR_WyrmRock_MessHallCook_a6e1bf3c-ef89-29df-5fc9-4cb5c5569906);
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_MessHallWaiter_aa01fd84-b94f-43be-8fd8-c4346ea1e7da, (DIALOGRESOURCE)WYR_WyrmRock_MessHallWaiter_3b1751ea-b1ff-8fdb-b1a7-d820db31d617);

DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_001_2c553951-81ba-472e-98e3-7e688116c8c0, (TRIGGER)S_WYR_WyrmRock_Bodyguard_001_DeathPos_0a3359d3-5b7a-4761-b20b-07b133505187);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_002_214fd102-81e0-4492-8bef-389c66dcd7dc, (TRIGGER)S_WYR_WyrmRock_Bodyguard_002_DeathPos_8b2dcc3e-1b4a-4765-9a2f-92c0bb0c4494);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_003_36078682-fde3-40cc-8f26-c238cb10c75e, (TRIGGER)S_WYR_WyrmRock_Bodyguard_003_DeathPos_c5af6acf-d95f-41c1-8f73-1e6121f9c280);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_004_80511a28-308f-486c-ac56-2c84e1c36f91, (TRIGGER)S_WYR_WyrmRock_Bodyguard_004_DeathPos_222eee28-1d75-4c7e-bc50-de9d827aebb3);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_005_ed5b7cbe-b4e3-4687-a4e5-d2b120720b97, (TRIGGER)S_WYR_WyrmRock_Bodyguard_005_DeathPos_87534f94-6da2-4cb1-a719-64d9e4519b13);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_006_6e383e38-7cde-4180-8eeb-b406ea90e365, (TRIGGER)S_WYR_WyrmRock_Bodyguard_006_DeathPos_ca323fe4-0f6f-47b6-85e2-ae24758986b1);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_007_362acbc1-e8ce-44f7-8086-f01b7175070b, (TRIGGER)S_WYR_WyrmRock_Bodyguard_007_DeathPos_9e43acb9-143c-4099-8d47-efb512536b7b);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_008_c183baeb-2677-4340-8896-eccfb3ff2952, (TRIGGER)S_WYR_WyrmRock_Bodyguard_008_DeathPos_4f721b58-494b-434f-b53c-a28aac1f2981);
DB_WYR_WyrmRock_MessHallBodyguards((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_009_ef4022b9-6a19-469a-a822-8fbea29bf727, (TRIGGER)S_WYR_WyrmRock_Bodyguard_009_DeathPos_e9d14004-0be3-4e27-9e40-d14c845a867d);

DB_WYR_WyrmRock_SteelWatcherDiscussionNPCs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_002_214fd102-81e0-4492-8bef-389c66dcd7dc);
DB_WYR_WyrmRock_SteelWatcherDiscussionNPCs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_003_36078682-fde3-40cc-8f26-c238cb10c75e);
DB_WYR_WyrmRock_SteelWatcherDiscussionNPCs((CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_008_c183baeb-2677-4340-8896-eccfb3ff2952);


DB_ItemOwnerShipTriggers("BGO_Main_A", (TRIGGER)S_WYR_WyrmsRock_MessHall_Ownership_71b2fbb9-30db-47d5-b4f9-3f091a6acbb3, (CHARACTER)S_WYR_WyrmRock_MessHallGuard_001_bca3d3e3-3ddc-4ba2-8ad5-58afec936933);
DB_ItemOwnerShipTriggersFallback((TRIGGER)S_WYR_WyrmsRock_MessHall_Ownership_71b2fbb9-30db-47d5-b4f9-3f091a6acbb3, (CHARACTER)S_WYR_WyrmRock_MessHallCook_1ad44c05-4065-4c57-9b24-cab1378dca93);
DB_ItemOwnerShipTriggersFallback((TRIGGER)S_WYR_WyrmsRock_MessHall_Ownership_71b2fbb9-30db-47d5-b4f9-3f091a6acbb3, (CHARACTER)S_WYR_WyrmRock_MessHallWaiter_aa01fd84-b94f-43be-8fd8-c4346ea1e7da);
//END_REGION Mess Hall

//REGION Audience Hall
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_001_d3dea7b0-3c9d-431b-9671-e6a00b726a9c, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_001_352181ae-29c1-b43b-3044-d67548b60784);
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_002_7b486e65-0a3d-4c07-8ddd-0a1012846923, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_002_5861f895-8fe8-0fc7-97d9-384d98be2af8);
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_003_4c3df6e8-51f4-42d3-a895-bfb92b02b682, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_003_61cc3e83-f6a1-4265-ee92-815d7bfc70e9);
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_004_836595c5-c5eb-433b-b97d-ef3a93b78a4c, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_004_27cc0cd6-ad3b-d193-cb5d-73c9729290ed);
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_005_c3204c45-b2c8-45a7-bf68-24d64e98e593, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_005_ff73f9c4-1dad-0fc0-2869-4169b101f787);
DB_WYR_WyrmRock_AudienceHallGuards((CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_006_6cae7182-8327-4239-9de6-85e573a6df7c, (DIALOGRESOURCE)WYR_WyrmRock_AudienceHallGuard_006_8f315ca8-8498-191e-1f47-e796884dd0d6);
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("WYR_WyrmRock_AudienceHallGuards",WYR_WyrmRock_State_AudienceHallGuards_Defeated_b54a4637-0a52-4ac0-ae63-50fcbf801a7f);

DB_ItemOwnerShipTriggers("BGO_Main_A", (TRIGGER)S_WYR_WyrmsRock_AudienceHall_Ownership_a6ea8c9d-a3c6-4525-b20f-716b6cbfecbe, (CHARACTER)S_WYR_AudienceHall_SteelWatcher_004_fc380f9b-a440-4356-aaa1-7e74311f17e7);
DB_ItemOwnerShipTriggersFallback((TRIGGER)S_WYR_WyrmsRock_AudienceHall_Ownership_a6ea8c9d-a3c6-4525-b20f-716b6cbfecbe, (CHARACTER)S_WYR_WyrmRock_AudienceHallGuard_001_d3dea7b0-3c9d-431b-9671-e6a00b726a9c);
//END_REGION Audience Hall

//REGION Roof
DB_Dialogs((CHARACTER)S_WYR_WyrmRock_RoofGuard_001_2de31d40-ad10-4051-8901-4ad9609bcf6c, WYR_WyrmRock_RoofGuard_001_64595d0d-a349-c116-f05a-5778d8c4c57d);
//END_REGION

//REGION Alert State - Faction to become hostile
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_Prison_5ebe11a9-688f-44b7-ad4b-e86f8e0e790c);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_Barracks_a580cc4f-002b-436c-9a75-d666b09080d1);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_MessHallGuards_a3b7f4b5-ab95-4dc1-9be4-58ec447e104b);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_FlamingFistOffice_c4855605-0e11-4085-b2dc-5fe4cce5c946);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_AudienceHallBanites_6d14a589-c830-43d8-a78f-89684618db2b);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_AudienceHallGuards_88a87bc9-bd1b-4308-a283-df7a0fb282c8);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_PatriarBodyguards_a3d9c39b-23bc-4974-a99d-43f123641741);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_RoofSteelWatchers_523adbc8-5a94-4b33-aaac-1d1941fb1ac8);
DB_WYR_WyrmRock_AlertStateHostileFactions((FACTION)ACT3_WYR_WyrmRock_NorthBridge_67dad9b2-237c-43b8-b4fd-b82edf2f1138);
//END_REGION

//REGION WYR_FindWayIntoWyrmRock Journal
// Helper DBs
DB_WYR_Journal_FindWayIntoWyrmRock_Templates((ROOT)UNI_WYR_CoronationAccessPass_77cd8eaa-2cde-4a53-bc76-71fb48624406, (FLAG)WYR_Journal_FindWayIntoWyrmRock_State_GotCoronationPass_6890bd5b-954a-43bb-a845-45ec8ed2a6f1);
DB_WYR_Journal_FindWayIntoWyrmRock_Templates((ROOT)UNI_WYR_LowerCityPass_0a172d65-748c-4ff1-bf66-200fceb5ca79, (FLAG)WYR_Journal_FindWayIntoWyrmRock_State_GotLowerCityPass_a0f00fb0-dcb7-4603-9e86-23650e93bf9e);

DB_QuestDef_State((FLAG)WYR_WyrmRock_SouthBridge_Knows_FortressClosed_cd9ab671-ec0e-4f74-bb64-ca14a0c7e11e, "WYR_FindWayIntoWyrmRock", "FortressClosed");
DB_QuestDef_BookReadState("WYR_FindWayIntoWyrmRock", "GotSecretEntranceMap", PUZ_GEN_Map_JailSecretEntrance_3a826fbc-bb9c-4164-a510-905c7610693b);
DB_QuestDef_State((FLAG)WYR_Posthouse_State_HasEnvelopeForRavengard_cc01ae34-ee6b-46af-90d9-e179d50bbdbd, "WYR_FindWayIntoWyrmRock", "GotReportForRavengard");
DB_QuestDef_State((FLAG)WYR_Posthouse_State_HasReportForRavengard_0cebf782-e7ec-4a66-b989-85186a25ecde, "WYR_FindWayIntoWyrmRock", "GotReportForRavengard");
DB_QuestDef_State((FLAG)WYR_Journal_FindWayIntoWyrmRock_State_GotLowerCityPass_a0f00fb0-dcb7-4603-9e86-23650e93bf9e, "WYR_FindWayIntoWyrmRock", "GotLowerCityPass");
DB_QuestDef_State((FLAG)WYR_Journal_FindWayIntoWyrmRock_State_GotCoronationPass_6890bd5b-954a-43bb-a845-45ec8ed2a6f1, "WYR_FindWayIntoWyrmRock", "GotCoronationPass");
DB_QuestDef_State((FLAG)WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_Guards_eba53279-5d7f-45db-b104-9a828a4995d0, "WYR_FindWayIntoWyrmRock", "EnteredFortress_Guards");
DB_QuestDef_State((FLAG)WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_NoGuards_c0c71c36-ebe8-4fa4-af09-14e11f971a7b, "WYR_FindWayIntoWyrmRock", "EnteredFortress_NoGuards");

DB_WYR_WyrmRock_EnteredFortressTriggers((TRIGGER)S_WYR_Fortress_SUB_94ca5a54-0813-48b4-9f55-4cb039a63c82);
DB_WYR_WyrmRock_EnteredFortressTriggers((TRIGGER)S_WYR_Prison_SUB_cd67276d-52e4-44b9-a237-0e2cd45106d8);
//END_REGION

//REGION Safe
PROC_SetOnStage(S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7, 0);
//END_REGION

//REGION Steel Watchers inside the Wyrm Rock
// They shouldn't react to EnemyOfAbsolute crime: either Gortash invited us in or the fortress in the alert state
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_000_a8544d37-571c-4bcb-8b4c-c499dbe9c421);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_001_499e5f36-5640-425f-9ff6-13cb646a0bf8);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_002_6cb28cb2-905a-4a45-8040-c14dba941b26);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_003_6622cf7f-a119-4c42-9a1e-b7cc4543dd19);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_004_fc380f9b-a440-4356-aaa1-7e74311f17e7);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_005_12f4bdd7-aaf9-49c1-acb2-8c2e6c13c0c6);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_006_23dfde6d-09f4-4e9b-9ebf-99094f1a269e);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_007_3184594a-cd9a-4faf-921b-a60ff2c71727);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_AudienceHall_SteelWatcher_009_12adabf6-7d53-4e9e-a3e9-17637666b14d);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_KillDirectorGortash_SteelWatcher_5967b1c5-8e3c-4064-83e3-5219aa204c3d);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_KillDirectorGortash_GortashDummySteelWatcher_717f8325-71a0-47cd-8953-ab7848e7dad3);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_Roof_SteelWatcher_001_bd69f993-6c54-4571-820d-1ad6b11dbcfe);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_Roof_SteelWatcher_002_50341882-155e-4fe1-8e10-fc432a4de5db);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_Roof_SteelWatcher_003_73bc5c98-5eb8-499d-b935-00a71280ae5a);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_ArmourySteelWatcher_001_8dfc3747-560a-4811-945a-44f898cf0ed9);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_Roof_SniperSteelWatcher_61013091-60c9-4d36-bbb3-7c866fb47feb);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_NorthBridgeSteelWatcher_001_b3e4b592-b105-452c-bec1-052c7cd788c9);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_MessHallSteelWatcher_001_9754bb84-8146-4b9f-956e-855c079d47a8);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_SouthBridgeSteelWatcher_001_84b90470-d957-4acd-9e43-98adfd29d0d2);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_SouthBridgeSteelWatcher_002_908a04ff-13c7-4dc1-b70f-1f7d6771f03b);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_WyrmRock_SouthBridgeSteelWatcher_003_e5940d00-1ad1-4ed8-a222-fbb8862cce76);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_Fortress_SteelWatcher001_02a6e843-0fd5-41da-b59f-2824fad054d8);
DB_WYR_WyrmRock_SteelWatchers((CHARACTER)S_WYR_Fortress_SteelWatcher002_0f2a2177-ef70-4c05-9777-78274031846e);
//END_REGION

//REGION Civilians and Crowds
// Civilians and Crowds run away when the fortress goes into the alert state or when all the FFs in the area are defeated
DB_GLO_DefeatCounter(S_WYR_WyrmRock_MessHallGuard_001_bca3d3e3-3ddc-4ba2-8ad5-58afec936933, "WYR_WyrmRock_MessHall");

DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_MessHallCook_1ad44c05-4065-4c57-9b24-cab1378dca93, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_MessHallWaiter_aa01fd84-b94f-43be-8fd8-c4346ea1e7da, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_049_891c4169-ee5d-461f-b64a-9234d402407c, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_050_98642e2c-8824-48ab-83e4-86b8c486fa3a, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_051_a33c3cd5-8085-47ea-88cd-7a7fa690edd1, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_052_a22264df-7716-43aa-b7c9-e3a5438863dd, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_053_db3cdb81-3df5-431e-b90f-60cc9a69a1be, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_049_a80129e4-e4ee-431a-a13a-308564c15ca5, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_050_7eb09e87-36eb-46ce-8394-4e500e58d7a0, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_051_b50c0186-7ac4-4abd-9e2e-e7beeaa1771d, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_053_9ba9b147-70a3-4755-9382-8eb0ec0f94e8, "WYR_WyrmRock_MessHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_054_66073f55-60c3-44c5-9a6b-514a58c95d01, "WYR_WyrmRock_MessHall");

DB_GLO_DefeatCounter(S_WYR_WyrmRock_FFOfficeGuard_001_536289ba-700c-4990-b0ac-e325011c174e, "WYR_WyrmRock_FlamingFistsOffice");
DB_GLO_DefeatCounter(S_WYR_WyrmRock_FFOfficeGuard_002_1dce766a-e26a-45f8-a7d5-618a3c7bf72c, "WYR_WyrmRock_FlamingFistsOffice");
DB_GLO_DefeatCounter(S_WYR_WyrmRock_FFOfficeGuard_003_b7f14bc2-5fa5-4072-9cd4-7fa9ad673dc0, "WYR_WyrmRock_FlamingFistsOffice");
DB_GLO_DefeatCounter(S_WYR_WyrmRock_FFOfficeGuard_004_7f023df7-03e0-4d65-96ef-984be7392ba2, "WYR_WyrmRock_FlamingFistsOffice");

DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_TerrifiedLocal_Woman_adcbb246-87d6-46b8-a1a1-56ffced39b72, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_TerrifiedLocal_Man_be670f38-bfd4-4a26-8143-d21f7107ae6f, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WyrmRock_Lawyered_HalfOrc_43b5176f-b2d8-4d60-b901-d90194d50181, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WyrmRock_Lawyered_MaleElf_ccd96056-c992-439b-88b2-2989f158383b, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WyrmRock_Lawyered_FemaleElf_d69fceaf-1a8f-4fc3-b6d9-68d90e4fcfb0, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_001_35f23215-cb97-41ea-a19a-69fbcdfb87a6, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_002_1ad0bc19-781c-4b8c-a2ec-434c1fb87b9c, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_003_52d7945d-75bc-479b-af13-bc8c77733adc, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Civilians((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_004_7f4ec80d-c061-47f2-89bf-c40e679ca207, "WYR_WyrmRock_FlamingFistsOffice");

DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_055_c8329f4f-bb72-44a9-ba15-956ff202af23, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_056_ace08aa3-7165-4585-ad06-9930eb72f4ff, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_058_d5205507-4c3e-43db-83a5-e14bd008da58, "WYR_WyrmRock_FlamingFistsOffice");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_059_746a6ca2-444e-44c7-861f-21ec9a51c7b2, "WYR_WyrmRock_FlamingFistsOffice");

// Audience Hall doesn't require additional scripting
// any combat in the Audience Hall -> fortress goes into the alert state
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_TalkREAC_054_f5874485-88ee-4aac-a830-38ba70e4abd3, "WYR_WyrmRock_AudienceHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_055_a7060238-6fdf-4d64-8458-8af82a03ea9f, "WYR_WyrmRock_AudienceHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_056_a2cb687b-d199-45e2-8188-bf3f4f775d8e, "WYR_WyrmRock_AudienceHall");
DB_WYR_WyrmRock_Crowds((TRIGGER)CCT_BsG_RFG_Talk_057_69004cad-6ee8-4880-a921-b6c21717b4d4, "WYR_WyrmRock_AudienceHall");
//END_REGION

//REGION South Bridge
DB_GLO_ExclusiveFlag("WYR_WyrmRock_SouthBridgeState", (FLAG)WYR_WyrmRock_SouthBridge_State_BridgeLowered_b2ef324c-0a5b-447d-be7e-9d6a84550f68);
DB_GLO_ExclusiveFlag("WYR_WyrmRock_SouthBridgeState", (FLAG)WYR_WyrmRock_SouthBridge_State_BridgeRaised_0a37f68f-2983-4e22-8d0b-33f209fb8c7b);

SetForceUpdate(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1);
PROC_WYR_WyrmRock_InitSouthBridge();
//END_REGION

//REGION Disabled Fake Crowd characters
DB_WYR_WyrmRock_DisabledCrowdCharacters((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_001_35f23215-cb97-41ea-a19a-69fbcdfb87a6);
DB_WYR_WyrmRock_DisabledCrowdCharacters((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_002_1ad0bc19-781c-4b8c-a2ec-434c1fb87b9c);
DB_WYR_WyrmRock_DisabledCrowdCharacters((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_003_52d7945d-75bc-479b-af13-bc8c77733adc);
DB_WYR_WyrmRock_DisabledCrowdCharacters((CHARACTER)S_WYR_WyrmRock_FFOffice_FakeCrowdCharacter_004_7f4ec80d-c061-47f2-89bf-c40e679ca207);
//END_REGION

//REGION Hide turrets that were placed by LD as decorations and never worked
PROC_SetOnStage(PUZ_Trap_Gortash_ShieldCapacitor_000_f548f678-6e8b-496f-a5d9-3cdd7abb3cde, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_ShieldCapacitor_001_52038f5b-9922-448f-9855-cbba35775a6b, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_ShieldCapacitor_002_7ea8300e-afb6-49c9-b2c1-086abae80905, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_ShieldCapacitor_003_f3a194c7-d87e-44d2-a3fe-a707d2e7c707, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_GrenadeInstantiator_002_16fb8595-fcf0-4ac9-b643-6a047739256a, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_GrenadeInstantiator_003_256e2f97-7d59-4498-a26c-5f304a345439, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_GrenadeInstantiator_006_f6695ac3-02b3-414e-87e4-a3cf6c6eba0b, 0);
PROC_SetOnStage(PUZ_Trap_Gortash_GrenadeInstantiator_007_a39fa5e2-90cb-48be-b1fe-ce2c18f63691, 0);
//END_REGION
KBSECTION
//REGION Bridges
IF
TextEvent("checkbridge")
AND
IsOpened((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1)
THEN
DebugBreak("BRIDGE IS OPENED!");

IF
TextEvent("checkbridge")
AND
IsClosed((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1)
THEN
DebugBreak("BRIDGE IS CLOSED!");

IF
TextEvent("openbridge")
THEN
Open(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

IF
TextEvent("closebridge")
THEN
Close(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);


PROC
PROC_WYR_WyrmRock_InitSouthBridge()
THEN
SetEntityEvent((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridgeRaised"); // for NuWT

IF
ItemEnteredTrigger(_Item, (TRIGGER)S_WYR_WyrmRock_SouthBridgeArea_9be3e92c-784e-457d-810f-d51a851f1ca0, _)
AND
_Item != S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab
AND
Exists(_Item,1)
THEN
DB_WYR_WyrmRock_ItemsOnSouthBridge((ITEM)_Item);

IF
ItemLeftTrigger(_Item, S_WYR_WyrmRock_SouthBridgeArea_9be3e92c-784e-457d-810f-d51a851f1ca0, _)
AND
DB_WYR_WyrmRock_ItemsOnSouthBridge(_Item)
THEN
NOT DB_WYR_WyrmRock_ItemsOnSouthBridge(_Item);

// We call LowerBridges and RaiseBridges, but only South bridge can be actually lowered / raised
// Raising the north bridge might the prevent the player from getting back into the fortress
PROC
PROC_WYR_WyrmRock_LowerBridges()
AND
DB_WYR_WyrmRock_Bridges(_Bridge, _)
THEN
PROC_WYR_WyrmRock_LowerBridge(_Bridge);

PROC
PROC_WYR_WyrmRock_RaiseBridges()
AND
DB_WYR_WyrmRock_Bridges(_Bridge, _)
THEN
PROC_WYR_WyrmRock_RaiseBridge(_Bridge);

//REGION Old implementation that can't be patched
PROC
PROC_WYR_WyrmRock_LowerBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
IsForceUpdate(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 0)
THEN
SetForceUpdate(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1);

PROC
PROC_WYR_WyrmRock_LowerBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
DB_GlobalFlag(WYR_WyrmRock_SouthBridge_State_BridgeRaised_0a37f68f-2983-4e22-8d0b-33f209fb8c7b)
THEN
PlayAnimation((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, OBJ_Open_Unused_01_1c8ad609-f780-418e-9fdf-c52f6d749c9f);
RealtimeObjectTimerLaunch(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_BridgeLowering", 4500);

IF
ObjectTimerFinished((ITEM)_Bridge, "WYR_WyrmRock_BridgeLowering")
AND
DB_WYR_WyrmRock_Bridges(_Bridge, _BridgeAiGridPlatform)
THEN
PROC_GlobalSetFlagAndCache(WYR_WyrmRock_SouthBridge_State_BridgeLowered_b2ef324c-0a5b-447d-be7e-9d6a84550f68);
LoadLevelTemplate(_BridgeAiGridPlatform);
SetEntityEvent((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridgeLowered"); // for NuWT

PROC
PROC_WYR_WyrmRock_RaiseBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
IsForceUpdate(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 0)
THEN
SetForceUpdate(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1);

PROC
PROC_WYR_WyrmRock_RaiseBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
DB_GlobalFlag(WYR_WyrmRock_SouthBridge_State_BridgeLowered_b2ef324c-0a5b-447d-be7e-9d6a84550f68)
THEN
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters();
PROC_WYR_WyrmRock_RaiseBridge_Intern((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

PROC
PROC_WYR_WyrmRock_RaiseBridge_Intern((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
DB_WYR_WyrmRock_Bridges(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, _BridgeAiGridPlatform)
THEN
PROC_GlobalSetFlagAndCache(WYR_WyrmRock_SouthBridge_State_BridgeRaised_0a37f68f-2983-4e22-8d0b-33f209fb8c7b);
UnloadLevelTemplate(_BridgeAiGridPlatform);
RealtimeObjectTimerLaunch(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridge_Raising", 500);

IF
ObjectTimerFinished(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridge_Raising")
THEN
PlayAnimation(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, OBJ_Close_Unused_01_a7078367-8eed-4ba7-a436-196774f68a60);
//END_REGION

//REGION New implementation (bridge is a door)
PROC
PROC_WYR_WyrmRock_LowerBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
NOT DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
IsClosed((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1)
THEN
Open((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

IF
Opened((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
DB_WYR_WyrmRock_Bridges(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, _BridgeAiGridPlatform)
THEN
LoadLevelTemplate(_BridgeAiGridPlatform);
SetEntityEvent((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridgeLowered"); // for NuWT
PROC_SetOnStage(S_WYR_WyrmRock_SouthBridge_Blocker_f014b3e9-7d96-4cda-be36-eb251b0fb325, 0);

PROC
PROC_WYR_WyrmRock_RaiseBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
NOT DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
IsOpened((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, 1)
THEN
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters();
PROC_WYR_WyrmRock_RaiseBridge_Intern((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

PROC
PROC_WYR_WyrmRock_RaiseBridge_Intern((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab)
AND
NOT DB_WYR_WyrmRock_UseOldImplementationOfBridges(1)
AND
DB_WYR_WyrmRock_Bridges(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, _BridgeAiGridPlatform)
THEN
UnloadLevelTemplate(_BridgeAiGridPlatform);
RealtimeObjectTimerLaunch(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridge_Raising_New", 500);

IF
ObjectTimerFinished(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab, "WYR_WyrmRock_SouthBridge_Raising_New")
THEN
Close(S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);
PROC_SetOnStage(S_WYR_WyrmRock_SouthBridge_Blocker_f014b3e9-7d96-4cda-be36-eb251b0fb325, 1);
//END_REGION

//REGION Teleporting items and chars off the bridge is universal for both implementation
PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
DB_WYR_WyrmRock_ItemsOnSouthBridge(_Item)
AND
GetPosition((TRIGGER)S_WYR_WyrmRock_SouthBridge_ScatterPoint_6d8fe53b-a1b2-401c-b78e-2ce585ba4855, _X, _Y, _Z)
AND
FindValidPosition(_X, _Y, _Z, 3.0, _Item, 0, _ValidX, _ValidY, _ValidZ)
THEN
DB_WYR_SouthBridgeItemTeleported(1);
TeleportToPosition(_Item, _ValidX, _ValidY, _ValidZ);

//FindValidPosition fallback
PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
NOT DB_WYR_SouthBridgeItemTeleported(1)
AND
DB_WYR_WyrmRock_ItemsOnSouthBridge(_Item)
AND
GetPosition((TRIGGER)S_WYR_WyrmRock_SouthBridge_ScatterPoint_6d8fe53b-a1b2-401c-b78e-2ce585ba4855, _X, _Y, _Z)
THEN
DB_WYR_SouthBridgeItemTeleported(1);
TeleportToPosition(_Item, _X, _Y, _Z);

PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
DB_PartyMembers(_PartyMember)
AND
IsInTrigger(_PartyMember, (TRIGGER)S_WYR_WyrmRock_SouthBridgeArea_9be3e92c-784e-457d-810f-d51a851f1ca0, 1)
AND
GetPosition((TRIGGER)S_WYR_WyrmRock_SouthBridge_ScatterPoint_6d8fe53b-a1b2-401c-b78e-2ce585ba4855, _X, _Y, _Z)
AND
FindValidPosition(_X, _Y, _Z, 5.0, _PartyMember, 0, _ValidX, _ValidY, _ValidZ)
THEN
DB_WYR_SouthBridgePartyMemberTeleported(1);
TeleportToPosition(_PartyMember, _ValidX, _ValidY, _ValidZ);

//FindValidPosition fallback
PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
NOT DB_WYR_SouthBridgePartyMemberTeleported(1)
AND
DB_PartyMembers(_PartyMember)
AND
IsInTrigger(_PartyMember, (TRIGGER)S_WYR_WyrmRock_SouthBridgeArea_9be3e92c-784e-457d-810f-d51a851f1ca0, 1)
AND
GetPosition((TRIGGER)S_WYR_WyrmRock_SouthBridge_ScatterPoint_6d8fe53b-a1b2-401c-b78e-2ce585ba4855, _X, _Y, _Z)
THEN
DB_WYR_SouthBridgePartyMemberTeleported(1);
TeleportToPosition(_PartyMember, _X, _Y, _Z);

PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
DB_WYR_SouthBridgeItemTeleported(1)
THEN
NOT DB_WYR_SouthBridgeItemTeleported(1);

PROC
PROC_WYR_WyrmRock_RaiseBridge_TeleportItemsAndCharacters()
AND
DB_WYR_SouthBridgePartyMemberTeleported(1)
THEN
NOT DB_WYR_SouthBridgePartyMemberTeleported(1);
//END_REGION

IF
DialogEnded((DIALOGRESOURCE)WYR_KillDirectorGortash_Ceremony_5149a422-854a-9e05-433a-0520d87eb112, _)
THEN
TimerLaunch("WYR_WyrmRock_LowerSouthBridge", 3000);

IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_SteelWatcherInvitation_b3b7e371-5ea7-9824-9ed8-4b2b153d0882, _)
THEN
TimerLaunch("WYR_WyrmRock_LowerSouthBridge", 3000);

IF
TimerFinished("WYR_WyrmRock_LowerSouthBridge")
AND
NOT DB_GlobalFlag((FLAG)WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8)
AND
NOT DB_WYR_KillDirectorGortash_AudienceHallCombatID(_)
THEN
PROC_GlobalSetFlagAndCache((FLAG)WYR_WyrmRock_SouthBridge_State_GainedAccess_4002c43d-55f3-4d1c-b170-f0ffa1f6b5fd);
PROC_WYR_WyrmRock_LowerBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

// if flag is set in a dialog, then we only want to lower the bridge after the dialog
PROC
PROC_GlobalFlagReactionAfterDialog(WYR_WyrmRock_SouthBridge_State_GainedAccess_4002c43d-55f3-4d1c-b170-f0ffa1f6b5fd)
THEN
PROC_WYR_WyrmRock_LowerBridge((ITEM)S_WYR_WyrmRock_SouthBridge_9e8dab1b-b39e-4c73-8621-9bbeee61baab);

// We need to help the player to find the way inside the fortress if both the bridges are raised
PROC
PROC_WYR_WyrmRock_RaiseBridges()
THEN
DB_WYR_WyrmRockPrison_SecretEntranceDiscovered(1);
SetEntityEvent((ITEM)S_WYR_WyrmRockPrison_SecretEntrance_ac85bbb6-b546-4104-a050-59f16e147f41, "StoryReveal", 1);

IF
TextEvent("lowerbridges")
THEN
PROC_WYR_WyrmRock_LowerBridges();

IF
TextEvent("raisebridges")
THEN
PROC_WYR_WyrmRock_RaiseBridges();
//END_REGION

//REGION Barracks
IF
DB_WYR_WyrmRock_SleepingBarrackGuards(_BarracksGuard, _BarracksBed)
THEN
Use(_BarracksGuard, _BarracksBed, "");

IF
ReposeAdded((CHARACTER)_BarracksGuard, (ITEM)_BarracksBed)
AND
DB_WYR_WyrmRock_SleepingBarrackGuards(_BarracksGuard, _BarracksBed)
THEN
ApplyStatus(_BarracksGuard, "SLEEPING", -1.0, 1, _BarracksBed);

IF
EnteredCombat((CHARACTER)_BarracksGuard, _)
AND
DB_WYR_WyrmRock_SleepingBarrackGuards(_BarracksGuard, _BarracksBed)
AND
HasActiveStatus(_BarracksGuard, "SLEEPING", 1)
THEN
RemoveStatus(_BarracksGuard, "SLEEPING");
//END_REGION Barracks

//REGION Flaming Fist Thief
IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc, _)
THEN
PROC_RemoveDBTrespassTrigger(S_WYR_WyrmRock_BarracksTrespassingAreaFFThief_9043a52c-7c43-4171-9db0-e0de26571b38, S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240);

IF
FlagSet((FLAG)WYR_WyrmRock_FlamingFistThief_Knows_StashLocation_1b463b02-ff54-4bd6-b3b5-25b8d20044f7, _Player, _)
THEN
PROC_ShowMarker((CHARACTER)_Player, "WYR_WyrmRock_FlamingFistThiefStash");

IF
UseStarted(_Player, (ITEM)S_WYR_WyrmRock_FFThief_Stash_ff56c634-8009-4a7e-a995-924f1fde6786)
AND
DB_ActivePlayerMarker(_Player, "WYR_WyrmRock_FlamingFistThiefStash")
THEN
PROC_HideMarker(_Player, "WYR_WyrmRock_FlamingFistThiefStash");

IF
FlagSet((FLAG)WYR_WyrmRock_FlamingFistThief_Event_TransferLockpick_385f07d9-bca8-4a98-9937-211845a65fd0, _Player, _)
THEN
TemplateAddTo(TOOL_GEN_ThievesTools_A_Open_A_e32a200c-5b63-414d-ae57-00e7b38f125b, _Player, 1, 1);
DB_WYR_WyrmRock_FlamingFistThiefLostLockpick(1);

IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc, _)
AND
NOT DB_WYR_WyrmRock_FlamingFistThiefLostLockpick(1)
AND
QRY_OnlyOnce("WYR_WyrmRock_GiveFFThiefLockpick")
THEN
TemplateAddTo(TOOL_GEN_ThievesTools_A_Open_A_e32a200c-5b63-414d-ae57-00e7b38f125b, (CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, 1, 1);

IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_8e55cfec-2f8b-08b0-aff0-9e7a6272f1cc, _)
AND
GetFlag((FLAG)WYR_WyrmRock_FlamingFistThief_Event_WalkAway_c2d2a419-d397-4053-9d90-afb6c66571db, NULL_00000000-0000-0000-0000-000000000000, 0)
THEN
SetFlag((FLAG)WYR_WyrmRock_FlamingFistThief_State_SittingInChair_3bedc771-9f83-4b83-8e0c-ecc93e4669df, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_PlayerWakedUpBarracksGuards_5fbdef68-18ce-42d8-a206-572088d6a52a)
THEN
PROC_TryStartAD((DIALOGRESOURCE)WYR_WyrmRock_BarracksGuard_003_AD_RunsAway_51e34f11-c61d-3ee5-f475-fb4aa3ac94d8, S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6);
PROC_DisappearOutOfSight((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "Run", 0, "");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_FlamingFistThief_Event_WalkAway_c2d2a419-d397-4053-9d90-afb6c66571db)
THEN
PROC_DisappearOutOfSight((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "Walk", 0, "");

PROC
PROC_LongRest()
AND
DB_GlobalFlag((FLAG)WYR_WyrmRock_FlamingFistThief_State_DisappearAfterLongRest_57a7c3b4-c8af-4b2d-8b5d-d6cc4f9e6f45)
AND
QRY_OnlyOnce("WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest")
THEN
DB_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest(1);

IF
DB_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest(1)
AND
DB_ActiveLevel("BGO_Main_A")
THEN
NOT DB_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest(1);
PROC_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest();

PROC
PROC_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest()
THEN
PROC_SetOnStage(S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, 0);

PROC
PROC_WYR_WyrmRock_FlamingFistThief_DisappearAfterLongRest()
AND
NOT DB_OffStage(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b)
THEN
PROC_SetOnStage(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, 0);
PROC_SetOnStage(S_WYR_WyrmRock_FFThief_Stash_ff56c634-8009-4a7e-a995-924f1fde6786, 1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_PlayerWakedUpBarracksGuards_5fbdef68-18ce-42d8-a206-572088d6a52a)
AND
DB_WYR_WyrmRock_SleepingBarrackGuards(_Guard, _)
AND
HasAppliedStatus(_Guard, "SLEEPING", 1)
THEN
RemoveStatus(_Guard, "SLEEPING", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_FFWakedUpBarracksGuards_471a1fea-5800-481b-b27c-2f47204370df)
AND
DB_WYR_WyrmRock_SleepingBarrackGuards(_Guard, _)
AND
HasAppliedStatus(_Guard, "SLEEPING", 1)
THEN
RemoveStatus(_Guard, "SLEEPING", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_PlayerWakedUpBarracksGuards_5fbdef68-18ce-42d8-a206-572088d6a52a)
AND
DB_WYR_WyrmRock_InterrogationPositions(_Guard, _InterrogationPos)
THEN
PROC_CharacterMoveTo(_Guard, _InterrogationPos, "Walk", "WYR_WyrmRock_ArrivedAtInterrogationPos");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)WYR_WyrmRock_Event_PlayerWakedUpBarracksGuards_5fbdef68-18ce-42d8-a206-572088d6a52a)
THEN
TimerLaunch("Timer_WYR_WyrmRock_BarracksGuards_Spotting",6000);

IF
EntityEvent(S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, "WYR_WyrmRock_ArrivedAtInterrogationPos")
THEN
DB_SpotPlayers_IncludeWildshapedPlayers((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, "WYR_WyrmRock_Interrogation");
DB_SpotPlayers((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, "WYR_WyrmRock_Interrogation", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, "WYR_WyrmRock_Interrogation", _Player)
AND
QRY_StartDialog((DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93, S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c, _Player)
THEN
DB_NOOP(1);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Player, (FLAG)WYR_WyrmRock_State_AgreedToGetImprisoned_85087840-8b6a-4ad9-8d36-e7e291180851)
AND
DB_RegionPrison("BGO_Main_A_WyrmRock", _PrisonCell, _PrisonSpawnPoint)
AND
DB_PlayerPrison(_PrisonCell, _, _, _FugitiveStatus)
THEN
PROC_CrimeTeleportCharacterToPrison((CHARACTER)S_WYR_WyrmRockPrison_Guard_001_bbdac4e8-23cb-4134-b718-2d852ce22ea1, _Player, _PrisonCell, _PrisonSpawnPoint, _FugitiveStatus);

IF
TimerFinished("Timer_WYR_WyrmRock_BarracksGuards_Spotting")
THEN
PROC_SpotPlayers_StopSpotting("WYR_WyrmRock_Interrogation");
SetFlag(WYR_WyrmRock_State_GuardsInterrogatedPlayer_f40b5d3b-57e6-46a7-b691-1ecefa0a5eaa, NULL_00000000-0000-0000-0000-000000000000);
DB_TrespassTrigger(S_WYR_BarracksTrespassingArea_29febee2-df07-425c-a8f6-427fe46c2557, (TRIGGER)S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240, "WYR_WyrmRock_LowSecurityAreaTrespassing");

IF
DialogStarted((DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93, _)
THEN
TimerCancel("Timer_WYR_WyrmRock_BarracksGuards_Spotting");

IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_BarracksInterrogation_fbeba4b8-63bc-3692-eb5d-cdc92b262f93, _)
THEN
SetFlag(WYR_WyrmRock_State_GuardsInterrogatedPlayer_f40b5d3b-57e6-46a7-b691-1ecefa0a5eaa, NULL_00000000-0000-0000-0000-000000000000);
DB_TrespassTrigger(S_WYR_BarracksTrespassingArea_29febee2-df07-425c-a8f6-427fe46c2557, (TRIGGER)S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240, "WYR_WyrmRock_LowSecurityAreaTrespassing");

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Player, (FLAG)WYR_WyrmRock_FlamingFistThief_State_AgreedToLeave_f076d26f-6dff-4319-88bb-adeb7a731c6a)
THEN
TeleportTo(_Player, S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240, "WYR_WyrmRock_TeleportedOutOfBarracks", 1, 1, 1, 0, 1);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Player, (FLAG)WYR_WyrmRock_FlamingFistThief_State_AgreedToLeave_f076d26f-6dff-4319-88bb-adeb7a731c6a)
AND
QRY_OnlyOnce("WYR_WyrmRock_Barracks_PeacefulResolve")
THEN
PROC_PeacefulResolve((CHARACTER)S_WYR_WyrmRock_BarracksGuard_001_a9b44d9f-2fe3-4554-bc10-04e28f05f5d2);
PROC_PeacefulResolve((CHARACTER)S_WYR_WyrmRock_BarracksGuard_002_b0c71c56-815d-4b9a-a4be-a112af11bd4b);
PROC_PeacefulResolve((CHARACTER)S_WYR_WyrmRock_BarracksGuard_004_c6c74e70-690f-4ff7-a661-7cb47e470b6c);

IF
EntityEvent(_, "WYR_WyrmRock_TeleportedOutOfBarracks")
THEN
PROC_CharacterEnableCrime((CHARACTER)S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "WYR_WyrmRock_LowSecurityAreaTrespassing");
DB_TrespassTrigger(S_WYR_BarracksTrespassingArea_29febee2-df07-425c-a8f6-427fe46c2557, (TRIGGER)S_WYR_WyrmRock_BarracksOutPos_bb0f9158-de42-4565-9a2b-5b1e6e17e240, "WYR_WyrmRock_LowSecurityAreaTrespassing");

IF
EntityEvent(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, "StoryReveal")
AND
GetClosestAlivePlayer(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, _Player, _)
THEN
PROC_TryStartAD(WYR_WyrmRock_PAD_FFStashIllusion_027e7f81-ca34-0ad8-e006-f89edb01c3d3, _Player);
PROC_WYR_WyrmRock_FFThief_RemoveIllusion();

PROC
PROC_WYR_WyrmRock_FFThief_RemoveIllusion()
THEN
PlayEffect((ITEM)S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, (EFFECTRESOURCE)VFX_Script_Illusion_Perception_Check_Overlay_01_b8fe40e4-b49b-f7b1-25ba-f5b97341a16d);
RealtimeObjectTimerLaunch((ITEM)S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, "WYR_WyrmRock_PileOfBricksIllusion", 600);

IF
ObjectTimerFinished(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, "WYR_WyrmRock_PileOfBricksIllusion")
THEN
PROC_SetOnStage(S_WYR_WyrmRock_IllusoryPileOfBricks_84e04f92-ff88-4f05-bca4-04f8640a347b, 0);
PROC_SetOnStage(S_WYR_WyrmRock_FFThief_Stash_ff56c634-8009-4a7e-a995-924f1fde6786, 1);

PROC
PROC_KnockedOut(S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, _)
THEN
ObjectTimerCancel(S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6, "Timer_WYR_WyrmRock_BarracksGuard_003_SayAD");
PROC_ForceStopDialog(S_WYR_WyrmRock_BarracksGuard_003_c57ca6b4-de77-4230-b85c-06fd284e0ec6);
//END_REGION Flaming Fist Thief

//REGION Gortash Invitation
PROC
PROC_SpotPlayers_Spotted(_SteelWatcher, "WYR_WyrmRock_GortashInvitation", _Player)
AND
QRY_StartDialog((DIALOGRESOURCE)WYR_WyrmRock_SteelWatcherInvitation_b3b7e371-5ea7-9824-9ed8-4b2b153d0882, _SteelWatcher, _Player, S_WYR_KillDirectorGortash_GortashDummySteelWatcher_717f8325-71a0-47cd-8953-ab7848e7dad3)
THEN
PROC_WYR_WyrmRock_CancelGortashInvitation();

QRY
QRY_WYR_KillDirectorGortash_StartCeremonyDialog(_)
THEN
PROC_WYR_WyrmRock_CancelGortashInvitation();

PROC
PROC_WYR_WyrmRock_CancelGortashInvitation()
THEN
PROC_SpotPlayers_StopSpotting("WYR_WyrmRock_GortashInvitation");

IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_SteelWatcherInvitation_b3b7e371-5ea7-9824-9ed8-4b2b153d0882, _ID)
AND
DB_DialogPlayers(_ID, _Player, 1)
THEN
PROC_TryStartAD(WYR_WyrmRock_PAD_AfterInvitation_f5cdcff7-4841-2738-48e7-37ae634b7f4d, _Player);

//Once the steel watcher has delivered the invitation, all watchers in the game will tell the player (on sight) to meet gortash
IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_SteelWatcherInvitation_b3b7e371-5ea7-9824-9ed8-4b2b153d0882, _)
AND
DB_WYR_WyrmRockWatchers(_Watcher)
THEN
DB_SpotPlayers((CHARACTER)_Watcher, "WYR_GortashInvite_WatcherAD", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous((CHARACTER)_Watcher, "WYR_GortashInvite_WatcherAD");

PROC
PROC_SpotPlayers_Spotted(_Watcher, "WYR_GortashInvite_WatcherAD", _Player)
AND
NOT DB_GLO_WatcherDeliveredGortashInvitationTo(_Watcher, _)
THEN
LookAtEntity((CHARACTER)_Watcher, (GUIDSTRING)_Player, 3.0);
PROC_TryStartAD((DIALOGRESOURCE)GLO_SteelWatcher_AD_GortashMessage_d890f5be-6e54-2020-e750-6c6ef744f8d7, _Watcher);
DB_GLO_WatcherDeliveredGortashInvitationTo(_Watcher, _Player);

IF
LostSightOf(_Watcher, _Player)
AND
DB_GLO_WatcherDeliveredGortashInvitationTo(_Watcher, _Player)
THEN
ObjectTimerLaunch(_Watcher, "WYR_GortashInvite_ReEnableWatcherAD", 5000, 0);

IF
ObjectTimerFinished(_Watcher, "WYR_GortashInvite_ReEnableWatcherAD")
AND
DB_GLO_WatcherDeliveredGortashInvitationTo((CHARACTER)_Watcher, _Player)
THEN
NOT DB_GLO_WatcherDeliveredGortashInvitationTo(_Watcher, _Player);

//Once the ceremony has happened, or gortash is dead, stop the spotting
IF
FlagSet(WYR_KillDirectorGortash_State_AfterCeremony_a05a6945-21ad-400d-80bc-7b4934571c57, _, _)
THEN
PROC_SpotPlayers_StopSpotting("WYR_GortashInvite_WatcherAD");

IF
DB_PermaDefeated((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
THEN
PROC_SpotPlayers_StopSpotting("WYR_GortashInvite_WatcherAD");
//END_REGION

//REGION Mess Hall
QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Char, _Player)
AND
DB_WYR_WyrmRock_SteelWatcherDiscussionNPCs(_Char)
AND
NOT DB_GlobalFlag((FLAG)GLO_Foundry_State_ControlCentreDestroyed_456906c5-40a6-429e-8e1c-7120a2ef631b)
AND
NOT DB_OnlyOnce("WYR_WyrmRock_MessHallSteelWatchersDiscussion")
AND
QRY_StartDialog_Fixed(WYR_WyrmRock_MessHallSteelWatchersDiscussion_22c51288-a378-72b0-994e-d7b76ee77a96, 
	(CHARACTER)S_WYR_WyrmRock_MessHallBodyguard_002_214fd102-81e0-4492-8bef-389c66dcd7dc, 
	S_WYR_WyrmRock_MessHallBodyguard_003_36078682-fde3-40cc-8f26-c238cb10c75e, 
	S_WYR_WyrmRock_MessHallBodyguard_008_c183baeb-2677-4340-8896-eccfb3ff2952, 
	_Player)
THEN
DB_OnlyOnce("WYR_WyrmRock_MessHallSteelWatchersDiscussion");
//END_REGION Mess Hall

//REGION Audience Hall
IF
DB_WYR_WyrmRock_AudienceHallGuards(_Guard, _Dialog)
THEN
DB_Dialogs(_Guard, _Dialog);
DB_GLO_DefeatCounter(_Guard, "WYR_WyrmRock_AudienceHallGuards");
//END_REGION

//REGION Roof
IF
EntityEvent((ITEM)S_WYR_KillDirectorGortash_SafePainting_cdba37fd-cada-41ba-88bf-b51ec8826db9, "StoryReveal")
AND
DB_OffStage(S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7)
THEN
PROC_SetOnStage((ITEM)S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7, 1);

IF
DB_Destroyed((ITEM)S_WYR_KillDirectorGortash_SafePainting_cdba37fd-cada-41ba-88bf-b51ec8826db9)
AND
DB_OffStage(S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7)
THEN
PROC_SetOnStage((ITEM)S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7, 1);

IF
Moved((ITEM)S_WYR_KillDirectorGortash_SafePainting_cdba37fd-cada-41ba-88bf-b51ec8826db9)
AND
DB_OffStage(S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7)
THEN
PROC_SetOnStage((ITEM)S_WYR_KillDirectorGortash_Safe_23c69bcc-148f-4932-85e8-cd99c8ff4eb7, 1);

PROC
PROC_GLO_SteelWatchers_SetWatchersBrainControlled(_)
THEN
ClearOwnership(S_WYR_WyrmRock_DoorToRoof_99cede9e-36e3-49cc-97c0-b6799d498e91);
ClearOwnership(S_Teleport_InvisibleDoor_A_WyrmRockBottomSpiral_dc367158-c538-4637-8316-3c1b6a2d196c);
PROC_WYR_WyrmRock_GiveAccessToRoof();

IF
FlagSet((FLAG)GLO_BrainEscalation_SteelWatchHuntingPlayer_fa13dce6-cc01-4627-a1d1-edd284afc6de, _, _)
THEN
PROC_WYR_WyrmRock_GiveAccessToRoof();

PROC
PROC_WYR_WyrmRock_GiveAccessToRoof()
THEN
PROC_RemoveDBTrespassTrigger((TRIGGER)S_WYR_WyrmRock_RoofTrespass_000_0327c2c9-798d-48ed-a7a8-c8952d80d635, (TRIGGER)NULL_00000000-0000-0000-0000-000000000000);
PROC_RemoveDBTrespassTrigger((TRIGGER)S_WYR_WyrmRock_RoofTrespass_001_179fbca9-41c7-4ba6-9f1d-297e93473b0c, (TRIGGER)NULL_00000000-0000-0000-0000-000000000000);
PROC_RemoveDBTrespassTrigger((TRIGGER)S_WYR_WyrmRock_RoofTrespass_002_190e61db-cad8-4f88-addc-8ef63bec3049, (TRIGGER)S_WYR_WyrmRock_TrespassOutTrigger_fc0ab1fd-2186-46c5-adea-0fa59cd33f87);

IF
UseFinished(_Char, S_WYR_WyrmRock_Roof_DropDownLadder_Lever_7469ffdc-4a6c-43c6-b02a-cea02fd976cf, 1)
AND
QRY_OnlyOnce("WYR_WyrmRock_Roof_DropDownLadder_Drop")
THEN
ItemMoveTo((ITEM)S_WYR_WyrmRock_Roof_DropDownLadder_bf16b561-1083-4e3e-a20d-d0df6373026b, S_WYR_WyrmRock_Roof_DropDownLadder_LoweredPos_dd7a1b0d-e0f7-4427-8e39-12f8892c3df4, 2.0, 2.0, 0, "WYR_WyrmRock_Roof_DropDownLadder_Lowered");

IF
EntityEvent((ITEM)_Ladder, "WYR_WyrmRock_Roof_DropDownLadder_Lowered")
THEN
SetCanInteract(_Ladder, 1);
//END_REGION

//REGION Alert State
IF
DB_GlobalFlag((FLAG)CURRENTREGION_BGO_Main_A_11239767-48ad-4879-8312-b9164b6e4978)
AND
DB_GlobalFlag((FLAG)IRN_IronThrone_State_Destroyed_91795368-af06-4b56-9ac1-b78995aa9ea9)
AND
NOT DB_GlobalFlag((FLAG)WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8)
THEN
PROC_WYR_WyrmRock_GoToAlertState("IronThroneDestroyed");

IF
DB_GlobalFlag((FLAG)CURRENTREGION_BGO_Main_A_11239767-48ad-4879-8312-b9164b6e4978)
AND
DB_GlobalFlag((FLAG)GLO_Foundry_State_ControlCentreDestroyed_456906c5-40a6-429e-8e1c-7120a2ef631b)
AND
NOT DB_GlobalFlag((FLAG)WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8)
THEN
PROC_WYR_WyrmRock_GoToAlertState("SteelWatchFoundryDestroyed");

// we don't check who attacked him
// he might die from an explosion of a runepowder bomb, in that case the attacker owner will be the bomb
IF
AttackedBy(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _, _, _, _, _, _)
AND
DB_GlobalFlag((FLAG)CURRENTREGION_BGO_Main_A_11239767-48ad-4879-8312-b9164b6e4978)
THEN
PROC_WYR_WyrmRock_GoToAlertState("GortashAttacked");

IF
FlagSet((FLAG)GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769, _, _)
AND
DB_GlobalFlag((FLAG)CURRENTREGION_BGO_Main_A_11239767-48ad-4879-8312-b9164b6e4978)
THEN
PROC_WYR_WyrmRock_GoToAlertState("GortashAttacked");

IF
EntityEvent(_, "WYR_WyrmRock_RaisedAlarm")
THEN
PROC_WYR_WyrmRock_GoToAlertState("AlarmRaised");

PROC
PROC_WYR_WyrmRock_GoToAlertState((STRING)_Reason)
AND
QRY_OnlyOnce("WYR_WyrmRock_GoToAlertState")
THEN
PROC_WYR_WyrmRock_WentToAlertState(_Reason);

PROC
PROC_WYR_WyrmRock_WentToAlertState((STRING)_Reason)
THEN
PROC_GlobalSetFlagAndCache(WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8);

IF
FlagSet(WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8, _, _)
AND
NOT DB_GlobalFlag((FLAG)GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769)
THEN
DB_DangerZone((TRIGGER)S_WYR_Fortress_DangerZone_4b5d9d0a-d33e-4257-816f-77a32c5fe533, "WYR_WyrmRockFortress");
DB_DangerZone_SafeOnGlobalFlagSet("WYR_WyrmRockFortress", GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769);

IF
FlagSet(WYR_WyrmRock_State_AlertState_3d238a15-bb39-411a-8023-23385c98f2b8, _, _)
THEN
PROC_WYR_WyrmRock_RaiseBridges();
PROC_WYR_WyrmRock_DisableAllSpotting();
PROC_WYR_WyrmRock_MakeNpcsHostile();
PROC_GlobalSetFlagAndCache(WYR_WyrmRock_Event_ToBattleStations_60b1788c-5206-4a94-bb28-783809d3bcf8);
PROC_WYR_WyrmRock_TransitionPrisonToAlertState();
PROC_WYR_WyrmRock_TransitionBarracksToAlertState();
PROC_WYR_WyrmRock_TransitionAudienceHallToAlertState();
PROC_WYR_WyrmRock_TransitionNorthBridgeToAlertState();

PROC
PROC_WYR_WyrmRock_DisableAllSpotting()
THEN
PROC_SpotPlayers_StopSpotting("WYR_WyrmRock_Interrogation");
PROC_SpotPlayers_StopSpotting("WYR_WyrmRock_GortashInvitation");
PROC_SpotPlayers_StopSpotting("WYR_GortashInvite_WatcherAD");
PROC_SpotPlayers_StopSpotting("WYR_KillDirectorGortash_Ceremony");

PROC
PROC_WYR_WyrmRock_MakeNpcsHostile()
AND
DB_WYR_WyrmRock_AlertStateHostileFactions(_Faction)
THEN
PROC_SetRelationToPlayers(_Faction, 0);

//REGION Prison to Alert State
PROC
PROC_WYR_WyrmRock_TransitionPrisonToAlertState()
AND
HasActiveStatus(S_WYR_WyrmRockPrison_EntranceGuard_3f27f04f-4041-462e-9db3-a3ba163eb0c6, "SLEEPING_SEATED", 1)
AND
HasActiveStatus(S_WYR_WyrmRockPrison_EntranceGuard_3f27f04f-4041-462e-9db3-a3ba163eb0c6, "SILENCED", 0)
THEN
RemoveStatus(S_WYR_WyrmRockPrison_EntranceGuard_3f27f04f-4041-462e-9db3-a3ba163eb0c6, "SLEEPING_SEATED", NULL_00000000-0000-0000-0000-000000000000);
//END_REGION

//REGION Barracks to Alert State
PROC
PROC_WYR_WyrmRock_TransitionBarracksToAlertState()
AND
DB_WYR_WyrmRock_SleepingBarrackGuards(_BarracksGuard, _)
AND
HasActiveStatus(_BarracksGuard, "SLEEPING", 1)
AND
HasActiveStatus(_BarracksGuard, "SILENCED", 0)
THEN
RemoveStatus(_BarracksGuard, "SLEEPING", NULL_00000000-0000-0000-0000-000000000000);
//END_REGION

//REGION Audience Hall to Alert State
PROC
PROC_WYR_WyrmRock_TransitionAudienceHallToAlertState()
AND
IsInTrigger(S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03, (TRIGGER)S_WYR_WyrmRock_AudienceHallArea_a078f420-9f5e-452b-9391-e96e754b61c8, 1)
AND
NOT DB_PermaDefeated((CHARACTER)S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03)
AND
GetFaction(S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03, _Faction)
THEN
PROC_SetRelationToPlayers(_Faction, 0);

PROC
PROC_WYR_WyrmRock_TransitionAudienceHallToAlertState()
AND
IsInTrigger(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (TRIGGER)S_WYR_WyrmRock_AudienceHallArea_a078f420-9f5e-452b-9391-e96e754b61c8, 1)
AND
NOT DB_PermaDefeated((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
GetFaction(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Faction)
THEN
PROC_SetRelationToPlayers(_Faction, 0);
PROC_TryStartAD(WYR_KillDirectorGortash_AD_Attack_11966b71-49cc-daae-f56e-2a861167ee33, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
//END_REGION

//REGION Roof to Alert State
// If Alert state is because we attacked Gortash in his office - he and his bodyguards in the office become hostile + he plays an AD
// Otherwise we don't do any additional actions
PROC
PROC_WYR_WyrmRock_GoToAlertState("GortashAttacked")
AND
NOT DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
DB_InRegion(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_WYR_WyrmRock_RoofArea_6f590602-360a-4b7f-b936-f04f44a33dee)
AND
GetFaction(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Faction)
AND
GetCombatGroupID(S_WYR_KillDirectorGortash_GortashsBodyguard_001_8b142ad1-8ca5-487c-9ecd-93fb4172ea25, _CombatGroupID)
AND
QRY_OnlyOnce("WYR_WyrmRock_GoToAlertState_GortashAttacked_CombatSetup")
THEN
PROC_SetRelationToPlayers(_Faction, 0);
SetCombatGroupID(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _CombatGroupID);

PROC
PROC_WYR_WyrmRock_GoToAlertState("GortashAttacked")
AND
NOT DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
DB_InRegion(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_WYR_GortashsOfficeArea_d3c1c480-47bd-48cf-95c2-1ba9ed5a4bd0)
AND
QRY_OnlyOnce("WYR_WyrmRock_GoToAlertState_GortashAttacked_AD")
THEN
PROC_TryStartAD(WYR_KillDirectorGortash_AD_AttackInOffice_3d0dbc06-2cef-715a-9cb3-62e18df1161a, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
//END_REGION

//REGION North Bridge to Alert State
PROC
PROC_WYR_WyrmRock_TransitionNorthBridgeToAlertState()
AND
GetCombatGroupID(S_WYR_WyrmRock_NorthBridgeGuard_001_352d8f42-9588-4bce-b206-e031f4f3f36f, _CombatGroupID)
THEN
SetCombatGroupID(S_WYR_Fortress_FlamingFist001_40893ed8-ef6c-437f-9ef3-3fa2c7ac3a98, _CombatGroupID);
SetCombatGroupID(S_WYR_Fortress_FlamingFist002_baaf58e1-8880-4dda-a351-4d4680c3cb2f, _CombatGroupID);
SetCombatGroupID(S_WYR_WyrmRock_MessHallGuard_001_bca3d3e3-3ddc-4ba2-8ad5-58afec936933, _CombatGroupID);
//END_REGION

//REGION Removing civilians
PROC
PROC_WYR_WyrmRock_GoToAlertState(_)
AND
QRY_OnlyOnce("WyrmRock_RemoveCivilians")
THEN
PROC_WYR_KillDirectorGortash_RemoveServantsFromAudienceHall();
PROC_WyrmRock_RemoveCivilians();
PROC_WyrmRock_RemoveCrowds();

PROC
PROC_WyrmRock_RemoveCivilians()
AND
DB_WYR_WyrmRock_Civilians(_Civilian, _)
THEN
PROC_WYR_WyrmRock_RemoveCivilian(_Civilian);

PROC
PROC_WyrmRock_RemoveCrowds()
AND
DB_WYR_WyrmRock_Crowds(_CrowdTrigger, _)
THEN
PROC_WyrmRock_RemoveCrowd(_CrowdTrigger);

PROC
PROC_WyrmRock_RemoveCrowd((TRIGGER)_CrowdTrigger)
THEN
TriggerSetCrowdSpawningEnable(_CrowdTrigger, 0);
TriggerSetCrowdBehaviour(_CrowdTrigger, CROWDBEHAVIOUR.Flee);
//END_REGION

//END_REGION

//REGION WYR_FindWayIntoWyrmRock Journal
IF
DialogEnded((DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea, _ID)
AND
NOT DB_GlobalFlag(WYR_WyrmRock_SouthBridge_Knows_FortressClosed_cd9ab671-ec0e-4f74-bb64-ca14a0c7e11e)
AND
GetFlag((FLAG)WYR_WyrmRock_SouthBridge_State_GainedAccess_4002c43d-55f3-4d1c-b170-f0ffa1f6b5fd, NULL_00000000-0000-0000-0000-000000000000, 0)
AND
DB_DialogPlayers(_ID, _Player, 1)
THEN
PROC_GlobalSetFlagAndCache((FLAG)WYR_WyrmRock_SouthBridge_Knows_FortressClosed_cd9ab671-ec0e-4f74-bb64-ca14a0c7e11e);
PROC_EmperorAD((CHARACTER)_Player, WYR_WyrmRock_SouthBridge_EmperorAD_FortressClosed_7c6df424-d1d6-3aad-c2f0-d05cbc31bc8e);

IF
TemplateAddedTo(_Template, _, (CHARACTER)_Player, _)
AND
DB_Players(_Player)
AND
DB_WYR_Journal_FindWayIntoWyrmRock_Templates(_Template, _Flag)
AND
NOT DB_GlobalFlag(_Flag)
THEN
PROC_GlobalSetFlagAndCache(_Flag);

IF
FlagSet((FLAG)WYR_WyrmRock_SouthBridge_State_GainedAccess_4002c43d-55f3-4d1c-b170-f0ffa1f6b5fd, _, _ID)
AND
DB_DialogName((DIALOGRESOURCE)WYR_WyrmRock_SouthBridgeGuard_001_c2af6826-fe03-4afe-aa40-3658fc04f5ea, _ID)
THEN
PROC_GlobalSetFlagAndCache((FLAG)WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_Guards_eba53279-5d7f-45db-b104-9a828a4995d0);
PROC_GlobalSetFlagAndCache((FLAG)WYR_WyrmRock_State_EnteredFortress_Guards_d63af5ec-20c9-4193-a25f-7cfe381c8125);

IF
DB_WYR_WyrmRock_EnteredFortressTriggers(_Trigger)
AND
DB_Players(_Player)
AND
DB_InRegion(_Player, _Trigger)
AND
NOT DB_GlobalFlag(WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_Guards_eba53279-5d7f-45db-b104-9a828a4995d0)
AND
NOT DB_GlobalFlag(WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_NoGuards_c0c71c36-ebe8-4fa4-af09-14e11f971a7b)
THEN
PROC_GlobalSetFlagAndCache(WYR_Journal_FindWayIntoWyrmRock_State_EnteredFortress_NoGuards_c0c71c36-ebe8-4fa4-af09-14e11f971a7b);
//END_REGION

//REGION Debug
IF
TextEvent("sb_getdocs")
AND
GetHostCharacter(_Player)
THEN
ToInventory(S_WYR_OpenHand_LowerCityPass_350eba29-7233-42df-be7b-0a0bd375c745, _Player, 1, 1, 1);
ToInventory(S_WYR_MerchantsHouse_CoronationAccessPass_b41b4a1c-f740-4798-9a00-170a9db4f034, _Player, 1, 1, 1);
ToInventory(S_WYR_SharessCaress_CoronationAccessPass_50daa914-92be-49e3-974c-521c44121ffb, _Player, 1, 1, 1);
ToInventory(S_WYR_Posthouse_UrgentReportForDukeRavengard_d9922125-23f8-405c-a2cc-f448621cd178, _Player, 1, 1, 1);

IF
TextEvent("wr_gortashattacked")
THEN
PROC_WYR_WyrmRock_GoToAlertState("GortashAttacked");

IF
TextEvent("wr_alarmraised")
THEN
PROC_WYR_WyrmRock_GoToAlertState("AlarmRaised");

IF
TextEvent("wr_emperorad")
AND
GetHostCharacter(_Player)
THEN
PROC_ResetEmperorAD(_Player, WYR_WyrmRock_SouthBridge_EmperorAD_FortressClosed_7c6df424-d1d6-3aad-c2f0-d05cbc31bc8e);
PROC_EmperorAD(_Player, WYR_WyrmRock_SouthBridge_EmperorAD_FortressClosed_7c6df424-d1d6-3aad-c2f0-d05cbc31bc8e);
//END_REGION Debug

//REGION Enemy of Absolute crime
IF
DB_WYR_WyrmRock_SteelWatchers(_SteelWatcher)
THEN
PROC_CharacterDisableCrime(_SteelWatcher, "EnemyOfAbsolute");
//END_REGION

//REGION Quartermaster
IF
FlagSet((FLAG)WYR_WyrmRock_Quartermaster_State_AgreedToTrade_162266ba-66af-4383-a4e7-f58d46604b5c, _, _)
THEN
NOT DB_DialogBlockTradeButton((DIALOGRESOURCE)WYR_WyrmRock_Quartermaster_7e22c89c-72fc-e2f5-ba50-8435f57be76d);
//END_REGION

//REGION Removing civilians and crowds if all the FFs in the area are defeated
PROC
PROC_GLO_DefeatCounter_AllDefeated(_ID)
AND
DB_WYR_WyrmRock_Civilians(_Civilian, _ID)
THEN
PROC_WYR_WyrmRock_RemoveCivilian(_Civilian);

PROC
PROC_WYR_WyrmRock_RemoveCivilian((CHARACTER)_Civilian)
THEN
PROC_DisappearOutOfSight(_Civilian, "Run", 0, "");

PROC
PROC_GLO_DefeatCounter_AllDefeated(_ID)
AND
DB_WYR_WyrmRock_Crowds(_CrowdTrigger, _ID)
THEN
PROC_WyrmRock_RemoveCrowd(_CrowdTrigger);
//END_REGION

//REGION Disabled Fake Crowd characters
IF
DB_WYR_WyrmRock_DisabledCrowdCharacters(_FakeCrowdCharacter)
THEN
PROC_SetOnStage(_FakeCrowdCharacter, 0);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3"
