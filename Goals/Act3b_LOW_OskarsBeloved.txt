Version 1
SubGoalCombiner SGC_AND
INITSECTION
//Kerri Ring
DB_GiveItemToEvent((ITEM)S_UNI_LOW_JannathRing_5c8a91bb-2d0e-4136-9ed2-6aa307ba4f27,(FLAG)LOW_Jannath_Event_GivesRing_0f9260ad-0319-49f2-8d3b-53ee369d2de9);
DB_HasItemEvent((ITEM)S_UNI_LOW_JannathRing_5c8a91bb-2d0e-4136-9ed2-6aa307ba4f27,(FLAG)LOW_OskarsBeloved_Event_HasJannathRing_9a687e64-0239-4e86-a865-7afe7e3f9fef);

DB_HasItemEvent((ITEM)S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046,(FLAG)LOW_PhilgravesMansion_State_HasTorch_963a8ced-1976-41fa-8994-c5b71330cc9b);
DB_GiveItemToEvent((ITEM)S_LOW_AtelierChestKey_fe224cbf-d7e5-412c-bee7-8d0f622ea7f4,(FLAG)LOW_OskarsBeloved_Event_GiveOskarKey_69be28d0-8b3c-4af7-9bd1-cb478f916310);

SetOnStage(S_UNI_LOW_KerriRing_2b1eab03-4655-4d95-a94f-2f1c9031bc8c,0);

DB_LOW_OskarsBeloved_GuildhallTraders((CHARACTER)S_LOW_Guildhall_Bartender_00c74e3b-5880-4525-9558-860e4f7c77e2);
DB_LOW_OskarsBeloved_GuildhallTraders((CHARACTER)S_LOW_Guildhall_FetchersBrat_002_3352a47c-4259-464d-8047-65bc8a2adff9);

DB_DialogBlockAttackButton((DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562);
DB_DialogBlockAttackButton((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionScene_b0c1258a-cd28-cc19-3094-8308f974427d);
DB_DialogBlockTradeButton((DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562);
DB_DialogBlockTradeButton((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionScene_b0c1258a-cd28-cc19-3094-8308f974427d);
DB_DialogBlockTradeButton((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5);
DB_DialogBlockAttackButton((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5);

//Torches
//SetFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315);
DB_Dialogs((CHARACTER)S_LOW_TarhunMnemonis_2d1b98a0-01a9-4c21-8bc2-9738c47f6966,(DIALOGRESOURCE)LOW_OskarsBeloved_TarhunMnemonis_dca723fe-bcf0-2b6c-ca44-87ddc6c61d0e);

//Final confrontation
DB_LOW_KerriFinalConfrontationAllies(S_LOW_KerriGhostMummy_01_e0d5067c-5cf9-42c7-92c5-acec03e6e61a);
DB_LOW_KerriFinalConfrontationAllies(S_LOW_KerriGhostMummy_02_a1721b88-3bb8-4989-9d7b-b0341dc24e07);
DB_LOW_KerriFinalConfrontationAllies(S_LOW_KerriGhostNurse_01_b8588238-d973-4363-9c78-bbb02729aa90);
DB_LOW_KerriFinalConfrontationAllies(S_LOW_KerriGhostNurse_02_49163297-18fd-4451-8fe9-6988bae89dd5);

PROC_SetOnStage(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,0);
DB_Dialogs((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,(DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d);

DB_DropMutingStatussesDialog((DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662);
DB_DropMutingStatussesDialog((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionScene_b0c1258a-cd28-cc19-3094-8308f974427d);
DB_DropMutingStatussesDialog((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5);

//Dynamic db where allies are removed when spawned and added when killed
DB_LOW_AvailablePortraitAllies(S_LOW_KerriZombie_001_9e5c669c-94fe-4531-ba6a-10810389a789);
DB_LOW_AvailablePortraitAllies(S_LOW_KerriZombie_002_805b3124-bbb2-4f6a-926c-f68ff79fdbe4);
DB_LOW_AvailablePortraitAllies(S_LOW_KerriZombie_003_453a3bfd-d53d-48fa-b664-ad24c8ea7007);
DB_LOW_AvailablePortraitAllies(S_LOW_KerriZombie_004_f1fbe911-c2d7-4a33-b50b-89241d863e2f);

PROC_SetCustomTradeTreasure(S_LOW_BloomridgeGhostWatch_Civilian3_baaa4da1-5d5e-49f7-9800-0f7087599185,"LOW_Streets_GhostWatch");

PROC_LOW_OskarsBeloved_InitEnemiesFinalConfrontation();

DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_001_cb8e9694-b4ac-4396-84a0-bb2fa0b89252,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_001_fb85e12b-cea9-8b7f-b726-98ff3f016721,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_001_4d5a0be6-e0f8-409b-b0c7-ce4008a3b60e);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_002_49b95036-c60b-4abb-8757-64fccd0e7ab6,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_002_9a52412b-1311-8233-ca5a-c23e62ae4342,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_002_d1c44187-09e0-41d7-8b03-f9de281b22b7);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_003_b9c77aaf-5d48-4ce4-b054-5d9c9be23222,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_009_e75de93e-86f4-775a-3cb9-55f38d7eb523,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_003_ed90c9a4-8c86-49f9-882d-78532d318c1f);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_004_c4978ed5-b776-4ec8-9ccd-41e872385ebf,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_004_ffc360c6-e304-e2be-5b83-8826171ff142,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_004_44a669f3-72e1-43ec-971e-c8ec1e4b065e);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_005_d90f1bc8-d037-412a-a31c-9b8535e7c2f1,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_005_d4270edf-f2b4-5535-695e-80fe0e2ff7fa,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_005_c03f3a74-278d-43e5-86f4-95643b25f87f);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_006_b5ef23a5-9afb-40e4-8d71-2fbdd97446f7,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_006_17cbdde0-3bb2-a86f-fddf-b108203e75bb,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_006_5df9c8f8-8a20-4831-8e8f-a87f39384501);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_007_82097df7-922e-436d-8326-966e16bea7e3,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_007_e9311b25-fe28-9825-291b-c59eed871c25,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_007_342da135-ae2b-4493-90eb-d54d62740d5b);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_008_e4594974-2d6f-4965-8ae5-73e1e2923c06,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_008_d9c9f2e7-1c4d-8dcc-2603-fa90042f5030,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_008_b3c61e52-8bcd-489c-a1a6-11fb315f4bb7);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_010_5d6b014f-aa82-458b-9c6c-fbf2b61b4a7f,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_010_1f33ee4c-5095-4b47-7bf9-12139529e386,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_010_7a8ce2b2-9297-411d-9f05-cc8ded5d8dfe);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_LOW_AtelierPortrait_011_389cd0c2-6a40-453c-9b64-ede808285297,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_011_492c4577-10be-ee88-170a-898ae922d3de,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_011_ed779e53-97d9-4fb4-8b4d-0711dac448d9);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_UNI_LOW_OskarPortrait_1836435f-a6c0-4ed0-9be3-7a64bd391e85,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_Oskar_e837361e-2d85-31fd-16ef-bdee3fc55fef,(TRIGGER)NULL_00000000-0000-0000-0000-000000000000);
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)S_UNI_LOW_JannathPortrait_beb93272-ab48-4e10-befd-73e1e1478cd9,(DIALOGRESOURCE)LOW_OskarsBeloved_AD_AtelierPortrait_Jannath_6e4658a4-36fd-debe-a4f7-76e28b64d3df,(TRIGGER)S_LOW_AtelierPortraitOriginalPos_Jannath_b13be211-00f3-4bf3-9b6a-ca5501848ae9);

DB_OneShot_ADTrigger((TRIGGER)S_LOW_BeratingServantTrigger_070baf4d-5a44-4c47-8090-e43aeb5a758a, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_StaffBeratingServant_9a3ebb9a-ba12-9507-28e6-60d5ced2ddd0, (CHARACTER)S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41, (CHARACTER)S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);
DB_OneShot_ADTrigger((TRIGGER)S_LOW_AngryNoblesTrigger_f4310dc8-b546-4f1c-8dc0-57dd91214e35, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_NoblesArguing_ea57798b-b1e3-6fa1-4959-1ccc887eda6d, (CHARACTER)S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb, (CHARACTER)S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446);

//REGION Poltergeist systemic throws

DB_LOW_OskarsBeloved_DestroyArmouryObjects((ITEM)S_LOW_OskarsBeloved_DisplayCase_001_4eae156c-e8d6-4836-8ae0-9df5385b4112);
DB_LOW_OskarsBeloved_DestroyArmouryObjects((ITEM)S_LOW_OskarsBeloved_DisplayCase_002_0f92bdb6-4a2d-4d49-890b-55f1461f5158);

DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Dining_000_163f6f62-ec48-42e5-886b-0c9c1038170b,"dining",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Dining_001_6c1d9263-bc76-4331-822f-1878e8e886c8,"dining",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Cellar_000_0a24f2b9-fd4c-458f-a5e7-5bf2231aed0d,"cellar",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Cellar_001_4dc01c2c-48fd-4a88-93b6-e1445c1e1326,"cellar",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Cellar_002_0466d1f7-a4eb-4da0-87a0-26a3f87d798c,"cellar",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Corridor_000_7e4cc727-c952-4e74-b504-5b0c1fd1ee6a,"corridor",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Corridor_001_444e733e-f699-41fd-a7d1-32ab74fef259,"corridor",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Corridor_002_fda18475-150d-40e7-a425-6514a36d0875,"corridor",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Art_000_3c8fe34a-03e8-43c8-80a3-41730483c366,"art",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Art_001_e1395413-c8e5-450b-9a7f-54d457111eda,"art",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Kitchen_000_2e93b2a0-e5c5-4593-b2ef-f832b80267c1,"kitchen",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Kitchen_001_9b4d7812-dd50-4b55-9f5f-837e5aa0ddb5,"kitchen",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Kitchen_002_dc4c9b21-21f3-4c8f-9c9c-295ab1778d8e,"kitchen",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Armoury_001_d95161fd-5632-440d-9ead-c4c4783ee0ee, "armoury",1);
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)S_LOW_Poltergeist_Armoury_002_9a0a22f8-9c2b-4b48-9456-548424a35652, "armoury",1);

DB_LOW_OskarsBeloved_PoltergeistsBedroom(S_LOW_Poltergeist_Bedroom_000_3f37f17d-d273-4cbc-85ea-e803587366f6, (TRIGGER)S_LOW_OskarsBeloved_BedroomPoltergeistPosition_001_58bf4aad-646f-4b45-a925-44b3e531718d);
DB_LOW_OskarsBeloved_PoltergeistsBedroom(S_LOW_Poltergeist_Bedroom_002_7372513a-a82e-4ac8-9754-a19231c72934, (TRIGGER)S_LOW_OskarsBeloved_BedroomPoltergeistPosition_002_fbd1be2a-1aa5-41e6-b40a-373f9c3deeee);
DB_LOW_OskarsBeloved_PoltergeistsBedroom(S_LOW_Poltergeist_Bedroom_001_a25a404c-de80-4927-9c73-2d18a46a46ae, (TRIGGER)S_LOW_OskarsBeloved_BedroomPoltergeistPosition_003_a0e52a5d-eee1-47d6-be18-7d979ea2fe33);

DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_Cellar_fc33b9c8-ef65-4c4e-bcbd-a5225700217d,"cellar");
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_ArtAreaSecondFloor_873ee2a7-b85d-43c8-8441-0f2604555c50,"art");
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_DiningRoom_dd694e8c-ca0f-4c6a-865c-510b08a4f4fd,"dining");
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_Corridor_06f8cda6-e2db-4d67-b36f-db8fc5a61e78,"corridor");
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_Kitchen_d95d28ab-cfb6-438a-bbf8-561c9d90c6f4, "kitchen");
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)S_LOW_PossessionTrigger_Armoury_0acaf3e8-0bcd-4e0a-ad0d-49968575d5b7,"armoury");

DB_LOW_OskarsBeloved_CivilianInHauntingCombat((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);
DB_LOW_OskarsBeloved_CivilianInHauntingCombat((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

//Target trigger, Room, Locked

DB_LOW_OskarBeloved_RoomTargets("cellar","DB_LOW_OskarsBeloved_PlayersInCellar");
DB_LOW_OskarBeloved_RoomTargets("art","DB_LOW_OskarsBeloved_PlayersInArtArea");
DB_LOW_OskarBeloved_RoomTargets("dining","DB_LOW_OskarsBeloved_PlayersInDining");
DB_LOW_OskarBeloved_RoomTargets("corridor","DB_LOW_OskarsBeloved_PlayersInCorridor");
DB_LOW_OskarBeloved_RoomTargets("kitchen","DB_LOW_OskarsBeloved_PlayersInKitchen");
DB_LOW_OskarBeloved_RoomTargets("armoury","DB_LOW_OskarsBeloved_PlayersInArmoury");

DB_LOW_OskarBeloved_RoomAmmo("dining","DB_LOW_OskarBeloved_DiningRoomThrowableObjects");
DB_LOW_OskarBeloved_RoomAmmo("cellar","DB_LOW_OskarBeloved_CellarThrowableObjects");
DB_LOW_OskarBeloved_RoomAmmo("art","DB_LOW_OskarBeloved_ArtAreaThrowableObjects");
DB_LOW_OskarBeloved_RoomAmmo("corridor","DB_LOW_OskarBeloved_CorridorThrowableObjects");
DB_LOW_OskarBeloved_RoomAmmo("kitchen","DB_LOW_OskarBeloved_KitchenThrowableObjects");
DB_LOW_OskarBeloved_RoomAmmo("armoury","DB_LOW_OskarBeloved_ArmouryThrowableObjects");


DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_006_5d7280b6-d1fa-4560-92eb-ee4a75781f85);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_010_25956b33-af26-4f96-b6fe-ec0ab3006ddd);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_002_155dbf81-9926-4494-bbb7-30d8e1278fc7);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_004_1dacdee5-41fd-49f3-9f54-af306b87321a);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_001_dea19fcc-6fb6-46ce-b9b3-244d8f94058c);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_003_7e0d6f71-5463-4faf-9851-9c0f7712ca21);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_005_7ee0547a-acae-4fc8-96d9-530fcb80ddcf);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_007_1c862165-0db3-4829-869a-3b656a17407d);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_009_facd113e-8655-486a-891b-9831dafbf0e2);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_008_30b36d28-c814-4092-8615-1a3ac5808e5b);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_013_4d951341-6701-4055-854a-8a5bcfd3df8d);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_012_0e2ce115-c3aa-483e-8e4a-05343c3a78a6);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_011_b77f5669-6d13-4200-a1ea-eecdca32379b);
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)S_LOW_OskarsBeloved_ArmouryThrowable_014_344f89ed-f506-4307-93b5-882e893a217a);

DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_010_3a346b79-1c32-4917-be35-13303465c374);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_006_6e1cd9ac-5c3f-40c1-b71f-e01097674e93);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_009_758001a4-91c5-4fe2-b39c-34323683a98b);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_003_4679b8f0-9b9f-40aa-a694-92a5df71d95a);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_002_d8083abc-d9f6-4660-816a-c0a279d8c437);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_004_f6e44344-73a3-4911-b855-6347f40d24fc);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_017_74197460-f100-409d-90bc-1cba8cb3c3de);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_007_ff6fbdfd-be3a-47cb-bcf0-671bc968a8ab);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_025_086de8b1-b2fc-4935-a465-fa495784348f);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_026_9d901cdd-5fd8-416e-977e-d7ecec70d864);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_020_11edef3a-55e0-4514-b06a-0df754273772);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_016_b9d2a49c-e563-420f-bda5-72006c8bf9aa);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_018_7842cd29-eca0-45d7-86b9-17c793f3f512);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_019_e5ca6c59-ba1c-40df-9e7b-201ca7abd85f);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_028_04f8b5c1-fd90-4918-ae1b-25c59bacdfa8);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_011_05601336-04b3-45e8-898c-917dd34d60c6);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_030_24ae5e7f-0159-4269-8683-d94445f6245f);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_014_089a4a1d-36d5-4ef8-9c38-47a9059bdeea);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_015_807d375a-d7d1-461f-bcef-68230f907b85);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_024_b64a5b47-042d-46ba-b750-784e5430c7a8);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_027_79c9102e-e6c5-4820-9768-f72064950839);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_023_af8957e4-eeea-4b1e-8742-42e81e1a24e1);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_022_8514e659-1cfd-4d45-8640-a998eb9cec9d);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_021_d10ecf3a-f613-46dd-b391-cca74185cf84);
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)S_LOW_CellarThrowableItem_029_cfac4c44-343c-4d5c-9d0b-f8be1b70de94);


DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair4_3f359072-abe3-4d5a-baf6-e321035b8464);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair5_da183cc9-6699-4230-bca9-7abc92371198);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair6_14b2177a-dd5d-4df6-8cc2-bfd8edaac8e5);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair1_c93dd323-2d0f-4837-9813-f54d23c80ea3);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair3_578cdf49-eced-4f17-b7d5-bcee7d905d7c);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningCandle1_a97cba6c-22e0-4e3b-b7c0-6be4c87225a3);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_Stool_4dc0832f-e83a-4a2c-8378-93e95c8ba04e);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningCandle2_69ee741c-a54a-4d5a-be10-9a8cb73f296a);
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)S_LOW_DiningChair2_cab5c436-d75a-416c-81e3-e3e1779fb7f5);

NOT DB_LOW_OskarBeloved_TempSelectedThrow((ITEM)NULL_00000000-0000-0000-0000-000000000000);
NOT DB_LOW_OskarsBeloved_HadHauntRoomFTB("");


DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea2_fc83667f-0224-45d2-8b9c-a38a7d22bd62);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea3_df33f8e3-33f2-40e3-89ef-bae20b2ba988);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea4_4d17be13-0659-49fd-9d25-872d163816a1);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea5_f38676a6-bdc9-4364-8ac4-71087f60516d);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea6_5f859e2d-4044-440d-ab6b-f62cd288b013);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_ChairArtArea7_7c0e94ba-317e-4c39-bcb0-d09ce38536c8);
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)S_LOW_SofaArtArea2_68ed81e3-85d2-433d-a5e3-a6243e7e41e9);

DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)S_LOW_ThrowingVase_002_93ceb4fb-836a-41da-a804-4313d1e460b5);
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)S_LOW_ThrowingVase_001_3eae86af-a4a9-40f9-86e3-382fe67791a3);
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)S_LOW_ThrowingBench_0b67044f-86f9-4dd4-a6e7-45d90506e9e9);
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)S_LOW_ThrowingChairCorridor_001_c4dae410-a07d-4b52-a19c-63c2f7278c25);
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)S_LOW_OskarsBeloved_ThrowingBench_3efd79bd-6b8b-4242-9e70-2943c73f0bfe);

DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_001_53e29cdc-24ab-4e34-ac2f-8111388acefa);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_002_59767f9e-b487-4174-a7eb-af44f33bec74);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_003_8ae84c09-a8d9-420c-8a86-c8432bf2c653);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_004_e3f5af0c-bae3-44f1-8a61-d0ae2b9b063b);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_005_1f7f41de-8d3e-42c7-b845-25ec8c1c26df);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_006_3abe5870-e793-4c3b-b9f4-84e4bb68d762);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_007_465e4d1d-d9cf-4b53-86a7-1b5a21a2addc);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_008_ca607e7c-4297-435c-867f-d8bde9b0ac02);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_009_a7ca0704-1678-4ef0-b09c-eecea7706099);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_010_59313609-de90-43b0-8d07-9de47402d01c);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_011_8ffb87f0-e19d-4632-861a-37befed45ef4);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_012_6c38d57a-7423-49b7-b76c-fe557c70d95e);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_013_17c5aca0-adfe-4424-a464-28cdb52745a9);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_014_deb4163e-f4a7-488a-a823-d2382da2fa68);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_015_e249d9bb-3dd3-46ae-b34f-700a02a4dfe8);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_016_64ea7b64-c14b-4ab0-a128-3de2f5f8cc3a);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_017_f4aa4bb7-e910-449c-8034-e5ac12ddf13e);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_018_89d6031c-e8c1-4874-a422-ea9e8692896c);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_019_b1314916-f140-49fe-8a6a-018a3e82ef76);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_020_01365584-ef33-406e-87e3-6d23f07c475c);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_021_4e2bfd28-826e-4b27-801f-baaacc1a2b42);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_022_64330002-4ca7-47df-ae9e-8e23876b91fa);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_023_ebcd1d56-4080-4a61-bdde-e055d9101192);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_024_725c3891-8655-4bfc-8c2d-6cf78b5f4860);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_025_eb3e445e-db3f-4559-91b1-5b3cd9aa2ee5);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_027_e43f9ea4-75a9-49e5-ad07-f4bb17363255);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_028_a3ae1b19-aee2-42f8-958f-d95430d5eaf0);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_029_c9ac79a7-897f-4f2f-9cff-8dc0be05a5b2);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_030_0ecf33ec-ec88-4c49-abe2-ab8020a55903);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_031_8b0900d3-abfc-4588-b3d3-f50cd3fd6fca);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_032_76401046-2743-43b7-a9b7-c3f6ccbbf33b);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_033_cbf55785-ba95-48bb-a561-194480352cd0);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_034_8650a7dd-0505-4c5f-91cc-0018f031a6ec);
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)S_LOW_ThrowableObjectKitchen_035_ada38664-04e8-493c-949a-77be7ba3b2a4);


DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_001_7677134e-a250-4bfc-a54f-2771497a0f5f,S_LOW_PossessedLight_001_44ec8496-0982-4b70-888a-4ed8bd232fa1);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_002_02d111b1-0e78-440c-900d-0d1f81503036,S_LOW_PossessedLight_002_73ed4d6b-79fe-457e-b47e-253b3377a53c);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_003_a902f5ad-f957-42a7-aa15-732aab699957,S_LOW_PossessedLight_003_bfed1e6c-47ea-47bf-9472-3ca2744de7c0);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_004_ea6766d5-d555-41f7-bb7f-814b99213e3f,S_LOW_PossessedLight_004_8e6b78e7-8861-4ced-9a84-e6be7524da7a);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_005_763f96c3-5f4a-4993-be8d-b2eee4cdfb09,S_LOW_PossessedLight_005_9225ac2c-6852-4cf3-8c82-b59bf5feca4b);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_006_9c1c408a-b34f-4e36-877a-8574a5487d36,S_LOW_PossessedLight_006_ff74a067-4c1c-4f31-a667-afa95d5823a0);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_007_a03f0664-abe8-41ca-94a3-e56a1a4aef3f,S_LOW_PossessedLight_007_77027f1c-e6a5-4657-a6e4-7daa5b16813d);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_008_8a7b374c-6105-4474-bf0d-6f7db46c01e3,S_LOW_PossessedLight_008_51a795d3-9dcb-439d-b8e3-6a341120127d);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_009_11dd1f1a-24dc-4a5b-b8f7-062597d4224d,S_LOW_PossessedLight_009_1e729d61-63a2-4e09-b639-5fc48aa0e388);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_010_4e39f2ff-ac26-4b3f-a2be-8923ce5fd232,S_LOW_PossessedLight_010_1c7d291a-1d31-4efc-9537-e42118b350b6);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_011_8e08073e-9089-4714-bcc0-fd1021133ceb,S_LOW_PossessedLight_011_4cc9be25-5bda-4cc8-8db5-48373b7f62e6);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_013_096a61ab-3652-437b-b271-8ce82e6c413c,S_LOW_PossessedLight_013_ddb5fa60-932e-408e-880f-8432e22ec8a1);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_014_ef4e6348-49a5-4565-bafe-e208c9cfb013,S_LOW_PossessedLight_014_4ec10095-926c-44b8-86ba-1d6550bf17cf);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_012_2f80f4bf-a226-48b4-b431-e37183d9f9f3,S_LOW_PossessedLight_012_002_f679be67-949d-4eb6-b196-07b229b9cbcd);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_012_2f80f4bf-a226-48b4-b431-e37183d9f9f3,S_LOW_PossessedLight_012_003_b4676c00-54b5-4084-9b71-a59ef358802e);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_012_2f80f4bf-a226-48b4-b431-e37183d9f9f3,S_LOW_PossessedLight_012_001_2e402a28-bcca-48c8-b541-bd61c4c546ce);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_015_986bb2e8-a78e-4b88-90f5-42e3d7a85804,S_LOW_PossessedLight_015_f1ffb6cd-39f7-496d-99eb-d5a3dd84e2cb);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_016_c8008cbe-3a7c-44b2-939c-c0895ff003fe,S_LOW_PossessedLight_016_7e09eeeb-0e57-421b-9ab3-c965841c30fe);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_019_c3853741-66f2-40dd-a341-c0371d34021a,S_LOW_PossessedLight_019_635c8a50-cfcd-45e9-9edd-168ca8e88caf);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_018_65baea1b-7ac3-43bd-b950-fc45da156d38,S_LOW_PossessedLight_018_2167e7ef-0452-42e1-bc37-591d71bc3c80);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_017_c0ad053e-c2ad-45a7-a303-5fdcc1b3019f,S_LOW_PossessedLight_017_fc922180-ecd1-4acf-81d7-7192d964f469);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_020_470cc40a-c38a-44ab-bdfa-714a8a3e3000,S_LOW_PossessedLight_020_31f2266a-44ea-424a-bf96-485a3874810a);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_021_bc7c020a-9a0e-4d06-9e88-65aeece7f5b8,S_LOW_PossessedLight_021_4cec8cf1-06e9-4413-8fda-e1c4e0bc9f09);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_022_bd09631a-25e2-4810-ba0f-b16c0d26d45a,S_LOW_PossessedLight_022_7a51efda-1eb3-4890-8846-f310eef394f7);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_023_62072178-16fe-42a0-890c-e0028e2402e4,S_LOW_PossessedLight_023_9e04a7ee-e073-4e51-905d-542cafd212d9);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_024_67cb951f-8a38-40a7-a116-967ef1b21e34,S_LOW_PossessedLight_024_b93e3094-0452-495c-b39e-7ac8d378a32a);
DB_LOW_OskarsBeloved_HauntLights((TRIGGER)S_LOW_LightTrigger_025_cfbb9102-5b49-42f1-801f-5d6327243266,S_LOW_PossessedLight_025_d65df9ca-900b-4028-8120-b4e7babb7cb7);

DB_LOW_OskarsBeloved_ThrowablePaintings(S_LOW_ThrowingPainting_003_815495e2-1221-4be8-99f4-e24dc97416d7);
DB_LOW_OskarsBeloved_ThrowablePaintings(S_LOW_ThrowingPainting_002_a60e5e5a-e61b-4ad4-8fad-4f1fdb80b590);
DB_LOW_OskarsBeloved_ThrowablePaintings(S_LOW_ThrowingPainting_001_317f54ef-355b-48ec-b040-992f74343d66);

//END_REGION

//REGION Haunt Environment

DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_015_d15a9308-5c1d-43d3-93ff-6b2e7e1508bf, (ITEMROOT)CONS_GEN_Food_Tart_Treacle_A_Spoiled_A_c5c39373-6a83-4a74-818a-da1642b9dfd0);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_007_b0394447-fc9e-4433-a169-a8e00d9bf76e, (ITEMROOT)CONS_FOOD_Vegetable_Carrot_A_Rotten_89439def-e8bc-43c3-bec1-331492d01d74);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_006_916c664e-eb5b-44fb-a701-3a41e2cb3497, (ITEMROOT)CONS_FOOD_Vegetable_Carrot_A_Rotten_89439def-e8bc-43c3-bec1-331492d01d74);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_005_96d58c5e-8501-485f-84ce-5b989db8cc43, (ITEMROOT)CONS_FOOD_Vegetable_Carrot_A_Rotten_89439def-e8bc-43c3-bec1-331492d01d74);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_004_33318c62-419f-409e-9e47-576a3bd6cf0f, (ITEMROOT)CONS_FOOD_Fruit_Lemon_A_Rotten_dc980269-d8bd-4a25-b521-d3ac7bb4812f);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_003_86f98db9-69d1-4c12-813f-aabbd97e1f49, (ITEMROOT)CONS_FOOD_Fruit_Lemon_A_Rotten_dc980269-d8bd-4a25-b521-d3ac7bb4812f);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_002_7dae1e52-cc9f-4f66-ad31-9612fd7c2d3f, (ITEMROOT)CONS_FOOD_Fruit_Lemon_A_Rotten_dc980269-d8bd-4a25-b521-d3ac7bb4812f);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_001_5b1aedf3-b12f-4fb7-b530-08239ce7e171, (ITEMROOT)CONS_FOOD_Fruit_Lemon_A_Rotten_dc980269-d8bd-4a25-b521-d3ac7bb4812f);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_010_966c195c-27fa-406b-b585-74aa80568fea, (ITEMROOT)CONS_FOOD_Vegetable_Tomato_A_Rotten_32a3bb2c-ce98-41ec-9476-06867d354ca3);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_012_800c2822-37bc-4b82-8cbb-6780d1b2b966, (ITEMROOT)CONS_GEN_Food_Cheese_Cheddar_Wheel_A_Rotten_89d194fd-3f0c-487b-8b60-e5ab1a2bd522);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_009_f5ac4865-2c30-4384-b226-0111cd71edd3, (ITEMROOT)CONS_FOOD_Vegetable_Tomato_A_Rotten_32a3bb2c-ce98-41ec-9476-06867d354ca3);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_008_6b347cad-0e84-4a72-84d2-f6fec1200405, (ITEMROOT)CONS_FOOD_Vegetable_Tomato_A_Rotten_32a3bb2c-ce98-41ec-9476-06867d354ca3);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_011_a3195bc8-373d-4e58-81dd-52f19b94129f, (ITEMROOT)CONS_GEN_Food_Cheese_Cheddar_Wheel_A_Rotten_89d194fd-3f0c-487b-8b60-e5ab1a2bd522);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_013_3e256a15-1b93-418f-8a5d-3009cdd94d63, (ITEMROOT)CONS_GEN_Food_Cheese_Goat_Wheel_A_Rotten_8a85cc9b-f865-4582-bb39-1272378f552f);
DB_LOW_OskarsBeloved_CellarFood((ITEM)S_LOW_OskarsBeloved_CellarFood_014_2cb8c95e-9ce4-4779-a8ec-64cbd7a9cafa, (ITEMROOT)CONS_GEN_Food_Cheese_Goat_Wheel_A_Rotten_8a85cc9b-f865-4582-bb39-1272378f552f);

DB_LOW_OskarsBeloved_AuraItems((TRIGGER)S_LOW_OskarsBeloved_AuraItemTrigger_000_073ce175-ab04-4cc7-ac04-1e434ffc4874,(ITEM)S_LOW_AuraItem_000_41fb21e5-94e3-4565-a3c8-e3815d7d4073);
DB_LOW_OskarsBeloved_AuraItems((TRIGGER)S_LOW_OskarsBeloved_AuraItemTrigger_001_7bde7a75-8967-4a32-b700-14394a92e3f6, (ITEM)S_LOW_AuraItem_001_3db439ae-df9b-4776-973a-9f9a0a651acd);
DB_LOW_OskarsBeloved_AuraItems((TRIGGER)S_LOW_OskarsBeloved_AuraItemTrigger_002_597ef93a-aa0b-477e-8870-d715b8b963e2,(ITEM)S_LOW_AuraItem_002_1a6ed15c-06ab-45cf-ab0f-3af5587d410b);
DB_LOW_OskarsBeloved_AuraItems((TRIGGER)S_LOW_OskarsBeloved_AuraItemTrigger_003_700ddfcc-a899-497d-9445-84c5783a96f6,(ITEM)S_LOW_AuraItem_003_54f8cff0-6ec9-4974-a49f-62622e854e0e);

DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_001_Trigger_afe6d42f-ec8d-4eb9-ac7a-f1f82c05950b,(ITEM)S_LOW_OskarsBeloved_Thunderwave_001_Caster_83f6f5fb-8382-4348-bcae-4d3c543bac9e,"armoury");
DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_002_Trigger_a1f4d7d3-ab2f-4899-807e-ebff8dc628f1,(ITEM)S_LOW_OskarsBeloved_Thunderwave_002_Caster_dee914e1-3452-450d-91f7-ed3429cf494f,"armoury");
DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_003_Trigger_c7494fac-0cf8-440f-8df4-2ad882f89ad2,(ITEM)S_LOW_OskarsBeloved_Thunderwave_003_Caster_1da5019d-31b7-4562-b3e1-e826ceceb140,"armoury");
DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_004_Trigger_d0ba95fe-c416-450f-aff7-95f4889f3120,(ITEM)S_LOW_OskarsBeloved_Thunderwave_004_Caster_b07d0d52-a819-41a1-8ecd-9322c1c2b2d6,"corridor");
DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_005_Trigger_1bb111dc-6300-4ada-93f1-6523223aa871,(ITEM)S_LOW_OskarsBeloved_Thunderwave_005_Caster_11c871b7-59bf-4ae7-aa17-4b7a2ad20102,"corridor");
DB_LOW_OskarsBeloved_Thunderwaves((TRIGGER)S_LOW_OskarsBeloved_Thunderwave_006_Trigger_e1bdd434-c665-4212-b523-e318e7e68d31,(ITEM)S_LOW_OskarsBeloved_Thunderwave_006_Caster_81a61e17-c4be-4fa3-8765-02852dc5fb58,"armoury");

DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)S_LOW_BloodTrigger_001_cba9a2bc-2bba-431c-a62f-b155c6cc273b,"SurfaceBlood", 2.5);
DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)S_LOW_BloodTrigger_002_c98a9b73-7242-4263-a77b-82ef6eebaa59,"SurfaceBlood", 2.5);
DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)S_LOW_BloodTrigger_003_1b8a0f4c-dbe2-4e8f-9d05-03b5e4074609,"SurfaceBlood", 2.5);
DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)S_LOW_BloodTrigger_003_1b8a0f4c-dbe2-4e8f-9d05-03b5e4074609,"SurfaceBlood", 2.5);
DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)S_LOW_OskarsBeloved_SpikeGrownSpawnTrigger_a0f8b22d-c7c8-44c2-9a1d-a661a2756c1a, "SurfaceSpikeGrowth" , 3.0);

DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_FlyingChair_001_712bd6ac-c749-4945-b08a-d200343d256e);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_FlyingChair_003_9656a7f6-f991-4ce0-8fc9-15a1931dea9d);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_FlyingChair_002_f749107c-ccdf-4be7-b337-b24d7f0c6083);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_BedroomFlyingVase_6851679c-0531-4783-b55d-be350f68d7be);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_BedroomFlyingChest_b49f2c5d-4a71-4e67-9d38-4022de38598d);
DB_LOW_OskarsBeloved_FlyingObjects((ITEM)S_LOW_OskarsBeloved_ExteriorFlyingChair_c63684f2-8f9c-427a-b6bf-e9744ada8d7f);

DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_001_f884f709-4c67-4753-9c76-b6007a4b056a,(TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_001_19fdb953-838b-48ac-a50a-614d6a2508dd);
DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_002_2a2b058a-4bcf-44bc-aac1-fe180e57210f,(TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_002_3217f441-bb84-4868-8af6-006bd3b01c9d);
DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_003_d7ba95f2-9657-41e6-b5a3-333e62a18af2,(TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_003_ed3e9f9b-4e2c-4fb5-a40f-12c3f05e8cae);
DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_004_ef3102f5-e6f9-4f05-96a0-4ab995dd8280, (TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_004_1ac1f9cb-1cc7-4738-b822-cba2f4f2338e);
DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_005_6d4cb69e-efc8-44bd-82b9-f8758f0fc12c, (TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_005_0e790c8d-f40e-49c0-82c0-cd98d9b7ad9d);
DB_LOW_OskarsBeloved_FallingFlyingObjects((ITEM)S_LOW_HauntFallingObject_006_e0e750be-110f-4d33-9b8a-3c4455d0207a, (TRIGGER)S_LOW_OskarsBeloved_FallingObjectTrigger_006_d9cd7b31-b357-4b0a-940f-cda83b23100a);

DB_GLO_DefeatCounter(S_LOW_Poltergeist_000_3f37f17d-d273-4cbc-85ea-e803587366f6,"LOW_OskarsBeloved_BedroomPoltergeists");
DB_GLO_DefeatCounter(S_LOW_Poltergeist_001_a25a404c-de80-4927-9c73-2d18a46a46ae,"LOW_OskarsBeloved_BedroomPoltergeists");
DB_GLO_DefeatCounter(S_LOW_Poltergeist_002_7372513a-a82e-4ac8-9754-a19231c72934,"LOW_OskarsBeloved_BedroomPoltergeists");

DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("LOW_OskarsBeloved_BedroomPoltergeists",(FLAG)LOW_OskarsBeloved_Event_AllBedroomPoltergeistsDefeated_e2d17cde-b625-456d-9dd7-23e944cc0e4a);

DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Armoury_08ede11e-d9e3-4d82-9d1a-8d8935193cd8,"armoury","LOW_OskarsBeloved_ArmouryPoltergeists");
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Art_ad2b3a9a-8301-4f23-874d-023673141728,"art","LOW_OskarsBeloved_ArtPoltergeists");
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Cellar_e8c94154-14ca-4d01-a50b-146e9cc54afb,"cellar","LOW_OskarsBeloved_CellarPoltergeists");
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Corridor_e83bd627-ab43-45b5-a164-20de080fce03,"corridor","LOW_OskarsBeloved_CorridorPoltergeists");
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Dining_e8ab39bf-cb31-4d77-b0b7-18d2964b7477,"dining","LOW_OskarsBeloved_DiningPoltergeists");
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter((FLAG)LOW_OskarsBeloved_RoomCleared_Kitchen_01350773-a118-458f-ab41-16423c13a5b6,"kitchen","LOW_OskarsBeloved_KitchenPoltergeists");

//END_REGION

//REGION Set State DBs
DB_LOW_OskarsBeloved_SoundTriggers((TRIGGER)Amb_SV_CTY_ArtisteHouse_Haunted_008_2088fb9f-6ec6-403b-bf7a-178931d57b2f);
DB_LOW_OskarsBeloved_SoundTriggers((TRIGGER)Amb_SV_CTY_ArtisteHouse_Haunted_007_49611909-0798-4cd4-92af-bbfba07b4818);
DB_LOW_OskarsBeloved_SoundTriggers((TRIGGER)Amb_SV_CTY_ArtisteHouse_Haunted_009_b0307fd5-cc2f-4a48-b2dd-6400858f132e);
DB_LOW_OskarsBeloved_SoundTriggers((TRIGGER)Amb_SV_CTY_ArtisteHouse_Haunted_006_bd393665-1b3b-4377-8baa-50b526887a44);
DB_LOW_OskarsBeloved_SoundTriggers((TRIGGER)Amb_SV_CTY_ArtisteHouse_Haunted_005_b5cb92ad-520c-4eda-baca-7a23c9bc3354);

DB_LOW_OskarsBeloved_HauntEntities(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92);
DB_LOW_OskarsBeloved_HauntEntities(S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205);
DB_LOW_OskarsBeloved_HauntEntities(S_UNI_JannathInteractableEasel_d76f86a3-70ca-4740-90f5-b1651634d81a);
DB_LOW_OskarsBeloved_HauntEntities(S_LOW_KerriEasel_b6dd6c20-bc8a-4f98-9c27-3cabbd79f53b);
DB_LOW_OskarsBeloved_HauntEntities(S_UNI_OskarInteractableEasel_bf01a01b-5d2d-46f7-9e1f-32358d231908);
DB_LOW_OskarsBeloved_HauntEntities(S_UNI_LOW_JannathPortrait_beb93272-ab48-4e10-befd-73e1e1478cd9);

DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Guildhall_Member_006_75cbf81e-0f16-459b-aa07-966eccf658ce);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Guildhall_Member_004_d40ae4a2-f29a-4d69-b9f7-9b078aeee0be);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Guildhall_Member_005_b34e82a2-f774-4f73-b808-c2e79cabdb2a);

DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_NoblesGossipTrigger_1e5fbdf1-3f0d-4d71-b399-f2301f0eb7fe);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_BeratingServantTrigger_070baf4d-5a44-4c47-8090-e43aeb5a758a);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_AngryNoblesTrigger_f4310dc8-b546-4f1c-8dc0-57dd91214e35);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_GossipingServantsTrigger_56c6d361-a385-4c04-892f-88e33e46af7d);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_NobleLookingPaintingTrigger_a16932eb-a384-4e54-9e90-f4c30f1ae592);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_GossipingServantsTrigger_56c6d361-a385-4c04-892f-88e33e46af7d);
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers((TRIGGER)S_LOW_ChefsCookingTrigger_2afb5013-da53-4b21-9acf-46a79c85ac55);

DB_PerceptionSkillCustomAD((ITEM)S_LOW_Masterpiece_462d6671-62cb-432f-8223-4bd2326f7504,(DIALOGRESOURCE)LOW_OskarsBeloved_PAD_SeenMasterpiece_2dd79b26-cef1-569f-97e0-95b2cb4d6a5f);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Chef_c324c082-2fb7-4e6a-a74b-6988b67dc6e5,(DIALOGRESOURCE)LOW_OskarsBeloved_Chef_93721523-7b56-38cc-819d-f582e64eada1);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,(DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_SecondaryGuard_4fabed5f-1a45-4676-87e2-2919c15ad91d,(DIALOGRESOURCE)LOW_OskarsBeloved_SecondaryGuardCheckpoint_0e011934-88dc-6f5a-c6d7-6379934b5329);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_SousChef_635592ec-64a4-4582-a038-aa78fb6a681e,(DIALOGRESOURCE)LOW_OskarsBeloved_Souschef_99d28fd3-855a-0f8c-4c6a-5c772f268585);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Noble_001_6efe6e4a-cac8-4060-b4e2-fd89d9278742, (DIALOGRESOURCE)LOW_OskarsBeloved_Noble_001_34ce25a5-ffef-8e92-f2be-ad0e748a7bec);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Noble_002_0a721bf1-ebb5-4ea3-98f2-1d53229a5325, (DIALOGRESOURCE)LOW_OskarsBeloved_Noble_002_b3a7e90f-9fbb-25af-c310-34ec0ee0b027);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Noble_003_b4bb8286-b0d2-4826-9106-e22c3f62e30c, (DIALOGRESOURCE)LOW_OskarsBeloved_Noble_003_b758434b-2c3a-c657-f99b-910e0e4fc15a);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41, (DIALOGRESOURCE)LOW_OskarsBeloved_YellingServant_b9a2ae83-005b-8e42-da8a-e9e5435f3098);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805, (DIALOGRESOURCE)LOW_OskarsBeloved_CleaningServant_327fa58e-2cd3-0fae-968b-0ced67128ccb);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_Servant_d6f7eb30-b069-4445-8fb7-d89ce8f539cb, (DIALOGRESOURCE)LOW_OskarsBeloved_Servant_604a8630-627c-b61e-175b-e888ee625c79);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_GossipingServant_002_409eae4a-4de6-491b-a839-9ff1f3dbd7cc, (DIALOGRESOURCE)LOW_OskarsBeloved_GossipingCook_002_af56088d-b14c-0d02-3007-af72e6a98772);
DB_LOW_OskarsBeloved_NotHauntDialogs((CHARACTER)S_LOW_GossipingServant_001_32024a4d-f4c4-4d6f-9032-7bf58fe28e90,(DIALOGRESOURCE)LOW_OskarsBeloved_GossipingCook_001_a29210d6-82c7-9718-fb3d-65e873356488);

DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_PossessionTrigger_Stairs_394d6600-c213-44b3-b3a0-f2dcbe59554f);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_PossessionTrigger_Bedroom_6114494a-0022-4593-bec2-aa8bd62c54d6);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_PossessionTrigger_Entrance_0d0e8371-cb49-4d93-8ab8-dbe7853e48e5);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_PossessionTrigger_Corridor_06f8cda6-e2db-4d67-b36f-db8fc5a61e78);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_OskarsBeloved_AtelierSeenPortraitsTrigger_c03c9227-af2e-4a22-a45d-3d088639a595);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_OskarsBeloved_LeavingRoomTrigger_Cellar_20a0298d-c93e-4cc2-818e-d2b724cc69a3);
DB_LOW_OskarsBeloved_HauntTriggers((TRIGGER)S_LOW_OskarsBeloved_LeavingRoomTrigger_Kitchen_62c2b466-86cc-41be-a60e-df5153503244);

DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Bard_e81cb0c9-41c4-4212-ad2a-84046693cfbf);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Noble_001_6efe6e4a-cac8-4060-b4e2-fd89d9278742);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Noble_002_0a721bf1-ebb5-4ea3-98f2-1d53229a5325);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Chef_c324c082-2fb7-4e6a-a74b-6988b67dc6e5);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_DoormanGuard_4fabed5f-1a45-4676-87e2-2919c15ad91d);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Servant_d6f7eb30-b069-4445-8fb7-d89ce8f539cb);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Noble_003_b4bb8286-b0d2-4826-9106-e22c3f62e30c);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_GossipingServant_002_409eae4a-4de6-491b-a839-9ff1f3dbd7cc);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_GossipingServant_001_32024a4d-f4c4-4d6f-9032-7bf58fe28e90);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_SousChef_635592ec-64a4-4582-a038-aa78fb6a681e);
DB_LOW_OskarsBeloved_NotHauntEntities(S_LOW_Masterpiece_462d6671-62cb-432f-8223-4bd2326f7504);

//END_REGION
//noble, location trigger, victory AD, victory dialog
DB_LOW_OskarsBeloved_AngryNobles(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,(TRIGGER)S_LOW_NobleDuelLocation_002_6c36cbcc-f989-41e7-a4fe-e9a1356b74fc, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_AngryNobleVictory_001_c1b380dc-e3b5-4329-c523-b4214b0dd5d1,(DIALOGRESOURCE)LOW_AngryNoble_001_PostDuel_05093b04-54b4-1781-9bfb-793573ab504a);
DB_LOW_OskarsBeloved_AngryNobles(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,(TRIGGER)S_LOW_NobleDuelLocation_001_f9b4e46f-79b4-4073-b460-87403046f2c7, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_AngryNobleVictory_002_4c28fc26-55cf-d47c-35b6-87b77b31edd4,(DIALOGRESOURCE)LOW_AngryNoble_002_PostDuel_cb51f9bd-0bc0-27b5-3ac4-1c99bd953366);


DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_DroppedCutlery_002_19220846-d7ef-4a08-ba2c-9a180e9490b9);
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_DroppedCutlery_000_6ea68ad1-5656-48a3-8dd3-ba23c2308053);
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_DroppedCutlery_001_2209a0e5-7cd6-4d24-8455-bcf5f03043d9);
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_Statue_002_67c03ac9-0c9e-458e-b797-48e4cf1caa8b);
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_Statue_001_5900d9d2-b815-4960-9376-9875276f21cd);
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(S_LOW_ChefThrowPie_2f543093-e8c3-4d62-92e3-68d554958f59);

DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Kerri_Event_PlayersStartCombatKerri_4b90913f-03b5-4428-bb9f-0a745b17f772, (DIALOGRESOURCE)LOW_OskarsBeloved_KerriAttacked_4cc93c53-bf92-1400-8ff7-7043134c040d);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Kerri_Event_PlayersStartCombatKerri_4b90913f-03b5-4428-bb9f-0a745b17f772, (DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ConvincedKerriToLeave_eb5b448c-1d84-4b98-bd79-4f1e8627ae71, (DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Kerri_Event_PlayersSaidTheySideWithKerri_e2e58fa9-02e1-4556-a7d3-8246516a780d, (DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562);

DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_NoblesGoToDuel_4cd392fc-b7cc-4f4b-97e0-c3232ccbc1e5, (DIALOGRESOURCE)LOW_OskarsBeloved_AngryNobles_a6b6ed62-c09f-07c7-8b21-c790be2d45ba);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_NoblesGoToDuel_4cd392fc-b7cc-4f4b-97e0-c3232ccbc1e5, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_NoblesArguing_ea57798b-b1e3-6fa1-4959-1ccc887eda6d);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_StartDuel_c9e06bdc-6379-40fc-b9d7-78f74b632087, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_NoblesPreDuel_ce0b5364-63df-8ae0-803a-89e5dc716fa4);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_StartDuel_c9e06bdc-6379-40fc-b9d7-78f74b632087, (DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_LeaveWithoutDueling_5bfbf90f-71cb-4c67-a66a-c63f85312942, (DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df);

DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantFired_926ec1e2-4ef6-46a2-8a3b-4fc2d4cf975c, (DIALOGRESOURCE)LOW_OskarsBeloved_AD_StaffBeratingServant_9a3ebb9a-ba12-9507-28e6-60d5ced2ddd0);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantFired_926ec1e2-4ef6-46a2-8a3b-4fc2d4cf975c, (DIALOGRESOURCE)LOW_OskarsBeloved_InterruptedFiring_76d95ecd-c615-e0d8-96b1-795982c967eb);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantSaved_7f61db94-aa04-4a9b-8c01-b8ea5c7198de, (DIALOGRESOURCE)LOW_OskarsBeloved_InterruptedFiring_76d95ecd-c615-e0d8-96b1-795982c967eb);

DB_LOW_OskarsBeloved_HauntBooks((ITEM)S_LOW_OskarsBeloved_SendAwayStaff_000_d714600b-9c21-4f0d-b7f0-6367f5755df4);
DB_LOW_OskarsBeloved_HauntBooks((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205);
DB_LOW_OskarsBeloved_HauntBooks((ITEM)S_LOW_OskarsBeloved_GoodbyeKerri_000_98893e7f-3118-4f9f-a3fc-727607d126da);

DB_LOW_OskarsBeloved_HauntBooksOwner((ITEM)S_LOW_OskarsBeloved_TarhunSendAway_35e2561f-0f2f-40cb-b5a1-02ef116c3f13, S_LOW_TarhunMnemonis_2d1b98a0-01a9-4c21-8bc2-9738c47f6966);
DB_LOW_OskarsBeloved_HauntBooksOwner((ITEM)S_LOW_OskarsBeloved_ClericApology_4155cc38-3891-4282-bb89-4f09776968c0, S_LOW_OskarsBeloved_MailBox_9ff1fe4e-62d4-4061-b685-aa58e1736379);

DB_LOW_OskarsBeloved_NotHauntBooksOwner((ITEM)S_LOW_OskarsBeloved_JannathSecurityNote_d3ab6895-9615-4dce-9b5c-7ef5847af0b4,LOW_Jannath_Safe_762cde37-8b25-47d1-9119-5baea6bb9004);
DB_LOW_OskarsBeloved_NotHauntBooksOwner((ITEM)S_LOW_OskarsBeloved_WhereaboutsTip_08c3ddcd-6f2c-4ca1-85fb-6d0a77a3fc51,S_LOW_OskarsBeloved_MailBox_9ff1fe4e-62d4-4061-b685-aa58e1736379);

DB_OskarsBeloved_ServantFiringChars(S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41);
DB_OskarsBeloved_ServantFiringChars(S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);

DB_FlagReactionAfterDialog((FLAG)LOW_Oskar_State_PaintedPortrait_b9a55b88-f4df-4a9b-8738-80509b13029a, (DIALOGRESOURCE)LOW_OskarsBeloved_OskarMakesPortrait_22c647aa-ab83-c788-ff1a-c46ade6bf248);

DB_DeadOnceFlag((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,(FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2);
DB_DeadOnceFlag(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,LOW_Jannath_State_IsDead_a82242ba-1af8-4487-8c6d-4509497edeb6);
DB_PermaDefeatedFlag(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,(FLAG)LOW_Jannath_State_IsPermaDefeated_06c884e6-c82c-4157-83f2-a628c0a2435c);

DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_Defender_b2403110-734a-42c9-815b-1537c850c6c3, "LOW_OskarsBeloved_PortraitNames_Defender_");
DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_GhostWhisperer_25bbffe8-72d8-4b6b-bcba-122c4978a57c, "LOW_OskarsBeloved_PortraitNames_GhostWhisperer_");
DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_Portrait_3d6b1860-db32-452e-9ccb-956df83f6aec, "LOW_OskarsBeloved_PortraitNames_Hero_");
DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_SkaldSupreme_bb4be4c7-fbf6-4875-ba4c-86c7cf54304d,"LOW_OskarsBeloved_PortraitNames_Portrait_");
DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_UnnamedHero_21bb72aa-cd19-438a-a875-9f40a692b8e9, "LOW_OskarsBeloved_PortraitNames_SkaldSupreme_");
DB_LOW_OskarsBeloved_PortraitNames((FLAG)LOW_OskarsBeloved_Event_PortraitName_Untitled_6de83142-e231-4ad8-8157-620d17dd73bb, "LOW_OskarsBeloved_PortraitNames_Untitled_");

DB_LOW_OskarsBeloved_PortraitNamesIdentity((TAG)MALE_8f74d144-041e-4035-a9ac-72f41fc32de7,"Male");
DB_LOW_OskarsBeloved_PortraitNamesIdentity((TAG)IDENTITY_NEUTRAL_987da248-4855-40b8-9182-4ff04eb7c13d,"Neutral");
DB_LOW_OskarsBeloved_PortraitNamesIdentity((TAG)FEMALE_3806477c-65a7-4100-9f92-be4c12c4fa4f,"Female");

//Journal
DB_QuestDef_State((FLAG)LOW_Jannath_State_GivenQuestToCheckAtelier_a85271fa-cbd8-4f9a-97f3-23dd0776fe4e,"GLO_DoubtingArtist", "JannathPointedToAtelier");
DB_QuestDef_State((FLAG)LOW_Jannath_Event_ReactToDispeledOskar_9a29b39c-9351-4975-a475-3ca3a5d6d0c4,"GLO_DoubtingArtist", "PossessedOskarCombat_DispelledOskar");
DB_QuestDef_State((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac,"GLO_DoubtingArtist", "DestroyedPortrait");

DB_SeenDeadNPCGlobalFlag(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,(FLAG)LOW_OskarsBeloved_Event_SeenOskarDead_d26e044d-fb5e-4f06-afb8-cac19154fc5b);

DB_QuestDef_State_ConditionalFlag((FLAG)LOW_Oskar_State_StayedAfterPosession_4e309497-441c-49ee-a4dc-991f8865f85e, "GLO_DoubtingArtist", "OskarJannathFullyTogether", 1, (FLAG)LOW_OskarsBeloved_Event_ConvincedKerriToLeave_eb5b448c-1d84-4b98-bd79-4f1e8627ae71);

DB_QuestDef_State_ConditionalFlag((FLAG)LOW_OskarsBeloved_Event_GiveSketchbook_85bee4ab-915b-4e57-81b6-9d8bc963e350, "GLO_DoubtingArtist", "ConvincedKerri_OskarGivesSketchbook", 0, (FLAG)LOW_Kerri_State_IsDead_401c332b-e544-466f-96de-de0596c1fac6);
DB_QuestDef_State_ConditionalFlag((FLAG)LOW_OskarsBeloved_Event_GiveSketchbook_85bee4ab-915b-4e57-81b6-9d8bc963e350, "GLO_DoubtingArtist", "KilledKerri_OskarGivesSketchbook", 1, (FLAG)LOW_Kerri_State_IsDead_401c332b-e544-466f-96de-de0596c1fac6);
DB_QuestDef_State_ConditionalFlag((FLAG)LOW_FatherCarrion_State_IsHostile_50c741f9-19be-4fac-997a-3d31202ba14e, "GLO_DoubtingArtist", "CarrionHostile_KnowAboutTorch", 1, (FLAG)LOW_FatherCarrion_State_MentionedTorch_dc4ad5da-52b8-400d-bb12-1609d4248468);

DB_QuestDef_State_ConditionalFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e, "GLO_DoubtingArtist", "SeenSupernaturalEffect", 1, (FLAG)LOW_OskarsBeloved_State_MentionedJannathInAct1_1991f361-7478-4feb-8702-d947cd2ce24a);
DB_QuestDef_State_ConditionalFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e, "GLO_DoubtingArtist", "SeenSupernaturalEffect", 1, (FLAG)LOW_OskarsBeloved_State_LearnedAboutWedding_b3362132-a4c9-24b2-87fb-6f1cdf9398dc);

DB_DeadOnceFlag((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,(FLAG)LOW_Kerri_State_IsDead_401c332b-e544-466f-96de-de0596c1fac6);

//Ownership
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_JannathEstate_Ownership_c7d298cc-73fb-4a4e-8c84-dc868b1b184f, (CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);

DB_LOW_OskarsBeloved_CarrionPasswordLetters((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205);
DB_LOW_OskarsBeloved_CarrionPasswordLetters((ITEM)S_LOW_PhilgravesMansion_LetterFatherCarrion_002_dfcf8310-7986-4465-b71a-21bda436f84d);
DB_LOW_OskarsBeloved_CarrionPasswordLetters((ITEM)S_LOW_PhilgravesMansion_LetterFatherCarrion_003_6e985e7d-017c-45af-b197-255a6763d940);

DB_OskarsBeloved_TorchInfoUpdates("TalkedToCarrion_MentionedTorch");
DB_OskarsBeloved_TorchInfoUpdates("ReadClientList");

//REGION Inspiration_OskarSaved
DB_LOW_OskarsBeloved_BackgroundGoals_OskarSaved_QuestSteps("OskarJannathFullyTogether");
DB_LOW_OskarsBeloved_BackgroundGoals_OskarSaved_QuestSteps("OskarKerriSplitUp");
DB_LOW_OskarsBeloved_BackgroundGoals_OskarSaved_QuestSteps("PersuadedJannath");
//END_REGION
KBSECTION
//REGION Debug messages and debugbook
IF
TextEvent("LOW_OskarsBeloved_ResetPortraits")
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits(_Portrait,_,_Trigger)
AND
_Trigger != NULL_00000000-0000-0000-0000-000000000000
THEN
SetGravity(_Portrait,GRAVITYTYPE.Disabled);
TeleportTo(_Portrait,_Trigger,"",0,0,0,0,0);

IF
TextEvent("LOW_OskarsBeloved_GoToAtelier")
THEN
PROC_SceneOver("LOW_OskarsBeloved_Haunting");
Die(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92);
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OSKARSBELOVED_OSKARPOSSESSED");
PROC_NotifyWhenReadyToMoveOn(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_Oskar_ReadyToGoToAtelier");

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_Debug_HauntedState_d0309426-e815-4648-951b-d6097aa8add7)
THEN
PROC_GlobalSetFlagAndCache((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315);
PROC_LOW_OskarsBeloved_DebugReadyState();

PROC
PROC_LOW_OskarsBeloved_DebugReadyState()
AND
DB_CurrentLevel("CTY_Main_A")
THEN
QuestUpdate("GLO_DoubtingArtist", "ZhentDungeon_MeetArtist");
QuestUpdate("GLO_DoubtingArtist", "ZhentDungeon_LeftForBG");
PROC_LOW_OskarsBeloved_ReadyState(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_Debug_GetCandles_6b92cc95-eb83-4b19-bb88-57609316cfb6)
AND
GetHostCharacter(_Player)
THEN
PROC_ToInventoryAndOnStage((ITEM)S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046,_Player,1,1,1);

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_Debug_ResetPainting_fba00bfa-862d-4bbe-9970-b4b2360e7f38)
THEN
PROC_Foop(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92);

IF
TextEvent("LOW_OskarsBeloved_StopPossession")
THEN
PROC_LOW_OskarsBeloved_StopPossession();

IF
TextEvent("LOW_OskarsBeloved_BringOskarHome")
THEN
PROC_GlobalSetFlagAndCache((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315);
PROC_LOW_OskarsBeloved_DebugReadyState();

IF
TextEvent("LOW_OskarsBeloved_CombatReadyKerriSpirit")
AND
GetHostCharacter(_Player)
THEN
Transform((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356, (CHARACTER)LOW_OskarsBeloved_KerriSpirit_b2fe9ed6-c6b4-43fe-af6a-e463c5ae33cd, LOW_OskarsBeloved_SpiritForm_6dfb094f-1987-4473-baf6-b9c44b63b4c2);
SetFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac);
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"KNOCKED_OUT");
PROC_LOW_OskarsBeloved_StopPossession();
DB_LOW_OskarsBeloved_TeleportedKerri(1);
PROC_LOW_OskarsBeloved_SetupFinalConfrontation(_Player);

IF
TextEvent("LOW_OskarsBeloved_BringOskarHome")
AND
DB_LOW_KerriFinalConfrontationAllies(_Enemy)
THEN
Resurrect((CHARACTER)_Enemy);

IF
TextEvent("LOW_OskarsBeloved_Haunting")
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d);

IF
TextEvent("LOW_OskarsBeloved_StopHaunting")
THEN
ClearFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d,NULL_00000000-0000-0000-0000-000000000000);

IF
TextEvent("LOW_OskarsBeloved_KnockOutOskar")
THEN
ClearFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d,NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT", -1.0, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
TextEvent("LOW_OskarsBeloved_GetCandles")
AND
GetHostCharacter(_Player)
THEN
PROC_ToInventoryAndOnStage((ITEM)S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046,_Player,1,1,1);

IF
TextEvent("LOW_OskarsBeloved_FoopPortrait")
THEN
PROC_Foop(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92);

IF
TextEvent("LOW_OskarsBeloved_StartFinalConfrontation")
THEN
//PROC_LOW_OskarsBeloved_SetupFinalConfrontation();
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionTrigger_Bedroom_6114494a-0022-4593-bec2-aa8bd62c54d6);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_JannathADTrigger_88f7f828-5e35-41a3-9007-4cd716914cdf);

IF
TextEvent("LOW_OskarsBeloved_IntroThrow")
THEN
RemoveStatus(S_LOW_Poltergeist_000_3f37f17d-d273-4cbc-85ea-e803587366f6,"LOW_POLTERGEIST_INVISIBLE");
TeleportTo(S_LOW_Poltergeist_000_3f37f17d-d273-4cbc-85ea-e803587366f6,S_LOW_ThrowStartLocationTrigger_e581d2a3-37c9-4e3f-9ee6-5d43f9f1bee9);
PROC_NotifyWhenReadyToMoveOn(S_LOW_Poltergeist_000_3f37f17d-d273-4cbc-85ea-e803587366f6,"ReadyToMoveForIntroThrow");

//END_REGION


//REGION Oskar and Mansion State

PROC
PROC_LOW_OskarsBeloved_ReadyState((CHARACTER)_Oskar)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
NOT DB_PermaDefeated(_Oskar)
AND
DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_Leaving_201c1ed0-ecc3-4c25-8f68-8716bd5ca7ae)
THEN
PROC_GlobalSetFlagAndCache((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315);

//STATE: OSKAR DID NOT LEFT THE HIDEOUT - JANNATH ESTATE, INDEPENDENT OF OSKAR
PROC
PROC_LOW_OskarsBeloved_ReadyState((CHARACTER)_Oskar)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
THEN
PROC_SetOnStage(S_LOW_AtelierChestKey_fe224cbf-d7e5-412c-bee7-8d0f622ea7f4,0);
TeleportTo(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,S_LOW_JannathWanderTrigger_2bec1ade-6ddd-4d77-81e0-941e5b2fb5cf);
SetHasDialog(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,1);
SetHasDialog(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,1);
DB_SceneManager((CHARACTER)S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,"LOW_OskarsBeloved_AngryNobles_Scene");
DB_SceneManager((CHARACTER)S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,"LOW_OskarsBeloved_AngryNobles_Scene");
DB_LOW_OskarsBeloved_NoblesArguing(1);
PROC_TriggerRegisterForPlayers((TRIGGER)S_LOW_ComplainingDoormanTrigger_afbec02e-0596-45ca-be37-7b2282fb8307);
UnloadLevelTemplate(LT_BGH_ArtistHouse_A_Haunted_28d2d370-37bb-4ee9-a427-81fb1a68e98e);
PROC_LOW_OskasBeloved_SetJannathEstate();
DB_TrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_Bedroom_SUB_952d569f-106c-4180-85e5-4ed8caadd673,(TRIGGER)S_LOW_OskarsBeloved_OutTrigger_Bedroom_8e179e0f-ffcd-47a6-b0d8-5c0a423dd546);
DB_TrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_OfficeTrespassArea_fd375402-858e-4339-ac90-5ed1c5a15fff, (TRIGGER)S_LOW_OskarsBeloved_OutTrigger_Office_e86d79ef-b5a0-4ceb-b870-938a089b49cb);
DB_TrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_UpperMansionTrespassArea_4c9a3444-39d0-4f73-a97c-d16f728d1e2a,(TRIGGER)S_LOW_OskarsBeloved_OutTrigger_Upper_35c683ef-ae80-42a7-89d6-113b5c9cc650);

PROC
PROC_LOW_OskarsBeloved_CheckStateBooks()
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
THEN
PROC_LOW_OskarsBeloved_SetNotHauntedBooks();

PROC
PROC_LOW_OskarsBeloved_CheckStateBooks()
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
THEN
PROC_LOW_OskarsBeloved_SetHauntedBooks();

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_FlyingObjects(_Item)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_FallingFlyingObjects(_Item,_)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_AuraItems(_, _Item)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_SoundTriggers(_Trigger)
THEN
TriggerSetSoundState(_Trigger,"S_LOW_JannathEstate_States","ArtExhibition",1);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits(_Item,_AD,_)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_,_)
THEN
PROC_SetOnStage(_Poltergeist,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_HauntEntities(_Entity)
THEN
PROC_SetOnStage(_Entity,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_Thunderwaves(_Trigger,_Item,_)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_NotHauntDialogs(_Char, _Dialog)
THEN
DB_Dialogs(_Char,_Dialog);

PROC
PROC_LOW_OskasBeloved_SetJannathEstate()
AND
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers(_Trigger)
THEN
DB_OneShotPlayerTrigger(_Trigger);



//STATE: OSKAR DID NOT LEAVE THE HIDEOUT AND HE DID NOT DIE - OSKAR CRIME BOSS
PROC
PROC_LOW_OskarsBeloved_ReadyState((CHARACTER)_Oskar)
AND
QRY_LOW_OskarsBeloved_OskarCanBeBoss()
THEN
PROC_CharacterFullRestore((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
SetCanJoinCombat((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
PROC_RemoveAllDialogEntriesForSpeaker(_Oskar);
DB_Dialogs((CHARACTER)_Oskar,(DIALOGRESOURCE)LOW_OskarsBeloved_OskarAlternativeState_acb91bbe-0d1e-fda0-9a1a-23ebee0f4ad0);
PROC_SetOnStage(_Oskar,1);
ToInventory((ITEM)LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, _Oskar,1,0,1);
TeleportTo(LOW_OskarsBeloved_CounterfitPainting_LowValue_ce9d9e8b-b5fb-4b05-b9e7-3b194af2f890,S_LOW_OskarsBeloved_CounterfeitAsylumPos_eb28fccf-cbf9-461e-b9b3-3a74e6181aea);
PROC_LOW_Guildhall_SetupOskar();

PROC
PROC_LOW_OskarsBeloved_SetHauntedBooks()
AND
DB_LOW_OskarsBeloved_NotHauntBooksOwner(_Item,_)
AND
Exists(_Item,1)
THEN
RequestDelete(_Item);

PROC
PROC_LOW_OskarsBeloved_SetHauntedBooks()
AND
DB_LOW_OskarsBeloved_HauntBooksOwner(_Item,_Owner)
THEN
ToInventory(_Item,_Owner);

PROC
PROC_LOW_OskarsBeloved_SetNotHauntedBooks()
AND
DB_LOW_OskarsBeloved_HauntBooks(_Book)
AND
Exists(_Book,1)
THEN
RequestDelete(_Book);

PROC
PROC_LOW_OskarsBeloved_SetNotHauntedBooks()
AND
DB_LOW_OskarsBeloved_HauntBooksOwner(_Item,_)
AND
Exists(_Item,1)
THEN
RequestDelete(_Item);

PROC
PROC_LOW_OskarsBeloved_SetNotHauntedBooks()
AND
DB_LOW_OskarsBeloved_NotHauntBooksOwner(_Item,_Owner)
THEN
ToInventory(_Item,_Owner);

PROC
PROC_LOW_OskarsBeloved_SetNotHauntedBooks()
AND
NOT QRY_LOW_OskarsBeloved_OskarCanBeBoss()
AND
Exists(S_LOW_OskarsBeloved_CounterfeitRequests_000_ceb240d4-ef01-4030-967b-eb7c14537924,1)
THEN
RequestDelete((ITEM)S_LOW_OskarsBeloved_CounterfeitRequests_000_ceb240d4-ef01-4030-967b-eb7c14537924);

QRY
QRY_LOW_OskarsBeloved_OskarCanBeBoss()
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
NOT DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_FledAfterCalledSlave_21bedc93-b1fb-4acd-9aad-a674e0b358b1)
AND
NOT DB_PermaDefeated(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
DB_NOOP(1);



//Oskar will be angry at players when finding him again in act 3 if left with zhents in act 1
IF
FlagSet((FLAG)LOW_Oskar_Event_RecognizesFromGuildhall_6957f41c-b10a-471a-907b-e00374502ecd,_Player,_)
AND
GetAttitudeTowardsPlayer((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,(CHARACTER)_Player,_Attitude)
AND
_Attitude > -20
THEN
PROC_SetAttitude((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,(CHARACTER)_Player,-20);

IF
LevelLoaded("CTY_Main_A")
AND
QRY_OnlyOnce("LOW_OskarsBeloved_CheckState")
THEN
PROC_LOW_OskarsBeloved_ReadyState((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
PROC_LOW_OskarsBeloved_CheckStateBooks();

IF
LevelGameplayStarted("CTY_Main_A",_)
AND
NOT DB_PermaDefeated((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_SetInitialHauntedATM")
THEN
TriggerSetAtmosphere((TRIGGER)S_ATM_CTY_ArtistHouse_4440ee01-d742-49bc-b19a-b5bdf136ec2e,"238620f3-9e2c-47fd-5fca-f4e40136d24d");

//OSKAR LEFT THE HIDEOUT AND HE IS ALIVE - HAUNT
PROC
PROC_LOW_OskarsBeloved_ReadyState((CHARACTER)_Oskar)
AND
NOT DB_PermaDefeated(_Oskar)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
THEN
PROC_CharacterFullRestore(_Oskar);
DB_SceneManager(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"LOW_OskarsBeloved_Haunting");
DB_SceneManager(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OskarsBeloved_Haunting");
ApplyStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "ANIM_COWER",-1.0);
SetCanJoinCombat((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
SetCanFight((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
SetCanJoinCombat((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,1);
SetCanFight((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,1);
PROC_RemoveAllDialogEntriesForSpeaker(_Oskar);
PROC_LoopEffect((EFFECTRESOURCE)VFX_Script_Cursed_Portrait_01_189d3a78-c2aa-3429-717a-b44603c3f2ca, (ITEM) S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92, "LOW_OskarsBeloved_CursedPortrait", "CTY_Main_A","");
SetCanInteract((ITEM)S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,1);
TeleportTo(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,S_LOW_JannathBedroomTrigger_2ccc213b-e3b8-4a39-bdf1-c7756a61a0f6);
TeleportTo(_Oskar,S_LOW_OskarTeleportTo_e62380f3-2dc0-43fc-9ed7-b38f034603df);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OSKARSBELOVED_OSKARPOSSESSED", -1.0, 0);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "POSSESSED_TECHNICAL", -1.0, 0);
DB_DoNotRemoveKnockedOutCharacterOnLongRest((CHARACTER)_Oskar);
DB_PreventKnockedOutPermaDefeated((CHARACTER)_Oskar);
SetFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d);
DB_LOW_OskarsBeloved_KerriPossessing(1);
PROC_LOW_OskarsBeloved_RegisterAtelierTriggerZombies();
LoadLevelTemplate(LT_BGH_ArtistHouse_A_Haunted_28d2d370-37bb-4ee9-a427-81fb1a68e98e);
DB_DialogMoneyTransfer(1,(DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d,100,2);
DB_GiveItemToEvent((ITEM)S_LOW_KerriRing_2b1eab03-4655-4d95-a94f-2f1c9031bc8c,(FLAG)LOW_Kerri_Event_Leaves_7ed68fc0-2836-4574-8148-15344187116a);
Lock(S_LOW_ChestLetter_6ae18b9d-e089-4f05-873e-5f9d0872e636, "LOW_OskarsBeloved_AtelierChest");
PROC_SetOnStage(LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, 0);
PROC_SetOnStage(_Oskar,1);
ToInventory(S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,S_LOW_ChestLetter_6ae18b9d-e089-4f05-873e-5f9d0872e636,1,0,0);
PROC_ToInventoryAndOnStage(S_LOW_AtelierChestKey_fe224cbf-d7e5-412c-bee7-8d0f622ea7f4, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1,0,0);
DB_GLO_DefeatCounter(S_LOW_KerriGhostMummy_01_e0d5067c-5cf9-42c7-92c5-acec03e6e61a, "LOW_OskarsBeloved_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_KerriGhostMummy_02_a1721b88-3bb8-4989-9d7b-b0341dc24e07, "LOW_OskarsBeloved_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_KerriGhostNurse_01_b8588238-d973-4363-9c78-bbb02729aa90, "LOW_OskarsBeloved_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_KerriGhostNurse_02_49163297-18fd-4451-8fe9-6988bae89dd5, "LOW_OskarsBeloved_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356, "LOW_OskarsBeloved_FinalConfrontationEnemies");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_OskarsBeloved_FinalConfrontationEnemies",(FLAG)LOW_OskarsBeloved_State_AllFinalEnemiesPermaDefeated_5c1eeb4a-b09d-42f2-bbc2-f606fcbfc899);
DB_OneShotPlayerTrigger((TRIGGER)S_LOW_ThrowObjectTrigger_98b0749e-07f2-4c69-bf9b-ba1a50d2d6ad);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_ComplainingDoormanTrigger_afbec02e-0596-45ca-be37-7b2282fb8307);
PROC_OskarsBeloved_SetHauntState();
DB_PerceptionSkillCustomAD((ITEM)S_UNI_OskarInteractableEasel_bf01a01b-5d2d-46f7-9e1f-32358d231908, (DIALOGRESOURCE)LOW_OskarsBeloved_PAD_OskarEaselSeen_c5a39ca7-68d0-589a-165b-9a24a0dc98fe);
PROC_TriggerRegisterForPlayers((TRIGGER)S_LOW_OskarsBeloved_PianoTrigger_2d031113-83f1-411e-a086-b2e38fddf0c7);
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d, 1500, 2);
DB_HasItemEvent((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,(FLAG)LOW_OskarsBeloved_State_HasCarrionLetter_738f20e5-763b-46f4-b4e9-3369b17d1836);
PROC_RemoveDBTrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_Bedroom_SUB_952d569f-106c-4180-85e5-4ed8caadd673);
PROC_RemoveDBTrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_OfficeTrespassArea_fd375402-858e-4339-ac90-5ed1c5a15fff);
PROC_RemoveDBTrespassTrigger((TRIGGER)S_LOW_OskarsBeloved_UpperMansionTrespassArea_4c9a3444-39d0-4f73-a97c-d16f728d1e2a);
ClearOwnership((ITEM)S_LOW_OskarsBeloved_OfficeDoor_001_2aee5a95-e805-4660-9ece-02520e3dcecf);
ClearOwnership((ITEM)S_LOW_OskarsBeloved_OfficeDoor_002_2b65b35d-1980-4606-b067-080085807e40);
ClearOwnership((ITEM)S_LOW_OskarsBeloved_JannathRoomDoor_9909a9e0-16d3-4930-bb88-e3489ecc3628);
PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_HauntLights(_Trigger,_Light)
THEN
RemoveStatus(_Light, "BURNING");
PROC_TriggerRegisterForPlayers(_Trigger);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_CellarFood(_Item,_Template)
THEN
Transform(_Item,_Template, (SHAPESHIFTRULE)PHYSICAL_4acc6277-6dcd-4110-9450-b9379beaedac);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_Thunderwaves(_Trigger,_Item,_)
THEN
PROC_TriggerRegisterForParty(_Trigger);
PROC_SetOnStage(_Item,1);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_HauntSurfaceSpawn(_Trigger,_,_)
THEN
DB_OneShotPartyTrigger(_Trigger);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_FlyingObjects(_Item)
THEN
PROC_SetOnStage(_Item,1);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_AuraItems(_Trigger,_Item)
THEN
PROC_SetOnStage(_Item,1);
PROC_TriggerRegisterForParty(_Trigger);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_SoundTriggers(_Trigger)
THEN
TriggerSetSoundState(_Trigger,"S_LOW_JannathEstate_States","HauntActive",1);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_HauntEntities(_Entity)
THEN
PROC_SetOnStage(_Entity,1);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_Poltergeists(_Entity,_Location,_)
AND
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter(_Flag,_Location,_CombatCounter)
THEN
PROC_SetOnStage(_Entity,1);
DB_GLO_DefeatCounter(_Entity,_CombatCounter);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits(_Item,_AD,_)
THEN
PROC_SetOnStage(_Item,1);


PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_OnlyNotHauntObjects(_Item)
THEN
PROC_SetOnStage(_Item,0);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_FallingFlyingObjects(_Item,_Trigger)
THEN
PROC_SetOnStage(_Item,1);
//DB_OneShotPartyTrigger(_Trigger);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_HauntTriggers(_Trigger)
THEN
PROC_TriggerRegisterForParty(_Trigger);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers(_Trigger,_)
THEN
PROC_TriggerRegisterForParty(_Trigger);


PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_NotHauntEntities(_Entity)
THEN
PROC_SetOnStage(_Entity,0);

PROC
PROC_OskarsBeloved_SetHauntState()
AND
DB_LOW_OskarsBeloved_NotHauntOneShotTriggers(_Trigger)
THEN
PROC_RemoveOneShotTrigger(_Trigger);

PROC
PROC_LOW_OskarsBeloved_RegisterAtelierTriggerZombies()
AND
DB_LOW_AvailablePortraitAllies(_Zombie)
THEN
TriggerRegisterForCharacter((TRIGGER)S_LOW_AtelierRegionTrigger_0e518c99-b205-4ad7-8ce6-e05f9f37ecbe,(CHARACTER)_Zombie);

//TODO: Removed this after bug with set visible
PROC
PROC_LongRest()
AND
IsOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1)
THEN
SetVisible(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
//END_REGION

//END_REGION

//REGION Introductory Object throws

//Throw outside

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Player, (TRIGGER)S_LOW_ThrowObjectTrigger_98b0749e-07f2-4c69-bf9b-ba1a50d2d6ad)
THEN
Die(S_LOW_BreakableDoor_b3b77b06-f522-4890-8548-cd50f2087599);
Die(S_LOW_OskarsBeloved_ExteriorFlyingChair_c63684f2-8f9c-427a-b6bf-e9744ada8d7f);
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_AD_TarhunMurmuring_a93495d8-c2a5-1b9e-0d1e-8f37271e4311,S_LOW_TarhunMnemonis_2d1b98a0-01a9-4c21-8bc2-9738c47f6966);



IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
DB_Players(_Player)
AND
QRY_SpeakerIsAvailable(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
QRY_SpeakerIsAvailable(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_StartPossessionDialog")
AND
QRY_StartDialogCustom((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionScene_b0c1258a-cd28-cc19-3094-8308f974427d, S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, _Player,0,0,0,0)
THEN
DB_NOOP(1);
//END_REGION

//REGION Possession

IF
DB_LOW_OskarsBeloved_PoltergeistsBedroom(_Poltergeist,_)
THEN
SetOnStage(_Poltergeist,0);

PROC
PROC_SceneInterrupted(_NPC, _Char, "LOW_OskarsBeloved_Haunting", "Attacked")
AND
DB_SceneManager_DisturbanceRegistering(_Char,_Reason,_,_,_,_ID)
THEN
DB_SceneManager_BlockDisturbance(_ID);
PROC_LOW_OskarsBeloved_StartHauntingCombat();

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionScene_b0c1258a-cd28-cc19-3094-8308f974427d,_)
THEN
PROC_LOW_OskarsBeloved_StartHauntingCombat();

PROC
PROC_LOW_OskarsBeloved_StartHauntingCombat()
AND
QRY_OnlyOnce("LOW_OskarsBeloved_StartHauntCombat")
THEN
PROC_SceneOver("LOW_OskarsBeloved_Haunting");
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);
SetFlag((FLAG)LOW_OskarsBeloved_State_TurnBasedPossession_ddb51d84-4944-48b7-9322-d9e41ff43e4a);
DB_LOW_OskarsBeloved_WitnessedPossession(1);
PROC_LOW_OskarsBeloved_PlaceBedroomPoltergeists();

PROC
PROC_LOW_OskarsBeloved_PlaceBedroomPoltergeists()
AND
DB_LOW_OskarsBeloved_PoltergeistsBedroom(_Poltergeist,_Location)
THEN
TeleportTo(_Poltergeist,_Location,"LOW_OskarsBeloved_BedroomPoltergeistAppears",0,0,0,0,1);

IF
EntityEvent(_Poltergeist,"LOW_OskarsBeloved_BedroomPoltergeistAppears")
THEN
PROC_Foop(_Poltergeist,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);

IF
TurnStarted(_Civilian)
AND
DB_LOW_OskarsBeloved_CivilianInHauntingCombat((CHARACTER)_Civilian)
AND
DB_LOW_OskarsBeloved_PossessionCombatID(_ID)
AND
DB_Is_InCombat(_Civilian,_ID)
THEN
EndTurn(_Civilian);

IF
DB_Is_InCombat(S_LOW_Poltergeist_3f37f17d-d273-4cbc-85ea-e803587366f6,_ID)
AND
DB_Is_InCombat(S_LOW_Poltergeist_001_a25a404c-de80-4927-9c73-2d18a46a46ae,_ID)
AND
DB_Is_InCombat(S_LOW_Poltergeist_002_7372513a-a82e-4ac8-9754-a19231c72934,_ID)
AND
NOT DB_LOW_OskarsBeloved_PossessionCombatID(_)
THEN
DB_IgnoreAssault((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
DB_IgnoreAssault((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);
DB_LOW_OskarsBeloved_PossessionCombatID(_ID);
PROC_LOW_OskarsBeloved_HideBedroomPoltergeists();

IF
EnteredCombat(_Item,_ID)
AND
DB_LOW_OskarsBeloved_Thunderwaves(_,(ITEM)_Item,_)
AND
NOT DB_LOW_OskarsBeloved_SkullCombat(_ID,_Item)
THEN
DB_LOW_OskarsBeloved_SkullCombat(_ID,_Item);

IF
SwitchedCombat(_Item,_OldID,_ID)
AND
DB_LOW_OskarsBeloved_SkullCombat(_OldID,(ITEM)_Item)
THEN
NOT DB_LOW_OskarsBeloved_SkullCombat(_OldID,(ITEM)_Item);
DB_LOW_OskarsBeloved_SkullCombat(_ID,(ITEM)_Item);
		
IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_SkullCombat(_ID,_Item)
THEN
NOT DB_LOW_OskarsBeloved_SkullCombat(_ID,_Item);

PROC
PROC_LOW_OskarsBeloved_HideBedroomPoltergeists()
AND
DB_LOW_OskarsBeloved_PoltergeistsBedroom(_Poltergeist,_)
AND
HasActiveStatus(_Poltergeist,"LOW_POLTERGEIST_INVISIBLE",0)
THEN
ApplyStatus(_Poltergeist,"LOW_POLTERGEIST_INVISIBLE",-1.0);


IF
SwitchedCombat(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, _ID, _NewID)
AND
DB_LOW_OskarsBeloved_PossessionCombatID(_ID)
THEN
NOT DB_LOW_OskarsBeloved_PossessionCombatID(_ID);
DB_LOW_OskarsBeloved_PossessionCombatID(_NewID);

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_Event_AllBedroomPoltergeistsDefeated_e2d17cde-b625-456d-9dd7-23e944cc0e4a)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
THEN
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT", -1.0);


IF
KilledBy(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,_Player,_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
QRY_CharacterGetOwnerOrSelf((CHARACTER)_Player)
AND
DB_QRYRTN_CharacterGetOwnerOrSelf(_OwnerOrSelf)
AND
DB_Players((CHARACTER)_OwnerOrSelf)
THEN
DB_SpotPlayers((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "LOW_OskarsBeloved_JannathSpotKillersOskar", (FLAG)NULL_00000000-0000-0000-0000-000000000000, (FLAG)NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "LOW_OskarsBeloved_JannathSpotKillersOskar", (TRIGGER)S_LOW_OskarsBeloved_Bedroom_SUB_952d569f-106c-4180-85e5-4ed8caadd673);



PROC
PROC_SpotPlayers_Spotted((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "LOW_OskarsBeloved_JannathSpotKillersOskar", _Player)
AND
QRY_StartDialog((DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d, (CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, _Player)
THEN
PROC_SpotPlayers_StopSpotting("LOW_OskarsBeloved_JannathSpotKillersOskar");

PROC
PROC_LOW_OskarsBeloved_JannathReactToOskarFate()
AND
QRY_SpeakerIsAvailable(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
NOT DB_LOW_OskarsBeloved_OskarWakingUp(_,_)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_FledPossession_1e218b07-c517-451a-94f8-a853bcb03bc0)
AND
QRY_LOW_OskarsBeloved_AvatarForJannathDialog()
AND
DB_QRYRTN_LOW_OskarsBeloved_AvatarForJannathDialog(_Player)
THEN
PROC_CharacterMoveToAndTalk((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, _Player, (DIALOGRESOURCE)LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d, "LOW_OskarsBeloved_JannathRunsToTalk","Run",10.0);

IF
DialogEnded(LOW_OskarsBeloved_Jannath_e62d18e1-6498-dcb3-39b3-5367523d433d,_)
AND
DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2)
THEN
PROC_LOW_OskarsBeloved_JannathRunToOskarDead();

PROC
PROC_LOW_OskarsBeloved_JannathRunToOskarDead()
AND
NOT DB_PermaDefeated(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_JannathRunToDeadOskar")
THEN
DB_DoNotFace(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);
SetFlag((FLAG)LOW_Jannath_Event_GoCryNearOskar_a85ab57c-8800-45ed-bf6a-f6c5ac2a1ce8);

IF
KilledBy(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,_Player,_,_)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_StopPossession")
THEN
PROC_LOW_OskarsBeloved_StopPossession();

QRY
QRY_LOW_OskarsBeloved_AvatarForJannathDialog()
AND
DB_Avatars(_Player)
AND
CanSee(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,_Player, 1)
AND
NOT DB_QRYRTN_LOW_OskarsBeloved_AvatarForJannathDialog(_)
THEN
DB_QRYRTN_LOW_OskarsBeloved_AvatarForJannathDialog(_Player);

IF
LeftCombat(_Player,_ID)
AND
DB_LOW_OskarsBeloved_PossessionCombatID(_ID)
AND
CombatGetInvolvedPartyMembersCount(_ID,0)
AND
NOT DB_Dead(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
QRY_LOW_OskarsBeloved_CheckPoltergeistsAlive()
AND
NOT DB_LOW_OskarsBeloved_OskarWakingUp(_,_)
THEN
Die(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, DEATHTYPE.Necrotic, NULL_00000000-0000-0000-0000-000000000000, 0, 0);
SetFlag((FLAG)LOW_OskarsBeloved_State_FledPossession_1e218b07-c517-451a-94f8-a853bcb03bc0);
QuestUpdate("GLO_DoubtingArtist", "ArtistIsDead_AbandonedInPossession");
NOT DB_LOW_OskarsBeloved_PossessionCombatID(_ID);

//Combat counter flag gets set after combat ended, this query allows to discern if players ended combat with poltergeists alive
QRY
QRY_LOW_OskarsBeloved_CheckPoltergeistsAlive()
AND
DB_LOW_OskarsBeloved_PoltergeistsBedroom(_Poltergeist,_)
AND
NOT DB_PermaDefeated(_Poltergeist)
THEN
DB_NOOP(1);

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_FledPossession_1e218b07-c517-451a-94f8-a853bcb03bc0)
THEN
PROC_LOW_OskarsBeloved_JannathRunToOskarDead();

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_PossessionCombatID(_ID)
AND
NOT DB_Dead((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
NOT DB_LOW_OskarsBeloved_PossessionCombatID(_ID);
TimerLaunch("LOW_OskarsBeloved_JannathRecoverBeforeReact",2000);

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_PossessionCombatID(_ID)
AND
DB_Dead((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
NOT DB_LOW_OskarsBeloved_PossessionCombatID(_ID);
PROC_LOW_OskarsBeloved_JannathReactToOskarFate();

IF
TimerFinished("LOW_OskarsBeloved_JannathRecoverBeforeReact")
THEN
PROC_LOW_OskarsBeloved_JannathReactToOskarFate();

IF
DB_PermaDefeated(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_HandleOskarDiabled")
THEN
PROC_LOW_OskarsBeloved_HandleOskarDisabled();

IF
FlagSet((FLAG)LOW_OskarsBeloved_State_FledPossession_1e218b07-c517-451a-94f8-a853bcb03bc0,_,_)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_StopPossession")
THEN
PROC_LOW_OskarsBeloved_StopPossession();

IF
StatusApplied(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT", _, _)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
HasActiveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OSKARSBELOVED_OSKARPOSSESSED",1)
THEN
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OSKARSBELOVED_OSKARPOSSESSED");

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_LOW_OskarsBeloved_KerriPossessing(1)
THEN
DB_NOOP(1);


//When knocked out, no more haunting and removed possesed status
IF
StatusApplied(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT", _, _)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_HandleOskarDiabled")
THEN
QuestUpdate("GLO_DoubtingArtist", "PossessedOskarCombat_KnockedOutOskar");
PROC_LOW_OskarsBeloved_HandleOskarDisabled();

PROC
PROC_LOW_OskarsBeloved_HandleOskarDisabled()
AND
DB_LOW_OskarsBeloved_SoundTriggers(_Trigger)
THEN
TriggerSetSoundState(_Trigger,"S_LOW_JannathEstate_States","HauntInactive",1);

PROC
PROC_LOW_OskarsBeloved_HandleOskarDisabled()
AND
DB_LOW_OskarsBeloved_PoltergeistsBedroom(_Poltergeist,_)
AND
NOT DB_Dead((CHARACTER)_Poltergeist)
THEN
Die(_Poltergeist,DEATHTYPE.Disintegrate,1);


PROC
PROC_LOW_OskarsBeloved_HandleOskarDisabled()
AND
DB_LOW_OskarsBeloved_FlyingObjects(_Item)
AND
NOT _Item == S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692
THEN
Die(_Item);

PROC
PROC_LOW_OskarsBeloved_HandleOskarDisabled()
AND
IsOnStage(S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692,1)
THEN
PROC_Poof(S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692);

PROC
PROC_LOW_OskarsBeloved_HandleOskarDisabled()
THEN
NOT DB_IgnoreAssault((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);
NOT DB_IgnoreAssault((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "ANIM_COWER");
SetCharacterLootable((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
ClearFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d,NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
THEN
NOT DB_LOW_OskarsBeloved_KerriPossessing(1);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_OskarsBeloved_PianoTrigger_2d031113-83f1-411e-a086-b2e38fddf0c7);
PROC_ResetRelationMutual((FACTION)ACT3_LOW_OskarsBeloved_JannathEstate_d9fda891-059b-47fa-83f1-8b83c888a0d1,(FACTION)ACT1_PLA_DoubtingArtist_d800ec60-240e-49e8-9b26-f0a90416c4a0);
PROC_SetRelationToPlayers((FACTION)ACT1_PLA_DoubtingArtist_d800ec60-240e-49e8-9b26-f0a90416c4a0,50);


PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location)
THEN
NOT DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
THEN
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_HadHauntRoomFTB(_Location)
THEN
NOT DB_LOW_OskarsBeloved_HadHauntRoomFTB(_Location);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_AuraItems(_Trigger,_Item)
THEN
PROC_StopLoopEffect(_Item, "LOW_OskarsBeloved_CursedItemEffect");
PROC_Poof(_Item);
PROC_TriggerUnregisterForParty(_Trigger);

IF
StatusApplied(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT", _, _)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarFevras_State_IsKnockedOut_d21b05d1-d05e-49fd-bde5-868e4e4a67c3)
THEN
SetFlag((FLAG)LOW_OskarFevras_State_IsKnockedOut_d21b05d1-d05e-49fd-bde5-868e4e4a67c3);

IF
StatusRemoved(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "KNOCKED_OUT",_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarFevras_State_IsKnockedOut_d21b05d1-d05e-49fd-bde5-868e4e4a67c3)
THEN
ClearFlag((FLAG)LOW_OskarFevras_State_IsKnockedOut_d21b05d1-d05e-49fd-bde5-868e4e4a67c3);

IF
UsingSpellOnTarget(_Player,S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"Target_DispelEvilAndGood_BreakEnchantment",_,_,_ID)
AND
NOT DB_LOW_OskarsBeloved_OskarWakingUp(_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
THEN
DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player);

IF
UsingSpellOnTarget(_Player,S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"Target_ProtectionFromEvilAndGood",_,_,_ID)
AND
NOT DB_LOW_OskarsBeloved_OskarWakingUp(_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
THEN
DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player);

IF
StatusRemoved(_Oskar,"LOW_OSKARSBELOVED_OSKARPOSSESSED",_,_)
AND
DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_HandleOskarDiabled")
THEN
PROC_LOW_OskarsBeloved_HandleOskarDisabled();

IF
StatusRemoved(_Oskar,"LOW_OSKARSBELOVED_OSKARPOSSESSED",_,_)
AND
DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player)
THEN
PROC_SetRelationToPlayers((FACTION)ACT1_PLA_DoubtingArtist_d800ec60-240e-49e8-9b26-f0a90416c4a0, 50);
LeaveCombat(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
DB_Dialogs(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, (DIALOGRESOURCE)LOW_OskarsBeloved_OskarDispeledEvil_ca94f104-8b96-2ecf-8ace-bd8aad978656);
PROC_SelfHealing_Disable((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
TimerLaunch("LOW_OskarsBeloved_OskarWakesUpDispel",2000);

IF
StatusRemoved(_Oskar,"LOW_OSKARSBELOVED_OSKARPOSSESSED",_,_)
THEN
ClearFlag((FLAG)LOW_Oskar_State_IsPosessed_97965760-380f-4bbf-a94b-8d0ddff33912);

IF
UseStarted(_Player, (ITEM)S_LOW_BedBedroom_762d92aa-277b-4b75-a0bf-42625da09d57)
AND
DB_Players(_Player)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
NOT DB_Defeated(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92)
THEN
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_AD_JannathReactToBedInteraction_d57d50d5-70f8-c735-1821-d62a9705ebfb, S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, _Player);

QRY
QRY_OskarsBeloved_FindAvailableAvatar((CHARACTER)_Oskar)
AND
DB_QRYRTN_OskarsBeloved_FindAvailableAvatar(_Previous)
THEN
NOT DB_QRYRTN_OskarsBeloved_FindAvailableAvatar(_Previous);

QRY
QRY_OskarsBeloved_FindAvailableAvatar((CHARACTER)_Oskar)
AND
DB_Avatars(_Avatar)
AND
NOT DB_QRYRTN_OskarsBeloved_FindAvailableAvatar(_)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Avatar, _Oskar)
THEN
DB_QRYRTN_OskarsBeloved_FindAvailableAvatar(_Avatar);

IF
TimerFinished("LOW_OskarsBeloved_OskarWakesUpDispel")
AND
DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player)
THEN
NOT DB_LOW_OskarsBeloved_OskarWakingUp(_ID,_Player);

IF
TimerFinished("LOW_OskarsBeloved_OskarWakesUpDispel")
AND
QRY_OskarsBeloved_FindAvailableAvatar((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_QRYRTN_OskarsBeloved_FindAvailableAvatar(_Avatar)
AND
GetHostCharacter(_Player)
AND
QRY_StartDialog_Fixed((DIALOGRESOURCE)LOW_OskarsBeloved_OskarDispeledEvil_ca94f104-8b96-2ecf-8ace-bd8aad978656,S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, _Avatar)
THEN
DB_NOOP(1);

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_OskarDispeledEvil_ca94f104-8b96-2ecf-8ace-bd8aad978656, _)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_OskarKnockOutPostDispel")
THEN
PROC_SelfHealing_Disable((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"KNOCKED_OUT",-1.0);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"KNOCKED_OUT_PERMANENTLY",-1.0);
PROC_LOW_OskarsBeloved_JannathReactToOskarFate();

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)LOW_OskarsBeloved_OskarDispeledEvil_ca94f104-8b96-2ecf-8ace-bd8aad978656, _InstanceID)
AND
QRY_SpeakerIsAvailable(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
THEN
PROC_DialogAddSpeakingActor(_InstanceID, S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);


//AD reaction from Jannath
IF
StatusRemoved(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OSKARSBELOVED_OSKARPOSSESSED",_,_)
AND
NOT DB_Defeated(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92)
AND
NOT DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2)
AND
QRY_SpeakerIsAvailable(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_JannathADReact")
THEN
SetFlag((FLAG)LOW_Jannath_Event_ReactToKnockedOutOskar_b35af662-d81d-4203-8f23-a7e66283f0f8);
PROC_ForceStopDialog(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);
TimerLaunch("LOW_OskarsBeloved_JannathReact",500);


IF
TimerFinished("LOW_OskarsBeloved_JannathReact")
THEN
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_PossessionAD_7fc3c512-b463-e099-6a4c-bf527b6275fd, S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);

//END_REGION

//REGION Painting puzzle / Atelier

IF
RequestCanCombine(_Player,S_UNI_OskarInteractableEasel_bf01a01b-5d2d-46f7-9e1f-32358d231908,_WrongItem,_,_,_,_RequestID)
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)_WrongItem,_,_OriginalPos)
AND
_WrongItem != S_UNI_LOW_OskarPortrait_1836435f-a6c0-4ed0-9be3-7a64bd391e85
AND
CreateAtObject((CHARACTERROOT)LOW_OskarsBeloved_Nurse_NoXP_24ecdb16-44ec-43a4-9135-5d8c55758575,S_LOW_OskarsBeloved_WrongPortrait_EnemyLocation_7d1fd32b-9776-469e-be00-4e08fb80b5a1,0,1,"",1,_Enemy)
AND
GetPosition(S_LOW_OskarsBeloved_WrongPortrait_EnemyLocation_7d1fd32b-9776-469e-be00-4e08fb80b5a1,_X,_Y,_Z)
AND
FindValidPosition(_X,_Y,_Z,15.0, _Enemy, 1,_XF,_YF,_ZF)
THEN
TeleportToPosition(_Enemy,_XF,_YF,_ZF, "LOW_OskarsBeloved_TeleportedWrongPortraitEnemy",0,0,0,0,1);
SetGravity(_WrongItem,GRAVITYTYPE.Disabled);
PROC_Poof(_WrongItem);
TeleportTo(_WrongItem,_OriginalPos,"LOW_OskarsBeloved_TeleportedWrongPortrait",0,0,0,0,0);
DB_LOW_OskarsBeloved_ConnectedEnemyPortrait(_WrongItem, _Enemy);
SetCanPickUp(_WrongItem,0);

//FindValidPosition Fallback
IF
RequestCanCombine(_Player,S_UNI_OskarInteractableEasel_bf01a01b-5d2d-46f7-9e1f-32358d231908,_WrongItem,_,_,_,_RequestID)
AND
NOT DB_LOW_OskarsBeloved_ConnectedEnemyPortrait(_, _)
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits((ITEM)_WrongItem,_,_OriginalPos)
AND
_WrongItem != S_UNI_LOW_OskarPortrait_1836435f-a6c0-4ed0-9be3-7a64bd391e85
AND
CreateAtObject((CHARACTERROOT)LOW_OskarsBeloved_Nurse_NoXP_24ecdb16-44ec-43a4-9135-5d8c55758575,S_LOW_OskarsBeloved_WrongPortrait_EnemyLocation_7d1fd32b-9776-469e-be00-4e08fb80b5a1,0,1,"",1,_Enemy)
AND
GetPosition(S_LOW_OskarsBeloved_WrongPortrait_EnemyLocation_7d1fd32b-9776-469e-be00-4e08fb80b5a1,_X,_Y,_Z)
THEN
TeleportToPosition(_Enemy,_X,_Y,_Z, "LOW_OskarsBeloved_TeleportedWrongPortraitEnemy",0,0,0,0,1);
SetGravity(_WrongItem,GRAVITYTYPE.Disabled);
PROC_Poof(_WrongItem);
TeleportTo(_WrongItem,_OriginalPos,"LOW_OskarsBeloved_TeleportedWrongPortrait",0,0,0,0,0);
DB_LOW_OskarsBeloved_ConnectedEnemyPortrait(_WrongItem, _Enemy);
SetCanPickUp(_WrongItem,0);

IF
EntityEvent(_WrongItem, "LOW_OskarsBeloved_TeleportedWrongPortrait")
THEN
DB_LOW_OskarsBeloved_BurningPortrait(_WrongItem);
PROC_Foop(_WrongItem);

IF
WentOnStage(_Portrait,1)
AND
DB_LOW_OskarsBeloved_BurningPortrait(_WrongItem)
THEN
NOT DB_LOW_OskarsBeloved_BurningPortrait(_WrongItem);
ApplyStatus(_WrongItem, "BURNING", -1.0);


PROC
PROC_StateSet_Defeated(_Enemy)
AND
DB_LOW_OskarsBeloved_ConnectedEnemyPortrait(_WrongItem, _Enemy)
THEN
PROC_Poof(_WrongItem);

IF
GameBookInterfaceClosed((ITEM)S_LOW_AtelierDoorNote_eda67de2-1682-4fda-9402-2bd948a3e3ab,_Player)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_DiscoveredAtelierNote")
THEN

SetCanInteract(S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c,1);
SetEntityEvent(S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c, "RevealFromStory");

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_Event_RevealAtelierWall_bf9386b2-cdf4-4011-991c-274f169f8cfe)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_DiscoveredAtelierNote")
THEN
SetCanInteract(S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c,1);
SetEntityEvent(S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c, "RevealFromStory");

IF
Combined(S_UNI_OskarInteractableEasel_bf01a01b-5d2d-46f7-9e1f-32358d231908,S_UNI_LOW_OskarPortrait_1836435f-a6c0-4ed0-9be3-7a64bd391e85, _, _, _, _Player, _)
THEN
SetCanInteract((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c,1);
PROC_ItemUnlockAndOpen((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c);
PROC_TryStartAD(LOW_OskarsBeloved_PAD_SolvedAtelierPuzzle_fcfc719b-9fe2-21c9-70cc-771f6ef74d14, _Player);

IF
GameBookInterfaceClosed(_Item,_)
AND
DB_LOW_OskarsBeloved_CarrionPasswordLetters(_Item)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_ReactingToGettingCarrionLetter")
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_ReadLetter_ee3f0fae-416f-4511-a2e6-30e79685f730);


//END_REGION

//REGION Kerri Painting
IF
EnteredTrigger(_Player, (TRIGGER)S_LOW_OskarsBeloved_AtelierSeenPortraitsTrigger_c03c9227-af2e-4a22-a45d-3d088639a595)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_ReachedAtelier_1e97b510-cae3-46d6-932c-7502450f666d);
PROC_TriggerUnregisterForParty((TRIGGER)S_LOW_OskarsBeloved_AtelierSeenPortraitsTrigger_c03c9227-af2e-4a22-a45d-3d088639a595);

IF
Opened((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_SeenKerriPortrait_33e38cf7-eede-4085-a0da-8d90205af858)
AND
IsOnStage(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,1)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_SeenKerriPortrait_33e38cf7-eede-4085-a0da-8d90205af858);

IF
DB_Destroyed((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_SeenKerriPortrait_33e38cf7-eede-4085-a0da-8d90205af858)
AND
IsOnStage(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,1)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_SeenKerriPortrait_33e38cf7-eede-4085-a0da-8d90205af858);

IF
LeftTrigger(_Zombie, (TRIGGER)S_LOW_AtelierRegionTrigger_0e518c99-b205-4ad7-8ce6-e05f9f37ecbe)
THEN
Die(_Zombie, DEATHTYPE.Physical, 0);

IF
UseStarted(_Player, S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92)
AND
DB_Players(_Player)
AND
NOT DB_DialogPlayers(_,_Player,_)
AND
NOT GetEquippedWeapon((CHARACTER)_Player,S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046)
THEN
PROC_TryStartAD(LOW_OskarsBeloved_AD_PortraitInteraction_0f31cb00-1bf8-50ab-c362-b5b1d9213b33, _Player);


//Destroying the portrait - If players attack the cursed portrait with Torch of Revocation or they interact with it having the Torch equipped, the portrait is destroyed, kerri pops out, dialog starts after a couple seconds
IF
UseStarted(_Player, S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92)
AND
GetEquippedWeapon((CHARACTER)_Player,S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046)
THEN
PROC_OskarsBeloved_FreeKerri(_Player);

IF
StatusRemoved(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,"LOW_OSKARSBELOVED_POSSESSEDPORTRAIT",_,_)
AND
GetOwner((ITEM)S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046,_Player)
THEN
PROC_OskarsBeloved_FreeKerri(_Player);

PROC
PROC_OskarsBeloved_FreeKerri((GUIDSTRING)_Attacker)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_FreeKerri")
THEN
TriggerSetAtmosphere((TRIGGER)S_ATM_CTY_ArtistHouse_4440ee01-d742-49bc-b19a-b5bdf136ec2e,"f97ad0bd-4d19-160f-92c1-efca58159b6d");
Transform((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356, (CHARACTER)LOW_OskarsBeloved_KerriSpirit_b2fe9ed6-c6b4-43fe-af6a-e463c5ae33cd, LOW_OskarsBeloved_SpiritForm_6dfb094f-1987-4473-baf6-b9c44b63b4c2);
SetFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac);
Die(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92);
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"KNOCKED_OUT");
RealtimeObjectTimerLaunch(_Attacker,"LOW_OskarsBeloved_KerriFreed",1500);

IF
EnteredCombat(_Zombie, _ID)
AND
GetTemplate(_Zombie, (CHARACTERROOT)LOW_OskarsBeloved_Nurse_NoXP_24ecdb16-44ec-43a4-9135-5d8c55758575)
AND
CombatGetInvolvedPlayersCount(_ID,_CountPlayers)
AND
_CountPlayers > 0
AND
CombatGetInvolvedPlayer(_ID,1,_Player)
AND
NOT DB_LOW_OskarsBeloved_PortraitZombieCombat(_ID, _Player)
THEN
PROC_TryStartAD(LOW_OskarsBeloved_PAD_ReactionPortraitZombies_87561546-0f54-cae0-cf23-4eabc3a8fb53, _Player);
DB_LOW_OskarsBeloved_PortraitZombieCombat(_ID, _Player);

IF
SwitchedCombat(_Character, _OldID, _NewID)
AND
DB_LOW_OskarsBeloved_PortraitZombieCombat(_OldID, _Player)
THEN
NOT DB_LOW_OskarsBeloved_PortraitZombieCombat(_OldID, _Player);
DB_LOW_OskarsBeloved_PortraitZombieCombat(_NewID, _Player);

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_PortraitZombieCombat(_ID, _Player)
AND
QRY_SpeakerIsAvailable(_Player)
THEN
PROC_TryStartAD(LOW_OskarsBeloved_PAD_ReactionPortraitZombiesAfter_d951358e-528f-b41c-1edf-be4ddaa97050, _Player);

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_PortraitZombieCombat(_ID, _Player)
THEN
NOT DB_LOW_OskarsBeloved_PortraitZombieCombat(_ID, _Player);

IF
ObjectTimerFinished(_Attacker,"LOW_OskarsBeloved_KerriFreed")
THEN
PROC_LOW_OskarsBeloved_KerriAppearNextToPortrait(_Attacker);

IF
AttackedBy(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,_Attacker,_,_,_,_,_)
AND
HasActiveStatus(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92, "LOW_OSKARSBELOVED_POSSESSEDPORTRAIT",1)
THEN
PROC_OskarsBeloved_SpawnAllyPortrait(_Attacker);

PROC
PROC_OskarsBeloved_SpawnAllyPortrait((GUIDSTRING)_Attacker)
AND
SysCount("DB_LOW_OskarsBeloved_PortraitGuards", 1, _CountAllies)
AND
_CountAllies < 4
AND
GetPosition(_Attacker,_AttackerX,_AttackerY,_AttackerZ)
AND
CreateAt((CHARACTERROOT)LOW_OskarsBeloved_Nurse_NoXP_24ecdb16-44ec-43a4-9135-5d8c55758575,_AttackerX,_AttackerY,_AttackerZ, 0, 0, "", _Ally)
AND
FindValidPosition(_AttackerX,_AttackerY,_AttackerZ,5.0,_Ally,1,_NewX,_NewY,_NewZ)
THEN
DB_LOW_OskarsBeloved_PortraitGuards(_Ally);
TeleportToPosition(_Ally,_NewX,_NewY,_NewZ,"LOW_OskarsBeloved_KerriAllyTeleported",0,0,1);

IF
DB_PermaDefeated(_Ally)
AND
DB_LOW_OskarsBeloved_PortraitGuards(_Ally)
THEN
NOT DB_LOW_OskarsBeloved_PortraitGuards(_Ally);


IF
EntityEvent(_Ally,"LOW_OskarsBeloved_KerriAllyTeleported")
THEN
PROC_Foop(_Ally,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);


IF
AttackedBy(S_LOW_KerriPortrait_5815b9d5-052d-480a-a207-c455eda33f92,_Attacker,_,_,_,_,_)
AND
IsEquipped(S_UNI_LOW_TorchOfRevocation_a042774f-ae71-4d19-9554-ba90cf34d046, 0)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_FirstTimeAttackingPortrait")
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_PlayersAngeredPainting_e01896ca-66b2-4e39-8a5e-09e2cb5074f6);

//END_REGION

//REGION Final Confrontation

PROC
PROC_LOW_OskarsBeloved_InitEnemiesFinalConfrontation()
AND
DB_LOW_KerriFinalConfrontationAllies(_Ally)
THEN
PROC_SetOnStage(_Ally, 0);

PROC
PROC_LOW_OskarsBeloved_KerriAppearNextToPortrait((GUIDSTRING)_Player)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_StopPossession")
THEN
PROC_LOW_OskarsBeloved_StopPossession();

PROC
PROC_LOW_OskarsBeloved_KerriAppearNextToPortrait((GUIDSTRING)_Player)
THEN
DB_LOW_OskarsBeloved_DestroyerPlayer((CHARACTER)_Player);
TeleportTo(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,S_LOW_KerriAtelierTeleportPoint_94d7f808-b522-401b-aac9-468658547e38,"",0,0,0,0,1);
PROC_Foop(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);

IF
WentOnStage(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,1)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_KerriAppearInAtelier")
AND
DB_LOW_OskarsBeloved_DestroyerPlayer((CHARACTER)_Player)
AND
QRY_StartDialog_Fixed((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5, S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_Player)
THEN
DB_NOOP(1);

QRY
QRY_StartDialogFailed((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5, S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_Player,_,_,_,_)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_KerriTeleportToBedroom")
THEN
PROC_LOW_OskarsBeloved_SendKerriToBedroom((CHARACTER)_Player);

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5, _InstanceID)
AND
DB_Players(_Player)
AND
IsInTrigger(_Player,(TRIGGER)S_LOW_KerriDialogZone_ae257262-6279-44d9-a9f6-41829786a006,1)
AND
NOT DB_LOW_OskarsBeloved_DestroyerPlayer((CHARACTER)_Player)
THEN
PROC_DialogAddListeningActor(_InstanceID,_Player);

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_KerriLeavesPortrait_df3a05e2-e17b-b397-8e04-9a063b38c6e5,_)
AND
DB_LOW_OskarsBeloved_DestroyerPlayer((CHARACTER)_Player)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_KerriTeleportToBedroom")
THEN
PROC_LOW_OskarsBeloved_SendKerriToBedroom(_Player);

PROC
PROC_LOW_OskarsBeloved_SendKerriToBedroom((CHARACTER)_Player)
THEN
PROC_Poof(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
TeleportTo(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356, S_LOW_KerriFinalConfrontationTrigger_ff8f0f3e-10bf-4370-8bb8-a92c19e1a163,"LOW_OskarsBeloved_KerriTeleported",0,0,0,1,0);
PROC_LOW_OskarsBeloved_SetupFinalConfrontation((GUIDSTRING)_Player);


IF
EntityEvent(_,"LOW_OskarsBeloved_KerriTeleported")
THEN
DB_LOW_OskarsBeloved_TeleportedKerri(1);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_Thunderwaves(_Trigger, _Item,_)
THEN
PROC_SetOnStage(_Item,0);
PROC_TriggerUnregisterForParty(_Trigger);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_FallingFlyingObjects(_Item,_Trigger)
THEN
PROC_TriggerUnregisterForParty(_Trigger);
NOT DB_OneShotPartyTrigger(_Trigger);
Die(_Item);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
IsOnStage((ITEM)S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692,1)
THEN
PROC_Poof((ITEM)S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_FlyingObjects(_Item)
AND
_Item != S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692
THEN
Die(_Item);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
IsOnStage(S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692,1)
THEN
PROC_Poof(S_LOW_FlyingStatue_4b2c1831-6f04-4c62-bca2-af343f7db692);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_,_)
THEN
Die(_Poltergeist,DEATHTYPE.Disintegrate,1);

PROC
PROC_LOW_OskarsBeloved_StopPossession()
AND
DB_LOW_OskarsBeloved_HauntTriggers(_Trigger)
THEN
PROC_TriggerUnregisterForParty(_Trigger);

PROC
PROC_LOW_OskarsBeloved_SetupFinalConfrontation((GUIDSTRING)_Player)
AND
HasActiveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"ANIM_COWER",1)
THEN
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "ANIM_COWER");

PROC
PROC_LOW_OskarsBeloved_SetupFinalConfrontation((GUIDSTRING)_Player)
THEN
NOT DB_LOW_OskarsBeloved_DestroyerPlayer((CHARACTER)_Player);
PROC_SceneOver("LOW_OskarsBeloved_Haunting");
SetCanJoinCombat(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,0);
ApplyStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "ANIM_COWER",-1.0);
ApplyStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS",-1.0);
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OSKARSBELOVED_OSKARPOSSESSED");
DB_SceneManager(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"LOW_OskarsBeloved_FinalConfrontation");
DB_SceneManager(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_FinalConfrontation");
DB_SceneManager(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_OskarsBeloved_FinalConfrontation");
ClearFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionTrigger_Bedroom_6114494a-0022-4593-bec2-aa8bd62c54d6);
PROC_TriggerRegisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);
PROC_Foop(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
SetEntityEvent(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_KerriInBedroom");
PROC_SetRelationToPlayers((FACTION)ACT1_PLA_DoubtingArtist_d800ec60-240e-49e8-9b26-f0a90416c4a0, 50);
PROC_TryStartAD(LOW_OskarsBeloved_AD_ReactionPortraitDestroyed_7819c5a3-6da6-171c-d27c-3de9962734a4,S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_Player);
PROC_SelfHealing_Enable((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

PROC
PROC_SceneInterrupted(_NPC, _Char, "LOW_OskarsBeloved_FinalConfrontation", "DisturbanceRegistering")
AND
DB_SceneManager_DisturbanceRegistering(_Char,_Reason,_,_,_,_ID)
AND
QRY_CRIME_IsAssaultOrMurder(_Reason)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_FinalCombat")
THEN
DB_SceneManager_BlockDisturbance(_ID);
PROC_LOW_OskarsBeloved_StartFinalCombat();

PROC
PROC_StateCleared_Defeated(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedTrueRevocation_03b123b5-c787-4b15-a9ad-193d9ffd7369)
THEN
PROC_NotifyWhenReadyToMoveOn(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_Oskar_ReadyToGetOutOfBed");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Oskar,"LOW_Oskar_ReadyToGetOutOfBed")
THEN
TeleportTo(_Oskar, S_LOW_BedBedroom_762d92aa-277b-4b75-a0bf-42625da09d57);
PROC_CharacterMoveTo(_Oskar,S_LOW_OskarTeleportTo_e62380f3-2dc0-43fc-9ed7-b38f034603df,"Run","LOW_OskarsBeloved_OskarGetsUp");

IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff)
AND
NOT DB_PermaDefeated(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356)
AND
DB_LOW_OskarsBeloved_TeleportedKerri(1)
AND
DB_Players(_Player)
AND
NOT DB_LOW_OskarsBeloved_StartedFinalConfrontation(1)
AND
QRY_StartDialog(
(DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562, 
(CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,
_Player)
THEN
DB_NOOP(1);

IF
DialogStarted((DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562,_)
AND
NOT DB_LOW_OskarsBeloved_StartedFinalConfrontation(1)
THEN
SetEntityEvent(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_KerriNextPhase");
DB_LOW_OskarsBeloved_StartedFinalConfrontation(1);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562, _InstanceID)
AND
QRY_SpeakerIsAvailable(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
PROC_DialogAddSpeakingActor(_InstanceID, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

IF
DialogStarted((DIALOGRESOURCE)LOW_OskarsBeloved_Kerri_29f76bb9-ed9c-e281-7d66-a1d01d91f562,_ID)
AND
DB_DialogPlayers(_ID, _PlayerInDialog, 1)
THEN
DB_LOW_OskarsBeloved_KerriDialogPlayer(_PlayerInDialog);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_Kerri_Event_PlayersStartCombatKerri_4b90913f-03b5-4428-bb9f-0a745b17f772)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_FinalCombat")
THEN
PROC_LOW_OskarsBeloved_StartFinalCombat();

IF
EnteredCombat((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_ID)
AND
NOT DB_LOW_OskarsBeloved_StartedFinalConfrontation(1)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_FinalCombat")
THEN
DB_LOW_OskarsBeloved_StartedFinalConfrontation(1);
PROC_LOW_OskarsBeloved_StartFinalCombat();

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_Kerri_Event_PlayersSaidTheySideWithKerri_e2e58fa9-02e1-4556-a7d3-8246516a780d)
THEN
PROC_NotifyWhenReadyToMoveOn((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_KerriAboutToKillOskar");

PROC
PROC_ReadyToMoveOn((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_KerriAboutToKillOskar")
THEN
UseSpell(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"Target_LOW_OskarsBeloved_WitheringTouch_Dialogue", S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

IF
CastSpellFailed(_Kerri,"Target_LOW_OskarsBeloved_WitheringTouch_Dialogue",_,_,_)
THEN
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS");
Die(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,DEATHTYPE.Necrotic,_Kerri,0,1,1.0);
PROC_LOW_OskarsBeloved_HandleKerriLeaves();

IF
CastedSpell(_Kerri,"Target_LOW_OskarsBeloved_WitheringTouch_Dialogue",_,_,_)
AND
NOT DB_Dead(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
Die(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,DEATHTYPE.Necrotic,_Kerri,0,1,1.0);

IF
CastedSpell(_Kerri,"Target_LOW_OskarsBeloved_WitheringTouch_Dialogue",_,_,_)
THEN
PROC_LOW_OskarsBeloved_HandleKerriLeaves();

PROC
PROC_LOW_OskarsBeloved_HandleKerriLeaves()
AND
QRY_OnlyOnce("LOW_OskarsBeloved_KerriLeaves")
THEN
PROC_Poof(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
PROC_SceneOver("LOW_OskarsBeloved_FinalConfrontation");
TimerLaunch("LOW_OskarsBeloved_WaitUntilKerriLeft",2000);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);

IF
TimerFinished("LOW_OskarsBeloved_WaitUntilKerriLeft")
AND
DB_LOW_OskarsBeloved_KerriDialogPlayer(_PlayerInDialog)
THEN
SetCanJoinCombat(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,1);
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS");
PROC_ToInventoryAndOnStage((ITEM)S_UNI_LOW_KerriRing_2b1eab03-4655-4d95-a94f-2f1c9031bc8c,_PlayerInDialog,1,1,1);

IF
WentOnStage(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,0)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_ResetToNormalATM")
THEN
TriggerSetAtmosphere((TRIGGER)S_ATM_CTY_ArtistHouse_4440ee01-d742-49bc-b19a-b5bdf136ec2e,"3a3546d3-55bb-05aa-08dd-549e7f364030");


PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ConvincedKerriToLeave_eb5b448c-1d84-4b98-bd79-4f1e8627ae71)
THEN
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS");
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "ANIM_COWER");
PROC_Poof(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356);
PROC_PeacefulResolve((CHARACTER)S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356);
PROC_SceneOver("LOW_OskarsBeloved_FinalConfrontation");
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);
TimerLaunch("LOW_OskarsBeloved_StartOskarConclusion",2500);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ConvincedKerriToLeave_eb5b448c-1d84-4b98-bd79-4f1e8627ae71)
AND
DB_LOW_KerriFinalConfrontationAllies(_Enemy)
THEN
PROC_PeacefulResolve((CHARACTER)_Enemy);

PROC
PROC_LOW_OskarsBeloved_StartFinalCombat()
THEN
PROC_SceneOver("LOW_OskarsBeloved_FinalConfrontation");
SetEntityEvent(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OskarsBeloved_KerriNextPhase");
PROC_SetRelationToPlayers((FACTION)ACT3_LOW_OskarsBeloved_Kerri_791cbbc2-671b-42c0-afba-634d9ddea545,0);

PROC
PROC_LOW_OskarsBeloved_StartFinalCombat()
AND
DB_LOW_KerriFinalConfrontationAllies(_Ally)
THEN
PROC_Foop(_Ally,(EFFECTRESOURCE)VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);

IF
DB_Is_InCombat(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_ID)
AND
CombatGetInvolvedPartyMembersCount(_ID,_num)
AND
_num > 0
THEN
DB_OskarsBeloved_KerriCombat(_ID);

IF
SwitchedCombat(_,_OldID,_NewID)
AND
DB_OskarsBeloved_KerriCombat(_ID)
THEN
NOT DB_OskarsBeloved_KerriCombat(_OldID);
DB_OskarsBeloved_KerriCombat(_NewID);

//Edgecase - left final confrontation combat
IF
LeftCombat(_Player,_ID)
AND
DB_OskarsBeloved_KerriCombat(_ID)
AND
CombatGetInvolvedPartyMembersCount(_ID,0)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_AllFinalEnemiesPermaDefeated_5c1eeb4a-b09d-42f2-bbc2-f606fcbfc899)
THEN
PROC_LOW_OskarsBeloved_PlayersFledFinalConfrontation();


PROC
PROC_LOW_OskarsBeloved_PlayersFledFinalConfrontation()
AND
NOT DB_Dead(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
Die(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,DEATHTYPE.Necrotic,S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,0,1,1.0);
QuestUpdate("GLO_DoubtingArtist", "ArtistIsDead_AbandonedInFinalCombat");

PROC
PROC_LOW_OskarsBeloved_PlayersFledFinalConfrontation()
AND
NOT DB_Dead(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
THEN
Die(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,DEATHTYPE.Necrotic,S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,0,1,1.0);

PROC
PROC_LOW_OskarsBeloved_PlayersFledFinalConfrontation()
AND
QRY_OnlyOnce("LOW_OskarsBeloved_EndFinalConfronation")
THEN
SetFlag((FLAG)LOW_Tarhun_Event_ToTheKitchen_cd3872f1-5e33-4040-a457-c6caf10642a6);
PROC_Poof(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356);

PROC
PROC_LOW_OskarsBeloved_PlayersFledFinalConfrontation()
AND
DB_LOW_KerriFinalConfrontationAllies(_Ally)
AND
NOT DB_PermaDefeated(_Ally)
THEN
PROC_Poof(_Ally);

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_AllFinalEnemiesPermaDefeated_5c1eeb4a-b09d-42f2-bbc2-f606fcbfc899)
THEN
SetFlag((FLAG)LOW_Tarhun_Event_ToTheKitchen_cd3872f1-5e33-4040-a457-c6caf10642a6);
RemoveStatus(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "ANIM_COWER");
PROC_SceneOver("LOW_OskarsBeloved_FinalConfrontation");
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_PossessionSceneTrigger_b18e3b9a-a5f4-4d68-b4ff-c5b03af082ff);
TimerLaunch("LOW_OskarsBeloved_StartOskarConclusion",2500);

IF
CombatEnded(_ID)
AND
DB_OskarsBeloved_KerriCombat(_ID)
AND
HasActiveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS",1)
THEN
RemoveStatus(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS");

IF
StatusRemoved(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d,"UNCONSCIOUS",_,_)
AND
DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2)
THEN
PROC_LOW_OskarsBeloved_JannathRunToOskarDead();

//END_REGION

//REGION Conclusions

//Edgecase - interrupted before painting portrait and choosing name again
IF
FlagSet(_Flag,_Player,_)
AND
DB_LOW_OskarsBeloved_PortraitNames(_Flag,_String)
AND
DB_OskarsBeloved_FuturePortraitName(_Player,_FullString)
THEN
NOT DB_OskarsBeloved_FuturePortraitName(_Player,_FullString);

//Generating localized string key based on player identity
IF
FlagSet(_Flag,_Player,_)
AND
DB_LOW_OskarsBeloved_PortraitNames(_Flag,_String)
AND
DB_LOW_OskarsBeloved_PortraitNamesIdentity(_Tag,_String2)
AND
IsTagged(_Player,_Tag,1)
AND
Concatenate(_String,_String2,_FullString)
THEN
DB_OskarsBeloved_FuturePortraitName(_Player,_FullString);

//Creating and renaming portrait
IF
FlagSet((FLAG)LOW_Oskar_State_PaintedPortrait_b9a55b88-f4df-4a9b-8738-80509b13029a,_Player,_)
AND
CreateAtObject((ITEMROOT)FUR_GEN_Painting_Portrait_Square_Player_A_4069b438-2fd9-46c3-a5c0-a248039a3b52, S_LOW_OskarsBeloved_CounterfeitAsylumPos_eb28fccf-cbf9-461e-b9b3-3a74e6181aea, 0, 0, "LOW_OskarsBeloved_SpawnedPlayerPortrait", 1, _Portrait)
THEN
AddCustomMaterialOverride(_Portrait, "6201596e-059a-4619-86d5-3c5db0957fc8");
SetCharacterOnPortraitPainting(_Player, _Portrait);
DB_OskarsBeloved_PlayerPortrait(_Player,_Portrait);

IF
TextEvent("LOW_OskarsBeloved_CreatePortrait")
AND
GetHostCharacter(_Player)
AND
CreateAtObject((ITEMROOT)FUR_GEN_Painting_Portrait_Square_Player_A_4069b438-2fd9-46c3-a5c0-a248039a3b52, S_LOW_OskarsBeloved_CounterfeitAsylumPos_eb28fccf-cbf9-461e-b9b3-3a74e6181aea, 0, 0, "LOW_OskarsBeloved_SpawnedPlayerPortrait", 1, _Portrait)
THEN
DB_OskarsBeloved_FuturePortraitName(_Player,"Test portrait");
AddCustomMaterialOverride(_Portrait, "6201596e-059a-4619-86d5-3c5db0957fc8");
SetCharacterOnPortraitPainting(_Player, _Portrait);
DB_OskarsBeloved_PlayerPortrait(_Player,_Portrait);

IF
EntityEvent(_Portrait,"LOW_OskarsBeloved_SpawnedPlayerPortrait")
AND
DB_OskarsBeloved_PlayerPortrait(_Player,_Portrait)
AND
DB_OskarsBeloved_FuturePortraitName(_Player,_FullString)
THEN
SetStoryDisplayName(_Portrait, _FullString);
NOT DB_OskarsBeloved_PlayerPortrait(_Player,_Portrait);
NOT DB_OskarsBeloved_FuturePortraitName(_Player,_FullString);
ToInventory((ITEM)_Portrait, _Player, 1, 1, 1);

IF
FlagSet((FLAG)LOW_Jannath_Event_GivesRing_0f9260ad-0319-49f2-8d3b-53ee369d2de9,_,_)
AND
IsOnStage(S_LOW_KerriRing_2b1eab03-4655-4d95-a94f-2f1c9031bc8c,0)
THEN
PROC_SetOnStage(S_LOW_KerriRing_2b1eab03-4655-4d95-a94f-2f1c9031bc8c,1);

PROC
PROC_ReadyToMoveOn((CHARACTER)_Oskar,"LOW_Oskar_ReadyToGoToAtelier")
THEN
PROC_CharacterMoveTo(_Oskar,S_LOW_OskarAtelierLocation_3e8a53c0-b280-4cca-849b-53652b99692a,"Walk","LOW_Oskar_GoesToAtelier");

IF
EntityEvent(_Oskar,"LOW_Oskar_GoesToAtelier")
THEN
SetEntityEvent(_Oskar,"LOW_OskarsBeloved_InAtelier");
PROC_RemoveAllDialogEntriesForSpeaker(_Oskar);
DB_Dialogs((CHARACTER)_Oskar,(DIALOGRESOURCE)LOW_OskarsBeloved_OskarMakesPortrait_22c647aa-ab83-c788-ff1a-c46ade6bf248);

IF
TimerFinished("LOW_OskarsBeloved_StartOskarConclusion")
AND
NOT DB_Dead(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
DB_SpotPlayers_IncludeWildshapedPlayers((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OskarsBeloved_OskarSpottedSaviors"); 
DB_SpotPlayers_IgnoreCombat((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OskarsBeloved_OskarSpottedSaviors"); 
DB_SpotPlayers_SpotTrigger((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OskarsBeloved_OskarSpottedSaviors", (TRIGGER)S_LOW_OskarsBeloved_ConclusionSpotTrigger_fb48ce73-fad6-4df8-9204-14ea37c75cf5);
DB_SpotPlayers((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OskarsBeloved_OskarSpottedSaviors", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "LOW_OskarsBeloved_OskarSpottedSaviors", _Player)
AND
QRY_StartDialogCustom(
(DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, 
(CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,
_Player,0, 0, 0, 1)
THEN
DB_NOOP(1);

IF
DB_GlobalFlag((FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2)
AND
DB_LOW_OskarsBeloved_WaitingForPostCombat(1)
THEN
NOT DB_LOW_OskarsBeloved_WaitingForPostCombat(1);

QRY
QRY_StartDialogFailed((DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, _,_,_,_,_,_)
AND
NOT DB_LOW_OskarsBeloved_WaitingForPostCombat(1)
THEN
DB_LOW_OskarsBeloved_WaitingForPostCombat(1);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, _Player)
AND
DB_LOW_OskarsBeloved_WaitingForPostCombat(1)
THEN
DB_SelectedDialog(
	LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, 
	S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,
_Player);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, _Player)
AND
QRY_SpeakerIsAvailable(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
AND
DB_LOW_OskarsBeloved_WaitingForPostCombat(1)
THEN
DB_SelectedDialog(
	LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, 
	S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,
_Player);

IF
DialogStarted((DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662,_)
AND
DB_LOW_OskarsBeloved_WaitingForPostCombat(1)
THEN
NOT DB_LOW_OskarsBeloved_WaitingForPostCombat(1);

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, _)
AND
DB_GlobalFlag((FLAG)LOW_Oskar_State_Leaving_da5734d2-74ad-4e35-92e6-d477ece23571)
THEN
QuestClose("GLO_DoubtingArtist");

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, _)
THEN
PROC_NotifyWhenReadyToMoveOn(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,"LOW_Oskar_ReadyToGoToAtelier");

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_OskarsBeloved_OskarPostCombat_660563fb-7777-6012-f1f3-af71488e7662, _InstanceID)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd)
THEN
SetFlag((FLAG)LOW_Jannath_State_IsAvailableInPostCombatDialog_548afeaa-6adb-46b3-acd7-82a407272f8e);
PROC_DialogAddSpeakingActor(_InstanceID, S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d);

PROC
PROC_FlagReactionAfterDialog(_Player, (FLAG)LOW_Oskar_State_PaintedPortrait_b9a55b88-f4df-4a9b-8738-80509b13029a)
AND
QRY_LOW_OskarsBeloved_FindCompanionToReactToPortrait(_Player)
AND
DB_QRYRTN_LOW_OskarsBeloved_FindCompanionToReactToPortrait(_Reactor)
THEN
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_PAD_GottenPortrait_2a988191-bc01-306f-e454-46a5f4e53362,_Reactor);
DB_LOW_OskarsBeloved_HasReactedToPainting(_Reactor);

PROC
PROC_LongRest()
AND
DB_GlobalFlag((FLAG)LOW_Oskar_State_Leaving_da5734d2-74ad-4e35-92e6-d477ece23571)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_OskarLeft")
THEN
PROC_SetOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,0);

QRY
QRY_LOW_OskarsBeloved_FindCompanionToReactToPortrait((GUIDSTRING)_CharWithPainting)
AND
DB_Players(_Player)
AND
_Player != _CharWithPainting
AND
NOT DB_LOW_OskarsBeloved_HasReactedToPainting(_Player)
AND
NOT DB_QRYRTN_LOW_OskarsBeloved_FindCompanionToReactToPortrait(_)
AND
QRY_SpeakerIsAvailable(_Player)
AND
CanSee(_Player, _CharWithPainting, 1)
THEN
DB_QRYRTN_LOW_OskarsBeloved_FindCompanionToReactToPortrait(_Player);

//END_REGION

//REGION Alternative state
IF
Moved((ITEM)S_LOW_ChefThrowPie_2f543093-e8c3-4d62-92e3-68d554958f59)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_DisablePieThrow")
THEN
DB_LOW_OskarsBeloved_PieNotInInitialPlace(1);

IF
DestroyedBy((ITEM)S_LOW_ChefThrowPie_2f543093-e8c3-4d62-92e3-68d554958f59,_,_,_)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_DisablePieThrow")
THEN
DB_LOW_OskarsBeloved_PieNotInInitialPlace(1);


PROC
PROC_OneShotTriggerEntered(_Player,(TRIGGER)S_LOW_ChefsCookingTrigger_2afb5013-da53-4b21-9acf-46a79c85ac55)
AND
DB_LOW_OskarsBeloved_PieNotInInitialPlace(1)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_ThrowPieChef_696653f7-17be-4f6d-bdba-10f4e0a89eac);

PROC
PROC_OneShotTriggerEntered(_Player,(TRIGGER)S_LOW_ChefsCookingTrigger_2afb5013-da53-4b21-9acf-46a79c85ac55)
AND
NOT DB_LOW_OskarsBeloved_PieNotInInitialPlace(1)
THEN
UseSpell(S_LOW_Chef_c324c082-2fb7-4e6a-a74b-6988b67dc6e5, "Throw_Throw",S_LOW_ThrowPieTrigger_5896fc3d-fce0-4ce8-9ae8-bc8d6bd94947, S_LOW_ChefThrowPie_2f543093-e8c3-4d62-92e3-68d554958f59);

IF
UsingSpellAtPosition(S_LOW_Chef_c324c082-2fb7-4e6a-a74b-6988b67dc6e5,_,_,_,"Throw_Throw",_,_,_ID)
THEN
DB_LOW_OskarsBeloved_PieThrowID(_ID);

IF
CastSpellFailed(_,_,_,_,_ID)
AND
DB_LOW_OskarsBeloved_PieThrowID(_ID)
THEN
NOT DB_LOW_OskarsBeloved_PieThrowID(_ID);
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_AD_ChefsCooking_95cde0e5-2bb6-3fe7-b135-1d2259fef213,S_LOW_Chef_c324c082-2fb7-4e6a-a74b-6988b67dc6e5,S_LOW_SousChef_635592ec-64a4-4582-a038-aa78fb6a681e);

IF
AutomatedDialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_AD_ChefsCooking_95cde0e5-2bb6-3fe7-b135-1d2259fef213,_)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_PieLineSaid")
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_ThrowPieChef_696653f7-17be-4f6d-bdba-10f4e0a89eac);

IF
CastedSpell(_,_,_,_,_ID)
AND
DB_LOW_OskarsBeloved_PieThrowID(_ID)
THEN
NOT DB_LOW_OskarsBeloved_PieThrowID(_ID);
SetFlag((FLAG)LOW_OskarsBeloved_Event_ThrowPieChef_696653f7-17be-4f6d-bdba-10f4e0a89eac);

IF
DB_GlobalFlag((FLAG)LOW_Jannath_Event_ThrowsRing_693d05bb-f756-47db-8775-dfc944097bc1)
AND
GetPosition(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, _JannathX,_JannathY,_JannathZ)
AND
FindValidPosition(_JannathX,_JannathY,_JannathZ, 10.0, S_UNI_LOW_JannathRing_5c8a91bb-2d0e-4136-9ed2-6aa307ba4f27, 0, _vX, _vY, _vZ)
THEN
TeleportToPosition(S_LOW_JannathThrowPosition_5f3790f9-7135-41da-96b6-c7a1c3f694eb, _vX, _vY, _vZ,"",1);
UseSpell(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d, "Throw_Throw", S_LOW_JannathThrowPosition_5f3790f9-7135-41da-96b6-c7a1c3f694eb, S_UNI_LOW_JannathRing_5c8a91bb-2d0e-4136-9ed2-6aa307ba4f27);
ClearOwnership((ITEM)S_UNI_LOW_JannathRing_5c8a91bb-2d0e-4136-9ed2-6aa307ba4f27);


//REGION Counterfeits


IF
TextEvent("LOW_OskarsBeloved_ResetCounterfeit")
THEN
Transform(LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6,(ITEMROOT)LOW_OskarsBeloved_CounterfitPainting_OskarValue_31fd4753-ed72-4acb-9500-922dcda28872, (SHAPESHIFTRULE)Physical_4acc6277-6dcd-4110-9450-b9379beaedac); 

IF
TextEvent("LOW_OskarsBeloved_ChangeCounterfeit")
THEN
Transform(LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6,(ITEMROOT)LOW_OskarsBeloved_CounterfitPainting_LowValue_68e60d97-ce42-4f3f-bc7c-02ab2543a716, (SHAPESHIFTRULE)Physical_4acc6277-6dcd-4110-9450-b9379beaedac); 

IF
MovedFromTo((ITEM)LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, _Player,_NPC, 1)
AND
DB_Players((CHARACTER)_Player)
AND
DB_LOW_OskarsBeloved_GuildhallTraders((CHARACTER)_NPC)
THEN
AddAttitudeTowardsPlayer(_NPC, (CHARACTER)_Player, -50);

IF
MovedFromTo((ITEM)LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,_Player,1)
AND
DB_Players((CHARACTER)_Player)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_BoughtCounterfeit_981b916c-0592-4d42-b542-296d72083ff2);

IF
MovedFromTo((ITEM)LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, _Player,_NPC, 1)
AND
DB_Players((CHARACTER)_Player)
AND
DB_LOW_OskarsBeloved_GuildhallTraders((CHARACTER)_NPC)
THEN
AddAttitudeTowardsPlayer(_NPC, (CHARACTER)_Player, -50);

IF
MovedFromTo((ITEM)LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6, _Player,_NPC, 1)
AND
DB_Players((CHARACTER)_Player)
AND
NOT DB_Players((CHARACTER)_NPC)
THEN
TeleportTo(LOW_OskarsBeloved_CounterfitPainting_HighValue_b699213e-5cab-4615-8afc-d9cdac7999d6,S_LOW_OskarsBeloved_CounterfeitAsylumPos_eb28fccf-cbf9-461e-b9b3-3a74e6181aea);
ToInventory((ITEM)LOW_OskarsBeloved_CounterfitPainting_LowValue_ce9d9e8b-b5fb-4b05-b9e7-3b194af2f890, _NPC,1,0,1);

//END_REGION


//REGION Angry nobles

PROC
PROC_SceneInterrupted(_Char, _Player, "LOW_OskarsBeloved_AngryNobles_Scene", _Reason)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Reason)
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");
SetFlag((FLAG)LOW_OskarsBeloved_Event_BothNoblesHostile_c534930a-f718-47ad-9f26-2352f286ebdb);
NOT DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);
NOT DB_LOW_OskarsBeloved_NoblesArguing(1);
PROC_LOW_OskarsBeloved_HandleDuelSceneInterruption(_Player,(CHARACTER)_Char,_Reason);

//Player interrupted discussion, will trigger confrontation with players or start the duel depending on visibility
PROC
PROC_LOW_OskarsBeloved_HandleDuelSceneInterruption((CHARACTER)_Player,(CHARACTER)_Victim,(STRING)_Reason)
AND
_Reason != "Died"
AND
CanSee(_Victim,_Player,1)
AND
DB_Players(_Player)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,_Player)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,_Player)
AND
NOT QRY_StartDialog((DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df, S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb, S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,_Player)
THEN
PROC_SetRelationToPlayers((FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_001_89519947-249a-4326-9cfc-a9feef72d934,0);
PROC_SetRelationToPlayers((FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_002_db7a7ae5-4946-485a-840b-b57445c2a67c,0);

PROC
PROC_LOW_OskarsBeloved_HandleDuelSceneInterruption((CHARACTER)_Player,(CHARACTER)_Victim,(STRING)_Reason)
AND
_Reason != "Died"
AND
CanSee(_Victim,_Player,0)
THEN
PROC_ForceStopDialog(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb);
SetFlag((FLAG)LOW_OskarsBeloved_Event_StartDuel_c9e06bdc-6379-40fc-b9d7-78f74b632087);
PROC_LOW_OskarsBeloved_StartDuel();

//Player killed a noble before 
PROC
PROC_LOW_OskarsBeloved_HandleDuelSceneInterruption((CHARACTER)_Player,(CHARACTER)S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,"Died")
THEN
PROC_LOW_OskarsBeloved_CheckFateNoble(_Player,S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb);

PROC
PROC_LOW_OskarsBeloved_HandleDuelSceneInterruption((CHARACTER)_Player,(CHARACTER)S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,"Died")
THEN
PROC_LOW_OskarsBeloved_CheckFateNoble(_Player, S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446);

PROC
PROC_LOW_OskarsBeloved_CheckFateNoble((CHARACTER)_Player,(CHARACTER)_Noble)
AND
CanSee(_Noble,_Player,0)
THEN
PROC_DisappearOutOfSight(_Noble,"Run",0,"");

PROC
PROC_LOW_OskarsBeloved_CheckFateNoble((CHARACTER)_Player,(CHARACTER)_Noble)
AND
CanSee(_Noble,_Player,1)
AND
GetFaction(_Noble,_Faction)
THEN
PROC_SetRelationToPlayers(_Faction,0);


IF
DialogStarted((DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df,_)
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_NoblesGoToDuel_4cd392fc-b7cc-4f4b-97e0-c3232ccbc1e5)
AND
QRY_LOW_OskarsBeloved_BothNoblesAlive()
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _,  _,_)
THEN
PROC_NotifyWhenReadyToMoveOn((CHARACTER)_Noble,"LOW_OskarsBeloved_PrepareNobleMoveToSite");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_NoblesGoToDuel_4cd392fc-b7cc-4f4b-97e0-c3232ccbc1e5)
AND
NOT QRY_LOW_OskarsBeloved_BothNoblesAlive()
THEN
PROC_OskarsBeloved_ConcludeDuel();

QRY
QRY_LOW_OskarsBeloved_BothNoblesAlive()
AND
NOT DB_PermaDefeated(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb)
AND
NOT DB_PermaDefeated(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb)
THEN
DB_NOOP(1);

PROC
PROC_ReadyToMoveOn(_Noble,"LOW_OskarsBeloved_PrepareNobleMoveToSite")
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _Location,  _,_)
THEN
PROC_CharacterMoveTo((CHARACTER)_Noble,_Location, "Walk", "LOW_OskarsBeloved_ReachedDuelSite");

IF
EntityEvent(_Noble, "LOW_OskarsBeloved_ReachedDuelSite")
THEN
DB_LOW_OskarsBeloved_NobleOnsite(_Noble);

IF
DB_LOW_OskarsBeloved_NobleOnsite(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb)
AND
DB_LOW_OskarsBeloved_NobleOnsite(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446)
THEN
SetHasDialog(S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,1);
SetHasDialog(S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,1);
NOT DB_LOW_OskarsBeloved_NoblesArguing(1);
DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);
PROC_TryStartAD(LOW_OskarsBeloved_AD_NoblesPreDuel_ce0b5364-63df-8ae0-803a-89e5dc716fa4,S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446);

QRY
QRY_SelectCustomDialog_AfterGenerics(_Noble,_Player)
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _,  _,_)
AND
DB_LOW_OskarsBeloved_NoblesArguing(1)
THEN
DB_SelectedDialog(
	(DIALOGRESOURCE)LOW_OskarsBeloved_AngryNobles_a6b6ed62-c09f-07c7-8b21-c790be2d45ba, 
	S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,
	S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,
	_Player);

QRY
QRY_SelectCustomDialog_AfterGenerics(_Noble,_Player)
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _,  _,_)
AND
DB_LOW_OskarsBeloved_NoblesPreparingDuel(1)
THEN
DB_SelectedDialog(
	(DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df, 
	S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,
	S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,
	_Player);

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_DuelInterruption_45686d7c-d7d3-cef8-11fa-08e420b484df,_)
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");
NOT DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_StartDuel_c9e06bdc-6379-40fc-b9d7-78f74b632087)
THEN
PROC_LOW_OskarsBeloved_StartDuel();
NOT DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);

PROC
PROC_LOW_OskarsBeloved_StartDuel()
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");
PROC_SetRelationMutual((FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_001_89519947-249a-4326-9cfc-a9feef72d934,(FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_002_db7a7ae5-4946-485a-840b-b57445c2a67c,0);
DB_LOW_OskarsBeloved_DuelStarted(1);

QRY
QRY_CRIME_BlockRegisterCrime(_, _CrimeType, _, _Noble, (INTEGER)_CrimeID)
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _,  _,_)
AND
DB_LOW_OskarsBeloved_DuelStarted(1)
THEN
CrimeIgnoreCrime(_CrimeID, _Noble);

IF
DB_Is_InCombat((CHARACTER)S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb,_CombatGUID)
AND
DB_Is_InCombat((CHARACTER)S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446,_CombatGUID)
AND
GetRelation((FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_001_89519947-249a-4326-9cfc-a9feef72d934,(FACTION)ACT3_LOW_OskarsBeloved_AngryNoble_002_db7a7ae5-4946-485a-840b-b57445c2a67c,0)
AND
NOT DB_LOW_OskarsBeloved_NobleDuel(_CombatGUID)
THEN
DB_LOW_OskarsBeloved_NobleDuel(_CombatGUID);

IF
SwitchedCombat(_, _OldID, _NewID)
AND
DB_LOW_OskarsBeloved_NobleDuel(_OldID)
THEN
NOT DB_LOW_OskarsBeloved_NobleDuel(_OldID);
DB_LOW_OskarsBeloved_NobleDuel(_NewID);

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_NobleDuel(_ID)
THEN
NOT DB_LOW_OskarsBeloved_NobleDuel(_ID);
PROC_OskarsBeloved_ConcludeDuel();

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_LeaveWithoutDueling_5bfbf90f-71cb-4c67-a66a-c63f85312942)
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");
NOT DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);
NOT DB_LOW_OskarsBeloved_NoblesArguing(1);
PROC_PeacefulResolve((CHARACTER)S_LOW_AngryNoble_001_4707eca2-13b3-4912-9f5f-7a8ae5307aeb);
PROC_PeacefulResolve((CHARACTER)S_LOW_AngryNoble_002_24376c44-ee3e-4131-86b1-25b738aee446);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_LeaveWithoutDueling_5bfbf90f-71cb-4c67-a66a-c63f85312942)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_ConcludeDuel")
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble, _Location,  _,_)
THEN
PROC_NotifyWhenReadyToMoveOn((CHARACTER)_Noble,"LOW_OskarsBeloved_NobleReadyToLeave");

PROC
PROC_OskarsBeloved_ConcludeDuel()
AND
QRY_OnlyOnce("LOW_OskarsBeloved_ConcludeDuel")
AND
DB_LOW_OskarsBeloved_AngryNobles(_Noble,_,_FinalAD,_VictoryDialog)
AND
NOT DB_PermaDefeated(_Noble)
THEN
PROC_SceneOver("LOW_OskarsBeloved_AngryNobles_Scene");
NOT DB_LOW_OskarsBeloved_NoblesPreparingDuel(1);
NOT DB_LOW_OskarsBeloved_NoblesArguing(1);
NOT DB_LOW_OskarsBeloved_DuelStarted(1);
DB_Dialogs(_Noble, _VictoryDialog);
PROC_TryStartAD(_FinalAD, _Noble); 
ObjectTimerLaunch(_Noble,"LOW_OskarsBeloved_AngryNobleLeaves",10000);

IF
ObjectTimerFinished(_Noble,"LOW_OskarsBeloved_AngryNobleLeaves")
THEN
PROC_NotifyWhenReadyToMoveOn((CHARACTER)_Noble,"LOW_OskarsBeloved_NobleReadyToLeave");

PROC
PROC_ReadyToMoveOn(_Noble,"LOW_OskarsBeloved_NobleReadyToLeave")
THEN
PROC_DisappearOutOfSightTo((CHARACTER)_Noble, S_LOW_NobleLeavePosition_f55e4d51-e191-450d-9090-ebf2243de93b, "Walk", 0, "");

//END_REGION

//REGION Fired servant

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantFired_926ec1e2-4ef6-46a2-8a3b-4fc2d4cf975c)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_ServantStartPatrol_abc5886e-797a-427f-8cc9-a9d897f4eac5, S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41);
DB_OskarsBeloved_BeratingDone(1);
PROC_DisappearOutOfSightTo((CHARACTER)S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805, S_LOW_FiredServantTrigger_c6def488-8a56-45d6-aa71-12cf9bd81e20,"Walk",0,"");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantSaved_7f61db94-aa04-4a9b-8c01-b8ea5c7198de)
THEN
DB_OskarsBeloved_BeratingDone(1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantSaved_7f61db94-aa04-4a9b-8c01-b8ea5c7198de)
AND
QRY_LOW_OskarsBeloved_ReadyBothServants()
THEN
PROC_TryStartAD((DIALOGRESOURCE)LOW_OskarsBeloved_AD_HighServantWithBailey_21260501-7f8c-c801-d870-7e1c2afebbb5, S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41, S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);

IF
AutomatedDialogEnded(LOW_OskarsBeloved_AD_HighServantWithBailey_21260501-7f8c-c801-d870-7e1c2afebbb5,_)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_ServantStartPatrol_abc5886e-797a-427f-8cc9-a9d897f4eac5, S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41);
SetFlag((FLAG)LOW_OskarsBeloved_Event_ServantStartPatrol_abc5886e-797a-427f-8cc9-a9d897f4eac5, S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_OskarsBeloved_Event_ServantSaved_7f61db94-aa04-4a9b-8c01-b8ea5c7198de)
AND
NOT QRY_LOW_OskarsBeloved_ReadyBothServants()
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_ServantStartPatrol_abc5886e-797a-427f-8cc9-a9d897f4eac5, S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41);
SetFlag((FLAG)LOW_OskarsBeloved_Event_ServantStartPatrol_abc5886e-797a-427f-8cc9-a9d897f4eac5, S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805);

QRY
QRY_LOW_OskarsBeloved_ReadyBothServants()
AND
QRY_SpeakerIsAvailable(S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41)
AND
QRY_SpeakerIsAvailable(S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805)
THEN
DB_NOOP(1);


QRY
QRY_SelectCustomDialog_AfterGenerics(_Char,_Player)
AND
DB_OskarsBeloved_ServantFiringChars(_Char)
AND
NOT DB_OskarsBeloved_BeratingDone(1)
THEN
DB_SelectedDialog(
	(DIALOGRESOURCE)LOW_OskarsBeloved_InterruptedFiring_76d95ecd-c615-e0d8-96b1-795982c967eb, 
	S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41,
	S_LOW_CleaningServant_4d568121-69b1-4d39-b948-7eb229ad3805,
	_Player);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41,_Player)
AND
DB_OskarsBeloved_ServantFiringChars(_Char)
AND
DB_OskarsBeloved_BeratingDone(1)
THEN
DB_SelectedDialog(
	(DIALOGRESOURCE)LOW_OskarsBeloved_YellingServant_b9a2ae83-005b-8e42-da8a-e9e5435f3098, 
	S_LOW_YellingHighServant_ae833e8a-5787-4bd3-950d-b44fbf47df41,
	_Player);


//END_REGION


//END_REGION

//REGION Poltergeist attacks

//Removing throwing objects from DB if destroyed
PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_CorridorThrowableObjects(_Item);

PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_ArtAreaThrowableObjects(_Item);

PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_KitchenThrowableObjects(_Item);

PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_CellarThrowableObjects(_Item);

PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_KitchenThrowableObjects(_Item);

PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)_Item)
THEN
NOT DB_LOW_OskarBeloved_ArmouryThrowableObjects(_Item);

IF
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter(_Flag,_,_Counter)
THEN
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag(_Counter,_Flag);

IF
FlagSet(_Flag,_,_)
AND
DB_LOW_OskarsBeloved_PoltergeistDefeatedCounter(_Flag,_Location,_)
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers(_ThrowTrigger,_Location)
THEN
PROC_TriggerUnregisterForParty(_ThrowTrigger);


//Camera shakes when getting hit by poltergeist throws
IF
AttackedBy(_,_Poltergeist,_,_,_,"WorldThrow",_ID)
AND
DB_LOW_OskarsBeloved_ThrownItemAction((ITEM)_Item,_ID)
THEN
PROC_CameraShakeAroundObject(_Item, 200, 2.0);

IF
OnThrown(_Item,_,_Poltergeist,_ThrowId,_,_,_)
AND
GetTemplate(_Poltergeist, (CHARACTERROOT)LOW_Poltergeist_f5643770-a043-428d-bfc9-02bdbc69e53f)
THEN
DB_LOW_OskarsBeloved_ThrownItemAction((ITEM)_Item,(INTEGER)_ThrowId);

IF
AttackedBy(_,_Poltergeist,_,_,_,"WorldThrow",_ID)
AND
DB_LOW_OskarsBeloved_ThrownItemAction((ITEM)_Item,_ID)
AND
NOT DB_LOW_OskarsBeloved_ThrowablePaintings((ITEM)_Item)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e);
Die(_Item);

IF
AttackedBy(_,_,_,_,_,"WorldThrow",_ID)
AND
DB_LOW_OskarsBeloved_ThrownItemAction((ITEM)_Item,_ID)
AND
DB_LOW_OskarsBeloved_ThrowablePaintings((ITEM)_Item)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e);
PROC_Poof(_Item);


//If a entity enters combat in a haunted room, we want the timer-based throws to stop
IF
DB_Is_InCombat(_Entity, _ID)
AND
DB_LOW_OskarsBeloved_KerriPossessing(1)
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers(_Trigger,_Location)
AND
DB_InRegion((CHARACTER)_Entity,_Trigger)
AND
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
THEN
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID);

IF
SwitchedCombat(_, _OldID, _NewID)
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _OldID)
THEN
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _OldID);
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _NewID);

IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
AND
DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location)
THEN
NOT DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location);

//Resuming timer-based room throws once combat in a room is over
IF
CombatEnded(_ID)
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers(_Trigger, _Location)
THEN
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID);
ObjectTimerLaunch(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer",1000,0);

//Executing room throw during a combat at the start of a new round with poltergeists that are not in combat
IF
CombatRoundStarted(_ID,_Round)
AND
_Round > 1
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
THEN
PROC_LOW_OskarsBeloved_RoomThrow(_Location, "Immediate");

//Updating players entering and leaving rooms with poltergeists to randomly target them
IF
EnteredTrigger(_PartyMember, _Trigger)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers(_Trigger, _Location)
AND
DB_PartyMembers(_PartyMember)
THEN
PROC_LOW_OskarsBeloved_CheckCombatInRoom(_PartyMember,_Location);
PROC_LOW_OskarsBeloved_RoomTargetAdd(_PartyMember,_Location);
PROC_LOW_OskarsBeloved_CheckStartRoomTimer(_Trigger,_Location);

PROC
PROC_LOW_OskarsBeloved_CheckCombatInRoom((CHARACTER)_Player,(STRING)_Location)
AND
DB_Is_InCombat(_Player,_ID)
AND
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _)
THEN
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID);
DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location);

PROC
PROC_LOW_OskarsBeloved_LeftTriggerCheckCombat((CHARACTER)_Player,(TRIGGER)_Trigger,(STRING)_Location)
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _)
AND
DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location)
THEN
NOT DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location);

PROC
PROC_LOW_OskarsBeloved_LeftTriggerCheckCombat((CHARACTER)_Player,(TRIGGER)_Trigger,(STRING)_Location)
AND
DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID)
AND
NOT DB_LOW_OskarsBeloved_RoomCombatant(_Player,_Location)
THEN
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _ID);


PROC
PROC_OskarsBeloved_SetForceTurnBased((STRING)_Location, (CHARACTER)_Player)
AND
NOT DB_LOW_OskarsBeloved_HadHauntRoomFTB(_Location)
AND
IsInForceTurnBasedMode(_Player,0)
THEN
ForceTurnBasedMode(_Player,1);
DB_LOW_OskarsBeloved_HadHauntRoomFTB(_Location);

IF
LeftTrigger(_Player, _Trigger)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)_Trigger, _Location)
AND
DB_PartyMembers(_Player)
THEN
PROC_LOW_OskarsBeloved_LeftTriggerCheckCombat(_Player,_Trigger,_Location);
PROC_LOW_OskarsBeloved_RoomTargetRemove(_Player,_Location);
PROC_LOW_OskarsBeloved_CheckStopRoomTimer(_Trigger, _Location);

PROC
PROC_LOW_OskarsBeloved_CheckStopRoomTimer((TRIGGER)_Trigger, (STRING)_Location)
AND
NOT QRY_TriggerEvents_AnyPartyMemberInTrigger(_Trigger)
THEN
NOT DB_LOW_OskarsBeloved_ThrowsActive((STRING)_Location);

PROC
PROC_LOW_OskarsBeloved_CheckStartRoomTimer((TRIGGER)_Trigger,(STRING)_Location)
AND
_Location != "art"
AND
NOT DB_LOW_OskarsBeloved_ThrowsActive((STRING)_Location)
THEN
DB_LOW_OskarsBeloved_ThrowsActive(_Location);
ObjectTimerLaunch(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer",1000,0);


PROC
PROC_LOW_OskarsBeloved_CheckStartRoomTimer((TRIGGER)_Trigger,"art")
AND
DB_LOW_OskarsBeloved_FullAggressiveInArtRoom(1)
AND
NOT DB_LOW_OskarsBeloved_ThrowsActive("art")
THEN
DB_LOW_OskarsBeloved_ThrowsActive("art");
ObjectTimerLaunch(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer",100,0);

IF
ObjectTimerFinished(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer")
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)_Trigger, _Location)
AND
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_Location,_)
THEN
ObjectTimerCancel(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer");
ObjectTimerCancel(_Poltergeist,"LOW_OskarsBeloved_RandomTimeDelayBeforeThrow");

IF
ObjectTimerFinished(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer")
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)_Trigger, _Location)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_ThrowsActive(_Location)
AND
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _)
THEN
PROC_LOW_OskarsBeloved_RoomThrow(_Location, "RandomDelay");

IF
ObjectTimerFinished(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer")
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)_Trigger, "armoury")
AND
QRY_OnlyOnce("LOW_OskarsBeloved_DestroyArmouryObjects")
AND
DB_LOW_OskarsBeloved_DestroyArmouryObjects(_Item)
AND
Random(2000,_RandomTime)
THEN
ObjectTimerLaunch(_Item, "LOW_OskarsBeloved_ExplodeFurniture",_RandomTime);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"dining")
THEN
DB_LOW_OskarsBeloved_PlayersInDining(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"dining")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInDining(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"armoury")
THEN
DB_LOW_OskarsBeloved_PlayersInArmoury(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"armoury")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInArmoury(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"cellar")
THEN
DB_LOW_OskarsBeloved_PlayersInCellar(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"cellar")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInCellar(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"art")
THEN
DB_LOW_OskarsBeloved_PlayersInArtArea(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"art")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInArtArea(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"corridor")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInCorridor(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"corridor")
THEN
DB_LOW_OskarsBeloved_PlayersInCorridor(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetRemove((CHARACTER)_Player,"kitchen")
THEN
NOT DB_LOW_OskarsBeloved_PlayersInKitchen(_Player);

PROC
PROC_LOW_OskarsBeloved_RoomTargetAdd((CHARACTER)_Player,"kitchen")
THEN
DB_LOW_OskarsBeloved_PlayersInKitchen(_Player);

//This will never be called, it's set so when building story it doesn't complain about these DBs never being checked. We actually check them with GetRandom but they are defined with strings in DB_LOW_OskarBeloved_RoomTargets
PROC
PROC_LOW_OskarsBeloved_InitRandomTargetDB()
AND
DB_LOW_OskarsBeloved_PlayersInCellar(_)
AND
DB_LOW_OskarsBeloved_PlayersInArtArea(_)
AND
DB_LOW_OskarsBeloved_PlayersInDining(_)
AND
DB_LOW_OskarsBeloved_PlayersInCorridor(_)
AND
DB_LOW_OskarsBeloved_PlayersInKitchen(_)
AND
DB_LOW_OskarsBeloved_PlayersInArmoury(_)
THEN
DB_NOOP(1);


PROC
PROC_LOW_OskarsBeloved_RoomThrow((STRING)_Location, "Immediate")
AND
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_Location,1)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
THEN
PROC_LOW_OskarsBeloved_PoltergeistChooseThrowTarget(_Poltergeist,_Location);

PROC
PROC_LOW_OskarsBeloved_RoomThrow((STRING)_Location, "RandomDelay")
AND
DB_LOW_OskarsBeloved_PoltergeistTriggers((TRIGGER)_Trigger, _Location)
THEN
ObjectTimerLaunch(_Trigger,"LOW_OskarsBeloved_RoomThrowTimer",4000,1);

PROC
PROC_LOW_OskarsBeloved_RoomThrow((STRING)_Location, "RandomDelay")
AND
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_Location,1)
AND
Random(1500,_Time)
THEN
ObjectTimerLaunch(_Poltergeist,"LOW_OskarsBeloved_RandomTimeDelayBeforeThrow",_Time);

IF
ObjectTimerFinished(_Poltergeist,"LOW_OskarsBeloved_RandomTimeDelayBeforeThrow")
AND
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)_Poltergeist,_Location,1)
AND
NOT DB_LOW_OskarsBeloved_CurrentHauntCombatInRoom(_Location, _)
THEN
PROC_LOW_OskarsBeloved_PoltergeistChooseThrowTarget(_Poltergeist,_Location);

PROC
PROC_LOW_OskarsBeloved_PoltergeistChooseThrowTarget((CHARACTER)_Poltergeist,(STRING)_Location)
AND
DB_LOW_OskarBeloved_RoomTargets(_Location,_DBName)
AND
QRY_GetRandom(_DBName, 1, "DB_LOW_OskarBeloved_TempSelectedPlayer")
AND
DB_LOW_OskarBeloved_TempSelectedPlayer((CHARACTER)_Player)
THEN
NOT DB_LOW_OskarBeloved_TempSelectedPlayer((CHARACTER)_Player);
PROC_LOW_OskarsBeloved_PoltergeistThrow(_Poltergeist,_Player,_Location);

PROC
PROC_LOW_OskarsBeloved_PoltergeistThrow((CHARACTER)_Poltergeist,(CHARACTER)_Player,(STRING)_Location)
AND
DB_LOW_OskarBeloved_RoomAmmo(_Location,_DBName)
AND
QRY_GetRandom(_DBName, 1, "DB_LOW_OskarBeloved_TempSelectedThrow")
AND
DB_LOW_OskarBeloved_TempSelectedThrow((ITEM)_Object)
AND
QRY_LOW_OskarsBeloved_CheckAmmoState(_Location, _Object)
THEN
TeleportTo(_Poltergeist, _Object);
UseSpell(_Poltergeist, "Throw_LOW_Poltergeist_Telekinesis",_Player, _Object);

PROC
PROC_CastedSpellOnTarget((GUIDSTRING)_Poltergeist,(GUIDSTRING)_Player,"Throw_LOW_Poltergeist_Telekinesis",(STRING)_SpellType,(STRING)_SpellElement,(INTEGER)_StoryActionID)
AND
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)_Poltergeist,_Location,_)
AND
NOT DB_LOW_OskarsBeloved_HadHauntRoomFTB(_Location)
THEN
PROC_OskarsBeloved_SetForceTurnBased(_Location,(CHARACTER)_Player);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("cellar", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_CellarThrowableObjects((ITEM)_Object);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("art", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_ArtAreaThrowableObjects((ITEM)_Object);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("kitchen", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_KitchenThrowableObjects((ITEM)_Object);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("dining", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_DiningRoomThrowableObjects((ITEM)_Object);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("corridor", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_CorridorThrowableObjects((ITEM)_Object);

QRY
QRY_LOW_OskarsBeloved_CheckAmmoState("armoury", (ITEM)_Object)
AND
DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)_Object)
AND
NOT DB_Defeated(_Object)
THEN
NOT DB_LOW_OskarBeloved_ArmouryThrowableObjects((ITEM)_Object);

IF
StatusRemoved(_Poltergeist, "LOW_POLTERGEIST_INVISIBLE",_,_)
AND
DB_LOW_OskarsBeloved_Poltergeists((CHARACTER)_Poltergeist,_Location,1)
THEN
NOT DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_Location,1);
DB_LOW_OskarsBeloved_Poltergeists(_Poltergeist,_Location,0);
SetFaction(_Poltergeist, (FACTION)ACT3_LOW_OskarsBeloved_RevealedPoltergeists_9b37addf-60a8-4742-b9f1-81b68b698a96);
PROC_SetCanFight(_Poltergeist, 1);

//END_REGION

//REGION Spooky things


IF
FlagSet((FLAG)PLA_DoubtingArtist_State_Dead_0a27ed23-fc91-43ba-8a26-b7053f1f97e2,_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_ArtistLeftHideout_76dca7be-5c6a-4444-afa4-3ae4b13d6315)
AND
NOT DB_PermaDefeated(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_ResetToNormalATM")
THEN
TriggerSetAtmosphere((TRIGGER)S_ATM_CTY_ArtistHouse_4440ee01-d742-49bc-b19a-b5bdf136ec2e,"3a3546d3-55bb-05aa-08dd-549e7f364030");

IF
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_HauntSurfaceSpawn(_Trigger,_,_)
THEN
NOT DB_OneShotPartyTrigger(_Trigger);


//Thunderwaves

PROC
PROC_BlockMoveOfItem(_Character,_Item)
AND
DB_LOW_OskarsBeloved_Thunderwaves(_,_Item,_)
THEN
DB_CustomMoveItemResponse(_Character, _Item, 0);


//Phantasmal Force aura objects

IF
EnteredTrigger(_PartyMember, _Trigger)
AND
DB_LOW_OskarsBeloved_AuraItems(_Trigger, _Item)
AND
NOT DB_Defeated(_Item)
AND
HasActiveStatus(_PartyMember,"PHANTASMAL_FORCE",0)
THEN
PlayEffect(_Item,(EFFECTRESOURCE)VFX_Script_OskarsBeloved_CurseAura_Burst_01_13c5b482-4369-72f3-3323-fee8d3de948e,"",0.0);
ApplyStatus(_PartyMember,"PHANTASMAL_FORCE",-1.0);

IF
StatusRemoved(_PartyMember, "PHANTASMAL_FORCE",_,_)
AND
DB_PartyMembers((CHARACTER)_PartyMember)
AND
DB_LOW_OskarsBeloved_AuraItems(_Trigger, _Item)
AND
DB_InRegion((CHARACTER)_PartyMember,_Trigger)
AND
NOT DB_Defeated(_Item) 
THEN
PlayEffect(_Item,(EFFECTRESOURCE)VFX_Script_OskarsBeloved_CurseAura_Burst_01_13c5b482-4369-72f3-3323-fee8d3de948e,"",0.0);
ApplyStatus(_PartyMember,"PHANTASMAL_FORCE",-1.0);


IF
StatusRemoved(_Object, "LOW_OSKARSBELOVED_CURSEDITEM_CURSEDAURA",_,_)
THEN
Die((ITEM)_Object);

IF
StatusRemoved(_Object, "LOW_OSKARSBELOVED_CURSEDSKULL",_,_)
THEN
Die((ITEM)_Object);


PROC
PROC_StateSet_Defeated(_Item)
AND
DB_LOW_OskarsBeloved_AuraItems(_Trigger, (ITEM)_Item)
THEN
PROC_TriggerUnregisterForParty(_Trigger);
PROC_StopLoopEffect( _Item, "LOW_OskarsBeloved_CursedItemEffect");

//Automatic lights
IF
StatusRemoved(_Light, "BURNING",_,_)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
DB_LOW_OskarsBeloved_HauntLights(_Trigger,_Light)
AND
QRY_AnyPartyMemberInTrigger(_Trigger)
THEN
ApplyStatus(_Light, "BURNING",-1.0,1);

IF 
EnteredTrigger(_Player, _Trigger)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
DB_LOW_OskarsBeloved_HauntLights(_Trigger,_Light)
AND
HasActiveStatus(_Light, "BURNING", 0)
AND
NOT DB_Defeated(_Light)
THEN
ApplyStatus(_Light, "BURNING",-1.0,1);


IF
EnteredTrigger(_Player, S_LOW_OskarsBeloved_PianoTrigger_2d031113-83f1-411e-a086-b2e38fddf0c7)
THEN
PlaySound(S_LOW_Piano_9069ed6a-bbeb-4414-a3f2-45feea08016f,"LOW_OskarsBeloved_PlayPiano");

IF 
LeftTrigger(_Player, _Trigger)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
AND
DB_LOW_OskarsBeloved_HauntLights(_Trigger,_Light)
AND
HasActiveStatus(_Light, "BURNING", 1)
AND
NOT QRY_AnyPartyMemberInTrigger(_Trigger)
THEN
RemoveStatus(_Light, "BURNING");
 
IF
EnteredTrigger(_Player,(TRIGGER)S_LOW_PossessionTrigger_ArtAreaSecondFloor_873ee2a7-b85d-43c8-8441-0f2604555c50)
AND
NOT DB_LOW_OskarsBeloved_StartedSpookyExplosions(1)
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_HauntingHappening_a93014c2-fca7-4ab1-b2f3-ee674737fc7d)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e);
DB_LOW_OskarsBeloved_StartedSpookyExplosions(1);
ObjectTimerLaunch(S_LOW_GlobeArtArea_4b8189b7-3c50-4ac8-a12b-b0b6a8ac876e, "LOW_OskarsBeloved_ExplodeFurniture",1000);
ObjectTimerLaunch(S_LOW_ChairArtArea1_63bcd75a-b2d2-4cbb-b235-39204fdc1d62, "LOW_OskarsBeloved_ExplodeFurniture",3000);
ObjectTimerLaunch(S_LOW_ChairArtArea8_66a8c500-6b53-41e4-a6d3-65a77e2a2593, "LOW_OskarsBeloved_ExplodeFurniture",5000);
ObjectTimerLaunch(S_LOW_SofaArtArea1_6911f4cd-2867-46a1-873a-f80a832cd01a, "LOW_OskarsBeloved_ExplodeFurniture",7000);

IF
ObjectTimerFinished(_Item, "LOW_OskarsBeloved_ExplodeFurniture")
AND
NOT DB_Defeated(_Item)
THEN
Die((ITEM)_Item);

IF
ObjectTimerFinished(S_LOW_SofaArtArea1_6911f4cd-2867-46a1-873a-f80a832cd01a, "LOW_OskarsBeloved_ExplodeFurniture")
THEN
DB_LOW_OskarsBeloved_FullAggressiveInArtRoom(1);
PROC_LOW_OskarsBeloved_CheckStartRoomTimer((TRIGGER)S_LOW_PossessionTrigger_ArtAreaSecondFloor_873ee2a7-b85d-43c8-8441-0f2604555c50,"art");

PROC
PROC_OneShotTriggerEntered(_Player,(TRIGGER)_Trigger)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_HauntSurfaceSpawn((TRIGGER)_Trigger,_Surface,_Size)
THEN
SetFlag((FLAG)LOW_OskarsBeloved_Event_FirstSpookyEvent_315fec8c-16b2-41bc-a3db-1668641bb33e);
CreateSurface(_Trigger,_Surface, _Size, -1.0);

//Atelier objects speaking with kerri voice
IF 
Moved(_Item)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits(_Item, _AD,_)
THEN
PROC_TryStartAD(_AD, _Item);

IF
UseStarted(_,_Item)
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_LOW_OskarsBeloved_AtelierSpeakingPortraits(_Item, _AD,_)
THEN
PROC_TryStartAD(_AD, _Item);

//END_REGION

//REGION Stop Oskar from joining combats with the spirit.

IF
CrimeIsRegistered((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, _Crime, _ID, _, _Criminal, _, _, _)
AND
GetFaction(_Criminal, _Faction)
AND
_Faction == ACT3_LOW_OskarsBeloved_Kerri_791cbbc2-671b-42c0-afba-634d9ddea545
THEN
CrimeIgnoreCrime(_ID, S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

//END_REGION

//REGION [Combat] Transform Kerri spirit in Monstrous spirit
IF
HitpointsChanged(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_HpPercentage)
AND
_HpPercentage < 66.0
AND
QRY_OnlyOnce("LOW_OskarsBeloved_KerriTransformed")
THEN
ApplyStatus(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,"LOW_OSKARSBELOVED_MONSTROUSFORM",-1.0,1,NULL_00000000-0000-0000-0000-000000000000);

//END_REGION

//REGION [Combat] Remove POSSESSED status upon Kerri Spirit death
IF
StatusApplied(_Character,"LOW_GHOST_POSSESSED",S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356,_)
THEN
DB_LOW_OSKARSBELOVED_OSKARPOSSESSEDCharacter(_Character);

IF
StatusRemoved(_Character,"LOW_GHOST_POSSESSED",_,_)
THEN
NOT DB_LOW_OSKARSBELOVED_OSKARPOSSESSEDCharacter(_Character);

IF
DB_Defeated(S_LOW_KerriEvenfield_b7e59d50-dad4-40b3-88f7-e05d27134356)
AND
DB_LOW_OSKARSBELOVED_OSKARPOSSESSEDCharacter(_Character)
THEN
RemoveStatus(_Character,"LOW_GHOST_POSSESSED",NULL_00000000-0000-0000-0000-000000000000);

//END_REGION

//REGION Journal

IF
Opened((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c)
THEN
PROC_LOW_OskarsBeloved_HandleRevealingPortrait();

IF
DB_PermaDefeated((ITEM)S_LOW_AtelierDoor_52eab9da-3bdf-42ab-aaa3-e1fc3596944c)
THEN
PROC_LOW_OskarsBeloved_HandleRevealingPortrait();

PROC
PROC_LOW_OskarsBeloved_HandleRevealingPortrait()
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "OpenedSecretDoor")
THEN
QuestUpdate("GLO_DoubtingArtist", "OpenedSecretDoor");

PROC
PROC_OskarsBeloved_SpawnAllyPortrait(_)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "HitPortraitZombies")
THEN
QuestUpdate("GLO_DoubtingArtist", "HitPortraitZombies");

IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_PermaDefeated(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
THEN
QuestUpdate("GLO_DoubtingArtist", "ReadLetter_NotMetCarrion_JannathAlive");

IF
DB_GlobalFlag((FLAG)LOW_FatherCarrion_State_IsHostile_50c741f9-19be-4fac-997a-3d31202ba14e)
AND
NOT DB_GlobalFlag((FLAG)LOW_FatherCarrion_State_MentionedTorch_dc4ad5da-52b8-400d-bb12-1609d4248468)
THEN
DB_QuestDef_State_ConditionalFlag((FLAG)LOW_OskarsBeloved_Event_GiveSketchbook_85bee4ab-915b-4e57-81b6-9d8bc963e350, "GLO_DoubtingArtist", "CarrionHostile_NoTorchMention", 1, (FLAG)LOW_OskarsBeloved_State_ReadLetter_ee3f0fae-416f-4511-a2e6-30e79685f730);

IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_PermaDefeated(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_NotMetCarrion_JannathAlive")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_NotMetCarrion_JannathAlive");

IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
DB_PermaDefeated(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "ReadLetter_NotMetCarrion_JannathDead")
THEN
QuestUpdate("GLO_DoubtingArtist", "ReadLetter_NotMetCarrion_JannathDead");


IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
DB_PermaDefeated(S_LOW_Jannath_f64fa57e-8061-4eb4-8d46-1ac743e1852d)
AND
DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_NotMetCarrion_JannathDead")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_NotMetCarrion_JannathDead");


IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
DB_OnlyOnce("LOW_OskarsBeloved_FoundLetter")
THEN
SetFlag((FLAG)LOW_OskarsBeloved_State_FoundLetter_840482ff-dbf4-4c23-9ea9-8effb35f2172);

IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "ReadLetter_HasMetCarrionBefore")
THEN
QuestUpdate("GLO_DoubtingArtist", "ReadLetter_HasMetCarrionBefore");

IF
GameBookInterfaceClosed((ITEM)S_LOW_LetterFatherCarrion_c4aae84c-c9b5-4941-a94f-c5c8ead07205,_)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_GlobalFlag((FLAG)LOW_PhilgravesMansion_State_CarrionNotSpotting_223ba810-bd5e-4a07-801b-2a84c8eedd04)
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_HasMetCarrionBefore")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadLetter_HasMetCarrionBefore");



IF
UseFinished(_Player,(ITEM)S_LOW_PhilgravesMansion_ClientChest_ee7e8c08-5359-4cc2-932a-42edd01c4de6,1)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_GlobalFlag((FLAG)LOW_FatherCarrion_State_MentionedTorch_dc4ad5da-52b8-400d-bb12-1609d4248468)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "OpenedOskarStash_NoTorchMention")
THEN
QuestUpdate("GLO_DoubtingArtist", "OpenedOskarStash_NoTorchMention");

IF
UseFinished(_Player,(ITEM)S_LOW_PhilgravesMansion_ClientChest_ee7e8c08-5359-4cc2-932a-42edd01c4de6,1)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_GlobalFlag((FLAG)LOW_FatherCarrion_State_MentionedTorch_dc4ad5da-52b8-400d-bb12-1609d4248468)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "OpenedOskarStash_NoTorchMention")
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("OpenedOskarStash_NoTorchMention")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("OpenedOskarStash_NoTorchMention");



IF
GameBookInterfaceClosed((ITEM)S_LOW_ClientList_b56071d0-93f8-4d9c-9f5b-7c54b0121a15,_)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "ReadClientList")
THEN
QuestUpdate("GLO_DoubtingArtist", "ReadClientList");

IF
QuestUpdateUnlocked(_,"GLO_DoubtingArtist",_Update)
AND
DB_OskarsBeloved_TorchInfoUpdates(_Update)
AND
DB_Players(_Player)
AND
GetFlag((FLAG)LOW_PhilgravesMansion_State_HasTorch_963a8ced-1976-41fa-8994-c5b71330cc9b,_Player,1)
THEN
QuestUpdate("GLO_DoubtingArtist", "LootedTorch");

IF
GameBookInterfaceClosed((ITEM)S_LOW_ClientList_b56071d0-93f8-4d9c-9f5b-7c54b0121a15,_)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadClientList")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReadClientList");

IF
FlagSet((FLAG)LOW_PhilgravesMansion_State_HasTorch_963a8ced-1976-41fa-8994-c5b71330cc9b,_Player,_)
AND
DB_Players((CHARACTER)_Player)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "LootedTorch")
AND
QRY_LOW_OskarsBeloved_KnowAboutTorch()
THEN
QuestUpdate("GLO_DoubtingArtist", "LootedTorch");

QRY
QRY_LOW_OskarsBeloved_KnowAboutTorch()
AND
QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "ReadClientList")
THEN
DB_NOOP(1);

QRY
QRY_LOW_OskarsBeloved_KnowAboutTorch()
AND
QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist", "TalkedToCarrion_MentionedTorch")
THEN
DB_NOOP(1);

IF
EnteredTrigger(_Player, (TRIGGER)S_LOW_OskarsBeloved_AtelierSeenPortraitsTrigger_c03c9227-af2e-4a22-a45d-3d088639a595)
AND
DB_LOW_OskarsBeloved_WitnessedPossession(1)
THEN
QuestUpdate("GLO_DoubtingArtist", "ReachedAtelier");

IF
EnteredTrigger(_Player, (TRIGGER)S_LOW_OskarsBeloved_AtelierSeenPortraitsTrigger_c03c9227-af2e-4a22-a45d-3d088639a595)
AND
NOT DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReachedAtelier")
THEN
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar("ReachedAtelier");

IF
DB_LOW_OskarsBeloved_WitnessedPossession(1)
AND
DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar(_Step)
THEN
QuestUpdate("GLO_DoubtingArtist",_Step);
NOT DB_LOW_OskarsBeloved_StepsToUpdateWhenSeenOskar(_Step);

IF
DialogEnded((DIALOGRESOURCE)LOW_OskarsBeloved_TarhunMnemonis_dca723fe-bcf0-2b6c-ca44-87ddc6c61d0e,_ID)
AND
NOT QRY_QuestUpdateIsUnlockedForAny("GLO_DoubtingArtist","DialogTarhun")
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_MentionedJannathInAct1_1991f361-7478-4feb-8702-d947cd2ce24a)
THEN
QuestUpdate("GLO_DoubtingArtist","DialogTarhun");

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3b"
