Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa, (TRIGGER)S_END_VoloGroupPoint_9b6c1259-92fc-4bd9-9f78-a4114e2f7d6e, (FLAG)GLO_Volo_State_AtCamp_de1cadca-2eca-4cee-a3dc-e262bbb92277);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, (TRIGGER)S_END_ZevlorGroupPoint_051b8986-4568-4895-8d77-23eb9de57302, (FLAG)COL_TadpolingCentre_Event_ReleasePods_3e81dc65-eb2d-86aa-5163-28450894f868);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Wulbren_2d70edbf-1a70-4047-8099-48f3e75d93bf, (TRIGGER)S_END_GondianReinforcementGroupPoint_c87d3764-ee83-441b-b0ab-52a50f75c114, (FLAG)END_GatherYourAllies_State_WulbrenGaveIronhandSupport_dd929cfa-685e-41d6-8e04-be2f1a14da98);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_END_SteelWatcherAlly_cb20c38a-38f7-46f7-840d-b64b4d363674, (TRIGGER)S_END_GondianReinforcementGroupPoint_c87d3764-ee83-441b-b0ab-52a50f75c114, (FLAG)LOW_SteelWatchFoundry_State_GainedGondianENDSupport_1bb09a8b-001d-4b43-9f39-ba89eb3aece9);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976, (TRIGGER)S_END_BarcusGroupPoint_43691891-806f-4ddd-afc3-b9df2d8d2b85, (FLAG)LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, (TRIGGER)S_END_RolanGroupPoint_b746cb50-7c00-468a-ae14-ebb60cc69c8f, (FLAG)LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, (TRIGGER)S_END_OwlbearCubGroupPoint_284a78d8-e562-4e2a-9e57-88e46c9f9993, (FLAG)CAMP_OwlbearCub_State_Friend_3b963a1c-ca06-db60-75c3-063592e84dc4);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (TRIGGER)S_END_IsobelGroupPoint_f8db4a96-c2c1-4e74-9423-5753754babfc, (FLAG)LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, (TRIGGER)S_END_NightsongGroupPoint_494f1aa2-c0a0-4cce-9b65-7234391f4caf, (FLAG)LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, (TRIGGER)S_END_DammonGroupPoint_2b77f34b-5b86-4062-b255-9bdd832c1538, (FLAG)CAMP_OwlbearCub_State_Friend_3b963a1c-ca06-db60-75c3-063592e84dc4);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_HollyphantDetective_acf70307-3bb9-4b91-b894-fa2120916f58, (TRIGGER)S_END_ValeriaGroupPoint_925a0a37-3b35-4a73-8ca3-afb16bafd7b0, (FLAG)LOW_MurderTribunal_Event_ValeriaLeavesTribunal_57a75bf2-2648-c9f8-e75e-8366c582225e);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, (TRIGGER)S_END_HalsinGroupPoint_6e915a84-c13e-4087-b31b-c5b25254ee3e, (FLAG)GLO_LiftingTheCurse_State_BreathHasBeenRestored_2113b54e-a140-4aa0-97ac-219fa7b7d038);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (TRIGGER)S_END_ShadowheartGroupPoint_1f626048-6601-4d48-b045-e4ce09038d7f, (FLAG)ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a, (TRIGGER)S_END_JaheiraGroupPoint_a333602f-824a-41e2-ba1d-94a7b6101d86, (FLAG)GLO_Origin_PartOfTheTeam_Jaheira_d7d29efe-70bb-47c2-9db3-bc8a10347bc6);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c, (TRIGGER)S_END_OrthonGroupPoint_7789fcca-f249-462c-80c4-bce2d9d693ed, (FLAG)LOW_Orthon_State_PromisedENDSupport_b412f8bc-1cc6-2ac9-058e-8a5d06e77c5a);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, (TRIGGER)S_END_ShadowheartGroupPoint_1f626048-6601-4d48-b045-e4ce09038d7f, (FLAG)LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (TRIGGER)S_END_SmugglerGroupPoint_9332c88a-a86e-4cfa-9b07-53b726bfcea4, (FLAG)LOW_Guildhall_State_ZhentWillHelpEND_36a52d98-d9f0-4937-8d8d-e58dbf304b49);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Wyll_Cambion_491a7686-3081-405b-983c-289ec8781e0a, (TRIGGER)S_END_WyllGroupPoint_061df32b-1c47-4119-b721-14803d949e30, (FLAG)CAMP_MizorasPact_State_WyllEternalPact_8da8b1fb-5aa9-8cf5-8b45-6f8ca31a1227);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (TRIGGER)S_END_AstarionGroupPoint_3d35339f-0048-42f3-836e-a6ea5098e952, (FLAG)ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_WYR_GurCamp_GurLeader_5e52cf9c-b673-45b7-888c-2c105eb4d890, (TRIGGER)S_END_AstarionGroupPoint_3d35339f-0048-42f3-836e-a6ea5098e952, (FLAG)LOW_GurFollowUp_State_PeacefulResolution_260836ee-6f67-4ea4-9e2c-ccae94a75035);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, (TRIGGER)S_END_ArabellaGroupPoint_eb8502fb-393e-4c64-8951-1e53c1a746be, (FLAG)CAMP_ArabellaPowers_State_JergalToldToLeave_3d22614e-8762-8aec-4537-9d50abb97b23);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, (TRIGGER)S_END_FlorrickGroupPoint_f789858f-c31c-45cd-b260-71bc28585367, (FLAG)WYR_WyrmRockPrison_State_FlorrickEscaped_a84a5b16-ca29-43c3-91bf-17def670ba07);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, (TRIGGER)S_END_HagGroupPoint_a206f4b9-69f5-4340-8dbc-2981923c5db2, (FLAG)LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, (TRIGGER)S_END_SmugglerGroupPoint_9332c88a-a86e-4cfa-9b07-53b726bfcea4, LOW_Guildhall_State_NinefingersWillHelpEND_bdab2f3d-d878-4367-9519-c52117dcf915);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, (TRIGGER)S_END_SmugglerGroupPoint_9332c88a-a86e-4cfa-9b07-53b726bfcea4, (FLAG)LOW_Guildhall_State_ZhentWillHelpEND_36a52d98-d9f0-4937-8d8d-e58dbf304b49);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56, (TRIGGER)S_END_OxGroupPoint_a5e74407-44c1-4c51-8df1-dd18b474ca2a, (FLAG)LOW_DevilishOx_State_HelpedPhasmToCity_d1498063-a466-4f43-8cb5-103baa46c753);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03, (TRIGGER)S_END_RavengardGroupPoint_c121256a-08d7-4cbd-9d42-48e5ef3a3750, (FLAG)CAMP_Ravengard_State_RavengardInCamp_37309008-04cf-493c-8ca6-43034d331a8a);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, (TRIGGER)S_END_RolanGroupPoint_b746cb50-7c00-468a-ae14-ebb60cc69c8f, (FLAG)LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (TRIGGER)S_END_MolGroupPoint_211b9524-d63e-494d-9ca8-87475c76827d, (FLAG)LOW_Guildhall_State_MolHelpsPlayerInEND_5c4d5b0f-a9bb-4fe0-8003-2af9213a64b0);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_MurderTribunal_Sarevok_ae9f784a-ea64-4297-95a7-8377e85231b6, (TRIGGER)S_END_BhaalistGroupPoint_0f479d73-8f9e-45c2-833e-7866ecf26a7e, (FLAG)ORI_DarkUrge_State_BhaalAccepted_904c45e0-bb06-40ed-b5d7-4f1c851b9d86);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_BhaalTemple_UnholyAssassin_01_d00763c7-cac6-47b8-86be-a13ddd346861, (TRIGGER)S_END_BhaalistGroupPoint_0f479d73-8f9e-45c2-833e-7866ecf26a7e, (FLAG)ORI_DarkUrge_State_BhaalAccepted_904c45e0-bb06-40ed-b5d7-4f1c851b9d86);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_LOW_BhaalTemple_UnholyAssassin_02_cec194b2-0e8d-4d38-a136-0e9b1c38c684, (TRIGGER)S_END_BhaalistGroupPoint_0f479d73-8f9e-45c2-833e-7866ecf26a7e, (FLAG)ORI_DarkUrge_State_BhaalAccepted_904c45e0-bb06-40ed-b5d7-4f1c851b9d86);
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_END_KuotoaPointOfContact_265239be-2489-496d-936d-e78240ce2165, (TRIGGER)S_END_KuoToaGroupPoint_d0db2d7d-260f-40a2-a276-4a91a8b58021, (FLAG)END_GatherYourAllies_Event_KuotoaPromisedENDSupport_099fbdae-4e4f-eecd-6747-8d5a9f59fe22);

DB_GLO_CharacterCorpseDialog((CHARACTER)S_END_DeadAbsolutist001_293286c0-b0e6-4657-ab9b-1ddc6a3b93fa, (DIALOGRESOURCE)END_GatherYourAllies_AbsolutistSpeakWithDead_8f35e468-a9ac-14fa-fa0f-b6d1fb810cce);
DB_GLO_CharacterCorpseDialog((CHARACTER)S_END_FlamingFist001_f4ea6aa2-849e-41ac-848b-19fe3cbbc8dd, (DIALOGRESOURCE)END_GatherYourAllies_HalfarSpeakWithDead_ee5dc488-e013-5c8e-513e-f213012162a3);

DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa, (DIALOGRESOURCE)END_GatherYourAllies_VoloFollowUp_fd15e2c5-db95-33b2-a5f2-e2f1531dfe95, "END_Volo");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, (DIALOGRESOURCE)END_GatherYourAllies_ZevlorFollowUp_b6be461e-4567-05bc-0f0f-2bfb19c975a9, "END_Zevlor");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, (DIALOGRESOURCE)END_GatherYourAllies_DammonFollowUp_748101f4-ae6f-25e6-b6d2-e60d105dc48e, "END_Dammon");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (DIALOGRESOURCE)END_GatherYourAllies_IsobelFollowUp_93bcdd2b-5caf-4a83-0c8e-2675ef6492c3, "END_Isobel");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Wulbren_2d70edbf-1a70-4047-8099-48f3e75d93bf, (DIALOGRESOURCE)END_GatherYourAllies_WulbrenFollowUp_a92d0d1b-c2b7-7dc3-09c8-7fedef08199a, "END_Wulbren");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976, (DIALOGRESOURCE)END_GatherYourAllies_UnfortunateGnomeFollowUp_84389e8a-dd9d-5f29-5552-c4b1af73239a, "END_Barcus");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (DIALOGRESOURCE)END_GatherYourAllies_ShadowheartFollowUp_bf04643e-093a-8b07-139f-70f0a424518a, "END_Shadowheart");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_END_SteelWatcherAlly_cb20c38a-38f7-46f7-840d-b64b4d363674, (DIALOGRESOURCE)END_GatherYourAllies_SteelWatcherFollowUp_1f5d8495-c615-c459-3059-b84ea4a4e7dc, "END_SteelWatcher");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, (DIALOGRESOURCE)END_GatherYourAllies_RolanFollowUp_94b8d56b-05cc-7ec1-3e47-1d3b57edd76f, "END_Rolan");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, (DIALOGRESOURCE)END_GatherYourAllies_OwlbearCubFollowUp_612bbb9e-91d5-f182-4759-394e906d6eb9, "END_OwlbearCub");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, (DIALOGRESOURCE)END_GatherYourAllies_NightsongFollowUp_2262a52c-acb4-b632-bda8-372cc46c6a76, "END_Nightsong");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_HollyphantDetective_acf70307-3bb9-4b91-b894-fa2120916f58, (DIALOGRESOURCE)END_GatherYourAllies_ValeriaFollowUp_a709a201-de56-21da-849c-7afacaef52ed, "END_Valeria");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, (DIALOGRESOURCE)END_GatherYourAllies_HalsinFollowUp_9a404552-9cf9-7fdb-4537-a4d47894428a, "END_Halsin");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a, (DIALOGRESOURCE)END_GatherYourAllies_JaheiraFollowUp_5d7402ff-57d9-cfb8-a5a5-4b741ead098c, "END_Jaheira");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c, (DIALOGRESOURCE)END_GatherYourAllies_OrthonFollowUp_c2811449-76f2-8b78-0987-73b176929faf, "END_Orthon");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, (DIALOGRESOURCE)END_GatherYourAllies_ViconiaFollowUp_63126d55-17ab-3c95-5d10-7757afe38af4, "END_Viconia");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (DIALOGRESOURCE)END_GatherYourAllies_ZhentFollowUp_80bbcb71-cdb6-1df5-2738-1aeb983144f3, "END_Zhent");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Wyll_Cambion_491a7686-3081-405b-983c-289ec8781e0a, (DIALOGRESOURCE)END_GatherYourAllies_MizoraFollowUp_e788a7a9-a0a4-0a55-9fd8-eabea4253046, "END_Mizora");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (DIALOGRESOURCE)END_GatherYourAllies_LordAstarionFollowUp_21ffa6d0-e292-fa8f-0f7d-d8fc7187fcac, "END_Astarion");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_WYR_GurCamp_GurLeader_5e52cf9c-b673-45b7-888c-2c105eb4d890, (DIALOGRESOURCE)END_GatherYourAllies_GurFollowUp_741137b1-24a8-038f-f078-fdd256424039, "END_Gur");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, (DIALOGRESOURCE)END_GatherYourAllies_ArabellaFollowUp_7fc54e9a-0ec4-2215-866c-6a807f877e57, "END_Arabella");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, (DIALOGRESOURCE)END_GatherYourAllies_FlorrickFollowUp_2768324c-671a-a80b-aaeb-a691754e0431, "END_Florrick");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, (DIALOGRESOURCE)END_GatherYourAllies_HagFollowUp_3cdb1829-ce97-3a2b-9bdf-732a85a84dc0, "END_Hag");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, (DIALOGRESOURCE)END_GatherYourAllies_KeeneFollowUp_3c04dff9-524e-9755-71d6-7c59f9b2d697, "END_Keene");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03, (DIALOGRESOURCE)END_GatherYourAllies_RavengardFollowUp_73029dc7-19d6-1c3b-0f9c-28a4ae0211a3, "END_Ravengard");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, (DIALOGRESOURCE)END_GatherYourAllies_LorroakanFollowup_e782d6a2-f694-a00e-7dc0-200e00a369a1, "END_Lorroakan");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (DIALOGRESOURCE)END_GatherYourAllies_MolFollowUp_fc055e52-028e-05b9-c889-a89b632dee04, "END_Mol");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56, (DIALOGRESOURCE)END_GatherYourAllies_PhasmFollowUp_16f19936-9fd0-ac5b-d4e0-818cf1e9ca71, "END_Phasm");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_MurderTribunal_Sarevok_ae9f784a-ea64-4297-95a7-8377e85231b6, (DIALOGRESOURCE)END_GatherYourAllies_SarevokFollowUp_9edaf2ab-35f9-8b95-74a1-95ed0af76123, "END_Bhaalist");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_BhaalTemple_UnholyAssassin_01_d00763c7-cac6-47b8-86be-a13ddd346861, (DIALOGRESOURCE)END_GatherYourAllies_RyckeFollowUp_22893e0a-a849-6d40-da11-1595f256856c, "END_Bhaalist");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_LOW_BhaalTemple_UnholyAssassin_02_cec194b2-0e8d-4d38-a136-0e9b1c38c684, (DIALOGRESOURCE)END_GatherYourAllies_MitchiaFollowUp_6dde3407-00f2-a52e-9a7b-9896f54267f1, "END_Bhaalist");
DB_END_GatherYourAllies_FollowUpDialogue((CHARACTER)S_END_KuotoaPointOfContact_265239be-2489-496d-936d-e78240ce2165, (DIALOGRESOURCE)END_GatherYourAllies_KuoToaFollowUp_202d3335-9349-1f52-563b-86f7f4395c9c, "END_KuoToa");

DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_ShadowheartReinforcementsAwarded_09b3e430-9eb6-8b85-914b-10280a98b549, (CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_JaheiraReinforcementsAwarded_5f47c942-ac2c-b16d-5273-5653d9bbf5c0, (CHARACTER)S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_VoloReinforcementsAwarded_1d04bc5d-674b-7ad0-e13e-9f95defa3fa3, (CHARACTER)S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_HellriderReinforcementsAwarded_7aa84a11-88db-c5ea-1058-12d927ca1fdf, (CHARACTER)S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_IronhandReinforcementsAwarded_13c4957c-2f76-28fc-5a25-fd625613a68b, (CHARACTER)S_GLO_Wulbren_2d70edbf-1a70-4047-8099-48f3e75d93bf);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_SteelWatcherReinforcementsAwarded_7635609c-8f90-a6f5-a10b-4e573d763b65, (CHARACTER)S_END_SteelWatcherAlly_cb20c38a-38f7-46f7-840d-b64b4d363674);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_IronhandReinforcementsAwarded_13c4957c-2f76-28fc-5a25-fd625613a68b, (CHARACTER)S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_RolanReinforcementsAwarded_7f36c620-10ee-681e-0a13-33fcbfea04ab, (CHARACTER)S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_IsobelReinforcementsAwarded_e514a07c-81fe-6c48-6f90-2333b475d201, (CHARACTER)S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_NightsongReinforcementsAwarded_e6d46345-982d-4450-8a35-0b958746f119, (CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_OwlbearCubReinforcementsAwarded_e091bec3-e904-ad68-a2ee-d135bc37fa4a, (CHARACTER)S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_ValeriaReinforcementsAwarded_e5c0b5c4-749f-c90a-5aa6-8ed6769fd808, (CHARACTER)S_GLO_HollyphantDetective_acf70307-3bb9-4b91-b894-fa2120916f58);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_SpiritOfTheLandReinforcementAwarded_a554fa66-4387-4013-ace0-b2475c0cae19, (CHARACTER)S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_ViconiaReinforcementAwarded_85db0c1b-87b6-4dab-b9ae-b7356b445b90, (CHARACTER)S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_MizoraReinforcementAwarded_a48c83c9-0fe3-41f2-9d0a-eb3defbc9b52, (CHARACTER)S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_AstarionLordReinforcmentAwarded_4ae26be0-4664-475f-8b6c-4d616c036bb8, (CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_GurReinforcmentAwarded_7b978da2-83cf-3090-fbfa-8a8892fe2419, (CHARACTER)S_WYR_GurCamp_GurLeader_5e52cf9c-b673-45b7-888c-2c105eb4d890);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_ZhentReinforcementAwarded_ecf7e897-102c-4aaa-b666-d3118788b409, (CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_OrthonReinforcementAwarded_9c3d61b7-9212-4fc9-9c08-17012d072cf8, (CHARACTER)S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_ArabellaReinforcementAwarded_027f3339-9910-4d45-ba43-75e659d2ee05, (CHARACTER)S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_FlorrickReinforcementAwarded_9c450269-4072-43e1-ad9d-033b26347d28, (CHARACTER)S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_KeeneReinforcementAwarded_d6bae4db-96f2-2440-a61f-9157272443a2, (CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_VossEncounter_Event_GithReinforcementsAwarded_b5147ee9-ec6e-461e-8849-7d9af26c3d54, (CHARACTER)S_GLO_GithKnight_2adce2df-0799-49dc-b867-ba7ca21e9aea);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_MolReinforcementsAwarded_8b23e61f-3981-443c-a53e-51cc6ddbfecd, (CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_RavengardReinforcementAwarded_4f2c9d04-bb87-47be-b177-2f2334dd9f03, (CHARACTER)S_GLO_Ravengard_f6620372-ebd0-4511-a39d-8c2d4ad03f03);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_PhasmReinforcementAwarded_0c94e0dd-c7c4-4e0a-99c0-a927b22bf205, (CHARACTER)S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_HagReinforcementAwarded_30ee4993-10d4-40d7-8791-20c4d8635019, (CHARACTER)S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_LorroakanReinforcementAwarded_953bdea7-43fc-45d1-8181-d4d252aebfab, (CHARACTER)S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_SarevokReinforcementAwarded_cd484d53-1a89-43e2-9d50-181e5ab10834, (CHARACTER)S_LOW_MurderTribunal_Sarevok_ae9f784a-ea64-4297-95a7-8377e85231b6);
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)END_GatherYourAllies_Event_KuoToaReinforcementAwarded_f253beab-073b-4bf3-9199-f0437174bc13, (CHARACTER)S_END_KuotoaPointOfContact_265239be-2489-496d-936d-e78240ce2165);

DB_END_GatherYourAllies_PartyAllies((FLAG)GLO_LiftingTheCurse_State_BreathHasBeenRestored_2113b54e-a140-4aa0-97ac-219fa7b7d038);
DB_END_GatherYourAllies_PartyAllies((FLAG)ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac);
DB_END_GatherYourAllies_PartyAllies((FLAG)GLO_Origin_PartOfTheTeam_Jaheira_d7d29efe-70bb-47c2-9db3-bc8a10347bc6);
DB_END_GatherYourAllies_PartyAllies((FLAG)ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e);

DB_END_GatherYourAllies_PartyAlly_Clothes((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (ITEMROOT)ARM_Camp_Body_Shadowheart_7062410b-439c-4f2f-bc48-1c16ab1ace20);
DB_END_GatherYourAllies_PartyAlly_Clothes((CHARACTER)S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a, (ITEMROOT)ARM_Camp_Body_Jaheira_0d0d9c0f-e9aa-4ba4-a0a9-1a0b7b7069ca);
DB_END_GatherYourAllies_PartyAlly_Clothes((CHARACTER)S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, (ITEMROOT)ARM_Camp_Body_Halsin_dc74db6c-14b2-44fa-8415-0dd1194e90e2);
DB_END_GatherYourAllies_PartyAlly_Clothes((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (ITEMROOT)ARM_Camp_Body_Astarion_b7392453-6569-4c24-9a1b-cbaea7cebac8);

PROC_END_GatherYourAllies_InitFactionFlags();

DB_AddCharactersInTriggerToDialog((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (TRIGGER)S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0, 1, 1, 1, 1);

DB_IgnoreMutingStatussesDialog((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079);

PROC_RemoveAllDialogEntriesForSpeaker((CHARACTER)S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d);
DB_Dialogs(S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d, (DIALOGRESOURCE)END_GatherYourAllies_BeornFollowUp_32ca6082-d77e-fbe1-15fe-e032498ab7e5);
DB_Dialogs((CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, (DIALOGRESOURCE)END_GatherYourAllies_LastMinuteTrader_700cd9e0-3e24-605e-d7e5-e90bcda8ee3b);

TriggerSetItemsOwner((TRIGGER)S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4, (CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981);
DB_ItemShopTrigger((TRIGGER)S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4, (CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981);

PROC_TriggerRegisterForPlayers((TRIGGER)S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47);
PROC_TriggerRegisterForPlayers((TRIGGER)S_END_PartyMemberAllyWRDZone_0702b359-ab9c-4f1e-98e0-6006c2d62e4d);
PROC_TriggerRegisterForParty((TRIGGER)S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0);

DB_GLO_Chandelier((ITEM)S_END_AllyHouseChandelier_001_8ab8d61e-58ca-40d9-aa05-91b21ac8b31c,(ITEM)S_END_AllyHouseHinge_001_124503f1-bedf-49a3-bbd0-e2ea3ff591fc);
KBSECTION
//REGION Debug
//Exclusively for us. Anyone else testing this should go through the debug book and use reload/save to before setting up the situation instead.
//Pair with SetGlobalOsirisFlag for precise setups or use one of the debug book options for good/bad allies configurations.
IF
TextEvent("giveallyabilities")
THEN
PROC_END_AllyAbilities_CleanPotentialSummonsDB();

IF
TextEvent("clearallgatherflags")
AND
DB_END_GatherYourAllies_PotentialCharacter(_, _, _Flag)
THEN
PROC_GlobalClearFlagAndCache(_Flag);

IF
TextEvent("SetGoodAllyFlags")
THEN
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_Volo_State_AtCamp_de1cadca-2eca-4cee-a3dc-e262bbb92277);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_OwlbearCub_State_Friend_3b963a1c-ca06-db60-75c3-063592e84dc4);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_Origin_PartOfTheTeam_Jaheira_d7d29efe-70bb-47c2-9db3-bc8a10347bc6);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)COL_TadpolingCentre_Event_ReleasePods_3e81dc65-eb2d-86aa-5163-28450894f868);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_LiftingTheCurse_State_BreathHasBeenRestored_2113b54e-a140-4aa0-97ac-219fa7b7d038);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_MurderTribunal_Event_ValeriaLeavesTribunal_57a75bf2-2648-c9f8-e75e-8366c582225e);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SteelWatchFoundry_State_GainedGondianENDSupport_1bb09a8b-001d-4b43-9f39-ba89eb3aece9);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)ORI_Astarion_State_StayedVampireSpawn_2724b881-6be1-49a7-8375-a49e9acb4546);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_ArabellaPowers_State_JergalToldToLeave_3d22614e-8762-8aec-4537-9d50abb97b23);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)WYR_WyrmRockPrison_State_FlorrickEscaped_a84a5b16-ca29-43c3-91bf-17def670ba07);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_Guildhall_State_NinefingersWillHelpEND_bdab2f3d-d878-4367-9519-c52117dcf915);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_Ravengard_State_RavengardInCamp_37309008-04cf-493c-8ca6-43034d331a8a);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_Guildhall_State_MolHelpsPlayerInEND_5c4d5b0f-a9bb-4fe0-8003-2af9213a64b0);

IF
TextEvent("SetEvilAllyFlags")
THEN
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)GLO_Volo_State_AtCamp_de1cadca-2eca-4cee-a3dc-e262bbb92277);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)END_GatherYourAllies_State_WulbrenGaveIronhandSupport_dd929cfa-685e-41d6-8e04-be2f1a14da98);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_Guildhall_State_PostCoup_ZhentControlled_bd914804-54c7-4de2-b51e-988919c2e644);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_Orthon_State_PromisedENDSupport_b412f8bc-1cc6-2ac9-058e-8a5d06e77c5a);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)CAMP_MizorasPact_State_WyllEternalPact_8da8b1fb-5aa9-8cf5-8b45-6f8ca31a1227);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_DevilishOx_State_HelpedPhasmToCity_d1498063-a466-4f43-8cb5-103baa46c753);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_DarkUrge_State_BhaalAccepted_904c45e0-bb06-40ed-b5d7-4f1c851b9d86);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)UND_KuoToaGod_State_SacrificeComplete_8716b20b-607b-494c-be58-ebd167512b9d);

IF
TextEvent("setupgather")
THEN
PROC_END_GatherYourAllies_DebugSetup();

PROC
PROC_END_GatherYourAllies_DebugSetup()
THEN
TriggerUnregisterForPlayers(S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47);	//In case it is still registered.
Resurrect(S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d);
DB_END_GatherYourAllies_FlamingFistAlive(1);

PROC
PROC_END_GatherYourAllies_DebugSetup()
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
THEN
NOT DB_END_GatherYourAllies_PresentCharacter(_Character);
DB_END_GatherYourAllies_DebugRemoveCharacter(_Character);
SetOnStage(_Character, 0);

PROC
PROC_END_GatherYourAllies_DebugSetup()
THEN
ClearFlag((FLAG)END_GatherYourAllies_State_PlayerHasMoreEvilAllies_acea9be9-780d-db23-e5a5-9361a19eb9a9, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag((FLAG)END_GatherYourAllies_State_NoAlliesPresent_fce77c88-3045-4292-9028-079c391d5a19, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_END_GatherYourAllies_DebugSetup()
THEN
PROC_END_GatherYourAllies_InitFactionFlags();

IF
WentOnStage(_Character, 0)
AND
DB_END_GatherYourAllies_DebugRemoveCharacter(_Character)
THEN
NOT DB_END_GatherYourAllies_DebugRemoveCharacter(_Character);

PROC
PROC_END_GatherYourAllies_DebugSetup()
THEN
DB_END_GatherYourAllies_CheckDebugReady(1);

//Only re-start setup when all characters that were previously there were successfully cleared.
IF
DB_END_GatherYourAllies_CheckDebugReady(1)
AND
NOT DB_END_GatherYourAllies_DebugRemoveCharacter(_)
THEN
NOT DB_END_GatherYourAllies_CheckDebugReady(1);
PROC_END_GatherYourAllies_Setup();

//Debug to transform Nightsong in the event she is brought directly with the spell while skipping normal setup.
IF
EnteredLevel((CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, "END_Main")
AND
NOT DB_END_GatherYourAllies_TransformNightsong(1)
THEN
DB_END_GatherYourAllies_TransformNightsong(1);
PROC_GLO_Nightsong_GiveNightsongEquipment();

//Debug to transform Owlbear in the event it is brought directly with the spell while skipping normal setup.
IF
EnteredLevel((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, _, "END_Main")
AND
NOT DB_END_GatherYourAllies_TransformOwlbear(1)
THEN
DB_END_GatherYourAllies_TransformOwlbear(1);
ApplyStatus(S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, "END_ALLYBUFF_OWLBEARPOLYMORPH", -1.0);

IF
StatusApplied((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, "END_ALLYBUFF_OWLBEARENRAGE", _, _)
AND
NOT DB_END_GatherYourAllies_RemoveRage(1)
THEN
DB_END_GatherYourAllies_RemoveRage(1);
RemoveStatus(S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, "END_ALLYBUFF_OWLBEARENRAGE", S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09);

IF
StatusApplied((CHARACTER)S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "ANIM_COWER", _, _)
AND
NOT DB_END_GatherYourAllies_UncowerArabella(1)
THEN
DB_END_GatherYourAllies_UncowerArabella(1);
RemoveStatus(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "ANIM_COWER", S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f);
//END_REGION

//REGION INIT
PROC
PROC_END_GatherYourAllies_InitFactionFlags()
THEN
//Good
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_Volo_State_AtCamp_de1cadca-2eca-4cee-a3dc-e262bbb92277);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_OwlbearCub_State_Friend_3b963a1c-ca06-db60-75c3-063592e84dc4);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_Origin_PartOfTheTeam_Jaheira_d7d29efe-70bb-47c2-9db3-bc8a10347bc6);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)COL_TadpolingCentre_Event_ReleasePods_3e81dc65-eb2d-86aa-5163-28450894f868);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)GLO_LiftingTheCurse_State_BreathHasBeenRestored_2113b54e-a140-4aa0-97ac-219fa7b7d038);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_MurderTribunal_Event_ValeriaLeavesTribunal_57a75bf2-2648-c9f8-e75e-8366c582225e);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SteelWatchFoundry_State_GainedGondianENDSupport_1bb09a8b-001d-4b43-9f39-ba89eb3aece9);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)ORI_Astarion_State_StayedVampireSpawn_2724b881-6be1-49a7-8375-a49e9acb4546);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_ArabellaPowers_State_JergalToldToLeave_3d22614e-8762-8aec-4537-9d50abb97b23);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)WYR_WyrmRockPrison_State_FlorrickEscaped_a84a5b16-ca29-43c3-91bf-17def670ba07);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_Guildhall_State_NinefingersWillHelpEND_bdab2f3d-d878-4367-9519-c52117dcf915);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)CAMP_Ravengard_State_RavengardInCamp_37309008-04cf-493c-8ca6-43034d331a8a);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)LOW_Guildhall_State_MolHelpsPlayerInEND_5c4d5b0f-a9bb-4fe0-8003-2af9213a64b0);
//Evil
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)GLO_Volo_State_AtCamp_de1cadca-2eca-4cee-a3dc-e262bbb92277);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)END_GatherYourAllies_State_WulbrenGaveIronhandSupport_dd929cfa-685e-41d6-8e04-be2f1a14da98);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_Guildhall_State_PostCoup_ZhentControlled_bd914804-54c7-4de2-b51e-988919c2e644);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_Orthon_State_PromisedENDSupport_b412f8bc-1cc6-2ac9-058e-8a5d06e77c5a);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)CAMP_MizorasPact_State_WyllEternalPact_8da8b1fb-5aa9-8cf5-8b45-6f8ca31a1227);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_DevilishOx_State_HelpedPhasmToCity_d1498063-a466-4f43-8cb5-103baa46c753);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac);
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)ORI_DarkUrge_State_BhaalAccepted_904c45e0-bb06-40ed-b5d7-4f1c851b9d86);
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)END_GatherYourAllies_Event_KuotoaPromisedENDSupport_099fbdae-4e4f-eecd-6747-8d5a9f59fe22);

//Clear DB entry if a character is permadefeated when goal is loaded.
IF
DB_END_GatherYourAllies_PotentialCharacter(_Character, _Trigger, _Flag)
AND
DB_PermaDefeated(_Character)
THEN
NOT DB_END_GatherYourAllies_PotentialCharacter(_Character, _Trigger, _Flag);

IF
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, _Trigger, _Flag)
AND
DB_PermaDefeated(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79)
THEN
NOT DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, _Trigger, _Flag);

IF
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_GLO_Wulbren_2d70edbf-1a70-4047-8099-48f3e75d93bf, _Trigger, _Flag)
AND
NOT DB_GlobalFlag(LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46)
AND
DB_GlobalFlag(LOW_SteelWatchFoundry_State_GainedIronhandENDSupport_a090a831-c695-4478-8d0d-84661deabb98)
THEN
SetFlag(END_GatherYourAllies_State_BarcusGaveIronhandSupport_dd929cfa-685e-41d6-8e04-be2f1a14da98);

//END_REGION

//REGION Setup
IF
EnteredTrigger(_, (TRIGGER)S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47)
THEN
TriggerUnregisterForPlayers(S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47);
PROC_END_GatherYourAllies_Setup();

//check the two DBs of flag categories ("good" and "bad")
PROC
PROC_END_GatherYourAllies_Setup()
AND
DB_END_GatherYourAllies_GoodAllyFlags((FLAG)_GoodFlag)
AND
NOT DB_GlobalFlag(_GoodFlag)
THEN
NOT DB_END_GatherYourAllies_GoodAllyFlags(_GoodFlag);

PROC
PROC_END_GatherYourAllies_Setup()
AND
DB_END_GatherYourAllies_EvilAllyFlags((FLAG)_EvilFlag)
AND
NOT DB_GlobalFlag(_EvilFlag)
THEN
NOT DB_END_GatherYourAllies_EvilAllyFlags(_EvilFlag);

//compare the two integers in the opposing flagged DBs
PROC
PROC_END_GatherYourAllies_Setup()
AND
SysCount("DB_END_GatherYourAllies_GoodAllyFlags", 1, _GoodCount)
AND
SysCount("DB_END_GatherYourAllies_EvilAllyFlags", 1, _EvilCount)
AND
_EvilCount > _GoodCount
THEN
SetFlag((FLAG)END_GatherYourAllies_State_PlayerHasMoreEvilAllies_acea9be9-780d-db23-e5a5-9361a19eb9a9);

//check for no ally flags set
PROC
PROC_END_GatherYourAllies_Setup()
AND
SysCount("DB_END_GatherYourAllies_GoodAllyFlags", 1, _GoodCount)
AND
SysCount("DB_END_GatherYourAllies_EvilAllyFlags", 1, _EvilCount)
AND
_EvilCount == 0
AND
_GoodCount == 0
THEN
SetFlag((FLAG)END_GatherYourAllies_State_NoAlliesPresent_fce77c88-3045-4292-9028-079c391d5a19);

PROC
PROC_END_GatherYourAllies_Setup()
THEN
CharacterDisableCrime((CHARACTER)S_LOW_MurderTribunal_Sarevok_ae9f784a-ea64-4297-95a7-8377e85231b6, "LOW_MurderTribunal_Trespass");

PROC
PROC_END_GatherYourAllies_Setup()
THEN
PROC_END_GatherYourAllies_PlaceCharacters();

//If no characters have been placed at the end of the setup, kill flaming fist.
PROC
PROC_END_GatherYourAllies_Setup()
AND
NOT DB_END_GatherYourAllies_FlamingFistAlive(1)
THEN
TeleportTo((CHARACTER)S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d, (TRIGGER)S_END_GatherEntrancePoint_4f34b0e2-c6fb-4fc7-b552-30566581ab56);
Die((CHARACTER)S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d, DEATHTYPE.Physical, 0);

PROC
PROC_END_GatherYourAllies_Setup()
AND
NOT DB_END_GatherYourAllies_FlamingFistAlive(1)
AND
DB_END_GatherYourAllies_PotentialCharacter(_, _, (FLAG)_PotentialFlag)
AND
DB_GlobalFlag(_PotentialFlag)
AND
DB_END_GatherYourAllies_PartyAllies(_PotentialFlag)
AND
NOT QRY_END_GatherYourAllies_OtherAlliesPresent()
AND
NOT DB_END_GatherYourAllies_PartyOnly(1)
THEN
DB_END_GatherYourAllies_PartyOnly(1);
SetFlag((FLAG)END_GatherYourAllies_State_OnlyPartyAllies_562c1ba7-5715-e45f-20b6-d2430d5984d5);

QRY
QRY_END_GatherYourAllies_OtherAlliesPresent()
AND
DB_END_GatherYourAllies_PresentCharacter((CHARACTER)_Character)
AND
DB_END_GatherYourAllies_PotentialCharacter(_Character, _, (FLAG)_PresenceFlag)
AND
NOT DB_END_GatherYourAllies_PartyAllies(_PresenceFlag)
THEN
DB_NOOP(1);

PROC
PROC_LOW_MurderTribunal_TryTrialDialog((CHARACTER)_PartyMember)
THEN
ObjectTimerCancel(_PartyMember,"LOW_MurderTribunal_Court_SpottedInvalid");
//END_REGION

//REGION Place Characters
PROC
PROC_END_GatherYourAllies_PlaceCharacters()
THEN
PROC_RemoveAllDialogEntriesForSpeaker((CHARACTER)S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
TeleportTo(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, (TRIGGER)S_END_WithersPoint_b71a50a8-00b9-4fa9-b067-83be0672a0fe);
SetOnStage(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);
DB_Dialogs(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, (DIALOGRESOURCE)END_GatherYourAllies_WithersFollowUp_8ad51e88-b148-0813-f2f8-f21360853888);

PROC
PROC_END_GatherYourAllies_PlaceCharacters()
AND
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, (TRIGGER)_Trigger, (FLAG)_Flag)
AND
DB_PermaDefeated((CHARACTER)S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79)
THEN
NOT DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, (TRIGGER)_Trigger, (FLAG)_Flag);

PROC
PROC_END_GatherYourAllies_PlaceCharacters()
AND
DB_END_GatherYourAllies_PotentialCharacter((CHARACTER)_Character, (TRIGGER)_Trigger, (FLAG)_Flag)
AND
NOT DB_PartyMembers(_Character)	//Cancel setup for characters in player's party.
AND
DB_GlobalFlag(_Flag)
AND
DB_END_GatherYourAllies_FollowUpDialogue(_Character, _Dialog, _AnubisConfig)
THEN
PROC_END_GatherYourAllies_SetupCharacter(_Character, _Trigger, _Dialog, _AnubisConfig);

PROC
PROC_END_GatherYourAllies_SetupCharacter((CHARACTER)_Character, (TRIGGER)_Trigger, (DIALOGRESOURCE)_Dialog, (STRING)_AnubisConfig)
THEN
SetCombatGroupID(_Character, "");
DB_END_GatherYourAllies_PresentCharacter(_Character);
PROC_RemoveAllDialogEntriesForSpeaker(_Character);
DB_Dialogs(_Character, _Dialog);
AppearAt(_Character, _Trigger, 0, NULL_00000000-0000-0000-0000-000000000000, "END_GatherYourAllies_TeleportedAlly", 0);
LookFromTrigger(_Character, _Trigger, 1);
SetFaction(_Character, (FACTION)ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f);
PROC_SetAnubisConfig(_Character, _AnubisConfig);

//A single setup character keeps the flaming fist alive.
PROC
PROC_END_GatherYourAllies_SetupCharacter((CHARACTER)_Character, (TRIGGER)_Trigger, (DIALOGRESOURCE)_Dialog, (STRING)_AnubisConfig)
AND
NOT DB_END_GatherYourAllies_FlamingFistAlive(1)
THEN
DB_END_GatherYourAllies_FlamingFistAlive(1);

//END_REGION

//REGION Character-specific logic

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _)
THEN
SetCanJoinCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);
SetCanFight(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _)
THEN
SetCanJoinCombat(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
SetCanFight(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _)
AND
NOT DB_END_GatherYourAllies_TransformNightsong(1)
THEN
ApplyStatus((CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "TUT_RESTORATION", 6.0, 1, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_END_GatherYourAllies_TransformNightsong(1);
PROC_GLO_Nightsong_GiveNightsongEquipment();

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, _, _, _)
AND
NOT DB_END_GatherYourAllies_TransformOwlbear(1)
THEN
DB_END_GatherYourAllies_TransformOwlbear(1);
ApplyStatus((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, "END_ALLYBUFF_OWLBEARPOLYMORPH", -1.0);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _)
THEN
SetCanJoinCombat(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1);
SetCanFight(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Wyll_Cambion_491a7686-3081-405b-983c-289ec8781e0a, _, _, _)
THEN
ApplyStatus(S_GLO_Wyll_Cambion_491a7686-3081-405b-983c-289ec8781e0a,"MAGE_ARMOR",-1.0,1,S_GLO_Wyll_Cambion_491a7686-3081-405b-983c-289ec8781e0a);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c, _, _, _)
THEN
ClearTag(S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c,ACT3_HOH_ORTHON_SPELL_LIMIT_5f13326a-be94-4ca9-926b-8d6bec318ab0);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56, _, _, _)
THEN
SetLevel((CHARACTER)S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56, 11);
RemoveStatus((CHARACTER)S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56, "HAV_PHASM_OX_DISGUISE_ACT1", S_GLO_DevilishOx_49eb5b4b-c6ed-4d37-8f68-97b1128b7d56);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d,"LOW_HAG_MAGICRESISTANCE");
SetImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d,0);

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
AND
DB_SceneManager(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d,_HagScene)
THEN
PROC_SceneOver(_HagScene);
//END_REGION

//REGION Put clothes on naked companions
PROC
PROC_END_GatherYourAllies_SetupCharacter((CHARACTER)_Character, (TRIGGER)_Trigger, (DIALOGRESOURCE)_Dialog, (STRING)_AnubisConfig)
AND
DB_END_GatherYourAllies_PartyAlly_Clothes(_Character, _ClothesRoot)
THEN
PROC_END_GatherYourAllies_PartyAlly_CheckClothes(_Character);

PROC
PROC_END_GatherYourAllies_PartyAlly_CheckClothes((CHARACTER)_Character)
AND
NOT QRY_END_GatherYourAllies_PartyAlly_FallbackToArmor(_Character)
AND
NOT QRY_END_GatherYourAllies_PartyAlly_FallbackToVanityClothes(_Character)
THEN
PROC_END_GatherYourAllies_PartyAlly_GiveVanityClothes(_Character);

QRY
QRY_END_GatherYourAllies_PartyAlly_FallbackToArmor((CHARACTER)_Character)
AND
QRY_GetEquippedItem(_Character, "Breast")
THEN
PROC_SetArmourSet(_Character, ARMOURSET.Normal);

QRY
QRY_END_GatherYourAllies_PartyAlly_FallbackToVanityClothes((CHARACTER)_Character)
AND
QRY_GetEquippedItem(_Character, "VanityBody")
THEN
PROC_SetArmourSet(_Character, ARMOURSET.Vanity);

PROC
PROC_END_GatherYourAllies_PartyAlly_GiveVanityClothes((CHARACTER)_Character)
AND
DB_END_GatherYourAllies_PartyAlly_Clothes(_Character, _ClothesRoot)
AND
CreateAtObject(_ClothesRoot, _Character, 0, 0, "", 0, _Clothes)
THEN
Equip(_Character, (ITEM)_Clothes, 1, 0, 1);
PROC_SetArmourSet(_Character, ARMOURSET.Vanity);
//END_REGION

//REGION Add Speakers to dialogue
IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0)
AND
DB_Players(_Player)
THEN
PROC_TriggerUnregisterForParty(S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0);
PROC_TriggerRegisterForPlayers((TRIGGER)S_END_AlliesExitArea_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8);
PROC_END_GatherYourAllies_PriorizeAvatarSupport(_Player);

PROC
PROC_END_GatherYourAllies_PriorizeAvatarSupport((CHARACTER)_Player)
AND
DB_END_General_MainDialogAnchor(_Player)
THEN
DB_END_GatherYourAllies_SupportDialogStarting(1);
PROC_END_GatherYourAllies_StartSupportDialogue(_Player);

PROC
PROC_END_GatherYourAllies_PriorizeAvatarSupport((CHARACTER)_Player)
AND
DB_Avatars(_Player)
AND
NOT DB_END_GatherYourAllies_SupportDialogStarting(1)
THEN
DB_END_GatherYourAllies_SupportDialogStarting(1);
PROC_END_GatherYourAllies_StartSupportDialogue(_Player);

//Fetch nearest Avatar
PROC
PROC_END_GatherYourAllies_PriorizeAvatarSupport((CHARACTER)_Player)
AND
GetClosestPlayer(_Player, _Avatar, 10.0)
AND
DB_Avatars(_Avatar)
AND
DB_InRegion(_Avatar, S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47)
AND
NOT DB_END_GatherYourAllies_SupportDialogStarting(1)
AND
NOT DB_Defeated(_Avatar)
THEN
DB_END_GatherYourAllies_SupportDialogStarting(1);
PROC_END_GatherYourAllies_StartSupportDialogue(_Avatar);

PROC
PROC_END_GatherYourAllies_PriorizeAvatarSupport((CHARACTER)_Player)
AND
GetClosestPlayer(_Player, _Avatar, 10.0)
AND
DB_Avatars(_Avatar)
AND
NOT DB_END_GatherYourAllies_SupportDialogStarting(1)
AND
NOT DB_Defeated(_Avatar)
THEN
DB_END_GatherYourAllies_SupportDialogStarting(1);
PROC_END_GatherYourAllies_StartSupportDialogue(_Avatar);

PROC
PROC_END_GatherYourAllies_PriorizeAvatarSupport((CHARACTER)_Player)
AND
NOT DB_END_GatherYourAllies_SupportDialogStarting(1)
THEN
PROC_END_GatherYourAllies_StartSupportDialogue(_Player);

PROC
PROC_END_GatherYourAllies_StartSupportDialogue((CHARACTER)_Player)
AND
DB_Players(_Player)
AND
DB_GlobalFlag((FLAG)END_GatherYourAllies_State_NoAlliesPresent_fce77c88-3045-4292-9028-079c391d5a19)
AND
QRY_StartDialogCustom((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Player, 0, 0, 0, 0)
THEN
DB_NOOP(1);

PROC
PROC_END_GatherYourAllies_StartSupportDialogue((CHARACTER)_Player)
AND
DB_Players(_Player)
AND
DB_PermaDefeated((CHARACTER)S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d)
AND
QRY_StartDialogCustom((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Player, 0, 0, 0, 0)
THEN
DB_NOOP(1);

PROC
PROC_END_GatherYourAllies_StartSupportDialogue((CHARACTER)_Player)
AND
DB_Players(_Player)
AND
NOT DB_GlobalFlag((FLAG)END_GatherYourAllies_State_NoAlliesPresent_fce77c88-3045-4292-9028-079c391d5a19)
AND
QRY_StartDialogCustom((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (CHARACTER)S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d, (CHARACTER)S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Player, 0, 0, 0, 0)
THEN
DB_NOOP(1);

PROC
PROC_StartDialog_AddExtraSpeakers(END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (INTEGER)_ID)
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
THEN
PROC_DialogAddSpeakingActor(_ID, _Character, 0, 1); // 1 to place Steel Watcher in its slot with a speaker group

PROC
PROC_StartDialog_AddExtraSpeakers(END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (INTEGER)_ID)
AND
DB_PartyMembers((CHARACTER)_Character)
AND
IsInTrigger(_Character, S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0, 1)
THEN
PROC_DialogAddSpeakingActor(_ID, _Character);

PROC
PROC_StartDialog_AddExtraSpeakers(END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (INTEGER)_ID)
AND
DB_END_General_PartyMindFlayer((CHARACTER)_Mindflayer)
AND
NOT DB_Avatars(_Mindflayer)
AND
CharacterGetOwner(_Mindflayer, _MindflayerOwner)
AND
DialogFindReservedSpeakerSlot(_ID, _Mindflayer, _SpeakerSlot)
AND
_SpeakerSlot != -1
AND
IsInTrigger(_MindflayerOwner, S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0, 1)
AND
QRY_SpeakerIsAvailable(_Mindflayer)
THEN
PROC_DialogAddSpeakingActorAt(_ID, _Mindflayer, _SpeakerSlot);

PROC
PROC_StartDialog_AddExtraSpeakers(END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (INTEGER)_ID)
AND
DB_END_General_PartyMindFlayer((CHARACTER)_Mindflayer)
AND
NOT DB_Avatars(_Mindflayer)
AND
NOT DB_DialogNPCs(_ID, _Mindflayer, _)
AND
CharacterGetOwner(_Mindflayer, _MindflayerOwner)
AND
IsInTrigger(_MindflayerOwner, S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0, 1)
AND
QRY_SpeakerIsAvailable(_Mindflayer)
THEN
PROC_DialogAddListeningActor(_ID, _Mindflayer);

PROC
PROC_StartDialog_AddExtraSpeakers(END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, (INTEGER)_ID)
AND
DB_PartyMembers((CHARACTER)S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b)
AND
SysCount("DB_Avatars", 1, _NumAvatars)
AND
_NumAvatars == 1
AND
NOT DB_DialogNPCs(_ID, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _)
AND
CharacterGetOwner(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _MindflayerOwner)
AND
IsInTrigger(_MindflayerOwner, S_END_PartyMemberTeleport_b8d5ff34-ccc2-425c-a712-172497273dc0, 1)
AND
QRY_SpeakerIsAvailable(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b)
THEN
PROC_DialogAddSpeakingActor(_ID, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);

IF
DialogEnded((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, _)
AND
DB_Avatars((CHARACTER)_Origins)
AND
DB_END_GatherYourAllies_PotentialCharacter(_Origins, _, (FLAG)_PresenceFlag)
AND
DB_GlobalFlag(_PresenceFlag)
AND
DB_END_GatherYourAllies_AllyAwardFlags((FLAG)_AbilityFlag, _Origins)
AND
NOT DB_GlobalFlag(_AbilityFlag)
THEN
SetFlag(_AbilityFlag);

IF
DialogStarted((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, _ID)
THEN
DB_END_GatherYourAllies_GatheredAllies(_ID);

IF
DialogStarted((DIALOGRESOURCE)END_GatherYourAllies_GatheredAllies_52f087e3-36b0-8372-d473-837bb6a78079, _ID)
AND
DB_PartyMembers((CHARACTER)S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b)
AND
NOT DB_DialogNPCs(_ID, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _)
AND
CharacterGetOwner((CHARACTER)S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _EmperorOwner)
AND
DB_Players(_EmperorOwner)
AND
DB_DialogPlayers(_ID, _EmperorOwner, _)
THEN
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_PartyAlliesPoint_09649239-c078-43c2-a9b6-3c370e8a09bf);

IF
DB_GlobalFlag((FLAG)_Flag)
AND
DB_END_GatherYourAllies_AllyAwardFlags(_Flag, _)
AND
_Flag != END_VossEncounter_Event_GithReinforcementsAwarded_b5147ee9-ec6e-461e-8849-7d9af26c3d54
AND
DB_END_GatherYourAllies_GatheredAllies(_ID)
AND
DB_DialogSpeakers(_ID, _Player, 3)
AND
DB_Players((CHARACTER)_Player) 
THEN
TeleportTo(_Player, (TRIGGER)S_END_PartyAlliesPoint_09649239-c078-43c2-a9b6-3c370e8a09bf);
NOT DB_END_GatherYourAllies_GatheredAllies(_ID);

IF
DB_DialogSpeakers(_ID, _Player, 3)
AND
DB_END_GatherYourAllies_GatheredAllies(_ID)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GlobalFlag((FLAG)END_GatherYourAllies_State_NoAlliesPresent_fce77c88-3045-4292-9028-079c391d5a19)
THEN
Open(DOOR_Double_Slim_City_House_B_001_5f9c9388-56fc-4d25-8ec7-0df4081a7835);
TeleportTo(_Player, (TRIGGER)S_END_PartyAlliesPoint_09649239-c078-43c2-a9b6-3c370e8a09bf);
NOT DB_END_GatherYourAllies_GatheredAllies(_ID);

IF
BaseFactionChanged((CHARACTER)_Character, (FACTION)ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f, (FACTION)ACT3_END_AllyAbilities_Summon_ab4018cf-9f02-48aa-9c52-469b279c651a)
AND
NOT DB_END_GatherYourAllies_CharacterExodus(_)
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
AND
DB_END_AllyAbilities_Summons(_, _, _Character, _)
THEN
SetFaction(_Character, ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f);
//END_REGION

//REGION Remove characters when done
IF
DB_GlobalFlag((FLAG)_Flag)
AND
DB_END_GatherYourAllies_AllyAwardFlags(_Flag, _)
THEN
DB_END_GatherYourAllies_GrantedAwards(_Flag);

IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_END_AlliesExitArea_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8)
AND
DB_END_AllyAbilities_Summons(_, _, _Summon, _)
THEN
PROC_CharacterDisableAllCrimes(_Summon);

IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_END_AlliesExitArea_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8)
AND
DB_Players(_Player)
THEN
ApplyStatus((CHARACTER)S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09, "END_ALLYBUFF_OWLBEARENRAGE", -1.0, 1, S_FOR_OwlBear_Cub_001_c66b2865-6613-4372-b97a-e330c1d75d09);
DB_END_GatherYourAllies_CharacterExodus(1);
SetFlag((FLAG)END_GatherYourAllies_State_BeyondHirelings_7b3f93f8-274d-4803-a9bc-5023590c91c4, _Player);
TriggerUnregisterForCharacter(S_END_AlliesExitArea_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8, _Player);

IF
DB_END_GatherYourAllies_CharacterExodus(1)
AND
DB_END_GatherYourAllies_PresentCharacter((CHARACTER)_Character)
AND
DB_END_AllyAbilities_Summons(_, _, _Character, _)
THEN
SetFaction(_Character, (FACTION)ACT3_END_AllyAbilities_Summon_ab4018cf-9f02-48aa-9c52-469b279c651a);

IF
DB_END_GatherYourAllies_CharacterExodus(1)
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
AND
NOT DB_DialogNPCs(_, _Character, _)
THEN
PROC_END_GatherYourAllies_CharacterExodus(_Character);

PROC
PROC_END_GatherYourAllies_CharacterExodus((CHARACTER)_Character)
AND
_Character != S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b
THEN
PROC_DisappearOutOfSightTo(_Character, (TRIGGER)S_END_CharacterExitPoint_8a5cd47d-1e17-42ed-bb8e-26a70680c36a, "Run", 1, "");

PROC
PROC_CharacterRegisterCrime_Success(_Player, _CrimeType, _StoryActionID, _Evidence, S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _CrimeID)
AND
QRY_CRIME_IsCrimeFamilyMember(_CrimeType, "Steal")
THEN
PROC_END_GatherYourAllies_IgnoreTheft(_CrimeID);

PROC
PROC_END_GatherYourAllies_IgnoreTheft((INTEGER)_CrimeID)
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
THEN
CrimeIgnoreCrime(_CrimeID, _Character);

PROC
PROC_END_GatherYourAllies_IgnoreTheft((INTEGER)_CrimeID)
THEN
CrimeIgnoreCrime(_CrimeID, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
CrimeIgnoreCrime(_CrimeID, S_END_FlamingFist003_64dff07f-d65e-4bc1-bba2-87dfb921178d);

IF
CharacterOnCrimeSensibleActionNotification(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _, _CrimeID, _, _, _Player, _, _, _, _)
AND
CrimeGetType(_CrimeID, _CrimeType)
AND
QRY_CRIME_IsCrimeFamilyMember(_CrimeType, "Steal")
THEN
CharacterStopCrimeWithID(_Player, _CrimeID);
PROC_Poof(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981);
TriggerClearItemsOwner(S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4);

PROC
PROC_END_GatherYourAllies_CharacterExodus(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b)
THEN
UseSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Target_Invisibility", S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
DB_END_GatherYourAllies_CharacterExodus(1)
AND
DB_END_GatherYourAllies_PresentCharacter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b)
AND
NOT DB_DialogNPCs(_, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _)
THEN
UseSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Target_Invisibility", S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
CastedSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Target_Invisibility", _, _, _)
THEN
SetOnStage(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 0);
PROC_DisappearOutOfSightTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, (TRIGGER)S_END_CharacterExitPoint_8a5cd47d-1e17-42ed-bb8e-26a70680c36a, "Run", 1, "");
//END_REGION

//REGION Making allies hostile
IF
RelationChanged((FACTION)ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f, (FACTION)_Hero, 0, _)
AND
DB_AvatarFactions(_Hero)
AND
DB_Players((CHARACTER)_Player)
AND
HasSpell(_Player, "Shout_END_AllyAbilities_MultipleSummon", 1)
THEN
RemoveSpell(_Player, "Shout_END_AllyAbilities_MultipleSummon", 1);
//END_REGION

//REGION ADs
IF
EnteredTrigger((CHARACTER)_Player, (TRIGGER)S_END_HighHallCarnageADs_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8)
AND
DB_Players(_Player)
THEN
PROC_TriggerUnregisterForPlayers(S_END_HighHallCarnageADs_d70ddde8-3aa6-4167-b9d7-eeea5d7f0fc8);

//END_REGION

//REGION Ethel can't fight

PROC
PROC_END_GatherYourAllies_SetupCharacter(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
THEN
SetCanJoinCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);
SetCanFight(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);

IF
RelationChanged(ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, _)
AND
DB_END_GatherYourAllies_PresentCharacter(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d)
THEN
PROC_Poof(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, (EFFECTRESOURCE)VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);

//END_REGION

//REGION Block non-violent crimes
IF
ItemEnteredTrigger((ITEM)_Item, S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4, _)
AND
NOT DB_END_KossLooseItems(_Item)
AND
GetOwner(_Item, (CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981)
THEN
DB_END_KossLooseItems(_Item);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, (STRING)_Crime, (ITEM)_Item, (CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _)
AND
DB_END_KossLooseItems(_Item)
AND
IsInTrigger(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, (TRIGGER)S_END_GuardHouse_SUB_465cc4f7-f6ae-4383-a96f-409b18453419, 1)
AND
QRY_END_GatherYourAllies_IsRelevantCrime(_Crime)
THEN
NOT DB_END_KossLooseItems(_Item);
PROC_END_GatherYourAllies_ChangeAttitude(_Player, _Crime);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, (STRING)_Crime, _, (CHARACTER)_Ally, _)
AND
DB_END_GatherYourAllies_PresentCharacter(_Ally)
AND
IsInTrigger(_Ally, (TRIGGER)S_END_GuardHouse_SUB_465cc4f7-f6ae-4383-a96f-409b18453419, 1)
AND
QRY_END_GatherYourAllies_IsRelevantCrime(_Crime)
THEN
AddAttitudeTowardsPlayer(_Ally, _Player, -5);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, "VandaliseNoOwner", (GUIDSTRING)_Vandalised, (CHARACTER)NULL_00000000-0000-0000-0000-000000000000, _)
AND
IsInTrigger(_Vandalised, (TRIGGER)S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47, 1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, "PickPocketFailed", _, (CHARACTER)_Pickpocketed, _)
AND
IsInTrigger(_Pickpocketed, (TRIGGER)S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47, 1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Player, "PickPocketFailed", _, (CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _)
AND
IsInTrigger(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, (TRIGGER)S_END_GatherYourAllies_SUB_6651c6b2-90b2-4380-90f1-7cfd4f5f5c47, 1)
THEN
AddAttitudeTowardsPlayer(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _Player, -20);


QRY
QRY_END_GatherYourAllies_IsRelevantCrime((STRING)_Crime)
AND
_Crime != "END_GatherYourAllies_PettyCrime"
AND
NOT QRY_CRIME_IsCrimeFamilyMember(_Crime, "Assault")
AND
NOT QRY_CRIME_IsCrimeFamilyMember(_Crime, "Murder")
AND
NOT QRY_CRIME_IsCrimeFamilyMember(_Crime, "AssaultRelated")
AND
NOT QRY_CRIME_IsCrimeFamilyMember(_Crime, "Vandalise")
THEN
DB_NOOP(1);

PROC
PROC_END_GatherYourAllies_ChangeAttitude((CHARACTER)_Player, (STRING)_Crime)
AND
QRY_CRIME_CanSeeCriminal(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _Player)
AND
CharacterRegisterCrime(_Player, "END_GatherYourAllies_PettyCrime", NULL_00000000-0000-0000-0000-000000000000, S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, 0, 1)
THEN
AddAttitudeTowardsPlayer(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _Player, -20);

PROC
PROC_END_GatherYourAllies_ChangeAttitude((CHARACTER)_Player, (STRING)_Crime)
AND
GetAttitudeTowardsPlayer((CHARACTER)S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, _Player, (INTEGER)_Attitude)
AND
IsOnStage(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, 1)
AND
_Attitude < -30
THEN
PROC_Poof(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981);
TriggerClearItemsOwner((TRIGGER)S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4);
PROC_ItemShopTrigger_Delete(S_END_KossOwnershipBox_c9525524-4ee2-4679-8ae0-e64bda1defa4);

IF
WentOnStage(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, 0)
AND
DB_END_KossLooseItems(_Item)
THEN
PROC_Poof(_Item);

IF
WentOnStage(S_END_CircusTrader_c94a8e45-b601-4193-bb6a-aed77692c981, 0)
AND
DB_END_GatherYourAllies_PresentCharacter(_Character)
AND
GetFaction(_Character, _Faction)
AND
_Faction != ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f
THEN
SetFaction(_Character, (FACTION)ACT3_END_GatheredAllies_4bc4ab0d-e405-4559-9ab6-f58feab2160f);
//END_REGION

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3c"
