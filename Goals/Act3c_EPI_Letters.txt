Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Letterbox

DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_IsobelNightsong_5c47e3d7-1246-4f26-a9b5-d56670fb5afc);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_BarcusLeader_5c5f9fbf-0bce-4eb0-96fc-60775648c8e9);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ArtCullagh_a4b1b5db-107f-47c6-8dbe-2f5694dd08be);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ValeriaDevellaAlive_97ac3b36-f12e-4f18-aa1b-ab37e6a3a625);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DammonKarlachAvatar_d0de24c8-2df4-4375-9ce4-494ae72ef593);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Kagha_b1c618ef-0f86-428b-a2d8-bf38333a9bf9);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ShadowheartMother_b52ec84b-dbff-400d-91e2-048d425427c2);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ShadowheartFather_3413d837-5a33-4195-a2bb-04729a1ce604);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Nocturne_e3d81d8e-0d72-4e80-81c8-9e92da12fce9);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Viconia_7b5aedce-1374-426c-b0b3-0fdcfc47fdd9);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Haarlep_067f509b-03e8-4058-b536-2c5df123397d);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DukeRavenguard_dd22571a-25ea-48b5-bb77-32360c355157);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_HalsinShadowcurse_a097bd29-f9d1-488e-86a1-ce0600b56c31);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_VossOrpheusAlive_147b3c9c-e054-4b85-ba0c-49ba6e4ee67c);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_AlfiraAtElfsong_4b3f1501-b966-4569-bdcd-4587c54243fd);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Arabella_8b1d0291-180f-4f6d-87de-2ded16dc32c4);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_EttvardNeedle_586a6029-e5d0-47af-8e07-1be8cf2a139f);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Araj_4be6ccf0-11bf-4c07-b57f-74343e42260f);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DevellaDU_01f67b27-0083-49d2-baa0-1fcf4c630b60);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DevellaValeriaAlive_f7a56f65-aea9-4de6-a693-6054122fc01b);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DevellaValeriaDead_6fcd7f3c-276f-4f4a-8305-7fbd71b63a3d);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Sebastian_511fcb43-42a2-47c9-9c0d-62029a9ee99c);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Florrick_bb48516f-cc8d-4cb7-806d-fa5dfeb961d6);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_UlmaGur_1f51fc46-cb35-4a63-b4a0-045e51aa591a);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Sarevok_b1ac7e8b-2640-42cc-bfbd-2afead1f9cb9);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ElminsterGaleGod_f8184fd9-fdc9-4e18-8f47-4b66ab9f4351);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_AlfiraAndLakrissa_0c07c8d3-3b26-44ad-bd04-22d85e6b936a);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_AlfiraDUSaved_33d08041-5581-4d26-8b76-92c13ca2b643);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_BarcusRejected_1d7735a8-7529-455d-b28e-d785e09fe1b7);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DammonKarlachComp_cf300cca-153a-44c4-a347-5cc7bbed6e90);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_DammonKarlachDead_82179ce0-263e-466e-b786-fefe00713438);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ElminsterGaleWaterdeep_9445cd48-a46e-4b86-a862-599fc6e5db01);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ElminsterGale_9b617ba6-e927-40af-b2f1-bea1483608c0);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_NightsongAlone_d5ea9fd4-6538-46d6-8aa4-3688466e8bfe);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_NightsongTrapped_2ef64221-5c93-4f46-8a6a-29add07cdf21);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_NocturneTurnedFrom_d6bc1f90-611b-4d3a-a054-4e94879f519a);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ValeriaDevellaDead_c874a51a-71f3-44c8-8d43-532bdf918d07);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_ValeriaDevellaNotMet_1e841e73-328f-48ac-8f95-a84ff7466314);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_VossOrpheusDead_418411e0-6e20-4911-9e1c-b6f240fb7cd8);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Hope_ae0ffd5f-b7ef-43f5-9375-d75dd8e0b829);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Sazza_e05d3fd3-e647-4da7-9958-d75bcb9cbe93);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_MayrinaHagAlive_f8dfc111-3a3d-4df2-836e-08a518c90458);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_MayrinaHagDead_edcdfd57-6e5a-4417-80b0-3d6f1d934d3d);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Naaber_4b1b7eaa-6a7b-49a4-be86-d35765699a42);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_NineFingers_JaheiraAlive_07b14aa0-d33f-4cbb-a80c-c0710934a80b);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Zevlor_ca157943-1ce3-4988-b525-5b5ef8c0ed9b);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Geraldus_143808e4-0dbb-4d9e-9370-0061d59cabcc);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_EmperorBigPlans_f5304063-f97b-4076-809a-ecfc323eea40);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_EmperorAllies_9c3e2dfb-d399-4c44-ade8-db6181d92700);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_EmperorPlayerMF_646bc376-97dc-420c-8804-318c29b73e47);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Emperor_9eecd32e-ade2-4397-ac3e-cdc9f091e05e);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_HagVanraAndChild_40a61b5c-eccb-4d65-9497-3ca6cdbd20e7);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_HagAndVanraOnly_7ceb39ac-7762-4d76-979c-3181c8325945);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_OrpheusWithLaezel_493ced21-50b6-4dbb-ad8d-aa4013e4a7bc);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_Orpheus_e6bb88cf-c5cc-4345-8135-537ee8f2a2ef);
DB_EPI_Epilogue_Letters((ITEM)S_EPI_Letter_GroveMissive_f48af361-4d2a-458f-9717-229ab528032c);

DB_EPI_Epilogue_DynamicLetters("ID",(ITEM)NULL_00000000-0000-0000-0000-000000000000, "TextKeyName",(FLAG)NULL_00000000-0000-0000-0000-000000000000,0);

//END_REGION
KBSECTION
PROC
PROC_EPI_Epilogue_SetupLetters()
AND
DB_EPI_Epilogue_Letters(_Item)
AND
QRY_EPI_Epilogue_LetterIsValid((ITEM)_Item)
THEN
PROC_EPI_Epilogue_SendLetterToInventory(_Item);

PROC
PROC_EPI_Epilogue_SetupLetters()
AND
DB_EPI_Epilogue_DynamicLetters(_, _Item, _, _, _)
AND
NOT DB_EPI_Epilogue_SetLetter(_Item)
AND
QRY_EPI_Epilogue_LetterIsValid((ITEM)_Item)
THEN
PROC_EPI_Epilogue_SendLetterToInventory(_Item);

PROC
PROC_EPI_Epilogue_SendLetterToInventory((ITEM)S_EPI_Letter_ShadowheartFather_3413d837-5a33-4195-a2bb-04729a1ce604)
THEN
DB_EPI_Epilogue_SetLetter(S_EPI_Letter_ShadowheartFather_3413d837-5a33-4195-a2bb-04729a1ce604);
PROC_ToInventoryAndOnStage(S_EPI_Letter_ShadowheartFather_3413d837-5a33-4195-a2bb-04729a1ce604, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, 0, 1);

PROC
PROC_EPI_Epilogue_SendLetterToInventory((ITEM)S_EPI_Letter_ShadowheartMother_b52ec84b-dbff-400d-91e2-048d425427c2)
THEN
DB_EPI_Epilogue_SetLetter(S_EPI_Letter_ShadowheartMother_b52ec84b-dbff-400d-91e2-048d425427c2);
PROC_ToInventoryAndOnStage(S_EPI_Letter_ShadowheartMother_b52ec84b-dbff-400d-91e2-048d425427c2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, 0, 1);

PROC
PROC_EPI_Epilogue_SendLetterToInventory(_Item)
AND
NOT DB_EPI_Epilogue_SetLetter(_Item)
THEN
DB_EPI_Epilogue_SetLetter(_Item);
PROC_ToInventoryAndOnStage(_Item, S_EPI_Letterbox_a8c7f035-7564-46fe-88ac-a70faabdd7c0, 1, 0, 1);

//REGION Letter Valid QRYs
//REGION Dammon
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DammonKarlachAvatar_d0de24c8-2df4-4375-9ce4-494ae72ef593)
AND
NOT DB_PermaDefeated(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79)
AND
DB_Avatars(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c)
AND
NOT DB_GlobalFlag(ORI_Karlach_State_EngineBurnedOut_2cd8d398-d6ec-3227-2dfb-975127fb5393)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DammonKarlachComp_cf300cca-153a-44c4-a347-5cc7bbed6e90)
AND
NOT DB_PermaDefeated(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79)
AND
NOT DB_Avatars(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c)
AND
DB_PartOfTheTeam(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c)
AND
NOT DB_GlobalFlag(ORI_Karlach_State_EngineBurnedOut_2cd8d398-d6ec-3227-2dfb-975127fb5393)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DammonKarlachDead_82179ce0-263e-466e-b786-fefe00713438)
AND
NOT DB_PermaDefeated(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79)
AND
DB_GlobalFlag(ORI_Karlach_State_EngineBurnedOut_2cd8d398-d6ec-3227-2dfb-975127fb5393)
THEN
DB_NOOP(1);
//END_REGION

//REGION Shadowheart Parents
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ShadowheartMother_b52ec84b-dbff-400d-91e2-048d425427c2)
AND
DB_GlobalFlag(ORI_Shadowheart_State_ReturnToFamilyFarm_08a4c508-0971-6ed7-acf2-56aa067df750)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ShadowheartFather_3413d837-5a33-4195-a2bb-04729a1ce604)
AND
DB_GlobalFlag(ORI_Shadowheart_State_ReturnToFamilyFarm_08a4c508-0971-6ed7-acf2-56aa067df750)
THEN
DB_NOOP(1);
//END_REGION

//REGION Nocturne
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Nocturne_e3d81d8e-0d72-4e80-81c8-9e92da12fce9)
AND
DB_EPI_Epilogue_SetCharacters(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679)
AND
DB_GlobalFlag(ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_NocturneTurnedFrom_d6bc1f90-611b-4d3a-a054-4e94879f519a)
AND
DB_EPI_Epilogue_SetCharacters(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679)
AND
NOT DB_GlobalFlag(ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac)
THEN
DB_NOOP(1);
//END_REGION

//REGION Araj
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Araj_4be6ccf0-11bf-4c07-b57f-74343e42260f)
AND
NOT DB_Permadefeated(S_MOO_InfernalVendor_511c9413-25fe-449c-a81d-4b09bc20745a)
AND
DB_PartOfTheTeam(_Player)
AND
GetFlag(MOO_InfernalVendor_State_SoldBlood_ae50cf43-a0ef-4ce6-bdb1-0ccf628b9a63, _Player, 1)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Araj_4be6ccf0-11bf-4c07-b57f-74343e42260f)
AND
NOT DB_Permadefeated(S_MOO_InfernalVendor_511c9413-25fe-449c-a81d-4b09bc20745a)
AND
DB_PartOfTheTeam(_Player)
AND
GetFlag(LOW_BloodMerchant_Event_ArajGetBloodFromCharacter_00b0a0f7-98ee-86ac-3b8f-d7cce5b98ce0, _Player, 1)
THEN
DB_NOOP(1);
//END_REGION

//REGION Sebastian
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Sebastian_511fcb43-42a2-47c9-9c0d-62029a9ee99c)
AND
DB_GlobalFlag(ORI_Astarion_State_MetSebastian_b0158356-c6ca-4734-bc24-1d0b52c1d6bd)
AND
DB_GlobalFlag(LOW_CazadorsPalace_RitualRoom_State_ReleasedPrisoners_5784cf70-bff9-467c-b150-39d1f5a78240)
AND
NOT DB_GlobalFlag(ORI_Astarion_State_LeadSpawnInUnderdark_e7ed1e66-171e-96d7-3ea9-61176713cbf9)
THEN
DB_NOOP(1);
//END_REGION

//REGION Ulma Gur
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_UlmaGur_1f51fc46-cb35-4a63-b4a0-045e51aa591a)
AND
DB_EPI_Epilogue_SetCharacters(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
DB_GlobalFlag(LOW_GurFollowUp_State_PeacefulResolution_260836ee-6f67-4ea4-9e2c-ccae94a75035)
AND
DB_GlobalFlag(LOW_CazadorsPalace_RitualRoom_State_ReleasedPrisoners_5784cf70-bff9-467c-b150-39d1f5a78240)
THEN
DB_NOOP(1);
//END_REGION

//REGION Nightsong & Isobel
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_IsobelNightsong_5c47e3d7-1246-4f26-a9b5-d56670fb5afc)
AND
NOT DB_GlobalFlag(SHA_Nightsong_State_PermaDefeated_d02e8ea4-dec7-4824-8117-efc075dee4ba)
AND
NOT DB_GlobalFlag(LOW_SorcerousSundries_State_NightsongCaged_d9739530-c72a-4ad8-96f0-7ec71bbcfd98)
AND
DB_GlobalFlag(SCE_Isobel_State_WillJoinCamp_bd91b63d-9c38-1399-cb7d-9eeddff8b039)
AND
NOT DB_PermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_NightsongAlone_d5ea9fd4-6538-46d6-8aa4-3688466e8bfe)
AND
NOT DB_GlobalFlag(SHA_Nightsong_State_PermaDefeated_d02e8ea4-dec7-4824-8117-efc075dee4ba)
AND
NOT DB_GlobalFlag(LOW_SorcerousSundries_State_NightsongCaged_d9739530-c72a-4ad8-96f0-7ec71bbcfd98)
AND
DB_GlobalFlag(SCE_Isobel_State_WillJoinCamp_bd91b63d-9c38-1399-cb7d-9eeddff8b039)
AND
DB_PermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_NightsongTrapped_2ef64221-5c93-4f46-8a6a-29add07cdf21)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_NightsongCaged_d9739530-c72a-4ad8-96f0-7ec71bbcfd98)
THEN
DB_NOOP(1);
//END_REGION

//REGION Barcus
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_BarcusLeader_5c5f9fbf-0bce-4eb0-96fc-60775648c8e9)
AND
DB_GlobalFlag(LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46)
AND
DB_GlobalFlag(UND_GnomeWorkers_Event_Leave_ad897c6f-87d5-4a30-88f0-41c92b965bc8)
AND
NOT DB_Dead(S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_BarcusRejected_1d7735a8-7529-455d-b28e-d785e09fe1b7)
AND
NOT DB_GlobalFlag(LOW_SteelWatchFoundry_BarcusIsLeader_2feaf431-1f1d-d951-7b4f-daa744985a46)
AND
DB_GlobalFlag(UND_GnomeWorkers_Event_Leave_ad897c6f-87d5-4a30-88f0-41c92b965bc8)
AND
NOT DB_Dead(S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976)
THEN
DB_NOOP(1);
//END_REGION

//REGION Art Cullagh
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ArtCullagh_a4b1b5db-107f-47c6-8dbe-2f5694dd08be)
AND
DB_GlobalFlag(SCL_ShadowCurse_State_CurseLifted_af78af4a-48b2-46a8-be6f-f25dfa579471)
AND
NOT DB_GlobalFlag(HAV_CursedFist_State_PermaDefeated_62ac2304-a7a6-4519-b661-37ea993b1f97)
THEN
DB_NOOP(1);
//END_REGION

//REGION Valeria
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ValeriaDevellaAlive_97ac3b36-f12e-4f18-aa1b-ab37e6a3a625)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_BhaalistsDefeated_4f6e1415-fd18-4179-ab94-3efa59a2d1e9)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_ValeriaIsDead_35e90fa8-bff8-4fae-87ac-f0f6f23b6a28)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_FreedValeria_bc52002a-08fd-0b96-a273-f949e73353f9)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_DevellaIsDead_156d25aa-f1b8-47af-9fd5-da374420dc95)
AND
DB_GlobalFlag(LOW_SerialKiller_State_PlayersTalkDevellaPrivateroom_d7cb303c-e0b0-4c5b-8e1a-62eb68547781)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ValeriaDevellaDead_c874a51a-71f3-44c8-8d43-532bdf918d07)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_BhaalistsDefeated_4f6e1415-fd18-4179-ab94-3efa59a2d1e9)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_ValeriaIsDead_35e90fa8-bff8-4fae-87ac-f0f6f23b6a28)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_FreedValeria_bc52002a-08fd-0b96-a273-f949e73353f9)
AND
DB_GlobalFlag(LOW_SerialKiller_State_DevellaIsDead_156d25aa-f1b8-47af-9fd5-da374420dc95)
THEN
DB_NOOP(1);


QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ValeriaDevellaNotMet_1e841e73-328f-48ac-8f95-a84ff7466314)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_BhaalistsDefeated_4f6e1415-fd18-4179-ab94-3efa59a2d1e9)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_ValeriaIsDead_35e90fa8-bff8-4fae-87ac-f0f6f23b6a28)
AND
DB_GlobalFlag(LOW_MurderTribunal_State_FreedValeria_bc52002a-08fd-0b96-a273-f949e73353f9)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_DevellaIsDead_156d25aa-f1b8-47af-9fd5-da374420dc95)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_PlayersTalkDevellaPrivateroom_d7cb303c-e0b0-4c5b-8e1a-62eb68547781)
THEN
DB_NOOP(1);

//END_REGION

//REGION Sazza
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Sazza_e05d3fd3-e647-4da7-9958-d75bcb9cbe93)
AND
NOT DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb)
THEN
DB_NOOP(1);
//END_REGION

//REGION Hope
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Hope_ae0ffd5f-b7ef-43f5-9375-d75dd8e0b829)
AND
DB_GlobalFlag(LOW_HouseOfHope_Event_HopeRescued_119342c6-2a7b-8c90-e96e-3f3a5930e91a)
AND
NOT DB_PermaDefeated(S_LOW_RealHope_1947e869-a95d-43c6-81f7-b4c4f90d95ce)
THEN
DB_NOOP(1);
//END_REGION

//REGION Haarlep
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Haarlep_067f509b-03e8-4058-b536-2c5df123397d)
AND
DB_PartOfTheTeam(_Char)
AND
GetFlag(LOW_HouseOfHope_State_GaveBodyToIncubus_54fb1ca4-b259-c4d8-7f9b-47b3dd889020, _Char, 1)
AND
DB_GlobalFlag(GLO_Monitor_State_PermaDefeated_92f6d5f6-86af-4339-ad8a-da9d629f0dae)
THEN
DB_NOOP(1);
//END_REGION

//REGION Duke Ravengard
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DukeRavenguard_dd22571a-25ea-48b5-bb77-32360c355157)
AND
DB_GlobalFlag(CAMP_Ravengard_State_RavengardInCamp_37309008-04cf-493c-8ca6-43034d331a8a)
AND
NOT DB_GlobalFlag(GLO_Ravengard_State_PermaDefeated_b1b2458c-dd27-4db7-974e-a294ca6e2e9e)
THEN
DB_NOOP(1);
//END_REGION

//REGION Non-recruited Halsin
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_HalsinShadowcurse_a097bd29-f9d1-488e-86a1-ce0600b56c31)
AND
QRY_QuestUpdateIsUnlockedForAny("SCL_LiftingTheCurse", "OliverNotFound")
AND
NOT DB_GlobalFlag(GLO_Halsin_State_PermaDefeated_86bc3df1-08b4-fbc4-b542-6241bcd03df1)
THEN
DB_NOOP(1);
//END_REGION

//REGION Geraldus
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Geraldus_143808e4-0dbb-4d9e-9370-0061d59cabcc)
AND
DB_GlobalFlag(WYR_Axe_RealHarper_Alive_SpokeUpForGeraldus_ec235585-8866-63ae-a33c-3838e8132698)
AND
NOT DB_Permadefeated(S_WYR_Axe_RealHarper_76b789cf-7d4f-431a-abba-90b12de21ec7)
THEN
DB_NOOP(1);
//END_REGION

//REGION Voss
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_VossOrpheusAlive_147b3c9c-e054-4b85-ba0c-49ba6e4ee67c)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusPermaDefeated_9255d9c6-39b2-4436-bd03-c08d99526257)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusIsMindFlayer_2b638127-f30a-424e-9d4a-a9f8f100a307)
AND
NOT DB_PermaDefeated(S_GLO_GithKnight_2adce2df-0799-49dc-b867-ba7ca21e9aea)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_VossOrpheusDead_418411e0-6e20-4911-9e1c-b6f240fb7cd8)
AND
DB_GlobalFlag(END_General_State_OrpheusPermaDefeated_9255d9c6-39b2-4436-bd03-c08d99526257)
AND
NOT DB_PermaDefeated(S_GLO_GithKnight_2adce2df-0799-49dc-b867-ba7ca21e9aea)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_VossOrpheusDead_418411e0-6e20-4911-9e1c-b6f240fb7cd8)
AND
DB_GlobalFlag(END_General_State_OrpheusIsMindFlayer_2b638127-f30a-424e-9d4a-a9f8f100a307)
AND
NOT DB_PermaDefeated(S_GLO_GithKnight_2adce2df-0799-49dc-b867-ba7ca21e9aea)
THEN
DB_NOOP(1);
//END_REGION

//REGION Alfira
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_AlfiraAtElfsong_4b3f1501-b966-4569-bdcd-4587c54243fd)
AND
NOT DB_PermaDefeated(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c)
AND
DB_GlobaLFlag(LOW_Elfsong_State_LakrissaPermaDefeated_5db59b9f-a8a5-4c58-b386-0af81fab8eea)
AND
NOT DB_ORI_DarkUrge(_)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_AlfiraAndLakrissa_0c07c8d3-3b26-44ad-bd04-22d85e6b936a)
AND
NOT DB_PermaDefeated(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c)
AND
NOT DB_GlobaLFlag(LOW_Elfsong_State_LakrissaPermaDefeated_5db59b9f-a8a5-4c58-b386-0af81fab8eea)
AND
NOT DB_ORI_DarkUrge(_)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_AlfiraDUSaved_33d08041-5581-4d26-8b76-92c13ca2b643)
AND
NOT DB_Dead(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c)
AND
DB_ORI_DarkUrge(_Player)
THEN
DB_NOOP(1);
//END_REGION

//REGION Devella
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DevellaDU_01f67b27-0083-49d2-baa0-1fcf4c630b60)
AND
DB_GlobalFlag(LOW_Elfsong_State_AllowHelpDevella_6692d31b-c2a1-4c1f-6471-1a2c701867dd)
AND
DB_GlobalFlag(LOW_Elfsong_Devella_Knows_DarkUrgeBhaalspawn_90c8dd05-0233-1766-9f76-846f1de2d661)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DevellaValeriaAlive_f7a56f65-aea9-4de6-a693-6054122fc01b)
AND
DB_GlobalFlag(LOW_Elfsong_State_AllowHelpDevella_6692d31b-c2a1-4c1f-6471-1a2c701867dd)
AND
NOT DB_GlobalFlag(LOW_SerialKiller_State_ValeriaIsDead_35e90fa8-bff8-4fae-87ac-f0f6f23b6a28)
AND
NOT DB_GlobalFlag(LOW_Elfsong_Devella_Knows_DarkUrgeBhaalspawn_90c8dd05-0233-1766-9f76-846f1de2d661)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_DevellaValeriaDead_6fcd7f3c-276f-4f4a-8305-7fbd71b63a3d)
AND
DB_GlobalFlag(LOW_Elfsong_State_AllowHelpDevella_6692d31b-c2a1-4c1f-6471-1a2c701867dd)
AND
DB_GlobalFlag(LOW_SerialKiller_State_ValeriaIsDead_35e90fa8-bff8-4fae-87ac-f0f6f23b6a28)
AND
NOT DB_GlobalFlag(LOW_Elfsong_Devella_Knows_DarkUrgeBhaalspawn_90c8dd05-0233-1766-9f76-846f1de2d661)
THEN
DB_NOOP(1);
//END_REGION

//REGION Florrick
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Florrick_bb48516f-cc8d-4cb7-806d-fa5dfeb961d6)
AND
DB_GlobalFlag(WYR_WyrmRockPrison_State_FlorrickEscaped_a84a5b16-ca29-43c3-91bf-17def670ba07)
AND
NOT DB_GlobalFlag(GLO_Florrick_State_PermaDefeated_c190fb1f-4c27-4948-87f0-29dc5a9b5b55)
THEN
DB_NOOP(1);
//END_REGION

//REGION Sarevok
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Sarevok_b1ac7e8b-2640-42cc-bfbd-2afead1f9cb9)
AND
DB_GlobalFlag(ORI_DarkUrge_State_BhaalResisted_74944ac3-1ea0-4eae-9653-1f1319f8646b)
AND
NOT DB_GlobalFlag(LOW_MurderTribunal_Sarevok_State_Dead_e9d30711-af25-4ba9-813e-cc7c131b17b6)
THEN
DB_NOOP(1);
//END_REGION

//REGION Elminster
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ElminsterGaleGod_f8184fd9-fdc9-4e18-8f47-4b66ab9f4351)
AND
DB_GlobalFlag(ORI_Gale_State_IsGod_ec94f9a4-b032-ce25-f4eb-ecf4ed37d65d)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ElminsterGaleWaterdeep_9445cd48-a46e-4b86-a862-599fc6e5db01)
AND
DB_GlobalFlag(ORI_Gale_State_ReturnedToWaterdeep_c7b41398-0b76-4c71-8825-2e16ff810199)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_ElminsterGale_9b617ba6-e927-40af-b2f1-bea1483608c0)
AND
DB_EPI_Epilogue_PresentNPC(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
NOT DB_GlobalFlag(ORI_Gale_State_IsGod_ec94f9a4-b032-ce25-f4eb-ecf4ed37d65d)
AND
NOT DB_GlobalFlag(ORI_Gale_State_ReturnedToWaterdeep_c7b41398-0b76-4c71-8825-2e16ff810199)
THEN
DB_NOOP(1);
//END_REGION

//REGION Nine-fingers
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_NineFingers_JaheiraAlive_07b14aa0-d33f-4cbb-a80c-c0710934a80b)
AND
NOT DB_GlobalFlag(GLO_Jaheira_State_PermaDefeated_932fb5a1-00ba-4621-b7ae-877d40d7ddcd)
AND
NOT DB_PermaDefeated(S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd)
AND
NOT DB_GlobalFlag(LOW_Guildhall_State_NotMetNineFingers_311941fa-c871-4fa5-80df-d2c7914eed44)
AND
DB_GlobalFlag((FLAG)LOW_Guildhall_State_PostCoup_GuildControlled_596f7f8b-2de2-4550-87fd-9535c2a07635)
THEN
DB_NOOP(1);
//END_REGION

//REGION Ettvard
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_EttvardNeedle_586a6029-e5d0-47af-8e07-1be8cf2a139f)
AND
NOT DB_GlobalFlag(LOW_BaldursMouth_State_EttvardIsDead_0719687b-df33-4bf6-b5ab-cf9cab372b5b)
AND
DB_GlobalFlag(LOW_BaldursMouth_HasMet_Ettvard_1497e00d-3087-471d-ab01-acdd21497199)
THEN
DB_NOOP(1);
//END_REGION

//REGION Zevlor
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Zevlor_ca157943-1ce3-4988-b525-5b5ef8c0ed9b)
AND
NOT DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a)
AND
DB_GlobalFlag(COL_TadpolingCentre_Event_ReleasePods_3e81dc65-eb2d-86aa-5163-28450894f868)
THEN
DB_NOOP(1);
//END_REGION

//REGION Viconia
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Viconia_7b5aedce-1374-426c-b0b3-0fdcfc47fdd9)
AND
NOT DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097)
AND
DB_GlobalFlag(LOW_SharGrotto_ConfrontViconia_SharranAlliance_ea829b7c-5f69-c4fc-6b4c-b8a190d31a86)
AND
NOT DB_GlobalFlag(LOW_ShadowheartFriend_State_Defeated_cc356b4c-c53b-4326-8eb2-ae463b670acd)
THEN
DB_NOOP(1);
//END_REGION

//REGION Kagha
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Kagha_b1c618ef-0f86-428b-a2d8-bf38333a9bf9)
AND
DB_GlobalFlag(DEN_ShadowDruid_Event_KaghaTurnedGood_f2de839d-b971-86ee-f02c-5e09174ce919)
AND
NOT DB_GlobalFlag(DEN_GroveHostileState_04a03da4-b046-4332-9e1e-d6719626c210)
AND
NOT DB_PermaDefeated(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156)
THEN
DB_NOOP(1);
//END_REGION

//REGION Arabella
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Arabella_8b1d0291-180f-4f6d-87de-2ded16dc32c4)
AND
DB_GlobalFlag(END_GatherYourAllies_Event_ArabellaReinforcementAwarded_027f3339-9910-4d45-ba43-75e659d2ee05)
THEN
DB_NOOP(1);
//END_REGION

//REGION Emperor
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_EmperorBigPlans_f5304063-f97b-4076-809a-ecfc323eea40)
AND
DB_GlobalFLag(END_BrainBattle_State_MindFlayersWithBigPlans_ce25a452-eb2b-ce7e-f04a-f853b6df530e)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_EmperorAllies_9c3e2dfb-d399-4c44-ade8-db6181d92700)
AND
DB_GlobalFlag(END_BrainBattle_State_AlliedWithEmperor_1fb799bb-4b21-9adc-92a0-1c05542eb6b8)
AND
NOT DB_GlobalFlag(END_BrainBattle_State_MindFlayersWithBigPlans_ce25a452-eb2b-ce7e-f04a-f853b6df530e)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_EmperorPlayerMF_646bc376-97dc-420c-8804-318c29b73e47)
AND
NOT DB_GlobalFlag(END_BrainBattle_State_AlliedWithEmperor_1fb799bb-4b21-9adc-92a0-1c05542eb6b8)
AND
NOT DB_GlobalFlag(END_BrainBattle_State_MindFlayersWithBigPlans_ce25a452-eb2b-ce7e-f04a-f853b6df530e)
AND
NOT DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd)
AND
DB_GlobalFLag(END_General_State_PlayerIsMindFlayer_d138f537-2268-49a6-8dc4-256bd9cf5633)
AND
NOT DB_GlobalFlag(END_BrainBattle_Event_KillEmperor_187b621a-5f21-1715-753a-362f290e9eb0)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Emperor_9eecd32e-ade2-4397-ac3e-cdc9f091e05e)
AND
NOT DB_GlobalFlag(END_BrainBattle_State_AlliedWithEmperor_1fb799bb-4b21-9adc-92a0-1c05542eb6b8)
AND
NOT DB_GlobalFlag(END_BrainBattle_State_MindFlayersWithBigPlans_ce25a452-eb2b-ce7e-f04a-f853b6df530e)
AND
NOT DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd)
AND
NOT DB_GlobalFLag(END_General_State_PlayerIsMindFlayer_d138f537-2268-49a6-8dc4-256bd9cf5633)
AND
NOT DB_GlobalFlag(END_BrainBattle_Event_KillEmperor_187b621a-5f21-1715-753a-362f290e9eb0)
THEN
DB_NOOP(1);
//END_REGION

//REGION Hag
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_HagVanraAndChild_40a61b5c-eccb-4d65-9497-3ca6cdbd20e7)
AND
DB_GlobalFLag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5)
AND
NOT DB_PermaDefeated(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_HagAndVanraOnly_7ceb39ac-7762-4d76-979c-3181c8325945)
AND
NOT DB_GlobalFLag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5)
AND
DB_GlobalFlag(HAG_Hag_State_HagTookMother_38dc6752-5ab3-e108-64ed-fe63971d69fd)
AND
NOT DB_PermaDefeated(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d)
THEN
DB_NOOP(1);
//END_REGION

//REGION Mayrina

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_MayrinaHagAlive_f8dfc111-3a3d-4df2-836e-08a518c90458)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7)
AND
NOT DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMother_PermaDefeated_4391ae06-20bf-4e37-bbca-63519c550d0c)
AND
NOT DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c)
AND
NOT DB_GlobalFlag(LOW_HagSurvivors_State_ToldAboutHagDeal_fb133357-495c-495f-919e-a62c72d3b061)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_MayrinaHagDead_edcdfd57-6e5a-4417-80b0-3d6f1d934d3d)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7)
AND
NOT DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMother_PermaDefeated_4391ae06-20bf-4e37-bbca-63519c550d0c)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c)
AND
NOT DB_GlobalFlag(LOW_HagSurvivors_State_ToldAboutHagDeal_fb133357-495c-495f-919e-a62c72d3b061)
THEN
DB_NOOP(1);

//END_REGION

//REGION Orpheus
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_OrpheusWithLaezel_493ced21-50b6-4dbb-ad8d-aa4013e4a7bc)
AND
DB_GlobalFlag(END_GameFinale_State_LaezelLeavesFaerun_896fb62a-4f56-41d8-a173-7d06c4cb9209)
AND
DB_GlobalFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusPermaDefeated_9255d9c6-39b2-4436-bd03-c08d99526257)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusIsMindFlayer_2b638127-f30a-424e-9d4a-a9f8f100a307)
THEN
DB_NOOP(1);

QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Orpheus_e6bb88cf-c5cc-4345-8135-537ee8f2a2ef)
AND
NOT DB_GlobalFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusPermaDefeated_9255d9c6-39b2-4436-bd03-c08d99526257)
AND
NOT DB_GlobalFlag(END_General_State_OrpheusIsMindFlayer_2b638127-f30a-424e-9d4a-a9f8f100a307)
THEN
DB_NOOP(1);
//END_REGION

//REGION Naaber
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_Naaber_4b1b7eaa-6a7b-49a4-be86-d35765699a42)
AND
DB_GlobalFlag(WYR_FigaroSister_State_NaaberDialog_Finish_9b7e052e-d8d4-fb55-602f-0fbe47a1489b)
THEN
DB_NOOP(1);

//END_REGION

//REGION Grove Missive
QRY
QRY_EPI_Epilogue_LetterIsValid((ITEM)S_EPI_Letter_GroveMissive_f48af361-4d2a-458f-9717-229ab528032c)
AND
DB_GlobalFlag(EPI_Epilogue_State_HalsinPresent_e6847fa6-678a-4b4c-bb3b-4cfa61fbeb40)
AND
NOT DB_GlobalFlag(DEN_Lockdown_State_Active_0b54c7d2-b7b1-4d0f-b8e4-0cf1ee32b1eb)
AND
NOT DB_PermaDefeated(S_DEN_ZenBear_d4d4bfd2-9639-45bc-a256-2f079e53db29)
THEN
DB_NOOP(1);

//END_REGION 

PROC
PROC_EPI_Epilogue_SetupLetters()
AND
DB_EPI_Epilogue_DynamicLetters(_ID, _Item, _Text, _Flag, _Bool)
AND
_Flag != NULL_00000000-0000-0000-0000-000000000000
AND
GetFlag(_Flag, NULL_00000000-0000-0000-0000-000000000000, _Bool)
THEN
PROC_EPI_Epilogue_SetDynamicLetter(_ID, _Item, _Text);

PROC
PROC_EPI_Epilogue_SetDynamicLetter((STRING)_ID,(ITEM)_Item,(STRING)_)
AND
NOT DB_EPI_Epilogue_AvailableDynamicLetters(_ID, _Item)
THEN
PROC_SetOnStage(_Item, 1);
DB_EPI_Epilogue_AvailableDynamicLetters(_ID, _Item);

PROC
PROC_EPI_Epilogue_SetDynamicLetter((STRING)_ID,(ITEM)_,(STRING)_Text)
THEN
AddEntryToCustomBook(_ID, _Text);

IF
UseFinished(_Player, _Item, _)
AND
DB_EPI_Epilogue_AvailableDynamicLetters(_ID, _Item)
THEN
OpenReferencedBookUI(_Player, _ID, _Item); //Uses the same book UI type as the item
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3c_EPI"
