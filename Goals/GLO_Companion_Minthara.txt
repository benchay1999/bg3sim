Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_TadpolePowers_UnlockedByDefault((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

//REGION Companion Init Block
DB_OriginTags((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (TAG)MINTHARA_4ec1d8be-fe5e-466f-ab0d-1f0f6f20fef3, (TAG)REALLY_MINTHARA_3e84e1cd-2193-4f9f-80b4-c2ededefaea6);
DB_OriginInPartyGlobal((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b,(FLAG)ORI_Minthara_State_IsInParty_766b8981-eb17-3ec5-5d30-2626509c550f);

DB_CompanionOnlyFaction((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FACTION)Companion12_aeaf8c61-8ff3-1bc2-18fc-7da29495fc68);
DB_OriginNPCAlignment((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FACTION)GLO_DrowCommander_f984f683-e819-439e-af7c-48906053c20b);

DB_GLO_PartyMembers_BlockRecruitmentDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_OriginRecruitmentDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)CAMP_Minthara_e776dff2-6285-3f23-ceff-f40371236993);
DB_OriginInPartyDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8);
DB_OriginWarning1Dialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_Warning1_879a678a-1986-2ccc-30f9-9b1057641ae4);
DB_OriginWarning2Dialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_Warning2_d1956795-9fe2-8539-4c10-3c934f93c386);
DB_OriginLeavingDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_Leaving_0ffad71c-21b5-ed13-cf3a-5d5d0323b927);

DB_OriginPartOfTheTeamFlag((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FLAG)GLO_Origin_PartOfTheTeam_Minthara_fa0e4e0b-08f9-4094-bfed-5205481c683c,(FLAG)GLO_Origin_Avatar_Minthara_df3686a2-97b1-428d-9c03-0e20c748b650, (FLAG)ORI_Minthara_ControlledByUser_dba84de8-1dc2-4a76-b1b3-0192399e3b4d);
DB_OriginKickFromPartyFlags((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FLAG)ORI_Minthara_Event_KickCompanion_19e6dc5f-14cc-43cf-95bf-291313cc2cfc, (FLAG)ORI_Minthara_State_CanBeKicked_304f3837-09db-4c62-aed1-ff09cd566c8e);
DB_Inclusion_Object((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b,(FLAG)SCE_Minthara_Inclusion_Start_82541346-7f03-4e80-a590-79ebf95d2332,(FLAG)SCE_Minthara_Inclusion_End_057432e2-c0cb-4d2d-b16c-157a1e258bf5);

//END_REGION

//REGION Companion Debug Flags
DB_Debug_CharacterAddFlags((FLAG)Debug_AddMinthara_f5989c01-2600-4b16-9f29-c1fc7ee6bb9c, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FLAG)Debug_MintharaIsPlayer_27598901-3ded-41e4-8be0-5b8d88920df4);
DB_Debug_CharacterRemoveHideFlags((FLAG)Debug_RemoveHideMinthara_9874d577-c50b-4357-bdaf-ec7b49959e00, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//END_REGION

DB_ORI_FreeDating(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//REGION Counter Declarations
PROC_DeclareCounter("ORI_Minthara_ChoseExileOption");
PROC_DeclareCounter("ORI_Minthara_ChoseExploitOption");
//END_REGION

//REGION 
DB_FlagReactionAfterDialog((FLAG)CAMP_GoblinHuntCelebration_Event_ShowedMintharaArtifact_0c47dde3-6057-6daf-7116-32c63e7c5872, (DIALOGRESOURCE)CAMP_GoblinHuntCelebration_SD_ROM_NightWithDrow_0166176a-2eb4-db38-81b9-003dde80485b);
DB_FlagReactionAfterDialog((FLAG)GOB_DrowCommander_Event_GivePlayerSpiderLyre_158e897c-59bd-2db7-0524-94bb33980d64, (DIALOGRESOURCE)GOB_DrowCommander_b31382b6-355d-9ab4-3d20-4680e2c26477);
//END_REGION

DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutAstarion_04752cc3-e93d-2ee1-167d-be67617ddcec, (CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutGale_14f0b219-9190-7e6a-d7d9-941348a2e4a8, (CHARACTER)S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutJaheira_e3a47bf5-af86-d32e-58d8-f391bef3a233, (CHARACTER)S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutKarlach_5eaf5548-594e-7423-7255-8f48d0500212, (CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutMinsc_9854165f-5093-d68c-1213-d311db131e1a, (CHARACTER)S_Player_Minsc_0de603c5-42e2-4811-9dad-f652de080eba);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutLaezel_3e23b7be-6ff7-2331-2861-d5b4f0a7cfcb, (CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutShadowheart_faa6017f-ed6d-8e73-aeea-8412dc38c357, (CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_ORI_Minthara_DiscussedTeamFlags((FLAG)ORI_Minthara_Asked_AboutWyll_b327e6ea-0532-2a7a-bfcd-3f8ea990f491, (CHARACTER)S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

DB_GLO_CompoundFlag((FLAG)LOW_Guildhall_HasMet_NineFingers_0054cec3-9588-4427-d6dd-fc02da69c5b1, (FLAG)ORI_Minthara_Knows_GuildhallChaos_4251bf52-4da1-4154-b029-68283ef36a31);
DB_GLO_CompoundFlag((FLAG)LOW_Guildhall_HasMet_Roah_9c69c595-6589-3aaa-65b6-22d95e490ab4, (FLAG)ORI_Minthara_Knows_GuildhallChaos_4251bf52-4da1-4154-b029-68283ef36a31);

DB_ORI_Minthara_KissPoisons("POISON_SIMPLE_CONDITION");
DB_ORI_Minthara_KissPoisons("ALCH_TOXIN_BASIC_CONDITION");
DB_ORI_Minthara_KissPoisons("ALCH_TOXIN_SERPENTVENOM_CONDITION");
DB_ORI_Minthara_KissPoisons("ALCH_TOXIN_WYVERN_CONDITION");
DB_ORI_Minthara_KissPoisons("ALCH_TOXIN_PURPLEWORM_CONDITION");
DB_ORI_Minthara_KissPoisons("POISON_DROW_CONDITION");
DB_ORI_Minthara_KissPoisons("POISON_CRAWLER_MUCUS_CONDITION");
DB_ORI_Minthara_KissPoisons("ALCH_TOXIN_BASIC_CONDITION");
DB_ORI_Minthara_KissPoisons("POISON_ASSASSINS_BLOOD");

DB_GiveItemToEvent((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (FLAG)GOB_DrowCommander_Event_GivePlayerSpiderLyre_158e897c-59bd-2db7-0524-94bb33980d64);
DB_GiveItemToEvent((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (FLAG)CAMP_GoblinHuntCelebration_State_DrowBetrayalPacified_fb0ecbb3-fd85-ed40-8196-529afcdfd230);

DB_CompanionCanPartner((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FLAG)ORI_State_DatingMinthara_de1360cd-894b-40ea-95a7-1166d675d040, (FLAG)ORI_State_PartneredWithMinthara_39ac48fa-b440-47e6-a436-6dc9b10058d8, (FLAG)ORI_State_WasPartneredWithMinthara_8d0460d6-b00a-4947-bbd0-ad0c085a530f, (FLAG)ORI_State_HandledBreakupWithMinthara_6a880802-bf76-4ece-816e-82cf90fa97be, (FLAG)ORI_State_ChosePartnerOverMinthara_25202f13-55d3-4d13-b0c2-1245a90d99f2, "dateminthara");
DB_CompanionIsDating((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FLAG)ORI_State_MintharaIsDating_07338d12-2971-47b1-a5a1-1737b0bac1fb);

DB_HasItemEvent((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (FLAG)SCL_Drider_State_HasSpidersLyre_f9067120-850e-4db7-825d-b17f535021e6);

SetTag(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (TAG)BLOCK_RESURRECTION_22a75dbb-1588-407e-b559-5aa4e6d4e6a6);
KBSECTION
//REGION Debug
IF
TextEvent("minthara2camp")
THEN
PROC_ORI_SetupCamp((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

IF
BaseFactionChanged((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FACTION)Companion12_aeaf8c61-8ff3-1bc2-18fc-7da29495fc68, (FACTION)ACT3_END_HighHallAbsolutists_aeffb3e9-0b6c-43ab-9bc9-0928c24c30a2)
AND
DB_PartOfTheTeam((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
SetFaction(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FACTION)Companion12_aeaf8c61-8ff3-1bc2-18fc-7da29495fc68);

IF
TextEvent("Minthara_PoisonKiss")
AND
DB_Avatars(_Avatar)
AND
GetFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Avatar, 0)
THEN
SetFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Avatar);

IF
TextEvent("Minthara_PoisonKiss")
AND
DB_Avatars((CHARACTER)_Player)
AND
GetFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Player, 1)
AND
QRY_GetRandom("DB_ORI_Mintharwa_KissPoisons", 1, "DB_ORI_Minthara_SelectedKissPoison")
AND
DB_ORI_Minthara_SelectedKissPoison((STRING)_SelectedPoison)
THEN
NOT DB_ORI_Minthara_SelectedKissPoison(_SelectedPoison);
ApplyStatus(_Player, _SelectedPoison, 6.0, 0, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
ClearFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Player);
//END_REGION

//REGION Recruit & Move To Camp
PROC
PROC_GOB_DrowCommander_Init()
AND
DB_Origins((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
NOT DB_Tadpole_TadpoleBurstException((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

PROC
PROC_DebugBook_RecruitCompanion((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (CHARACTER)_Player)
AND
DB_Players(_Player)
THEN
SysCompleteGoal("Act2_MOO_MintharaFate");
SysCompleteGoal("Act2_Camp_Minthara");
PROC_SetAnubisConfig(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GLO_DrowCommander_Act2_2");
NOT DB_GLO_PartyMembers_BlockRecruitmentDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
PROC_GLO_Origins_SetRecruitmentDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)CAMP_Minthara_e776dff2-6285-3f23-ceff-f40371236993);
SetFlag((FLAG)MOO_MintharaFate_State_ToCamp_4e0701b1-c16d-4017-8be6-5781c3c682f4);

PROC
PROC_GLO_PartyMembers_AddHook((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b,(CHARACTER)_Player)
AND
QRY_OnlyOnce("RecruitedFirstTime_Minthara")
THEN
ObjectSetTitle(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "ORI_Minthara_RecruitedTitle");
NOT DB_GLO_PartyMembers_BlockRecruitmentDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
PROC_ORI_SetupCamp((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
SetCombatGroupID(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "");
SetFlag((FLAG)ORI_Minthara_HasMet_9dad3f1b-3c5c-4f2c-a70b-2a6b290ac115, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_GLO_DifficultyModes_AddPlayerBonuses((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b); // Make sure she gets the player bonuses if needed.

IF
EntityEvent((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b,"DebugTeleportedToCamp")
THEN
PROC_ORI_SetupCamp((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);

PROC
PROC_CheckFirstTimeRecruited((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
DB_Tadpole_TadpoleBurstException((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

//Invited to camp
IF
FlagSet((FLAG)ORI_MintharaRecuitment_Event_InvitedToCamp_70385d5f-7a3a-bcd7-aa76-51c3ce5d079b, NULL_00000000-0000-0000-0000-000000000000, _ID)
AND
_ID != 0
THEN
DB_ORI_ToCampAfterDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _ID, "Run");
PROC_SetAnubisConfig((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GLO_DrowCommander_Act2_2");

PROC
PROC_ORI_SendToCampAfterDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _)
THEN
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);

IF
EntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "ORI_ToCamp")
THEN
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
PROC_RemoveAllDialogEntriesForSpeaker(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
ClearFlag((FLAG)ORI_MintharaRecuitment_Event_InvitedToCamp_70385d5f-7a3a-bcd7-aa76-51c3ce5d079b);
DB_Dialogs(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8);
//END_REGION

//REGION Origin Dialogues and romance setting
PROC
PROC_GLO_PartyMembers_AddHook((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Player)
THEN
PROC_SetAnubisConfig(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GLO_DrowCommander_Act2_2");
SetFaction(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, Companion12_aeaf8c61-8ff3-1bc2-18fc-7da29495fc68);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);

IF
DB_InCamp((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
AND
DB_Avatars(_Avatar)
AND
GetApprovalRating((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Avatar, _CurrentApproval)
AND
_CurrentApproval > 30
THEN
PROC_CampRelationshipDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8, (FLAG)ORI_Minthara_IPRD_RomanceBegins_15f8fba3-45c1-a0fc-ccc5-6de4720538b7, 0, 31);
PROC_Try_CampRelationshipDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);

IF
FlagSet((FLAG)ORI_State_DatingMinthara_de1360cd-894b-40ea-95a7-1166d675d040, (CHARACTER)_Avatar, _ID)
AND
DB_ORI_Partnered(_Avatar, (CHARACTER)_Partner)
AND
DB_CompanionCanPartner(_Partner, _, (FLAG)_PartnerFlag, _, _, _, _)
THEN
ClearFlag(_Partnerflag, _Avatar, _ID);

IF
FlagSet((FLAG)_HandledBreakUp, (CHARACTER)_Avatar, _ID)
AND
DB_CompanionCanPartner(_, (FLAG)_DatingFlag, _, _, _HandledBreakup, _, _)
AND
GetFlag((FLAG)ORI_State_DatingMinthara_de1360cd-894b-40ea-95a7-1166d675d040, _Avatar, 1)
THEN
ClearFlag(_DatingFlag, _Avatar);
SetFlag((FLAG)ORI_State_PartneredWithMinthara_39ac48fa-b440-47e6-a436-6dc9b10058d8, _Avatar, _ID);

IF
ApprovalRatingChanged((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Avatar, _Approval)
AND
_Approval > 39
AND
DB_ORI_Dating(_Avatar, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
AND
GetFlag((FLAG)ORI_State_Partnered_6c1a31e8-1d3d-42a5-af4f-72ef7a798f74, _Avatar, 0)
THEN
SetFlag((FLAG)ORI_State_PartneredWithMinthara_39ac48fa-b440-47e6-a436-6dc9b10058d8, _Avatar);

IF
ApprovalRatingChanged((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Avatar, _Approval)
AND
_Approval > 39
AND
DB_ORI_Dating(_Avatar, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
AND
DB_ORI_Partnered(_Avatar, _Companion)
AND
_Companion != S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b
AND
DB_CompanionCanPartner(_Companion, _, _PartnerFlag, _, _, _, _)
THEN
ClearFlag(_PartnerFlag, _Avatar);
SetFlag((FLAG)ORI_State_PartneredWithMinthara_39ac48fa-b440-47e6-a436-6dc9b10058d8, _Avatar);

IF
FlagSet((FLAG)_DiscussedTeamMember, (CHARACTER)_Player, _)
AND
DB_ORI_Minthara_DiscussedTeamFlags(_DiscussedTeamMember, _)
THEN
PROC_ORI_Minthara_PresentTeamMembers();
PROC_ORI_Minthara_DiscussedTeam(_Player);

PROC
PROC_ORI_Minthara_PresentTeamMembers()
AND
DB_ORI_Minthara_PresentTeamMembers(_Companion)
THEN
NOT DB_ORI_Minthara_PresentTeamMembers(_Companion);

PROC
PROC_ORI_Minthara_PresentTeamMembers()
AND
DB_ORI_Minthara_DiscussedTeamFlags(_, (CHARACTER)_Companion)
AND
DB_PartOfTheTeam(_Companion)
AND
NOT DB_Avatars(_Companion)
AND
QRY_ORI_Minthara_ShouldGaleBeAdded(_Companion)
THEN
DB_ORI_Minthara_PresentTeamMembers(_Companion);

QRY
QRY_ORI_Minthara_ShouldGaleBeAdded((CHARACTER)_Companion)
AND
_Companion != S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
THEN
DB_NOOP(1);

QRY
QRY_ORI_Minthara_ShouldGaleBeAdded((CHARACTER)_Companion)
AND
_Companion == S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND
DB_GlobalFlag((FLAG)ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c)
THEN
DB_NOOP(1);

PROC
PROC_ORI_Minthara_DiscussedTeam((CHARACTER)_Player)
AND
DB_ORI_Minthara_SetTeamMemberFlags(_DiscussedTeamMember)
THEN
NOT DB_ORI_Minthara_SetTeamMemberFlags(_DiscussedTeamMember);

PROC
PROC_ORI_Minthara_DiscussedTeam((CHARACTER)_Player)
AND
DB_ORI_Minthara_DiscussedTeamFlags(_DiscussedTeamMember, _)
AND
GetFlag(_DiscussedTeamMember, _Player, 1)
THEN
DB_ORI_Minthara_SetTeamMemberFlags(_DiscussedTeamMember);

PROC
PROC_ORI_Minthara_DiscussedTeam((CHARACTER)_Player)
AND
SysCount("DB_ORI_Minthara_PresentTeamMembers", 1, _TeamCount)
AND
SysCount("DB_ORI_Minthara_SetTeamMemberFlags", 1, _FlagCount)
AND
_TeamCount == _FlagCount
THEN
SetFlag((FLAG)ORI_Minthara_State_AskedAboutAllCurrentTeamMembers_6efc8f72-ace6-8414-bb77-862f9dd4d6a5, _Player);

PROC
PROC_ORI_SendToCampAfterDialog((CHARACTER)_Companion, _, _, (CHARACTER)_Player)
AND
DB_ORI_Minthara_DiscussedTeamFlags(_DiscssedFlag, _Companion)
AND
GetFlag(_DiscssedFlag, _Player, 0)
AND
QRY_ORI_Minthara_ShouldGaleBeAdded(_Companion)
THEN
ClearFlag((FLAG)ORI_Minthara_State_AskedAboutAllCurrentTeamMembers_6efc8f72-ace6-8414-bb77-862f9dd4d6a5, _Player);

PROC
PROC_GLO_PartyMembers_AddHook((CHARACTER)_Companion, (CHARACTER)_Player)
AND
DB_ORI_Minthara_DiscussedTeamFlags(_DiscssedFlag, _Companion)
AND
GetFlag(_DiscssedFlag, _Player, 0)
AND
QRY_ORI_Minthara_ShouldGaleBeAdded(_Companion)
THEN
ClearFlag((FLAG)ORI_Minthara_State_AskedAboutAllCurrentTeamMembers_6efc8f72-ace6-8414-bb77-862f9dd4d6a5, _Player);
//END_REGION

//REGION Poisoned Kiss
IF
FlagSet((FLAG)ORI_Minthara_Event_AskingForPhysicalAffections_5b17de2a-2aff-12b5-62ae-03081400f9d1, _Player, _)
AND
Random(100, 0)
THEN
SetFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Player);

IF
DialogEnded((DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8, _)
AND
DB_Players((CHARACTER)_Player)
AND
GetFlag((FLAG)ORI_Minthara_Event_PoisonedKiss_27d18f3c-c54a-456e-aaec-5faea2364bc1, _Player, 1)
AND
QRY_GetRandom("DB_ORI_Minthara_KissPoisons", 1, "DB_ORI_Minthara_SelectedKissPoison")
AND
DB_ORI_Minthara_SelectedKissPoison(_SelectedPoison)
THEN
NOT DB_ORI_Minthara_SelectedKissPoison(_SelectedPoison);
ApplyStatus(_Player, _SelectedPoison, 12.0, 1, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//END_REGION

//REGION Spider Lyre post Act 2 entry
IF
FlagSet((FLAG)SCL_Drider_Caravan_ToldWillReturn_3498d4e6-9ad8-3474-fbcf-148daf1cb176, _, _Instance)
AND
DB_DialogPlayers(_Instance, _Player, 1)
AND
TemplateIsInPartyInventory(UNI_SCL_SpidersLyre_98282bec-aeaa-4490-ae43-0c27bed58c74, (CHARACTER)_Player, 0, 0)
THEN
SetFlag((FLAG)GOB_DrowCommnader_Knows_HasSpiderLyre_40a04a2d-cc84-4f45-ad92-a32e8e5796f7);

IF
AddedTo((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (CHARACTER)_PartyMember, _)
AND
DB_PartyMembers(_PartyMember)
THEN
NOT DB_GiveItemToEvent((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (FLAG)GOB_DrowCommander_Event_GivePlayerSpiderLyre_158e897c-59bd-2db7-0524-94bb33980d64);
NOT DB_GiveItemToEvent((ITEM)S_SCL_SpidersLyre_0054e844-cc8a-4b4e-89f0-b79dafcef0e5, (FLAG)CAMP_GoblinHuntCelebration_State_DrowBetrayalPacified_fb0ecbb3-fd85-ed40-8196-529afcdfd230);
//END_REGION

//REGION Post Act 2 Not Recruited
IF
LevelUnloading("SCL_Main_A")
AND
NOT DB_GlobalFlag((FLAG)GLO_Origin_PartOfTheTeam_Minthara_fa0e4e0b-08f9-4094-bfed-5205481c683c)
AND
QRY_ItemOrCharacterInCamp(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
SetOnStage((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);

IF
AddedTo((ITEM)S_GOB_DrowCommander_SpiderLyre_b44596d2-f533-42a1-8983-02521dfb1b4d, (CHARACTER)_Player, _ID)
THEN
NOT DB_GiveItemToEvent((ITEM)S_GOB_DrowCommander_SpiderLyre_b44596d2-f533-42a1-8983-02521dfb1b4d, (FLAG)CAMP_GoblinHuntCelebration_State_DrowBetrayalPacified_fb0ecbb3-fd85-ed40-8196-529afcdfd230);
NOT DB_GiveItemToEvent((ITEM)S_GOB_DrowCommander_SpiderLyre_b44596d2-f533-42a1-8983-02521dfb1b4d, (FLAG)GOB_DrowCommander_Event_GivePlayerSpiderLyre_158e897c-59bd-2db7-0524-94bb33980d64);
//END_REGION

//REGION Implementation of Exile/Exploit Arc tracking
IF
FlagSet((FLAG)ORI_Minthara_Event_ChoseExileOption_411b9665-85b1-4cb7-b0ab-304d4e641767, _, _)
THEN
PROC_IncreaseCounter("ORI_Minthara_ChoseExileOption");
ClearFlag((FLAG)ORI_Minthara_Event_ChoseExileOption_411b9665-85b1-4cb7-b0ab-304d4e641767);
PROC_ORI_Minthara_CheckMintharaStoryPath();

IF
FlagSet((FLAG)ORI_Minthara_Event_ChoseExploitOption_d90e8c60-dbb7-4215-ba52-1d5db067c90a, _, _)
THEN
PROC_IncreaseCounter("ORI_Minthara_ChoseExploitOption");
ClearFlag((FLAG)ORI_Minthara_Event_ChoseExploitOption_d90e8c60-dbb7-4215-ba52-1d5db067c90a);
PROC_ORI_Minthara_CheckMintharaStoryPath();

PROC
PROC_ORI_Minthara_CheckMintharaStoryPath()
AND
DB_GlobalCounter("ORI_Minthara_ChoseExileOption", _NumExile)
AND
DB_GlobalCounter("ORI_Minthara_ChoseExploitOption", _NumExploit)
AND
QRY_ORI_Minthara_ExileOrExploitEnding(_NumExile, _NumExploit)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Minthara_ExileOrExploitEnding((INTEGER)_NumExile, (INTEGER)_NumExploit)
AND
_NumExile >= _NumExploit
THEN
SetFlag((FLAG)ORI_Minthara_State_ExileEnding_22a42c26-d838-489c-8744-0914ee3a4b49);
ClearFlag((FLAG)ORI_Minthara_State_ExploitEnding_ecd667b6-d07b-478d-8e9b-808dfa7080f7);

QRY
QRY_ORI_Minthara_ExileOrExploitEnding((INTEGER)_NumExile, (INTEGER)_NumExploit)
AND
_NumExploit > _NumExile
THEN
SetFlag((FLAG)ORI_Minthara_State_ExploitEnding_ecd667b6-d07b-478d-8e9b-808dfa7080f7);
ClearFlag((FLAG)ORI_Minthara_State_ExileEnding_22a42c26-d838-489c-8744-0914ee3a4b49);


//END_REGION

//REGION Relationship Dialogues
IF
EnteredTrigger(_Player, (TRIGGER)S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81)
AND
DB_GlobalFlag((FLAG)ORI_Minthara_Event_AlurlssranSpoken_e94a907b-ac5a-422e-852e-0a6942fe78ed)
AND
GetFlag((FLAG)ORI_Minthara_Event_CalledPartnerAlurlssrin_84ddf16c-1c34-ef20-7900-29963e0d953a, _Player, 0)
THEN
SetFlag(ORI_Minthara_Event_CalledPartnerAlurlssrin_84ddf16c-1c34-ef20-7900-29963e0d953a, _Player);

IF
FlagSet((FLAG)LOW_BaldursMouth_Event_BoughtPaper_8ae9c432-8eb0-4959-bf42-3962e745853e, _, _)
THEN
SetFlag((FLAG)ORI_Minthara_Knows_BaldursMouthPropoganda_e493eab7-d363-42c7-9184-64b508510b2c);

IF
TadpolePowerAssigned((CHARACTER)_Avatar, _)
AND
DB_Avatars(_Avatar)
AND
GetFlag((FLAG)GLO_Tadpole_Event_FirstConsumed_fab5ae97-23b5-4bf2-88ae-0b1bd57523d8, _Avatar, 1)
AND
NOT DB_ORI_Minthara_ConsumedTadpole(1)
AND
NOT DB_ORI_Minthara_GainedTadpole(1)
AND
DB_PartOfTheTeam((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
DB_ORI_Minthara_ConsumedTadpole(1);
PROC_RelationshipDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8, (FLAG)ORI_Minthara_IPRD_ConsumedTadpoleAfterRecruited_8d1f5864-ea39-a49a-9436-59eadd300f03, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);

IF
AddedTo((ITEMROOT)UNI_TadpolePowerJar_1ec327be-3b7f-4502-9586-860e057e09ae, (CHARACTER)_Avatar, _)
AND
DB_Avatars(_Avatar)
AND
GetFlag((FLAG)GLO_Tadpole_Event_FirstConsumed_fab5ae97-23b5-4bf2-88ae-0b1bd57523d8, _Avatar, 0)
AND
NOT DB_ORI_Minthara_GainedTadpole(1)
AND
NOT DB_ORI_Minthara_ConsumedTadpole(1)
AND
DB_PartOfTheTeam((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
DB_ORI_Minthara_GainedTadpole(1);
PROC_RelationshipDialog((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (DIALOGRESOURCE)Minthara_InParty_13d72d55-0d47-c280-9e9c-da076d8876d8, (FLAG)ORI_Minthara_IPRD_PickedUpTadopleAfterRecruited_f9b4add3-a219-6771-5fd8-f534325deca5, (CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
//END_REGION

//REGION InParty Flag Management
IF
DB_GlobalFlag((FLAG)ORI_Shadowheart_State_SharPath_bf9ae334-ff6a-458d-b898-3074bca0bdfb)
AND
NOT DB_GlobalFlag((FLAG)GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e)
THEN
SetFlag((FLAG)ORI_Minthara_Knows_ShadowheartMayTurnFromShar_800bc976-433b-44ae-a241-c4ee0073b809);

IF
DB_GlobalFlag((FLAG)GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e)
AND
NOT DB_GlobalFlag((FLAG)ORI_Shadowheart_State_SharPath_bf9ae334-ff6a-458d-b898-3074bca0bdfb)
THEN
SetFlag((FLAG)ORI_Minthara_Knows_ShadowheartMayTurnFromShar_800bc976-433b-44ae-a241-c4ee0073b809);

IF
FlagSet((FLAG)ORI_Minthara_Event_AlurlssranSpoken_e94a907b-ac5a-422e-852e-0a6942fe78ed, (CHARACTER)_Player, _)
AND
DB_ORI_Partnered((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Player)
AND
GetFlag((FLAG)ORI_Minthara_Event_CalledPartnerAlurlssrin_84ddf16c-1c34-ef20-7900-29963e0d953a, _Player, 0)
THEN
DB_ORI_Minthara_CampNightDelay(1);

PROC
PROC_LongRest()
AND
NOT DB_ORI_Minthara_CampNightDelay(1)
AND
DB_GlobalFlag((FLAG)ORI_Minthara_Event_AlurlssranSpoken_e94a907b-ac5a-422e-852e-0a6942fe78ed)
AND
DB_ORI_Partnered((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (CHARACTER)_Player)
AND
GetFlag((FLAG)ORI_Minthara_Event_CalledPartnerAlurlssrin_84ddf16c-1c34-ef20-7900-29963e0d953a, _Player, 0)
THEN
SetFlag(ORI_Minthara_Event_CalledPartnerAlurlssrin_84ddf16c-1c34-ef20-7900-29963e0d953a, _Player);

PROC
PROC_LongRest()
AND
DB_ORI_Minthara_CampNightDelay(1)
THEN
NOT DB_ORI_Minthara_CampNightDelay(1);

PROC
PROC_TopicalGreeting_SetNewTopic((FLAG)_Flag)
THEN
SetFlag((FLAG)GLO_Minthara_InParty_HasTopicalGreeting_8069e1a8-51b5-afc0-de8c-f5af844f034d, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

PROC
PROC_TopicalGreeting_ClearOldTopic()
AND
GetFlag((FLAG)GLO_Minthara_InParty_HasTopicalGreeting_8069e1a8-51b5-afc0-de8c-f5af844f034d, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1)
THEN
ClearFlag(GLO_Minthara_InParty_HasTopicalGreeting_8069e1a8-51b5-afc0-de8c-f5af844f034d, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//END_REGION

//REGION Add Tadpole Powers
IF
BaseFactionChanged((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (FACTION)GLO_DrowCommander_f984f683-e819-439e-af7c-48906053c20b, (FACTION)Companion12_aeaf8c61-8ff3-1bc2-18fc-7da29495fc68)
AND
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
QRY_OnlyOnce("MintharaGetsHerTadpolePowers")
THEN
SetTadpoleTreeState(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 2);
AddTadpole(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 4);
AddTadpolePower(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "TAD_IllithidPersuasion", 1);
AddTadpolePower(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "Target_TAD_ConcentratedBlast", 1);
AddTadpolePower(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "TAD_PeaceBreaker", 1);
AddTadpolePower(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "TAD_Charm", 1);
AddTadpolePower(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "TAD_PsionicBacklash", 1);

QRY
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
NOT DB_GLO_DaisyAccepted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
DB_GLO_DaisyAccepted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

QRY
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
NOT DB_GLO_DaisyUnlocked(1)
THEN
DB_GLO_DaisyUnlocked(1);

QRY
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
NOT DB_GLO_Tadpole_HadConsumeDialog(1)
THEN
DB_GLO_Tadpole_HadConsumeDialog(1);

QRY
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
NOT DB_GLO_TadpoleTreeEnabled(1)
THEN
DB_GLO_TadpoleTreeEnabled(1);

QRY
QRY_ORI_Minthara_AbleToGainTadpolePowers()
AND
1 == 1
THEN
DB_NOOP(1);
//END_REGION

//REGION Difficulty HP boosts
PROC
PROC_DEN_AttackOnDen_BetrayTieflings()
THEN
PROC_GLO_DifficultyModes_AddPlayerBonuses((CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//END_REGION

//REGION Minthara should never go off stage "to warn authorities"
QRY
QRY_CRIME_Guards_GuardKillerExcludeWitness(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b)
THEN
DB_NOOP(1);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ModWrapper_Gustav"
