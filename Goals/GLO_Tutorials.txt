Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_TUT_DisplayMessages(1);

//Party size excl. avatars and followers
DB_GLO_Tutorials_ActiveCompanionCount(0);

DB_GLO_Tutorials_EncumberedStatuses("ENCUMBERED_LIGHT");
DB_GLO_Tutorials_EncumberedStatuses("ENCUMBERED_HEAVY");
DB_GLO_Tutorials_EncumberedStatuses("ENCUMBERED_MAX");

DB_GLO_Tutorials_ToughnessStatuses("DEBRIS_THRESHOLD");
DB_GLO_Tutorials_ToughnessStatuses("DEBRIS_THRESHOLD_LESSER");
DB_GLO_Tutorials_ToughnessStatuses("DEBRIS_THRESHOLD_GREATER");

DB_GLO_Tutorials_TutorialChains_Optional((UNIFIEDTUTORIAL)DLC_Items_0f69a7be-e9ae-4470-a371-f0ec7bad2ade, (UNIFIEDTUTORIAL)Your_Journal_504d7a73-a518-4a6e-ac55-6d47fe04f44d);

DB_GLO_Tutorials_BardicInspirationStatuses("BARDIC_INSPIRATION");
DB_GLO_Tutorials_BardicInspirationStatuses("BARDIC_INSPIRATION_D8");
DB_GLO_Tutorials_BardicInspirationStatuses("BARDIC_INSPIRATION_COMBAT");
DB_GLO_Tutorials_BardicInspirationStatuses("BARDIC_INSPIRATION_COMBAT_D8");

DB_GLO_Tutorials_ContainerItemTags((TAG)KEY_9851fa99-5538-432a-8e77-c90929a88974); 
DB_GLO_Tutorials_ContainerItemTags((TAG)ALCH_INGREDIENT_64b824e7-50c5-475a-98c2-52026e372d77);

DB_GLO_Tutorials_SneakAttackSpells("Target_SneakAttack");
DB_GLO_Tutorials_SneakAttackSpells("Projectile_SneakAttack");

DB_GLO_Tutorials_FlammableSurfaces("SurfaceOvergrowth");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceCausticBrine");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceAlcohol");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceWeb");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceAlienOil");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceBlackPowder");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceOil");
DB_GLO_Tutorials_FlammableSurfaces("SurfaceGrease");

DB_GLO_Tutorials_EndTheDayTutorials((UNIFIEDTUTORIAL)End_the_day__low_health_and_no_short_rests__3944e9b3-5090-4fc5-8a4d-a7ac204917ca);
DB_GLO_Tutorials_EndTheDayTutorials((UNIFIEDTUTORIAL)End_the_day__depleted_short_rest_resource__b931d222-c59c-41a1-9081-dca461606342);
DB_GLO_Tutorials_EndTheDayTutorials((UNIFIEDTUTORIAL)End_the_day__depleted_long_rest_resource__388fad02-67dc-4d8f-940c-9821322ec16b);

DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Shout_SecondWind");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Shout_ActionSurge");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_PommelStrike");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_Slash_New"); //aka Lacerate
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Projectile_HamstringShot");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Rush_SpringAttack");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_SneakAttack");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Projectile_SneakAttack");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_PiercingThrust");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_OpeningAttack");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Zone_Cleave");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_VampireBite_Astarion");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Projectile_PiercingShot");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_HinderingSmash");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_Topple");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Shout_Steady");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_HeartStopper");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Shout_SteadyRangedCrossbow");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_PostureBreaker");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_CripplingStrike");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Projectile_MobileShooting");
DB_GLO_TutorialEvents_EndTheDayTutorial_ShortRestSpells("Target_DisarmingStrike");

DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_UND_KethericCity_AdamantineGolem_2a5997fc-5f2a-4a13-b309-bed16da3b255);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_FOR_Bottomless_SpiderQueen_e6b2f3ba-2d02-4507-8680-6047322e1a4b);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_UND_TheDrowNere_06bf05c5-216b-4eaf-91f5-8f1dd3d57f30);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_FOR_OwlBear_e903a41f-8ef7-46dc-a847-7d0ec2804d08);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_UND_Bulette_307934b5-6fb5-4fdc-a7ff-433a7ba175b3);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_UND_Automaton_5038c0f2-0022-4699-82ce-a319b30616bb);
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)S_MOO_Ketheric_e9918f3e-5b87-40a3-a9bd-61545151573f);


//Some tutorial UUID definitions exist for journal only to cover multiple versions of the actual tutorial messages that pop-up
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Proficiences__JOURNAL__d0c768c4-1621-475b-bcc2-0bc09b5df58c, (UNIFIEDTUTORIAL)Weapon_Proficiency_19548521-dbd0-4408-8947-5b9cd8111314);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Proficiences__JOURNAL__d0c768c4-1621-475b-bcc2-0bc09b5df58c, (UNIFIEDTUTORIAL)Armour_Proficiency_e974fec1-52af-41c7-8283-fd9610aedfdb);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Proficiences__JOURNAL__d0c768c4-1621-475b-bcc2-0bc09b5df58c, (UNIFIEDTUTORIAL)Shield_Proficiency_4ce5ced0-5877-4eec-af81-349991a2c180);

DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Advantage_and_Disadvantage__JOURNAL__f41bdcac-83d2-4021-ba5b-5003ba4fc722, (UNIFIEDTUTORIAL)Rolling_with_Advantage_adaf8797-d1cd-45e2-95f4-96de80e56b20);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Advantage_and_Disadvantage__JOURNAL__f41bdcac-83d2-4021-ba5b-5003ba4fc722, (UNIFIEDTUTORIAL)Rolling_with_Disadvantage_cdc4bd35-ae5c-4117-9c72-e34b1ee6e336);

DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Camera_Controls__JOURNAL__88dadee8-e6cf-4046-b4db-61199a1f16ed, (UNIFIEDTUTORIAL)Camera_Rotation_27b3873b-0353-4284-b901-32edbcfa9fe1);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Camera_Controls__JOURNAL__88dadee8-e6cf-4046-b4db-61199a1f16ed, (UNIFIEDTUTORIAL)Camera_Movement_211b326e-4f31-4622-bfdb-07d6d5491ce7);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Camera_Controls__JOURNAL__88dadee8-e6cf-4046-b4db-61199a1f16ed, (UNIFIEDTUTORIAL)Camera_Distance_69c641d6-e8d7-4893-bc66-4b52d7657e1b);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Camera_Controls__JOURNAL__88dadee8-e6cf-4046-b4db-61199a1f16ed, (UNIFIEDTUTORIAL)Center_View_9b2defbf-eb6c-4660-9479-b121936f7804);

DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Sneak_Attack__JOURNAL__f7d4a625-a2b5-42e4-afff-712dcdb3a1c3, (UNIFIEDTUTORIAL)Sneak_Attack__advantage__608a969d-a156-40c8-b539-a77e856f2424);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Sneak_Attack__JOURNAL__f7d4a625-a2b5-42e4-afff-712dcdb3a1c3, (UNIFIEDTUTORIAL)Sneak_Attack__ally_in_melee_distance__ebf3bd95-ffb7-4e00-9e71-e1c5adc8e43d);

DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Spellcasting__JOURNAL__d0b62295-5aeb-441b-b7b0-98a7096f6296, (UNIFIEDTUTORIAL)Warlock_Spellcasting_2b331195-bd39-4bdf-be90-896d89229d13);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Spellcasting__JOURNAL__d0b62295-5aeb-441b-b7b0-98a7096f6296, (UNIFIEDTUTORIAL)Learning_Spells_3d80918d-5a85-4cf2-bc79-101e97f8c962);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Spellcasting__JOURNAL__d0b62295-5aeb-441b-b7b0-98a7096f6296, (UNIFIEDTUTORIAL)Metamagic_18a5b24d-082a-4017-879d-0c641af3cb3c);
DB_GLO_Tutorials_JournalGroups((UNIFIEDTUTORIAL)Spellcasting__JOURNAL__d0b62295-5aeb-441b-b7b0-98a7096f6296, (UNIFIEDTUTORIAL)Prepare_Spells_8bf00f46-c0c6-405c-9749-21a64a45d158);
KBSECTION
//REGION Tutorials

//REGION Party
// Followers Tutorial
IF
DB_PartyFollowers(_Follower)
AND
CharacterGetOwner(_Follower, _Player)
AND
DB_Players(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Followers_09969abc-53ab-4fcc-aa78-5f1c85af1e51);

IF
GainedControl(_Follower)
AND
CharacterGetOwner(_Follower, _Player)
AND
DB_Players(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Followers_09969abc-53ab-4fcc-aa78-5f1c85af1e51);


// Summons Tutorial
IF
DB_PlayerSummons(_Summon)
AND
CharacterGetOwner(_Summon, _Player)
AND
NOT DB_Is_InCombat(_Player, _)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Summons_ad65827a-64fe-4d33-9eb2-20dd8c80b044);

IF
GainedControl(_Summon)
AND
CharacterGetOwner(_Summon, _Player)
AND
DB_Players(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Summons_ad65827a-64fe-4d33-9eb2-20dd8c80b044);


//Full Party Tutorial
IF 
DB_GlobalFlag((FLAG)GLO_Tuturials_FullPartyRejection_94a40e88-0e15-33f5-0beb-0332de542341)
AND
DB_Players(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Full_Party_72bdfdaf-6f7a-4e38-9800-b3ee322bb479);
ClearFlag((FLAG)GLO_Tuturials_FullPartyRejection_94a40e88-0e15-33f5-0beb-0332de542341);


//Avatar Dismissal Tutorials
PROC
PROC_SetAvatarDismissable(_)
AND
NOT DB_GLO_AvatarDismissalForbidden(1)
THEN
PROC_GLO_Tutorials_TrackedTimerStart("GLO_Tutorials_DismissAvatarsDelay", 5000);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished("GLO_Tutorials_DismissAvatarsDelay")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord("GLO_Tutorials_DismissAvatarsDelay");

PROC
PROC_GLO_Tutorials_TrackedTimerFinished("GLO_Tutorials_DismissAvatarsDelay")
AND
DB_Avatars(_Avatar)
AND
NOT DB_Dead(_Avatar)
AND
QRY_GLO_AvatarCanBeDismissed(_Avatar)
AND
GetReservedUserID(_Avatar,_UserID)
AND
DB_Avatars(_Player)
AND
_Player != _Avatar
AND
GetReservedUserID(_Player,_UserID)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Dismiss_Avatar_ea544a76-afd2-48c1-88b0-4fa2edb45598);

IF
DialogStarted((DIALOGRESOURCE)GLO_AvatarDismissal_3132e4bf-3c94-1338-356b-cc105e26d407, _InstanceID)
AND
DB_DialogPlayers(_InstanceID, _Player, _)
THEN
PROC_GLO_Tutorials_TrackedTimerCancel("GLO_Tutorials_DismissAvatarsDelay");
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord("GLO_Tutorials_DismissAvatarsDelay");
SetTutorialShown((CHARACTER)_Player, (UNIFIEDTUTORIAL)Dismiss_Avatar_ea544a76-afd2-48c1-88b0-4fa2edb45598);

//Friends Container Tutorial
IF
DB_PlayerInCamp(_Player)
AND
NOT QRY_IsEmptyDB("DB_DismissedAvatar", 1)
AND
NOT DB_Camp_NightMode(1)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_FriendsContainerDelay", 8000);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_FriendsContainerDelay")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_FriendsContainerDelay");

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_FriendsContainerDelay")
AND
NOT QRY_IsEmptyDB("DB_DismissedAvatar", 1)
AND
DB_PlayerInCamp((CHARACTER)_Player)
AND
NOT DB_Camp_NightMode(1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Friends_Container_00eb939c-b30e-4660-bba8-0439e022d091);

IF
DB_Camp_NightMode(1)
AND
DB_Players(_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerCancel(_Player, "GLO_Tutorials_FriendsContainerDelay");
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_FriendsContainerDelay");

PROC
PROC_CAMP_LeftCamp(_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerCancel(_Player, "GLO_Tutorials_FriendsContainerDelay");
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_FriendsContainerDelay");

PROC
PROC_GLO_AvatarDismissed(_)
AND
DB_PlayerInCamp(_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_FriendsContainerDelay", 8000);

IF
TemplateUseStarted(_Player, FUR_GEN_Wardrobe_Player_A_d94c7491-0868-4444-b83c-82f5454d4b64, _)
THEN
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Friends_Container_00eb939c-b30e-4660-bba8-0439e022d091);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Friends_Container_00eb939c-b30e-4660-bba8-0439e022d091);
//END_REGION Party

//REGION Inventory and items
// Equipment Tutorial
IF
AddedTo(_Item, _Player, _)
AND
DB_GLO_Tutorials_TrackedTimers((GUIDSTRING)_Player, "GLO_Tutorials_TemporaryEquipmentTutSuppression", "Finished")
AND
DB_Players((CHARACTER)_Player)
AND
QRY_IsExistingItem(_Item,1)
AND
IsEquipable((ITEM)_Item, 1)
AND
IsEquipped(_Item, 0)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_EquipmentOverlapPrevention", 1500);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_EquipmentOverlapPrevention")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_EquipmentOverlapPrevention");

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_EquipmentOverlapPrevention")
AND
IsAnyTutorialShowingFor((CHARACTER)_Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Equipment_24382480-0b5b-4aa9-8f39-d7af8e188410);

//Encumbered Tutorial
IF
StatusApplied(_Player, _Status, _, _)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GLO_Tutorials_EncumberedStatuses(_Status)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Encumbered_a3ad1e91-0888-4eac-a3dd-3ff40c9941e6);


//Ranged Attacks Tutorial
IF
Equipped(_Item, _Player)
AND
DB_Players((CHARACTER)_Player)
AND
IsRangedWeapon(_Item, 1, 1)
AND
DB_GLO_Tutorials_TrackedTimers((GUIDSTRING)_Player, "GLO_Tutorials_TemporaryEquipmentTutSuppression", "Finished")
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Ranged_Attacks_6664771a-b20b-423b-8e37-a6add7e140ea);


//Inventory Containers Tutorial
IF
AddedTo(_Item, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GLO_Tutorials_ContainerItemTags(_Tag)
AND
Exists(_Item,1)
AND
IsTagged(_Item, _Tag, 1)
AND
DB_GLO_Tutorials_TrackedTimers((GUIDSTRING)_Player, "GLO_Tutorials_TemporaryEquipmentTutSuppression", "Finished")
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Inventory_Containers_cda6fcdd-74e8-4b63-bfa8-6ef3edca4779);

//edge case - possible overlap with camp supplies tutorial. Solution - delay this a bit to ensure Camp suppliers triggered first. Then, if some tutorial is showing, suppress until next pickup.
IF
AddedTo(_Item, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
QRY_IsExistingItem(_Item, 1)
AND
ItemGetSupplyValue((ITEM)_Item, _SupplyValue)
AND
_SupplyValue > 0
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_InventoryContainers", 1000);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_InventoryContainers")
AND
IsAnyTutorialShowingFor((CHARACTER)_Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Inventory_Containers_cda6fcdd-74e8-4b63-bfa8-6ef3edca4779);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_InventoryContainers")
AND
IsAnyTutorialShowingFor((CHARACTER)_Player, 1)
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_InventoryContainers");


//Alchemy Tutorial
//ingredients
IF
AddedTo(_AlchemyIngredient, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
Exists(_AlchemyIngredient, 1)
AND
IsTagged(_AlchemyIngredient, (TAG)ALCH_INGREDIENT_64b824e7-50c5-475a-98c2-52026e372d77, 1)
AND
GetTemplate(_AlchemyIngredient, _AlchemyIngredientTemplate)
AND
TemplateGetCountInMagicPockets((ROOT)_AlchemyIngredientTemplate, _Player, _Amount)
AND
_Amount > 2
AND
DB_Players(_AllPlayers)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_AllPlayers, (UNIFIEDTUTORIAL)Alchemy_280a7ac6-0edf-418e-8c9f-8216cf17ef19);


//Books Tutorial
IF
AddedTo(_Book, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
Exists(_Book, 1)
AND
IsTagged(_Book, (TAG)BOOK_8a8e253a-c081-45a1-9fa2-91b6901dc568, 1)
AND
IsTagged(_Book, (TAG)SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09, 0)
AND
NOT GetTemplate(_Book, UNI_S_DebugBook_31ee023c-d151-40f6-917e-84066772783b)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Books_e9297013-6a19-4c86-9f35-1cfd4edddb5b);

IF
UseStarted(_Player, _Book)
AND
DB_Players(_Player)
AND
IsTagged(_Book, (TAG)BOOK_8a8e253a-c081-45a1-9fa2-91b6901dc568, 1)
AND
IsTagged(_Book, (TAG)SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09, 0)
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Books_e9297013-6a19-4c86-9f35-1cfd4edddb5b);

IF
RemovedFrom(_Book, _Player)
AND
DB_Players((CHARACTER)_Player)
AND
Exists(_Book,1)
AND
IsTagged(_Book, (TAG)SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09, 0)
AND
IsTagged(_Book, (TAG)BOOK_8a8e253a-c081-45a1-9fa2-91b6901dc568, 1)
AND
ItemTagIsInInventory("BOOK_8a8e253a-c081-45a1-9fa2-91b6901dc568", (GUIDSTRING)_Player, _AllBooksCount)
AND
ItemTagIsInInventory("SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09", (GUIDSTRING)_Player, _SpellScrollsCount)
AND
_AllBooksCount <= _SpellScrollsCount
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Books_e9297013-6a19-4c86-9f35-1cfd4edddb5b);
//END_REGION Inventory and items

//REGION Camp and Resting
// Camp Tutorial
IF
DB_PlayerInCamp(_Player)
AND
QRY_OnlyOncePerUser(_Player, "GLO_Tutorials_CampTutorialTimer")
THEN
ObjectTimerLaunch((GUIDSTRING)_Player, "GLO_Tutorials_CampTutorialTimer", 3000, 0);

IF
ObjectTimerFinished(_Player, "GLO_Tutorials_CampTutorialTimer")
AND
DB_PlayerInCamp((CHARACTER)_Player)
AND
QRY_OnlyOncePerUser_Reset("GLO_Tutorials_CampTutorialTimer")
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Camp_0dc3c736-083e-4195-856e-cd47f2a36e43);


// Sleeping Tutorial
IF //all players are forced into camp on night mode activation
DB_Camp_NightMode(1)
THEN
TimerCancel("GLO_Tutorials_Sleeping");
TimerLaunch("GLO_Tutorials_Sleeping", 45000);

IF
TimerFinished("GLO_Tutorials_Sleeping")
AND
DB_Players(_Player)
AND
DB_Camp_NightMode(1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Sleeping_ec059164-013d-4937-b8ce-236f79153ad2);

PROC
PROC_LongRest()
AND
DB_Players(_Player)
THEN
TimerCancel("GLO_Tutorials_Sleeping");
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Sleeping_ec059164-013d-4937-b8ce-236f79153ad2);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Sleeping_ec059164-013d-4937-b8ce-236f79153ad2);

IF
TutorialEvent(_Player, (TUTORIALEVENT)CampSupplies_Opened_586ce1fc-4254-4439-a545-c5393b273825)
THEN
TimerCancel("GLO_Tutorials_Sleeping");
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Sleeping_ec059164-013d-4937-b8ce-236f79153ad2);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Sleeping_ec059164-013d-4937-b8ce-236f79153ad2);


//Fully Resting Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)CampSupplies_Opened_586ce1fc-4254-4439-a545-c5393b273825)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Fully_Resting_a664ec90-4367-49d0-9dab-08e544d01aa5);

PROC
PROC_LongRest()
AND
DB_Players(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Fully_Resting_a664ec90-4367-49d0-9dab-08e544d01aa5);


//Leave Camp Tutorial
PROC
PROC_LongRest()
AND
DB_Players(_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_LeaveCampTutorialDelay", 40000);

IF
DB_PlayerInCamp(_Player)
AND
NOT DB_Camp_NightMode(1) //you can be pulled directly into night mode
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_LeaveCampTutorialDelay", 40000);

IF
DB_Camp_NightMode(1)
AND
DB_Players(_Player)
THEN
ObjectTimerCancel(_Player, "GLO_Tutorials_LeaveCampTutorialDelay");
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_LeaveCampTutorialDelay");

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_LeaveCampTutorialDelay")
AND
DB_InCamp((CHARACTER)_Player)
AND
NOT DB_Camp_NightMode(1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Leave_Camp_605e1ae5-9c77-4a65-8a73-c538734a1174);


PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_LeaveCampTutorialDelay")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_LeaveCampTutorialDelay");

PROC
PROC_CAMP_LeftCamp(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Leave_Camp_605e1ae5-9c77-4a65-8a73-c538734a1174);
//END_REGION Camp and Resting

//REGION Combat + Death related
//Downed + Helping Downed Characters Tutorial
//note - there are many seemingly redudant checks for DB_Players. This is because there are some non-players downed too, like Nightsong - who has her own tutorial. We want to avoid overlap there.
//1a. show downed tut to other allies in combat
IF
TurnStarted(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
NOT QRY_IsEmptyDB("DB_Downed", 1)
AND
DB_Is_InCombat(_Player, _)
AND
NOT DB_Crime_DefeatedPlayers(_Player, _)
AND
NOT DB_Dominated(_Player)
AND
NOT DB_Downed(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Downed_3ad19c19-6627-4771-8498-a48da8560d74);

//1b. show to selfhelpless victim in combat in multiplayer
IF
TurnStarted(_Player)
AND
DB_Downed((CHARACTER)_Player)
AND
NOT DB_Crime_DefeatedPlayers(_Player, _)
AND
QRY_IsMultiPlayer()
AND
NOT QRY_GLO_Tutorials_HasPlayerOtherUnrestrainedCharacters(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Downed__mutiplayer__2e95e00e-bab4-47f0-ad93-1dcee3e47da4);

//1c. show downed immediately to everyone outside combat who can perform actions
PROC
PROC_Downed((CHARACTER)_Player)
AND
DB_Players(_Player)
AND
DB_Players(_OtherPlayer)
AND
_OtherPlayer != _Player
AND
NOT DB_CantAct(_OtherPlayer) //covers chars in combat
AND
NOT DB_Crime_DefeatedPlayers(_Player, _)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_OtherPlayer, (UNIFIEDTUTORIAL)Downed_3ad19c19-6627-4771-8498-a48da8560d74);

//1d. show downed immediately to self-helpless victim outside combat in multiplayer
PROC
PROC_Downed((CHARACTER)_Player)
AND
DB_Players(_Player)
AND
QRY_IsMultiPlayer()
AND
NOT DB_Is_InCombat(_Player, _)
AND
NOT QRY_GLO_Tutorials_HasPlayerOtherUnrestrainedCharacters(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Downed__mutiplayer__2e95e00e-bab4-47f0-ad93-1dcee3e47da4);

//2. React to dismissal of Downed
IF
TutorialClosed(_UserId, (UNIFIEDTUTORIAL)Downed_3ad19c19-6627-4771-8498-a48da8560d74)
AND
DB_PartyMembers(_Player)
AND
NOT DB_Downed(_Player)
AND
GetReservedUserID(_Player, _UserId)
AND
IsControlled(_Player, 1)
THEN
PROC_GLO_Tutorials_ProcessDownedTutorial(_Player);

PROC
PROC_GLO_Tutorials_ProcessDownedTutorial((CHARACTER)_Player)
AND
CanShowSpellForCharacter(_Player, "Target_Help", 1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters_a9e1a696-1985-4419-8828-beaee6ed68a4);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__shapeshift__c631c0e1-9340-4045-90a5-143e0d83e678);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__familiar__034c85b4-5a51-4f09-a389-2884bcbc09dc);

PROC
PROC_GLO_Tutorials_ProcessDownedTutorial((CHARACTER)_Player)
AND
CanShowSpellForCharacter(_Player, "Target_Help", 0)
AND
DB_Is_WildShaped(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__shapeshift__c631c0e1-9340-4045-90a5-143e0d83e678);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters_a9e1a696-1985-4419-8828-beaee6ed68a4);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__familiar__034c85b4-5a51-4f09-a389-2884bcbc09dc);

PROC
PROC_GLO_Tutorials_ProcessDownedTutorial((CHARACTER)_Player)
AND
CanShowSpellForCharacter(_Player, "Target_Help", 0)
AND
DB_PlayerSummons(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__familiar__034c85b4-5a51-4f09-a389-2884bcbc09dc);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__shapeshift__c631c0e1-9340-4045-90a5-143e0d83e678);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters_a9e1a696-1985-4419-8828-beaee6ed68a4);

//3. Hides
IF
DownedChanged(_DownedPlayer, 0)
AND
DB_Players(_DownedPlayer)
AND
DB_Players(_Player)
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters_a9e1a696-1985-4419-8828-beaee6ed68a4);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__shapeshift__c631c0e1-9340-4045-90a5-143e0d83e678);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Helping_Downed_Characters__familiar__034c85b4-5a51-4f09-a389-2884bcbc09dc);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Stabilized_d61b70c9-8aba-4859-8cfd-a840646ed647);

QRY
QRY_GLO_Tutorials_HasPlayerOtherUnrestrainedCharacters((CHARACTER)_Player)
AND
GetReservedUserID(_Player, _UserId)
AND
DB_PartyMembers(_PartyMember)
AND
GetReservedUserID(_PartyMember, _UserId)
AND
NOT QRY_IsCharaterUnconsciousOrEquivalent(_PartyMember)
AND
NOT DB_Dominated(_PartyMember)
THEN
DB_NOOP(1);


// Player Death Tutorial
IF
Died(_DeadChar)
AND
DB_Players(_DeadChar)
AND
DB_CanBeResurrected(_DeadChar)
AND
DB_Players(_Player)
AND
_Player != _DeadChar
AND
NOT DB_Dominated(_Player)
AND
NOT QRY_IsCharaterUnconsciousOrEquivalent(_Player)
AND
TemplateIsInPartyInventory(LOOT_SCROLL_Revivify_c1c3e4fb-d68c-4e10-afdc-d4550238d50e, _Player, _Count, 0)
AND
_Count > 0
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Dead_Character_ce58721e-f481-471e-86c8-c1712d928f84);


//Stabilized Tutorial
PROC //preventing misfire on beach
PROC_CRA_WakeupDone()
THEN
SetFlag((FLAG)CRA_WakeUp_WakeUpDone_c72b29a9-dcbc-487a-8ddd-707d8de73494);

QRY
QRY_GLO_Tutorials_Stabilized_IsExcludedMoment()
AND
DB_CurrentLevel("WLD_Main_A")
AND
NOT DB_GlobalFlag(CRA_WakeUp_WakeUpDone_c72b29a9-dcbc-487a-8ddd-707d8de73494)
THEN
DB_NOOP(1);

IF
DeathSaveStable(_StabilizedChar)
AND
NOT QRY_GLO_Tutorials_Stabilized_IsExcludedMoment()
AND
DB_Players(_Player)
AND
QRY_IsInRange((GUIDSTRING)_Player,(GUIDSTRING)_StabilizedChar, 40.0)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Stabilized_d61b70c9-8aba-4859-8cfd-a840646ed647);


// Turn Based Mode Tutorial
IF
EnteredForceTurnBased(_Player)
AND
DB_Players((CHARACTER)_Player)
AND
NOT DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Turn_Based_Mode_998714b4-730b-42c2-887f-38490ea14296);

IF
EnteredForceTurnBased(_Player)
AND
DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player)
THEN
NOT DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player);

IF
LeftForceTurnBased(_Player)
AND
DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player)
THEN
NOT DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player);

PROC
PROC_ORI_Gale_DeathVoice_BringInFTBSpeakers((CHARACTER)_Player)
AND
IsInForceTurnBasedMode(_Player,0)
THEN
DB_GLO_Tutorials_IgnoreFTB((CHARACTER)_Player);

//Combat Log Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)CombatLog_Expanded_158714b2-749d-4b92-96b8-3590922dcc2c)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Combat_Log_b9cdfe52-86e5-4366-9dd9-cd1148f76e68);


//Attack of Opportunity Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)AttackOfOpportunity_f658a860-7e3e-44fd-807b-88d3c0c31217)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Attack_of_Opportunity_1343038f-4eba-4118-bab6-2dd45b1f28ca);


//Reactions Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)ReactionDecision_Opened_1a3c4bbd-4db8-4c58-9620-f1f78d57c964)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Reactions_d7502a3e-1cae-4d97-abaf-f78ea54540e6);

IF
TurnEnded(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Reactions_d7502a3e-1cae-4d97-abaf-f78ea54540e6);

IF
TutorialEvent(_Player, (TUTORIALEVENT)Reactions_Opened_266efe77-4587-4b3f-9217-605923add7c5)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Reactions_d7502a3e-1cae-4d97-abaf-f78ea54540e6);


//Off Hand Attack aka Dual-wielding Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)DualWielding_Active_630445cb-2845-4dc0-b7cc-36eb615e470a)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Off_Hand_Attack_5d4c50fd-2ee9-4779-8361-f8122aa9afdb);


//Warlock Spellcasting Tutorial
IF
StartedPreviewingSpell(_Player, _Spell, 1, 0)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
IsTagged(_Player, (TAG)WARLOCK_5804f55a-93f7-4281-9512-8d548a9e2a22, 1)
AND
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Warlock_Spellcasting_2b331195-bd39-4bdf-be90-896d89229d13);


QRY
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
AND
GetActionResourceValuePersonal(_Player, "WarlockSpellSlot", 1, 2.0)
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
AND
GetActionResourceValuePersonal(_Player, "WarlockSpellSlot", 2, 2.0)
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
AND
GetActionResourceValuePersonal(_Player, "WarlockSpellSlot", 3, 2.0)
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
AND
GetActionResourceValuePersonal(_Player, "WarlockSpellSlot", 4, 2.0)
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_HasWarlockSpellSlots((CHARACTER)_Player)
AND
GetActionResourceValuePersonal(_Player, "WarlockSpellSlot", 5, 2.0)
THEN
DB_NOOP(1);


//Sneak Attack Tutorials
//Sneak Attack (ally in melee distance) Tutorial
IF
TurnStarted(_Player)
AND
DB_Players((CHARACTER)_Player)
AND
IsTagged(_Player, (TAG)ROGUE_f8a0608b-666c-4be6-a49c-03b369c10bd2, 1)
AND
QRY_GLO_Tutorials_CanCastAnySneakAttack(_Player)
AND
DB_Is_InCombat(_Player, _CombatId)
AND
DB_Is_InCombat(_Enemy, _CombatId)
AND
IsEnemy((CHARACTER)_Player, (CHARACTER)_Enemy, 1)
AND
HasActiveStatus(_Enemy, "FLANKED", 1)
AND
HasActiveStatus(_Player, "FLANKED", 0)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Sneak_Attack__ally_in_melee_distance__ebf3bd95-ffb7-4e00-9e71-e1c5adc8e43d);

QRY
QRY_GLO_Tutorials_CanCastAnySneakAttack((CHARACTER)_Player)
AND
DB_GLO_Tutorials_SneakAttackSpells(_SneakAttackSpell)
AND
CanCastSpellOnEnemyInSameCombat((CHARACTER)_Player, _SneakAttackSpell, _ValidTarget) 
AND
_ValidTarget != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_NOOP(1);

//Sneak Attack (advantage) Tutorial
//Hiding Advantage Tutorial
IF
StartedPreviewingSpell(_Player, _SneakAttackSpell, _, _)
AND
DB_GLO_Tutorials_SneakAttackSpells(_SneakAttackSpell)
AND
NOT QRY_GLO_Tutorials_AnyFlankedEnemyExists((CHARACTER)_Player)
THEN
PROC_GLO_Tutorials_EvaluateSneakAttackTutorial((CHARACTER)_Player);

QRY
QRY_GLO_Tutorials_AnyFlankedEnemyExists((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _CombatId)
AND
DB_Is_InCombat(_Enemy, _CombatId)
AND
IsEnemy((CHARACTER)_Player, (CHARACTER)_Enemy, 1)
AND
HasActiveStatus(_Enemy, "FLANKED", 1)
THEN
DB_NOOP(1);

//tested: It's never true to be unable to land Projectile_SneakAttack when you can already land Target_SneakAttack. Opposite is not true. Therefore test for Projectile_SneakAttack is enough.
PROC
PROC_GLO_Tutorials_EvaluateSneakAttackTutorial((CHARACTER)_Player)
AND
CanCastSpellOnEnemyInSameCombat((CHARACTER)_Player, "Projectile_SneakAttack", _ValidTarget)
AND
_ValidTarget != NULL_00000000-0000-0000-0000-000000000000
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Sneak_Attack__advantage__608a969d-a156-40c8-b539-a77e856f2424);

PROC
PROC_GLO_Tutorials_EvaluateSneakAttackTutorial((CHARACTER)_Player)
AND
CanCastSpellOnEnemyInSameCombat((CHARACTER)_Player, "Projectile_SneakAttack", _ValidTarget) 
AND
_ValidTarget == NULL_00000000-0000-0000-0000-000000000000
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Hiding_Advantage_5bcdad00-4677-4e9e-a99d-77b29b02b95b);

IF
TurnEnded(_Player)
AND
DB_Players((CHARACTER)_Player)
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Sneak_Attack__advantage__608a969d-a156-40c8-b539-a77e856f2424);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Sneak_Attack__ally_in_melee_distance__ebf3bd95-ffb7-4e00-9e71-e1c5adc8e43d);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Hiding_Advantage_5bcdad00-4677-4e9e-a99d-77b29b02b95b);

IF
CastedSpell(_Player, _Spell, _, _, _)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GLO_Tutorials_SneakAttackSpells(_Spell)
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Sneak_Attack__advantage__608a969d-a156-40c8-b539-a77e856f2424);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Sneak_Attack__ally_in_melee_distance__ebf3bd95-ffb7-4e00-9e71-e1c5adc8e43d);

IF
StatusApplied(_Player, "SNEAKING", _, _)
AND
DB_Players((CHARACTER)_Player)
THEN
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Hiding_Advantage_5bcdad00-4677-4e9e-a99d-77b29b02b95b);


//Temporarily Hostile Tutorial
IF
TurnStarted(_Player)
AND
DB_Players((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _CombatId)
AND
DB_Is_InCombat(_Enemy, _CombatId)
AND
HasActiveStatus(_Enemy, "TEMPORARILY_HOSTILE", 1)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Temporarily_Hostile_3565e29c-0446-4907-90ca-d84a33093f92);


//Suprised Tutorial
IF
CombatStarted(_CombatId)
AND
DB_Is_InCombat(_Enemy, _CombatId)
AND
NOT DB_PartyMembers((CHARACTER)_Enemy)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _CombatId)
AND
IsEnemy((CHARACTER)_Player, (CHARACTER)_Enemy, 1)
AND
HasActiveStatus(_Enemy, "SURPRISED", 1)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Surprised_88757f90-9a0b-4dfe-a245-46f60ba1f5b7);


//Disengage Tutorial
IF
TurnStarted(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
IsControlled(_Player, 1)
AND
IsInDangerOfAttackOfOpportunity(_Player, 1)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Disengage_b0c32855-fa8e-4b07-a213-dc087f4fc587);

IF
GainedControl(_Player)
AND
DB_Is_InCombat(_Player, _)
AND
IsInDangerOfAttackOfOpportunity((CHARACTER)_Player, 1)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Disengage_b0c32855-fa8e-4b07-a213-dc087f4fc587);

IF
CastSpell(_Player, "Shout_Disengage", _, _, _)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _)
AND
IsInDangerOfAttackOfOpportunity((CHARACTER)_Player, 1)
THEN
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Disengage_b0c32855-fa8e-4b07-a213-dc087f4fc587);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Disengage_b0c32855-fa8e-4b07-a213-dc087f4fc587);

// Honour mode special boss Tutorial
IF
CombatStarted(_CombatId)
AND
DB_HonorMode_Enabled(1)
AND
DB_Is_InCombat(_Boss, _CombatId)
AND
DB_GLO_Tutorials_HonorModeBosses((CHARACTER)_Boss)
AND
DB_Is_InCombat(_Player, _CombatId)
AND
DB_Players((CHARACTER)_Player)
THEN
DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _CombatId);

// Player joins afterwards
IF
EnteredCombat(_Player, _CombatId)
AND
DB_Players((CHARACTER)_Player)
AND
DB_GLO_Tutorials_ShowHonorModeBossTutorial(_, _CombatId)
THEN
DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _CombatId);

IF
TurnStarted(_Player)
AND
DB_HonorMode_Enabled(1)
AND
DB_GLO_Tutorials_ShowHonorModeBossTutorial((CHARACTER)_Player, _CombatId)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Honour_Mode_Bosses_8bc44612-51f5-4ced-9473-721eccb013f3);

IF
SwitchedCombat(_Player, _OldCombatId, _NewCombatId)
AND
DB_GLO_Tutorials_ShowHonorModeBossTutorial((CHARACTER)_Player, _OldCombatId)
THEN
NOT DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _OldCombatId);
DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _NewCombatId);

IF
CombatEnded(_CombatId)
AND
DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _CombatId)
THEN
NOT DB_GLO_Tutorials_ShowHonorModeBossTutorial(_Player, _CombatId);

//END_REGION Combat + Death related

//REGION Spells and abilities
// Call Forth Allies Tutorial (END)
PROC
PROC_Tutorials_EndGameAlliesSpellAdded((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Call_Forth_Allies_ccb044a8-5b8d-49e4-a3ca-c526b01765c6);


// Dismiss Wildshape Tutorial
IF
DB_Is_WildShaped(_Player)
AND
DB_Players(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Dismiss_Wildshape_0c09044f-bfff-445e-aac1-a06d352e81c6);


// Bardic Inspiration Tutorial
IF
StatusApplied(_Player, _Status, _, _)
AND
DB_GLO_Tutorials_BardicInspirationStatuses(_Status)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Bardic_inspiration_a64655c4-99b9-46ca-a7cb-af9b8021ad02);

IF
TurnEnded(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Bardic_inspiration_a64655c4-99b9-46ca-a7cb-af9b8021ad02);

IF
TutorialEvent(_Player, (TUTORIALEVENT)Reactions_Opened_266efe77-4587-4b3f-9217-605923add7c5)
AND
DB_PartyMembers(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Bardic_inspiration_a64655c4-99b9-46ca-a7cb-af9b8021ad02);


// Metamagic Tutorial
IF
TurnStarted(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _)
AND
IsTagged(_Player, (TAG)SORCERER_18266c0b-efbc-4c80-8784-ada4a37218d7, 1)
AND
GetActionResourceValuePersonal((CHARACTER)_Player, "SorceryPoint", 0, _InitialCharacterSorceryPoints)
AND
_InitialCharacterSorceryPoints > 0
THEN
DB_GLO_Tutorials_SorceryPointsTracker(_Player, _InitialCharacterSorceryPoints);
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Metamagic_18a5b24d-082a-4017-879d-0c641af3cb3c);

IF //has player used metamagic aka spent sourcery points?
CastedSpell(_Player, _, _, _, _)
AND
DB_GLO_Tutorials_SorceryPointsTracker((CHARACTER)_Player, _InitialCharacterSorceryPoints)
AND
DB_Is_InCombat(_Player, _)
AND
GetActionResourceValuePersonal((CHARACTER)_Player, "SorceryPoint", 0,  _CurrentCharacterSorceryPoints)
AND
_CurrentCharacterSorceryPoints < _InitialCharacterSorceryPoints
THEN
NOT DB_GLO_Tutorials_SorceryPointsTracker(_Player, _InitialCharacterSorceryPoints);
HideTutorial((CHARACTER)_Player, (UNIFIEDTUTORIAL)Metamagic_18a5b24d-082a-4017-879d-0c641af3cb3c);


// Wild Magic Surge (Barbarian)
IF
StartedPreviewingSpell(_Caster, "Rage_WildMagic", _, _)
AND
DB_PartyMembers((CHARACTER)_Caster)
AND
DB_GlobalFlag((FLAG)TUT_LowerDeck_State_ImpsDead_c505f03a-c6d4-4ac5-a0a1-ea805fc1a589)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Caster,(UNIFIEDTUTORIAL)Wild_Magic_Surge__barbarian__1021124a-73df-4313-93d0-9f965d1c7bff);


// Wild Magic Surge (Sorcerer)
IF
StartedPreviewingSpell(_Caster, _, _, _)
AND
DB_PartyMembers((CHARACTER)_Caster)
AND
DB_GlobalFlag((FLAG)TUT_LowerDeck_State_ImpsDead_c505f03a-c6d4-4ac5-a0a1-ea805fc1a589)
AND
IsTagged(_Caster, (TAG)SORCERER_WILDMAGIC_885f8675-e400-4d53-924d-6204ff1d9558, 1)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Caster,(UNIFIEDTUTORIAL)Wild_Magic_Surge__sorcerer__e7dcbdf4-52c1-4680-8e3b-fb684d2931d6);


//Learning Spells Tutorial
IF
AddedTo(_Item, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
QRY_IsExistingItem(_Item, 1)
AND
IsTagged(_Item, (TAG)SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09, 1)
AND
GetReservedUserID(_Player, _UserId)
AND
DB_Players(_UserOwnedCharacters)
AND
GetReservedUserID(_UserOwnedCharacters, _UserId)
AND
CanLearnSpell(_UserOwnedCharacters, (ITEM)_Item, 0, 1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Learning_Spells_3d80918d-5a85-4cf2-bc79-101e97f8c962);


//Unarmed Attack Tutorial (monk spell)
IF
TutorialEvent(_Player, (TUTORIALEVENT)HotbarSlot_Temp_Added_d6215072-82f7-4305-815d-a9f5c356a8e8)
AND
DB_GlobalFlag((FLAG)TUT_LowerDeck_State_ImpsDead_c505f03a-c6d4-4ac5-a0a1-ea805fc1a589)
AND
CanShowSpellForCharacter(_Player, "Target_UnarmedStrike_Monk", 1)
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
AND
DB_GLO_Tutorials_MonkUserSeenSituationalDeckTutorial(_UserProfileId)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Unarmed_Attack_029be879-ba06-4f72-b728-74869732ce5a);
//END_REGION Spells and abilities

//REGION Tadpoles
// Consuming Parasites Tutorial
IF
FlagSet(GLO_Daisy_State_Unlocked_100c65da-7fab-4643-9630-db143451edc9, _, _)
AND
DB_Players(_Player)
AND
TaggedItemsGetCountInMagicPockets("TADPOLE_NORMAL_a81294a2-e779-464f-8c8a-4e84f8e9da34", _Player, _Amount)
AND
_Amount > 0
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Consuming_Parasites_03651128-f8ec-4b2b-bada-f93248fa14fb);

IF
FlagSet(GLO_Daisy_State_Unlocked_100c65da-7fab-4643-9630-db143451edc9, _, _)
AND
DB_Players(_Player)
AND
TaggedItemsGetCountInMagicPockets("TADPOLE_NORMAL_a81294a2-e779-464f-8c8a-4e84f8e9da34", _Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Consuming_Parasites__no_parasite__e03002b8-b14c-4112-885e-60112f3879ae);

//hotfix - retries in case of weird suppressions the first time
IF
UseFinished(_Player, _Item, 1)
AND
DB_Players(_Player)
AND
IsTagged(_Item, (TAG)TADPOLE_NORMAL_a81294a2-e779-464f-8c8a-4e84f8e9da34, 1)
AND
DB_GlobalFlag(GLO_Daisy_State_Unlocked_100c65da-7fab-4643-9630-db143451edc9)
AND
DB_Players(_AllPlayers)
THEN
PROC_ShowUnifiedTutorialForPlayer(_AllPlayers, (UNIFIEDTUTORIAL)Consuming_Parasites_03651128-f8ec-4b2b-bada-f93248fa14fb);

// Silently add tutorial to journal if not first tadpole consume
IF
AddedTo(_Item, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
Exists(_Item, 1)
AND
IsTagged(_Item, (TAG)TADPOLE_NORMAL_a81294a2-e779-464f-8c8a-4e84f8e9da34, 1)
AND
DB_GlobalFlag(GLO_Daisy_State_Unlocked_100c65da-7fab-4643-9630-db143451edc9)
AND
NOT QRY_GLO_Tutorials_IsFirstTadpoleConsume(_Player)
AND
DB_Players(_AllPlayers)
THEN
SetTutorialShown(_AllPlayers, (UNIFIEDTUTORIAL)Consuming_Parasites_03651128-f8ec-4b2b-bada-f93248fa14fb);

// Show tutorial if first tadpole consume
QRY
QRY_GLO_Tutorials_IsFirstTadpoleConsume((CHARACTER)_Player)
AND
GetFlag((FLAG)GLO_Tadpole_Event_FirstConsumed_fab5ae97-23b5-4bf2-88ae-0b1bd57523d8, _Player, 0)
AND
DB_Players(_AllPlayers)
THEN
PROC_ShowUnifiedTutorialForPlayer(_AllPlayers, (UNIFIEDTUTORIAL)Consuming_Parasites_03651128-f8ec-4b2b-bada-f93248fa14fb);

// Illithid Powers Tutorial
PROC
PROC_AddTadpolePoint(_Player)
AND
DB_Players((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Illithid_Powers_fada8022-7043-445f-9e0e-c2fad68eb4a5);

IF
TutorialEvent(_Player, (TUTORIALEVENT)TadpolePowersTree_Opened_cc289292-2ed5-4d60-bb37-386726323b8c)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Illithid_Powers_fada8022-7043-445f-9e0e-c2fad68eb4a5);


// Half-Illithid Tutorial
IF 
FlagSet((FLAG)INT_EmperorRevealed_State_PartialCeremorph_bc1c1148-0ed1-8586-39b2-5aff43c3b393, _PLayer, _)
AND
DB_Players((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Half-Illithid_115cc695-d6f2-42b8-b758-f025b7044d96);


// Barbarian Rage Tutorial
IF
StatusApplied(_Player, _Rage, _, _)
AND
DB_Players((CHARACTER)_Player)
AND
IsStatusFromGroup(_Rage, "SG_Rage", 1)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Barbarian_Rage_1547f2c8-0dd3-4986-970f-45eb18f31b5b);


//Convincing Companions (refuse) Tutorial
IF
TemplateUseStarted(_Player,(ITEMROOT)LOOT_MF_Tadpole_Astral_A_4a82e6f2-839f-434e-addf-b07dd1578194,_AstralTadpole)
AND
GetFlag((FLAG)GLO_Daisy_State_AstralIndividualAccepted_9c5367df-18c8-4450-9156-b818b9b94975, _Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Convincing_Companions__refuse__cfa08d5f-d1d3-4995-aeac-f2167e49eae6);


//Convincing Companions (accepted) Tutorial
IF
FlagSet((FLAG)GLO_Daisy_State_AstralIndividualAccepted_9c5367df-18c8-4450-9156-b818b9b94975, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
NOT DB_Avatars(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Convincing_Companions__accepted__6ca7bc17-776f-4ee3-adc3-611ece8adc13);
//END_REGION Tadpoles

//REGION World interactions
//Locked Item Tutorial
//primary rule is in a ZZZ_Tutorials file
PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_Timer_LockedItemTutorial")
AND
DB_GLO_Tutorials_LockpickTutorialItem((CHARACTER)_Player, _Item)
AND
IsLocked((ITEM)_Item, 1)
THEN
PROC_EvaluateLockedItemsTutorial(_Player);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_Timer_LockedItemTutorial")
AND
DB_GLO_Tutorials_LockpickTutorialItem((CHARACTER)_Player, _Item)
THEN
NOT DB_GLO_Tutorials_LockpickTutorialItem(_Player, _Item);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorials_Timer_LockedItemTutorial")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorials_Timer_LockedItemTutorial");

PROC //has lockpick
PROC_EvaluateLockedItemsTutorial((CHARACTER)_Player)
AND
QRY_GLO_Tutorials_UserHasLockpick((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Locked__has_thieves_tools__f2856b18-690a-48d3-9175-7ad54a70cd0f);

PROC //doesn't have lockpick
PROC_EvaluateLockedItemsTutorial((CHARACTER)_Player)
AND
NOT QRY_GLO_Tutorials_UserHasLockpick((CHARACTER)_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Locked__no_thieves_tools__5f7bfa1c-4a32-43b4-921f-15ef571fcac5);

QRY
QRY_GLO_Tutorials_UserHasLockpick((CHARACTER)_Player)
AND
TemplateGetCountInMagicPockets(TOOL_GEN_ThievesTools_A_Closed_A_08851ac0-3bfa-44f3-80c6-6ab0536f0e10, _Player, _Count)
AND
_Count > 0
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_UserHasLockpick((CHARACTER)_Player)
AND
TemplateGetCountInMagicPockets(TOOL_GEN_ThievesTools_A_Open_A_e32a200c-5b63-414d-ae57-00e7b38f125b, _Player, _Count)
AND
_Count > 0
THEN
DB_NOOP(1);

IF
StartedLockpicking(_Player, _Item)
AND
DB_Players(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Locked__has_thieves_tools__f2856b18-690a-48d3-9175-7ad54a70cd0f);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Locked__no_thieves_tools__5f7bfa1c-4a32-43b4-921f-15ef571fcac5);

IF
Unlocked(_Item, _Player, _)
AND
DB_Players(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Locked__has_thieves_tools__f2856b18-690a-48d3-9175-7ad54a70cd0f);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Locked__no_thieves_tools__5f7bfa1c-4a32-43b4-921f-15ef571fcac5);


//Traps tutorial
PROC
PROC_RollResult("GLO_HiddenItemCheck", _Player, _HiddenItem, 1)
AND
IsControlled(_Player, 1)
AND
IsTrapArmed((ITEM)_HiddenItem, 1)
AND
TemplateIsInInventory((ITEMROOT)TOOL_GEN_Disam_Toolkit_A_22c74b5e-bef2-41b1-b9ed-f4acc766d4ee, _Player, _Count)
THEN
PROC_GLO_Tutorials_EvaluateTrapsTutorial((CHARACTER)_Player, _Count);

PROC
PROC_RollResult("GLO_CONST_HiddenItemCheck", _Player, _HiddenItem, 1)
AND
IsControlled(_Player, 1)
AND
IsTrapArmed((ITEM)_HiddenItem, 1)
AND
TemplateIsInInventory((ITEMROOT)TOOL_GEN_Disam_Toolkit_A_22c74b5e-bef2-41b1-b9ed-f4acc766d4ee, _Player, _Count)
THEN
PROC_GLO_Tutorials_EvaluateTrapsTutorial((CHARACTER)_Player, _Count);


PROC
PROC_GLO_Tutorials_EvaluateTrapsTutorial((CHARACTER)_Player, (INTEGER)_DisarmToolCount)
AND
_DisarmToolCount > 0
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Traps__has_disarm_kit__fff4a41e-af46-4657-9605-d5ea1036676f);

PROC
PROC_GLO_Tutorials_EvaluateTrapsTutorial((CHARACTER)_Player, (INTEGER)_DisarmToolCount)
AND
_DisarmToolCount < 1
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Traps__no_disarm_kits__ccf63910-b483-4443-bf6d-f07d019d1d15);


//Gas Pits Tutorial
IF
StatusApplied(_Player, "CONST_TUTORIAL_GASPIT_TECHNICAL", _, _)
AND
DB_Players((CHARACTER)_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorial_GaspitDelay", 2000); //Prevents overlap with traps tutorial. Revealing a hidden gas pit also triggers that.

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorial_GaspitDelay")
THEN
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Player, "GLO_Tutorial_GaspitDelay");

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Player, "GLO_Tutorial_GaspitDelay")
AND
IsAnyTutorialShowingFor((CHARACTER)_Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Gas_Pits_abfe8c5e-d789-45b3-ba1f-ddbf55dd223c);

//Jump Tutorial
IF
CastedSpell(_Player, "Projectile_Jump", _, _, _)
AND
DB_PartyMembers((CHARACTER)_Player)
THEN
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Jump_d332cfa0-ea0c-482f-973f-73c04c8a5d0b);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Jump_d332cfa0-ea0c-482f-973f-73c04c8a5d0b);
//END_REGION World interactions

//REGION RPG rules
// Toughness Tutorial
IF
AttackedBy(_Attacked, _, _Player, _, _, _, _)
AND
DB_Players((CHARACTER)_Player)
AND
QRY_GLO_Tutorials_HasAnyToughness(_Attacked)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Toughness_94808500-05e5-4c2b-8391-c1062b86df76);

QRY
QRY_GLO_Tutorials_HasAnyToughness((GUIDSTRING)_Entity)
AND
DB_GLO_Tutorials_ToughnessStatuses(_Thoughness)
AND
HasActiveStatus(_Entity, _Thoughness, 1)
THEN
DB_NOOP(1);


// Level Up Tutorial 
IF
ObjectAvailableLevelChanged(_Player,_,_)
AND
NOT DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player)
AND
DB_Players(_Player)
THEN
DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player);

IF
DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player)
AND
IsInCombat(_Player, 0)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Level_Up_75d5e922-8de9-41c2-9a10-0c8e3305c3c1);

IF
CombatEnded(_)
AND
DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Level_Up_75d5e922-8de9-41c2-9a10-0c8e3305c3c1);

PROC
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Level_Up_75d5e922-8de9-41c2-9a10-0c8e3305c3c1)
AND
DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player)
THEN
NOT DB_GLO_Tutorials_ShouldSeeLeveledUpTutorial(_Player);

IF
TutorialEvent((CHARACTER)_Player, (TUTORIALEVENT)LevelUp_Opened_a9b0d917-809d-43bc-a3fb-6da86e6f517d)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Level_Up_75d5e922-8de9-41c2-9a10-0c8e3305c3c1);


//Multiclassing Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)Multiclass_Opened_903e0cfe-5bf3-42c3-95ad-869318c638b5)
AND
DB_ActiveLevel(_LevelName)
AND
IsGameLevel(_LevelName, 1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Multiclassing_f2beafbb-b8f8-48ff-a1c5-9121aa366f53);


//Rolling with Advantage Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)ActiveRoll_Advantage_8ba90ebb-cf5c-4c18-bd50-9657e11d0b2d)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Rolling_with_Advantage_adaf8797-d1cd-45e2-95f4-96de80e56b20);

IF
RollResult(_, _Player, _, _, _, _)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Rolling_with_Advantage_adaf8797-d1cd-45e2-95f4-96de80e56b20);


//Rolling with Disadvantage Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)ActiveRoll_Disadvantage_32516c6a-a8e1-44e9-b053-5ba29ab36792)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Rolling_with_Disadvantage_cdc4bd35-ae5c-4117-9c72-e34b1ee6e336);

IF
RollResult(_, _Player, _, _, _, _)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Rolling_with_Disadvantage_cdc4bd35-ae5c-4117-9c72-e34b1ee6e336);


//Critical Fail Tutorial
IF
DialogRollResult(_Player, 0, _, _, CRITICALITYTYPE.Fail)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Critical_Fail_cabf4b6e-2295-46df-a7cc-abc1f528f492);

IF
RollResult(_, _Player, _, 0, 1, CRITICALITYTYPE.Fail)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Critical_Fail_cabf4b6e-2295-46df-a7cc-abc1f528f492);


//Critical Success Tutorial
IF
DialogRollResult(_Player, 1, _, _, CRITICALITYTYPE.Success)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Critical_Success_46779a90-4f4f-46ce-8d3c-f8303cc4c62a);

IF
RollResult(_, _Player, _, 1, 1, CRITICALITYTYPE.Success)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Critical_Success_46779a90-4f4f-46ce-8d3c-f8303cc4c62a);

//END_REGION RPG rules

//REGION Controls and UI
//Camera Distance Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)UserAction_CameraAtLeashLimit_ff54d87c-c574-45af-abf3-9b76e16b9ee2)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Camera_Distance_69c641d6-e8d7-4893-bc66-4b52d7657e1b);


//Worldmap Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)WorldMap_Opened_d98a41b1-baa3-4fa8-a17a-6d286a80c700)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Worldmap_516781ab-ac9a-4104-96c5-1eb3eb434b0b);


//Center View on Character Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)UserAction_CameraMove_33b6c863-0575-470b-b7aa-d91cc82132f8) 
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
AND
Concatenate("GLO_Tutorials_Timer_CenterViewTutorial", _UserProfileId, _Timer)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Timer, 10000);
DB_GLO_Tutorials_CenterViewTutorial_Timer2UserProfile(_Timer, _UserProfileId);

IF
TutorialEvent(_Player, (TUTORIALEVENT)UserAction_CameraTrackPlayer_f195e6ce-e327-4d32-9749-0b88458fd849)
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
AND
Concatenate("GLO_Tutorials_Timer_CenterViewTutorial", _UserProfileId, _Timer)
AND
DB_GLO_Tutorials_CenterViewTutorial_Timer2UserProfile(_Timer, _UserProfileId)
THEN
PROC_GLO_Tutorials_TrackedTimerCancel(_Timer);
NOT DB_GLO_Tutorials_CenterViewTutorial_Timer2UserProfile(_Timer, _UserProfileId);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Center_View_9b2defbf-eb6c-4660-9479-b121936f7804);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Center_View_9b2defbf-eb6c-4660-9479-b121936f7804);
DisableTutorialEvent(_Player, (TUTORIALEVENT)UserAction_CameraMove_33b6c863-0575-470b-b7aa-d91cc82132f8);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Timer)
AND
DB_GLO_Tutorials_CenterViewTutorial_Timer2UserProfile(_Timer, _UserProfileId)
AND
DB_PartyMembers(_Player)
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Center_View_9b2defbf-eb6c-4660-9479-b121936f7804);
DisableTutorialEvent(_Player, (TUTORIALEVENT)UserAction_CameraMove_33b6c863-0575-470b-b7aa-d91cc82132f8);


// Examining Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)AttackHit_Resistance_4a219633-8b74-41b5-9aa3-237b75fcbd49)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Examine__Resistances__f7cf0ebe-1f80-45e2-8479-8393ca18fc3d);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Immune__f5e7c88b-b131-4523-afd1-2deafc63ba7a);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Vulnerabilities__90d32bc7-3560-4ff2-b8c7-48309f771579);

IF
TutorialEvent(_Player, (TUTORIALEVENT)AttackHit_Immunity_66906aed-8915-4f03-88a7-c4fc8d506a77)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Examine__Immune__f5e7c88b-b131-4523-afd1-2deafc63ba7a);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Resistances__f7cf0ebe-1f80-45e2-8479-8393ca18fc3d);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Vulnerabilities__90d32bc7-3560-4ff2-b8c7-48309f771579);

IF
TutorialEvent(_Player, (TUTORIALEVENT)AttackHit_Vulnerable_8d5b5b23-814d-4f3a-92f7-73c868dc20f4)
AND
QRY_GLO_Tutorials_IsAfterHelmFightStart()
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Examine__Vulnerabilities__90d32bc7-3560-4ff2-b8c7-48309f771579);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Immune__f5e7c88b-b131-4523-afd1-2deafc63ba7a);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Examine__Resistances__f7cf0ebe-1f80-45e2-8479-8393ca18fc3d);

QRY
QRY_GLO_Tutorials_IsAfterHelmFightStart()
AND
DB_GlobalFlag((FLAG)TUT_Helm_JoinedMindflayerFight_ec25d7dc-f9d6-47ff-92c9-8921d6e32f54)
THEN
DB_NOOP(1);

QRY
QRY_GLO_Tutorials_IsAfterHelmFightStart()
AND
DB_ActiveLevel(_Level)
AND
_Level != "TUT_Avernus_C"
AND
IsGameLevel(_Level, 1)
THEN
DB_NOOP(1);

IF
TurnEnded(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Examine__Resistances__f7cf0ebe-1f80-45e2-8479-8393ca18fc3d);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Examine__Immune__f5e7c88b-b131-4523-afd1-2deafc63ba7a);
HideTutorial(_Player, (UNIFIEDTUTORIAL)Examine__Vulnerabilities__90d32bc7-3560-4ff2-b8c7-48309f771579);


//Hotbar Assignment (Items) Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)HotbarSlot_Item_Removed_860a80b4-48eb-4ea2-8037-eb8fee3ad6dd)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Hotbar_Assignment__Items__5919023d-7c74-4a63-859f-f3e42530b438);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Hotbar_Assignment__Spellbook__b1e7f214-338a-4081-b351-db6cbffcc057);


//Hotbar Assignment (Spellbook) Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)HotbarSlot_Spell_Removed_1fc4a8f3-5db1-4704-9d8b-323562fc279c)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Hotbar_Assignment__Spellbook__b1e7f214-338a-4081-b351-db6cbffcc057);
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)Hotbar_Assignment__Items__5919023d-7c74-4a63-859f-f3e42530b438);


//Situational Deck Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)HotbarSlot_Temp_Added_d6215072-82f7-4305-815d-a9f5c356a8e8)
AND
DB_GlobalFlag((FLAG)TUT_LowerDeck_State_ImpsDead_c505f03a-c6d4-4ac5-a0a1-ea805fc1a589)
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Situational_Actions_e743c6ce-7e4c-4956-be2e-11ae68a24ac3);
DB_GLO_Tutorials_MonkUserSeenSituationalDeckTutorial(_UserProfileId);


//Listening In Conversations Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)Dialogue_Listen_c01b74a1-7ff2-41da-885a-3fe0152d7775)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Listening_In_Conversations_f745eac2-8ca5-4a79-9646-1aefb8285510);
//END_REGION Controls and UI

//REGION Misc Tutorials
//Healing Potions Tutorial
IF
TurnStarted(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _)
THEN
PROC_GLO_Tutorials_EvaluateHealingPotionTutorial(_Player);

IF
GainedControl(_Player)
AND
DB_PartyMembers((CHARACTER)_Player)
AND
DB_Is_InCombat(_Player, _)
THEN
PROC_GLO_Tutorials_EvaluateHealingPotionTutorial(_Player);

PROC
PROC_GLO_Tutorials_EvaluateHealingPotionTutorial((CHARACTER)_Player)
AND
GetHitpointsPercentage(_Player, _HpPercentage)
AND
_HpPercentage <= 80
AND
NOT QRY_IsCharaterUnconsciousOrEquivalent((CHARACTER)_Player)
AND
NOT DB_Dominated(_Player)
AND
GetItemByTagInInventory("HEALING_POTION_1879a93d-2edf-4f54-85dd-81a3724d677f", _Player, _Item)
AND
_Item != NULL_00000000-0000-0000-0000-000000000000
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Healing_Potions_dcb11aba-59e4-402a-9297-b0addac661e5);


// Waypoints Tutorial
IF
DB_WaypointUnlocked(_, _Discoverer)
AND
DB_PartyMembers(_Player)
AND
QRY_IsInRange(_Discoverer, _Player, 30.0)
AND
GetReservedUserID((CHARACTER)_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
AND
Concatenate("GLO_Tutorials_Timer_WaypointsTutorial", _UserProfileId, _Timer)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Timer, 10000);
PROC_GLO_Tutorials_TrackedTimer_EraseTimerRecord(_Timer);
DB_GLO_Tutorials_Waypoints_Timer2UserProfile(_Timer, _UserProfileId);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Timer)
AND
DB_GLO_Tutorials_Waypoints_Timer2UserProfile(_Timer, _UserProfileId)
AND
DB_PartyMembers(_Player)
AND
GetReservedUserID(_Player, _UserId)
AND
GetUserProfileID(_UserId, _UserProfileId)
THEN 
PROC_GLO_Tutorials_ProcessWaypointsTutorialTimer(_Player);

PROC
PROC_GLO_Tutorials_TrackedTimerFinished(_Timer)
AND
DB_GLO_Tutorials_Waypoints_Timer2UserProfile(_Timer, _UserProfileId)
THEN 
NOT DB_GLO_Tutorials_Waypoints_Timer2UserProfile(_Timer, _UserProfileId);

PROC
PROC_GLO_Tutorials_ProcessWaypointsTutorialTimer((CHARACTER)_Player)
AND
IsControlled(_Player, 1)
AND
IsAnyTutorialShowingFor((CHARACTER)_Player, 0)
AND
NOT DB_DialogPlayers(_, _Player, _)
THEN
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)Waypoints_c3e13218-7574-48ea-b99d-90089e8816ae);

IF
TutorialEvent(_Player, (TUTORIALEVENT)WorldMap_Opened_d98a41b1-baa3-4fa8-a17a-6d286a80c700)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)Waypoints_c3e13218-7574-48ea-b99d-90089e8816ae);


//Skill Checks Tutorial
IF
TutorialEvent(_Player, (TUTORIALEVENT)ActiveRoll_Dialog_b8f0af40-db07-4d52-a4a7-b66ce8ec5325)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Skill_Checks_b57facb5-e96f-432f-b4d3-6694dd81e9f1);

//Dye Remover
IF
TemplatesCombined(_DyeTemplate, _ItemTemplate, _, _, _, _Player, _NewItem)
AND
DB_Players(_Player)
AND
IsTagged(_DyeTemplate, (TAG)DYE_d8ef5332-ed2f-42cb-817d-bd2164673223, 1)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, (UNIFIEDTUTORIAL)Dye_Remover_f4537347-0551-45c0-bd00-42fc5ffc51ac);
//END_REGION Misc Tutorials

//END_REGION


//REGION Helpers
PROC
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)_Tutorial)
AND
DB_TUT_DisplayMessages(1)
THEN
ShowTutorial(_Player, _Tutorial);

PROC
PROC_ShowUnifiedTutorialForPlayer((CHARACTER)_Player, (UNIFIEDTUTORIAL)_Tutorial)
AND
DB_GLO_Tutorials_JournalGroups(_JournalTutorialAggregator, _Tutorial)
THEN
SetTutorialShown(_Player, _JournalTutorialAggregator);

IF //drop in avatars can trigger multiple tutorials due to their initial equipment causing a deluge of item AddedTo events on joining game. This is used to suppress some tutorials for initial moments. 
DB_Players(_Player)
THEN
PROC_GLO_Tutorials_TrackedTimerStart(_Player, "GLO_Tutorials_TemporaryEquipmentTutSuppression", 3000);

//Optional tutorial chains. Generic tutorial closed -> show side tutorial BUT generic tutorial is optional
PROC
PROC_GLO_Tutorials_ChainOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_TutorialId,(UNIFIEDTUTORIAL)_SubsequentTutorial)
AND
DB_GLO_Tutorials_TutorialChains_Optional(_TutorialId,_SubsequentTutorial)
AND
QRY_GLO_Tutorials_ShouldShowOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_TutorialId)
AND
GetReservedUserID(_Player, _UserId)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, _TutorialId);
DB_GLO_Tutorials_TutorialChains_Optional_ShowingTo((INTEGER)_UserId,(UNIFIEDTUTORIAL)_TutorialId);

//If we didn't start generic tutorial, start side tutorial
PROC
PROC_GLO_Tutorials_ChainOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_TutorialId,(UNIFIEDTUTORIAL)_SubsequentTutorial)
AND
DB_GLO_Tutorials_TutorialChains_Optional(_TutorialId,_SubsequentTutorial)
AND
QRY_GLO_Tutorials_ShouldShowOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_SubsequentTutorial)
AND
GetReservedUserID(_Player, _UserId)
AND
NOT DB_GLO_Tutorials_TutorialChains_Optional_ShowingTo((INTEGER)_UserId,(UNIFIEDTUTORIAL)_TutorialId)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, _SubsequentTutorial);

//If we started generic tutorial, wait for it to close to start the side tutorial
IF
TutorialClosed(_UserId, _TutorialId)
AND
DB_GLO_Tutorials_TutorialChains_Optional_ShowingTo((INTEGER)_UserId,(UNIFIEDTUTORIAL)_TutorialId)
AND
DB_GLO_Tutorials_TutorialChains_Optional((UNIFIEDTUTORIAL)_TutorialId, _SubsequentTutorial)
AND
DB_Players(_Player)
AND
GetReservedUserID(_Player, _UserId)
AND
QRY_GLO_Tutorials_ShouldShowOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_SubsequentTutorial)
THEN
PROC_ShowUnifiedTutorialForPlayer(_Player, _SubsequentTutorial);

IF
TutorialClosed(_UserId, _TutorialId)
AND
DB_GLO_Tutorials_TutorialChains_Optional_ShowingTo((INTEGER)_UserId,(UNIFIEDTUTORIAL)_TutorialId)
THEN
NOT DB_GLO_Tutorials_TutorialChains_Optional_ShowingTo((INTEGER)_UserId,(UNIFIEDTUTORIAL)_TutorialId);

QRY
QRY_GLO_Tutorials_ShouldShowOptionalTutorial((CHARACTER)_Player,(UNIFIEDTUTORIAL)_TutorialId)
AND
1 == 0
THEN
DB_NOOP(1);
//END_REGION

//REGION Debug
IF
TextEvent("EnableTutorialEvent")
AND
GetTextEventParamUUID(1, _ID)
AND
DB_Players(_Player)
THEN
EnableTutorialEvent(_Player, (TUTORIALEVENT)_ID);

IF
TextEvent("ToggleTutorialMessages")
AND
DB_TUT_DisplayMessages(_Value)
AND
DB_Negate(_Value, _NotValue)
THEN
NOT DB_TUT_DisplayMessages(_Value);
DB_TUT_DisplayMessages(_NotValue);

IF
TextEvent("showtut")
AND
GetTextEventParamUUID(1,_Tut)
AND
GetHostCharacter(_Player)
THEN
ShowTutorial(_Player, (UNIFIEDTUTORIAL)_Tut);

IF
TextEvent("showntut")
AND
GetTextEventParamUUID(1,_Tut)
AND
GetHostCharacter(_Player)
THEN
SetTutorialShown(_Player, (UNIFIEDTUTORIAL)_Tut);

IF
TextEvent("hidetut")
AND
GetTextEventParamUUID(1,_Tut)
AND
GetHostCharacter(_Player)
THEN
HideTutorial(_Player, (UNIFIEDTUTORIAL)_Tut);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
