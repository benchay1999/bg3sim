Version 1
SubGoalCombiner SGC_AND
INITSECTION
// Smuggler will speak to anyone he spots getting close
DB_SpotPlayers((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_StartConvo", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
// Smuggler and his guards will attack if players get too close to the merchandise
DB_SpotPlayers((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_Attack", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_Attack", S_LOW_GuildSmugglers_Trigger_Attack_a4a58ecc-09e8-462a-bba7-c6d8402dfe1d);
DB_SpotPlayers((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_Attack", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger((CHARACTER)S_LOW_GuildSmugglers_Guard_001_b86be437-01de-4eb0-be7a-dd2894878ec9, "LOW_GuildSMugglers_Spotting_Attack", S_LOW_GuildSmugglers_Trigger_Attack_a4a58ecc-09e8-462a-bba7-c6d8402dfe1d);
DB_SpotPlayers((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_Attack", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger((CHARACTER)S_LOW_GuildSmugglers_Guard_002_8be5ed10-a4e2-41e9-839f-cdaa6c4d340c, "LOW_GuildSMugglers_Spotting_Attack", S_LOW_GuildSmugglers_Trigger_Attack_a4a58ecc-09e8-462a-bba7-c6d8402dfe1d);
DB_SpotPlayers((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_Attack", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger((CHARACTER)S_LOW_GuildSmugglers_Guard_003_a7b70658-5f85-43db-b978-5076b1a56de1, "LOW_GuildSMugglers_Spotting_Attack", S_LOW_GuildSmugglers_Trigger_Attack_a4a58ecc-09e8-462a-bba7-c6d8402dfe1d);
// Ownership for smugglers' wares
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_GuildSmugglers_Trigger_Ownership_7f269032-0a76-42e1-9a98-885ac4b73f16, S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e);
// Player can buy goods off smugglers for 1000 gold
DB_DialogMoneyTransfer(1, (DIALOGRESOURCE)LOW_GuildSmugglers_Smuggler_d659c5e6-ed89-7baf-42c5-ae550414b6dc, 1000, 2);
// Player can intimidate smuggler to gain 500 gold
DB_DialogMoneyTransfer(2, (DIALOGRESOURCE)LOW_GuildSmugglers_Smuggler_d659c5e6-ed89-7baf-42c5-ae550414b6dc, 500, 1);

DB_Dialogs((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, (DIALOGRESOURCE)LOW_GuildSmugglers_Smuggler_d659c5e6-ed89-7baf-42c5-ae550414b6dc);
DB_Dialogs((CHARACTER)S_LOW_GuildSmugglers_Guard_001_b86be437-01de-4eb0-be7a-dd2894878ec9, (DIALOGRESOURCE)LOW_GuildSmugglers_Guard_001_7922e259-026e-2867-00fa-fbd6ed71dcb9);
DB_Dialogs((CHARACTER)S_LOW_GuildSmugglers_Guard_002_8be5ed10-a4e2-41e9-839f-cdaa6c4d340c, (DIALOGRESOURCE)LOW_GuildSmugglers_Guard_002_8600cf98-10b0-94bf-e116-4286c83fecd0);
DB_Dialogs((CHARACTER)S_LOW_GuildSmugglers_Guard_003_a7b70658-5f85-43db-b978-5076b1a56de1, (DIALOGRESOURCE)LOW_GuildSmugglers_Guard_003_a5947c9e-5a80-1b01-2e5e-b53853b9980b);
KBSECTION
PROC
PROC_SpotPlayers_Spotted((CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, "LOW_GuildSMugglers_Spotting_StartConvo", _Player)
AND
QRY_LOW_GuildSmugglers_PlayerNotTooClose((CHARACTER)_Player)
AND
NOT QRY_StartDialog((DIALOGRESOURCE)LOW_GuildSmugglers_Smuggler_d659c5e6-ed89-7baf-42c5-ae550414b6dc, (CHARACTER)S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, _Player)
THEN
SetHostileAndEnterCombat((FACTION)ACT3_LOW_Guildhall_Smugglers_4bce359e-7eb9-4ce7-9609-021d2acec14d, (FACTION)Hero_a1542c81-6895-929e-4522-10ce218bb360, S_LOW_GuildSmugglers_Smuggler_9f79f33b-fccf-44d5-a68b-7cd4f01b1b4e, _Player);

QRY
QRY_LOW_GuildSmugglers_PlayerNotTooClose((CHARACTER)_Player)
AND
IsInTrigger(_Player, S_LOW_GuildSmugglers_Trigger_Attack_a4a58ecc-09e8-462a-bba7-c6d8402dfe1d, 0)
THEN
DB_NOOP(1);

PROC
PROC_SpotPlayers_Spotted(_GuildCombatant, "LOW_GuildSMugglers_Spotting_Attack", _Player)
THEN
SetHostileAndEnterCombat((FACTION)ACT3_LOW_Guildhall_Smugglers_4bce359e-7eb9-4ce7-9609-021d2acec14d, (FACTION)Hero_a1542c81-6895-929e-4522-10ce218bb360, _GuildCombatant, _Player);

IF
FlagSet((FLAG)LOW_GuildSmugglers_PersuadedPartOfGuild_a23c00d4-e13b-8215-f2b3-d954a6900eb7, _, _)
THEN
PROC_SpotPlayers_CleanupSpotting("LOW_GuildSMugglers_Spotting_Attack");

IF
FlagSet((FLAG)LOW_GuildSmugglers_BoughtGoodsOffSmugglers_91b80838-1270-4b1b-b862-999f34e7f757, _, _)
THEN
PROC_SpotPlayers_CleanupSpotting("LOW_GuildSMugglers_Spotting_Attack");
PROC_SpotPlayers_CleanupSpotting("LOW_GuildSMugglers_Spotting_StartConvo");
PROC_LOW_GuildSmugglers_RemoveSmugglewareOwnership();

IF
FlagSet((FLAG)LOW_GuildSmugglers_IntimidatedSmugglers_5066d2c1-e34f-4b13-b131-83529d840b6f, _, _)
THEN
PROC_SpotPlayers_CleanupSpotting("LOW_GuildSMugglers_Spotting_Attack");
PROC_SpotPlayers_CleanupSpotting("LOW_GuildSMugglers_Spotting_StartConvo");

PROC
PROC_LOW_GuildSmugglers_RemoveSmugglewareOwnership()
THEN
TriggerClearItemsOwner(S_LOW_GuildSmugglers_Trigger_Ownership_7f269032-0a76-42e1-9a98-885ac4b73f16);

//REGION Debug
// Debug command to bypass persuasion roll and reset the end flags.
IF
TextEvent("GuildSmugglers_BuyNow")
THEN
ClearFlag((FLAG)LOW_GuildSmugglers_BoughtGoodsOffSmugglers_91b80838-1270-4b1b-b862-999f34e7f757);
ClearFlag((FLAG)LOW_GuildSmugglers_IntimidatedSmugglers_5066d2c1-e34f-4b13-b131-83529d840b6f);
SetFlag((FLAG)LOW_GuildSmugglers_PersuadedPartOfGuild_a23c00d4-e13b-8215-f2b3-d954a6900eb7);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3b"
