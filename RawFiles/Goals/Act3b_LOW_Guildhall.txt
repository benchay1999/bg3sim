Version 1
SubGoalCombiner SGC_AND
INITSECTION
// Nine-Fingers Setup
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366, (DIALOGRESOURCE)LOW_Guildhall_Roah_ee1c7cf6-bc94-75ba-1859-ecb079f6f4b0);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5, (DIALOGRESOURCE)LOW_Guildhall_Roah_ee1c7cf6-bc94-75ba-1859-ecb079f6f4b0);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366, (DIALOGRESOURCE)LOW_Guildhall_Roah_OM_Minsc_COM_OOM_4207f162-c56e-4c6a-7bdc-9c01bec8131b);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5, (DIALOGRESOURCE)LOW_Guildhall_Roah_OM_Minsc_COM_OOM_4207f162-c56e-4c6a-7bdc-9c01bec8131b);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_dedccdbd-357a-e3a2-4a88-57eb758fe89a);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_dedccdbd-357a-e3a2-4a88-57eb758fe89a);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_OM_Minsc_COM_OOM_0450ca65-21fe-04d9-b50f-71aef887d00a);
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_OM_Minsc_COM_OOM_0450ca65-21fe-04d9-b50f-71aef887d00a);

DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_Roah_ee1c7cf6-bc94-75ba-1859-ecb079f6f4b0);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_Roah_ee1c7cf6-bc94-75ba-1859-ecb079f6f4b0);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_Roah_OM_Minsc_COM_OOM_4207f162-c56e-4c6a-7bdc-9c01bec8131b);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_Roah_OM_Minsc_COM_OOM_4207f162-c56e-4c6a-7bdc-9c01bec8131b);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_dedccdbd-357a-e3a2-4a88-57eb758fe89a);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_dedccdbd-357a-e3a2-4a88-57eb758fe89a);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_OM_Minsc_COM_OOM_0450ca65-21fe-04d9-b50f-71aef887d00a);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_BossFriol_OM_Minsc_COM_OOM_0450ca65-21fe-04d9-b50f-71aef887d00a);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_Zhent_LeaderBackup_78a61843-1660-6618-74d9-60d22018c911);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_Zhent_LeaderBackup_78a61843-1660-6618-74d9-60d22018c911);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_OOM_8ff4dc80-87cb-561c-6701-6e7431ad3d12);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_OOM_8ff4dc80-87cb-561c-6701-6e7431ad3d12);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_MinscJaheira_COM_CCM_OOM_OCM_db0f86d4-7c39-25e9-d2e2-7d5a5340ee27);
DB_FlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_MinscJaheira_COM_CCM_OOM_OCM_db0f86d4-7c39-25e9-d2e2-7d5a5340ee27);

// Ownership
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Ninefingers_3e6e6416-4a1c-41fa-b774-bbbb9444a2a5, (CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Bartender_f697e506-94e0-4b2d-ac30-03b54bdafbce, (CHARACTER)S_LOW_Guildhall_Bartender_00c74e3b-5880-4525-9558-860e4f7c77e2);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Bursar_d2cbcd8b-b823-4153-a681-e3b61f130894, (CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_FetchersBrats_040a42f6-c2de-43f6-a8e7-02736255667d, (CHARACTER)S_LOW_Guildhall_FetchersBrat_002_3352a47c-4259-464d-8047-65bc8a2adff9);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Painter_69e0c08e-47d5-4be8-9285-7e6a465e0b65, (CHARACTER)S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d);

// Minsc comments about the Guildhall bar
DB_OneShot_ADTrigger((TRIGGER)S_LOW_Guildhall_Bar_344b4aef-7e47-47e3-bdaa-18b5f2a93a46, (DIALOGRESOURCE)LOW_Guildhall_AD_MinscEnteringBar_1110432c-2f42-db6b-e71d-71e83891e087, S_Player_Minsc_0de603c5-42e2-4811-9dad-f652de080eba);


// Setup Rugan
PROC_LOW_Guildhall_SetupRugan();

// Setup Uktar
PROC_LOW_Guildhall_InitBursar();

// Setup Fetcher's Brats
DB_Children((CHARACTER)S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632);
DB_Children((CHARACTER)S_LOW_Guildhall_FetchersBrat_002_3352a47c-4259-464d-8047-65bc8a2adff9);
DB_Children((CHARACTER)S_LOW_Guildhall_FetchersBrat_003_18c2988a-5902-4cb8-b620-4b0c67a2aceb);
PROC_LOW_Guildhall_InitMol();
DB_GiveItemToEvent(S_COL_NecromancerLab_MolEyepatch_fa9baba1-f855-449c-8327-9728a493b193, (FLAG)LOW_Guildhall_Event_GiveEyePatch_5fac5f13-a46f-4a15-a210-6704cdbfd946);

// Book flags
DB_BookFlags(S_LOW_Guildhall_CountingHouseLetter_3d997a31-fda5-4780-90f0-b00fe43d1734, LOW_Guildhall_Knows_AmbushAtCountingHouse_ff72da6d-2069-4948-b732-d535a53d1562);

// Shootable boulder traps in Guildhall 
// (ITEM)_Boulder, (ITEM)_BoulderConnection
DB_LOW_Guildhall_Bouldertrap((ITEM)S_LOW_Guildhall_BoulderTrap_001_a09aab2d-9c0e-4890-b8d3-d00126fcdd54, (ITEM)NULL_00000000-0000-0000-0000-000000000000);
DB_LOW_Guildhall_Bouldertrap((ITEM)S_LOW_Guildhall_BoulderTrap_002_12cf9298-4cb2-44bf-aa49-259e20b581e5, (ITEM)S_LOW_Guildhall_BoulderTrapConnection_002_ff2d64ed-586b-4a6b-a9ab-177ba2b38c68);

// Dialogs for Zhent leaders
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "Default", (DIALOGRESOURCE)LOW_Guildhall_Roah_ee1c7cf6-bc94-75ba-1859-ecb079f6f4b0);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "AD_TakeoverStarts", (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_TakeoverStarts_7e55ae1b-6c83-3c8d-9106-159e168599f3);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "AD_TakeoverEasy", (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_TakeoverEasy_39c54c32-2c77-676f-45fb-ebbc4dedccb3);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "AD_TakeoverCancelled_MostMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_TakeoverCancelled_MostMenDead_837f3e04-cd7a-c17d-e9e2-571210cb67c5);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "AD_TakeoverCancelled_AllMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_TakeoverCancelled_AllMenDead_f670a9b9-e5d1-2101-a45d-42aef149a4af);

DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "Default", (DIALOGRESOURCE)LOW_Guildhall_BossFriol_dedccdbd-357a-e3a2-4a88-57eb758fe89a);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "AD_TakeoverStarts", (DIALOGRESOURCE)LOW_Guildhall_AD_BossFriol_TakeoverStarts_f44e50f3-29b8-a7da-2f69-73b1ea69bcd0);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "AD_TakeoverEasy", (DIALOGRESOURCE)LOW_Guildhall_AD_BossFriol_TakeoverEasy_390d4794-f976-8eaa-2389-a631d8f1a538);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "AD_TakeoverCancelled_MostMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_BossFriol_TakeoverCancelled_MostMenDead_3a7406dc-2887-50a4-814c-63b95437df51);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "AD_TakeoverCancelled_AllMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_BossFriol_TakeoverCancelled_AllMenDead_73161ef8-e7c0-3a20-18ea-45956a8bfd03);

DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "Default", (DIALOGRESOURCE)LOW_Guildhall_Zhent_LeaderBackup_78a61843-1660-6618-74d9-60d22018c911);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "AD_TakeoverStarts", (DIALOGRESOURCE)LOW_Guildhall_AD_Zhent_LeaderBackup_TakeoverStarts_e844e45d-c235-6437-3b5b-58714da72c49);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "AD_TakeoverEasy", (DIALOGRESOURCE)LOW_Guildhall_AD_Zhent_LeaderBackup_TakeoverEasy_16b0da38-a460-31cc-0142-f45c81880cb7);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "AD_TakeoverCancelled_MostMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_Zhent_LeaderBackup_TakeoverCancelled_MostMenDead_678adced-91f1-f2e2-5b56-cab2ae0be01a);
DB_LOW_Guildhall_ZhentRepresentativeDialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "AD_TakeoverCancelled_AllMenDead", (DIALOGRESOURCE)LOW_Guildhall_AD_Zhent_LeaderBackup_TakeoverCancelled_AllMenDead_3a74b5eb-5790-b8e0-f928-5603456126ff);

// Setup Zhent leader (Roah or Friol)
PROC_LOW_Guildhall_InitZhentLeader();

// Setup Zhent leader backup
PROC_LOW_Guildhall_InitZhentLeaderBackup();

// Setup for Doozy the Dunce ring quest
DB_HasItemEvent((ITEM)S_LOW_Giuldhall_Member_005_Ring_75a0d606-00de-4324-9bed-091310d643ed, (FLAG)LOW_Guildhall_State_HasMember005Ring_1d5204be-716d-4f75-9634-ec4d38df34c0);
DB_GiveItemToEvent((ITEM)S_LOW_Giuldhall_Member_005_Ring_75a0d606-00de-4324-9bed-091310d643ed, (FLAG)LOW_Guildhall_Event_GiveMember005Ring_26bac8b6-6f45-4cb9-b395-d10b6cf61ed1);

// Pre-combat positions for all fighters
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Ninefingers_CombatStartPoint_49953dcd-e71b-4f28-9330-108989677c76, (CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bodyguard_000_CombatStartPoint_35ee2121-b3e1-43a6-b900-a57ffea2b68c, (CHARACTER)S_LOW_Guildhall_Bodyguard_000_6d430ca2-660e-4000-bcf4-8ee5e2c88440);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bodyguard_001_CombatStartPoint_eb3cf7c1-d1b7-4d59-9c1a-53fd6e869f41, (CHARACTER)S_LOW_Guildhall_Bodyguard_001_0962e1ca-7d48-4fde-af0e-250091e9d4e1);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bodyguard_002_CombatStartPoint_665e52fe-8af0-42b5-819b-58fe2971f98d, (CHARACTER)S_LOW_Guildhall_Bodyguard_002_053734fb-4c70-4550-ae64-4b45d4bf59fb);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bodyguard_003_CombatStartPoint_3b492acf-34ec-4479-9fa5-a78d79482fb3, (CHARACTER)S_LOW_Guildhall_Bodyguard_003_1a070383-da33-4107-90ef-68e2fdc03ac0);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bodyguard_004_CombatStartPoint_a581ff03-bae1-4b3a-a0a9-95f06f6a50b2, (CHARACTER)S_LOW_Guildhall_Bodyguard_004_df4e07cc-8e02-4c66-94b9-8f4e34eccec0);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Guildhall_Member_007_CombatStartPoint_f33fce01-db3c-46dd-ae57-c65c17743b9a, (CHARACTER)S_LOW_Guildhall_Member_007_65a5e1cd-6714-4bf0-babd-80714c993953);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Guildhall_Member_009_CombatStartPoint_7c61c339-72f6-4b52-a373-242c5e4d2fd1, (CHARACTER)S_LOW_Guildhall_Member_009_7acea0a6-6e17-477c-b854-18e780b43b0e);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bursar_Guard_001_CombatStartPoint_acadb86b-6443-4d54-8527-1d794126f701, (CHARACTER)S_LOW_Guildhall_Bursar_Guard_001_9f22df22-dc41-4126-a2ce-fd86011c9427);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Bursar_Guard_002_CombatStartPoint_c5e78a5c-faee-4bc3-90fd-1b0c6815cb37, (CHARACTER)S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e);

DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_001_CombatStartPoint_474f4d5b-2781-466f-8bda-2b3babace347, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_002_CombatStartPoint_20c2c7e5-0ba0-4a05-9104-17d01ccf159c, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_002_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_003_CombatStartPoint_d158e2b2-46b4-4de5-a7ea-b77d7c63be5b, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_003_fbffc206-5f7d-4d27-9fc8-6080a7212602);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_004_CombatStartPoint_8dd240c8-ecac-4a0d-9ea3-819f53ca63ca, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_004_6e6853b1-b422-4c18-b08b-e4c3a96b3b0e);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_005_CombatStartPoint_f64a823d-f050-475a-9236-5b987100411a, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_005_0e5c8772-e931-48f8-9743-c9c09059efbc);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_006_CombatStartPoint_a686918a-7c56-4578-98e7-90c72af091ac, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_006_9a307843-3958-4c07-ace9-f1c04b5af558);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_007_CombatStartPoint_ec9caf75-dab2-4ffa-9520-3d2786f61bee, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_007_6dc1a56a-19b7-4a4a-9530-ec41ba9dfef7);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_008_CombatStartPoint_10ea07f2-73f3-4607-b68b-28b5603020ad, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_008_7d31c0db-57d7-4c7e-956c-0cb67d5ab60b);
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Mercenary_009_CombatStartPoint_547727ff-46a2-42e9-be9f-d12c5467b580, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_009_c8bb42d3-9670-4604-beb9-dde0f9e92abd);

// Track defeat status of all combatants
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bodyguard_000_6d430ca2-660e-4000-bcf4-8ee5e2c88440, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bodyguard_001_0962e1ca-7d48-4fde-af0e-250091e9d4e1, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bodyguard_002_053734fb-4c70-4550-ae64-4b45d4bf59fb, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bodyguard_003_1a070383-da33-4107-90ef-68e2fdc03ac0, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bodyguard_004_df4e07cc-8e02-4c66-94b9-8f4e34eccec0, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Member_007_65a5e1cd-6714-4bf0-babd-80714c993953, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Member_009_7acea0a6-6e17-477c-b854-18e780b43b0e, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bursar_Guard_001_9f22df22-dc41-4126-a2ce-fd86011c9427, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e, "LOW_Guildhall_ZhentBetrayal_Guild");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_Guildhall_ZhentBetrayal_Guild", (FLAG)LOW_Guildhall_State_CoupGuildDefeated_f4cef481-df6b-4773-bd26-3539f414c539);

DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_002_1140624b-d27c-43ec-9329-b45d883c900d, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_003_fbffc206-5f7d-4d27-9fc8-6080a7212602, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_004_6e6853b1-b422-4c18-b08b-e4c3a96b3b0e, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_005_0e5c8772-e931-48f8-9743-c9c09059efbc, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_006_9a307843-3958-4c07-ace9-f1c04b5af558, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_007_6dc1a56a-19b7-4a4a-9530-ec41ba9dfef7, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_008_7d31c0db-57d7-4c7e-956c-0cb67d5ab60b, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_009_c8bb42d3-9670-4604-beb9-dde0f9e92abd, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_Guildhall_ZhentBetrayal_Zhent", (FLAG)LOW_Guildhall_State_CoupZhentDefeated_e02bbc9a-fcdb-4003-a601-1550c65fb03a);


// Dialogs
DB_Dialogs((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bard_da9309e9-b13a-49a2-adb6-78fc44aeeb71, (DIALOGRESOURCE)LOW_Guildhall_Bard_ee9407ce-33e0-8fa5-79d1-ed5fdf349b7c);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bartender_00c74e3b-5880-4525-9558-860e4f7c77e2, (DIALOGRESOURCE)LOW_Guildhall_Bartender_bf3f75da-d142-071c-3e66-22b62934769c);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74, (DIALOGRESOURCE)LOW_Guildhall_Bursar_ad9033e2-23d7-9632-85d5-c4128f5ab143);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bursar_Guard_001_9f22df22-dc41-4126-a2ce-fd86011c9427, (DIALOGRESOURCE)LOW_Guildhall_Bursar_Guard_001_b1dfee35-515b-aa4f-229d-35716e2ecb12);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e, (DIALOGRESOURCE)LOW_Guildhall_Bursar_Guard_002_b1c18be9-22d0-41a4-9502-2d5b81057280);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e, (DIALOGRESOURCE)LOW_Guildhall_Bursar_Guard_002_b1c18be9-22d0-41a4-9502-2d5b81057280);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, (DIALOGRESOURCE)LOW_Guildhall_FetchersBrat_001_b634a1b3-dbb0-93f3-8e34-f995f4852420);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_FetchersBrat_002_3352a47c-4259-464d-8047-65bc8a2adff9, (DIALOGRESOURCE)LOW_Guildhall_FetchersBrat_002_cb31138f-ed25-91d1-4ea7-c34d830db29c);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_FetchersBrat_003_18c2988a-5902-4cb8-b620-4b0c67a2aceb, (DIALOGRESOURCE)LOW_Guildhall_FetchersBrat_003_0947bd51-bd4d-69ab-2099-b82fb89540f9);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a, (DIALOGRESOURCE)LOW_Guildhall_Member_001_2a9f4923-6303-34d7-6c37-90f8bceddf61);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_002_899738c6-ac8e-44f0-9c4b-c0843c717ad4, (DIALOGRESOURCE)LOW_Guildhall_Member_002_9fed3fa7-7a16-c428-31a3-91b89a206af6);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_003_28610d0d-fee5-4f7b-b7d3-db60c717b1dd, (DIALOGRESOURCE)LOW_Guildhall_Member_003_09d0ae6a-225c-f2cd-193f-c1c1e231ae8e);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_004_d40ae4a2-f29a-4d69-b9f7-9b078aeee0be, (DIALOGRESOURCE)LOW_Guildhall_Member_004_af1e8a61-4546-4028-8ef0-fbaf017aaaf7);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_005_b34e82a2-f774-4f73-b808-c2e79cabdb2a, (DIALOGRESOURCE)LOW_Guildhall_Member_005_e6b43115-8de9-0b9c-7dff-fada994f66f3);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_006_75cbf81e-0f16-459b-aa07-966eccf658ce, (DIALOGRESOURCE)LOW_Guildhall_Member_006_5079d502-e260-7e11-6371-6953ce166720);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_007_65a5e1cd-6714-4bf0-babd-80714c993953, (DIALOGRESOURCE)LOW_Guildhall_Member_007_92a02279-7bf9-9359-2de9-39e4703360f1);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, (DIALOGRESOURCE)LOW_Guildhall_Member_008_64ae4c63-2eda-19d6-3dbb-43f465047f4b);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Member_009_7acea0a6-6e17-477c-b854-18e780b43b0e, (DIALOGRESOURCE)LOW_Guildhall_Member_009_a360c6f1-3232-b31c-0b82-30e20d5e649e);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bodyguard_000_6d430ca2-660e-4000-bcf4-8ee5e2c88440, (DIALOGRESOURCE)LOW_Guildhall_Bodyguard_000_7164e7bc-3be9-f316-9219-12feaaad18a1);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bodyguard_001_0962e1ca-7d48-4fde-af0e-250091e9d4e1, (DIALOGRESOURCE)LOW_Guildhall_Bodyguard_001_17825560-78fc-b0db-4e4f-75708b0ddd8a);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bodyguard_002_053734fb-4c70-4550-ae64-4b45d4bf59fb, (DIALOGRESOURCE)LOW_Guildhall_Bodyguard_002_d7d0c785-3e7b-6a27-06f2-2823bb9e85bc);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bodyguard_003_1a070383-da33-4107-90ef-68e2fdc03ac0, (DIALOGRESOURCE)LOW_Guildhall_Bodyguard_003_b2c24eb8-fdfb-8677-76d0-dc041392e891);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Bodyguard_004_df4e07cc-8e02-4c66-94b9-8f4e34eccec0, (DIALOGRESOURCE)LOW_Guildhall_Bodyguard_004_c1d9e641-e96d-6d63-e2ba-cb1c0dcd2176);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Visitor_001_b8f45e3c-1ef2-4a66-bdfe-2d54c700a91d, (DIALOGRESOURCE)LOW_Guildhall_Visitor_001_52ada963-5b02-be48-ac84-0d2b81265092);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Visitor_002_d16d9c85-6d17-4e79-9c3b-864f033054b0, (DIALOGRESOURCE)LOW_Guildhall_Visitor_002_edfb81dc-0e69-3b78-6a6f-ae7c6d20b7cb);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Visitor_003_5a44b1da-b8c6-494b-abd5-0976c3f59745, (DIALOGRESOURCE)LOW_Guildhall_Visitor_003_eb29de27-d0fa-0504-8694-b3757aa00912);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Visitor_004_e6abd16d-33b4-471b-9e6a-4338171a7a43, (DIALOGRESOURCE)LOW_Guildhall_Visitor_004_f3021629-0603-2623-f511-7e23e3898ef7);
SetHasDialog((CHARACTER)S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, 1);
SetHasDialog((CHARACTER)S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, 1);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_001_4250b039-7336-ee5a-c9a5-f5bb01f6cd1a);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_002_1140624b-d27c-43ec-9329-b45d883c900d, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_002_129bfe34-fb89-f621-a802-4bfb58382c66);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_003_fbffc206-5f7d-4d27-9fc8-6080a7212602, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_003_dedf2aba-ca6e-1109-530c-e224a89c5850);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_004_6e6853b1-b422-4c18-b08b-e4c3a96b3b0e, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_004_4e5bf894-49a9-526c-9d3b-8feff79338cb);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_005_0e5c8772-e931-48f8-9743-c9c09059efbc, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_005_fcd1b899-6ddf-7617-659c-d79e4d47eac8);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_006_9a307843-3958-4c07-ace9-f1c04b5af558, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_006_d305bb0c-e9b5-7af8-38d3-667bc0c7f968);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_007_6dc1a56a-19b7-4a4a-9530-ec41ba9dfef7, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_007_ff94b849-b6ea-e062-e45f-c69f91eb15f9);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_008_7d31c0db-57d7-4c7e-956c-0cb67d5ab60b, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_008_fc3f204f-b62b-c902-f3d7-24ca9a9c0497);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_009_c8bb42d3-9670-4604-beb9-dde0f9e92abd, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Mercenary_009_c44e968f-363f-ef0c-b77a-9d764d7661cc);
DB_Dialogs((CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, (DIALOGRESOURCE)LOW_Guildhall_Zhent_LeaderBackup_78a61843-1660-6618-74d9-60d22018c911);

// Guildhall states
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", 10);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostHeist", 15);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreCoup", 20);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup", 30);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled", 40);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled", 40);
DB_State_Priority(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled", 41);

DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", (FLAG)LOW_Guildhall_State_PreHeist_6524a356-e76e-461f-a3b6-983ba636eb4f);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreCoup", (FLAG)LOW_Guildhall_State_PreCoup_9df31a91-16da-4aee-9ae0-8a824d5fccef);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup", (FLAG)LOW_Guildhall_State_DuringCoup_6dba56a5-8220-41f4-8849-085e38b80d4e);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled", (FLAG)LOW_Guildhall_State_PostCoup_ZhentControlled_bd914804-54c7-4de2-b51e-988919c2e644);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled", (FLAG)LOW_Guildhall_State_PostCoup_GuildControlled_596f7f8b-2de2-4550-87fd-9535c2a07635);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled", (FLAG)LOW_Guildhall_State_PostCoup_PlayerControlled_fd323316-a97e-4b00-8570-50552715b43b);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled", (FLAG)LOW_Guildhall_State_PostCoup_f777d823-f99b-42f5-bc0e-05a58b6c792d);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled", (FLAG)LOW_Guildhall_State_PostCoup_f777d823-f99b-42f5-bc0e-05a58b6c792d);
DB_State_Flags(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled", (FLAG)LOW_Guildhall_State_PostCoup_f777d823-f99b-42f5-bc0e-05a58b6c792d);

DB_State_Current(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist");
SetFlag((FLAG)LOW_Guildhall_State_PreHeist_6524a356-e76e-461f-a3b6-983ba636eb4f);

// Trade vault keys to Bursar Uktar
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault1_Key_34ae083f-fe59-45f9-9ed0-be94feab3b22, (FLAG)LOW_Guildhall_State_HasVault1Key_568131ca-61ce-4836-b617-068da68b2f93);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault1_Key_34ae083f-fe59-45f9-9ed0-be94feab3b22, (FLAG)LOW_Guildhall_Event_GivesVault1Key_03937a99-fa05-4685-9bd4-b56a98431bbe);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault2_Key_7459b479-f690-4be4-b394-9caaa314ed84, (FLAG)LOW_Guildhall_State_HasVault2Key_0be82fc9-8b46-4bf1-9fb6-43fa2b4592ff);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault2_Key_7459b479-f690-4be4-b394-9caaa314ed84, (FLAG)LOW_Guildhall_Event_GivesVault2Key_309df2bd-b257-4794-906b-28d1886917de);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault3_Key_3bb8470f-a2d7-4fb4-9ba4-009293a2db1b, (FLAG)LOW_Guildhall_State_HasVault3Key_a9608888-89cc-4861-ac5d-0a985af60630);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault3_Key_3bb8470f-a2d7-4fb4-9ba4-009293a2db1b, (FLAG)LOW_Guildhall_Event_GivesVault3Key_c8a6f94d-a215-4087-ba89-749f6d7fef81);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault4_Key_761d5d86-ecc1-455e-925f-271e4ab5dcc4, (FLAG)LOW_Guildhall_State_HasVault4Key_eed333f2-4cb1-40e6-b597-cbe4b9e57f01);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault4_Key_761d5d86-ecc1-455e-925f-271e4ab5dcc4, (FLAG)LOW_Guildhall_Event_GivesVault4Key_84c25628-901b-4abc-96d0-cb62649dd873);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault5_Key_ed764748-69da-4265-9e97-1326fcc7ab5c, (FLAG)LOW_Guildhall_State_HasVault5Key_7f68923d-101e-4af8-aad5-438f5b3f242c);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault5_Key_ed764748-69da-4265-9e97-1326fcc7ab5c, (FLAG)LOW_Guildhall_Event_GivesVault5Key_cee099b7-27b0-423b-849d-911a8b77893a);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault6_Key_52babaa9-60e0-4919-b523-4c0d916a0cc9, (FLAG)LOW_Guildhall_State_HasVault6Key_021265d4-baf8-4d4c-b5e2-c0e19db508d8);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault6_Key_52babaa9-60e0-4919-b523-4c0d916a0cc9, (FLAG)LOW_Guildhall_Event_GivesVault6Key_1a70670f-dd3f-4efa-931e-6c4e1276cbdc);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault7_Key_85ebe2f5-bd31-420e-bb23-81f85466c774, (FLAG)LOW_Guildhall_State_HasVault7Key_3b3fdc37-20ed-4f39-8d06-290db1abdeb2);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault7_Key_85ebe2f5-bd31-420e-bb23-81f85466c774, (FLAG)LOW_Guildhall_Event_GivesVault7Key_f4364a08-519f-4937-a2e7-70e7272f987b);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault8_Key_6499560e-4790-4aab-97a0-c0989088a8cb, (FLAG)LOW_Guildhall_State_HasVault8Key_4949feb9-5beb-4f15-9049-a3fce36d4134);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault8_Key_6499560e-4790-4aab-97a0-c0989088a8cb, (FLAG)LOW_Guildhall_Event_GivesVault8Key_d95e8e3a-ad09-4b66-a253-e4a4a0638a45);
DB_HasItemEvent((ITEM)S_LOW_CountingHouse_Vault9_Key_54d5b4f3-2bf3-47b5-8bb5-19e976a821e6, (FLAG)LOW_Guildhall_State_HasVault9Key_3ecb68e8-6189-4dc9-b9cb-1409c036bb01);
DB_GiveItemToEvent((ITEM)S_LOW_CountingHouse_Vault9_Key_54d5b4f3-2bf3-47b5-8bb5-19e976a821e6, (FLAG)LOW_Guildhall_Event_GivesVault9Key_78daedb4-4c6f-48b6-b34a-825673cf192f);

DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault1Key_03937a99-fa05-4685-9bd4-b56a98431bbe, "LOW_Guildhall_Bursar_GiveKey1");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault2Key_309df2bd-b257-4794-906b-28d1886917de, "LOW_Guildhall_Bursar_GiveKey2");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault3Key_c8a6f94d-a215-4087-ba89-749f6d7fef81, "LOW_Guildhall_Bursar_GiveKey3");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault4Key_84c25628-901b-4abc-96d0-cb62649dd873, "LOW_Guildhall_Bursar_GiveKey4");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault5Key_cee099b7-27b0-423b-849d-911a8b77893a, "LOW_Guildhall_Bursar_GiveKey5");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault6Key_1a70670f-dd3f-4efa-931e-6c4e1276cbdc, "LOW_Guildhall_Bursar_GiveKey6");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault7Key_f4364a08-519f-4937-a2e7-70e7272f987b, "LOW_Guildhall_Bursar_GiveKey7");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault8Key_d95e8e3a-ad09-4b66-a253-e4a4a0638a45, "LOW_Guildhall_Bursar_GiveKey8");
DB_LOW_Guildhall_Bursar_GiveKeyFlag((FLAG)LOW_Guildhall_Event_GivesVault9Key_78daedb4-4c6f-48b6-b34a-825673cf192f, "LOW_Guildhall_Bursar_GiveKey9");

// Positions of Guildhall people
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_Leader_29de84e5-b1c0-44a1-8531-f45f5461ca1b, (CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_LeaderGuard_001_c878b046-7058-429b-82c5-7b1fbd0dd688, (CHARACTER)S_LOW_Guildhall_Bodyguard_003_1a070383-da33-4107-90ef-68e2fdc03ac0);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_LeaderGuard_002_c7c64f35-4be9-451a-972b-7fe8a43f59e4, (CHARACTER)S_LOW_Guildhall_Bodyguard_000_6d430ca2-660e-4000-bcf4-8ee5e2c88440);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_LeaderGuard_003_b343bd19-65cb-4ad4-9b82-2a1c88aeffca, (CHARACTER)S_LOW_Guildhall_Bodyguard_001_0962e1ca-7d48-4fde-af0e-250091e9d4e1);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_LeaderGuard_004_0ef8a40b-c966-44f0-b45e-e406bc118b8e, (CHARACTER)S_LOW_Guildhall_Bodyguard_004_df4e07cc-8e02-4c66-94b9-8f4e34eccec0);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_LeaderGuard_005_86a24345-c945-477a-9298-9b926ef18c4a, (CHARACTER)S_LOW_Guildhall_Bodyguard_002_053734fb-4c70-4550-ae64-4b45d4bf59fb);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_BursarGuard_001_a9e2cb75-0a3c-47cd-aee1-d038da9c4bda, (CHARACTER)S_LOW_Guildhall_Bursar_Guard_001_9f22df22-dc41-4126-a2ce-fd86011c9427);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_BursarGuard_002_39af930e-1e88-4fec-9797-883afe5342dc, (CHARACTER)S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_MemberGuard_001_685285f4-389d-4192-897f-ad82591565c0, (CHARACTER)S_LOW_Guildhall_Member_009_7acea0a6-6e17-477c-b854-18e780b43b0e);
DB_LOW_Guildhall_FinalPositions("Guild", (TRIGGER)S_LOW_Guildhall_MemberGuard_002_ddf57aa4-878c-4a6e-b6b8-d6a4e95ea904, (CHARACTER)S_LOW_Guildhall_Member_007_65a5e1cd-6714-4bf0-babd-80714c993953);

// Positions of Zhent people
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_LeaderGuard_001_c878b046-7058-429b-82c5-7b1fbd0dd688, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_LeaderGuard_002_c7c64f35-4be9-451a-972b-7fe8a43f59e4, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_002_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_LeaderGuard_003_b343bd19-65cb-4ad4-9b82-2a1c88aeffca, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_004_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_LeaderGuard_004_0ef8a40b-c966-44f0-b45e-e406bc118b8e, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_006_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_LeaderGuard_005_86a24345-c945-477a-9298-9b926ef18c4a, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_003_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_BursarGuard_001_a9e2cb75-0a3c-47cd-aee1-d038da9c4bda, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_005_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_BursarGuard_002_39af930e-1e88-4fec-9797-883afe5342dc, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_007_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_MemberGuard_001_685285f4-389d-4192-897f-ad82591565c0, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_008_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_MemberGuard_002_ddf57aa4-878c-4a6e-b6b8-d6a4e95ea904, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_009_1140624b-d27c-43ec-9329-b45d883c900d);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_Advisor_04f4b6cd-0a4f-4304-bef2-1f6dab3d1c6a, (CHARACTER)S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8);

// AD between S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a AND S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4
DB_OneShotPartyTrigger((TRIGGER)S_LOW_Guildhall_StartADZhentMercenaryGuildMember_1222c4b0-6ace-46fb-acf9-773e8735951f);

// Bard gold transfer
DB_DialogMoneyTransfer(1, LOW_Guildhall_Bard_ee9407ce-33e0-8fa5-79d1-ed5fdf349b7c, 5);

// Dooze the Dunce
DB_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_Member_005_Leaves_809e7412-ec2d-55dc-ace8-037be33e35a3, (DIALOGRESOURCE)LOW_Guildhall_Member_005_e6b43115-8de9-0b9c-7dff-fada994f66f3);

// Guild Inhabitants
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_009_7acea0a6-6e17-477c-b854-18e780b43b0e, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_007_65a5e1cd-6714-4bf0-babd-80714c993953, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bursar_Guard_001_9f22df22-dc41-4126-a2ce-fd86011c9427, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bursar_Guard_002_2d55fd30-032e-43a8-87ad-40c89070f28e, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_002_899738c6-ac8e-44f0-9c4b-c0843c717ad4, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_004_d40ae4a2-f29a-4d69-b9f7-9b078aeee0be, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_003_28610d0d-fee5-4f7b-b7d3-db60c717b1dd, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_005_b34e82a2-f774-4f73-b808-c2e79cabdb2a, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_FetchersBrat_002_3352a47c-4259-464d-8047-65bc8a2adff9, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_FetchersBrat_003_18c2988a-5902-4cb8-b620-4b0c67a2aceb, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Member_006_75cbf81e-0f16-459b-aa07-966eccf658ce, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bartender_00c74e3b-5880-4525-9558-860e4f7c77e2, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bard_da9309e9-b13a-49a2-adb6-78fc44aeeb71, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bodyguard_000_6d430ca2-660e-4000-bcf4-8ee5e2c88440, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bodyguard_002_053734fb-4c70-4550-ae64-4b45d4bf59fb, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bodyguard_003_1a070383-da33-4107-90ef-68e2fdc03ac0, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bodyguard_004_df4e07cc-8e02-4c66-94b9-8f4e34eccec0, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, "Guild");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Bodyguard_001_0962e1ca-7d48-4fde-af0e-250091e9d4e1, "Guild");
DB_LOW_Guildhall_Inhabitants(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, "Guild");
DB_LOW_Guildhall_Inhabitants(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_003_fbffc206-5f7d-4d27-9fc8-6080a7212602, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_008_7d31c0db-57d7-4c7e-956c-0cb67d5ab60b, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_009_c8bb42d3-9670-4604-beb9-dde0f9e92abd, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_007_6dc1a56a-19b7-4a4a-9530-ec41ba9dfef7, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_005_0e5c8772-e931-48f8-9743-c9c09059efbc, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_004_6e6853b1-b422-4c18-b08b-e4c3a96b3b0e, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_002_1140624b-d27c-43ec-9329-b45d883c900d, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Zhent_Mercenary_006_9a307843-3958-4c07-ace9-f1c04b5af558, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "Zhent");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_003_5a44b1da-b8c6-494b-abd5-0976c3f59745, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_004_e6abd16d-33b4-471b-9e6a-4338171a7a43, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_002_d16d9c85-6d17-4e79-9c3b-864f033054b0, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_001_b8f45e3c-1ef2-4a66-bdfe-2d54c700a91d, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, "Visitor");
DB_LOW_Guildhall_Inhabitants(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, "Visitor");

DB_PermaDefeatedFlag(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615,(FLAG)LOW_Guildhall_State_ZhentLeaderRoah_PermaDefeated_44aa8b1e-14d0-4dc1-825c-a8f46155e0aa);
DB_PermaDefeatedFlag(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9,(FLAG)LOW_Guildhall_State_ZhentLeaderFriol_PermaDefeated_3362ce9b-32c1-4751-84a4-ada8274d1e05);

//REGION Topical Greetings
DB_TopicalGreeting((FLAG)TG_LOW_Guildhall_MinscIsStoneLord_414dd72a-ddee-48d5-8550-07e135ad385b);
DB_TopicalGreeting((FLAG)TG_LOW_GuildhallCoupResolved_099299c4-9101-49e0-a08c-7cd30fee8de7);
//END_REGION

//REGION clickables
DB_ItemDialog_NarratorAD(S_LOW_Guildhall_WelcomeEasel_92cd4681-113c-41a8-b993-621fe81eab64, LOW_Guildhall_AD_Rule_43d9fb27-5ac6-66ae-fcf4-a8e87ba5edc5);
DB_ItemDialog_NarratorAD(S_LOW_Guildhall_WelcomePlaque_4e3088f4-8018-468e-a7a4-7881fb762ec2, LOW_Guildhall_AD_Rule_43d9fb27-5ac6-66ae-fcf4-a8e87ba5edc5);
DB_ItemDialog_NarratorAD(S_LOW_Guildhall_Ninefingers_WinePlaque_0a24f074-9131-408e-88cb-5995b905c180, LOW_Guildhall_AD_VintageMoonshaeZinfandelCollection_b26f3d07-88ab-b4c7-c8c0-022291e51c3d);
//END_REGION

//REGION Gossip flags
SetFlag((FLAG)LOW_Guildhall_State_NotMetNineFingers_311941fa-c871-4fa5-80df-d2c7914eed44);
//END_REGION
KBSECTION
//REGION Flag when player enters Guildhall
IF
DB_InRegion(_Player, (TRIGGER)S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_PlayerEnteredGuildhall")
THEN
SetFlag((FLAG)LOW_Guildhall_State_PlayerHasBeenToGuildhall_3a991c6a-a315-47e3-ba78-58b5d011d256);
//END_REGION

//REGION AD between Zhent and Guild member upon approaching
PROC
PROC_OneShotTriggerEntered((CHARACTER)_Player, (TRIGGER)S_LOW_Guildhall_StartADZhentMercenaryGuildMember_1222c4b0-6ace-46fb-acf9-773e8735951f)
AND
GetDistanceTo(S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a, _Player, _DistanceToPlayer)
AND
_DistanceToPlayer < 20.0
AND
GetDistanceTo(S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a, S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4, _DistanceToBetweenNPCs)
AND
_DistanceToBetweenNPCs < 5.0
AND
NOT QRY_StartDialog((DIALOGRESOURCE)LOW_Guildhall_AD_Intro_Member_001_Zhent_Mercenary_001_5d8d8a20-4ef4-3c54-e0aa-ef6658cba1b7, (CHARACTER)S_LOW_Guildhall_Member_001_d71b8ebb-83e4-4732-bce5-722685ec9f5a, (CHARACTER)S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4)
THEN
SetFlag((FLAG)LOW_Guildhall_State_AD_Intro_ZhentGuild_Finished_4ab206fc-7590-46e5-98c6-395795dae13d);

IF
AutomatedDialogEnded((DIALOGRESOURCE)LOW_Guildhall_AD_Intro_Member_001_Zhent_Mercenary_001_5d8d8a20-4ef4-3c54-e0aa-ef6658cba1b7, _)
THEN
SetFlag((FLAG)LOW_Guildhall_State_AD_Intro_ZhentGuild_Finished_4ab206fc-7590-46e5-98c6-395795dae13d);

IF
AutomatedDialogRequestFailed((DIALOGRESOURCE)LOW_Guildhall_AD_Intro_Member_001_Zhent_Mercenary_001_5d8d8a20-4ef4-3c54-e0aa-ef6658cba1b7, _)
THEN
SetFlag((FLAG)LOW_Guildhall_State_AD_Intro_ZhentGuild_Finished_4ab206fc-7590-46e5-98c6-395795dae13d);
//END_REGION

//REGION Zhent leader
PROC
PROC_LOW_Guildhall_InitZhentLeader()
AND
NOT DB_PermaDefeated((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615)
THEN
DB_LOW_Guildhall_ZhentRepresentative((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
DB_LOW_Guildhall_ZhentLeader((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
PROC_SetOnStage(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, 0);
SetFlag((FLAG)LOW_Guildhall_State_RoahIsZhentLeader_f7e16290-420a-4504-911c-156764257e33);
SetLevel((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, 11);
RequestSetBaseArchetype((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "mage_no_inventory_items");
PROC_LOW_Guildhall_SetupZhentLeader();

PROC
PROC_LOW_Guildhall_InitZhentLeader()
AND
DB_PermaDefeated((CHARACTER)S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615)
THEN
DB_LOW_Guildhall_ZhentRepresentative((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
DB_LOW_Guildhall_ZhentLeader((CHARACTER)S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
ClearFlag((FLAG)LOW_Guildhall_State_RoahIsZhentLeader_f7e16290-420a-4504-911c-156764257e33);
PROC_LOW_Guildhall_SetupZhentLeader();

PROC
PROC_LOW_Guildhall_SetupZhentLeader()
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "Default", _LeaderDialog)
THEN
DB_GLO_DefeatCounter(_Leader, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_ZhentLeader_CombatStartPoint_9431524b-e12d-4b91-a976-743021cf59a4, _Leader);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_Leader_29de84e5-b1c0-44a1-8531-f45f5461ca1b, _Leader);
PROC_SetOnStage(_Leader, 0);
SetFaction(_Leader, (FACTION)ACT3_LOW_Guildhall_Zhent_0a9246a5-88ee-4b47-85d4-c86aba7d62dd);
PROC_RemoveDialog(_Leader);
DB_Dialogs(_Leader, _LeaderDialog);
ObjectSetTitle(_Leader, "LOW_Guildhall_Roah_Title");
//END_REGION

//REGION Zhent leader backup
PROC
PROC_LOW_Guildhall_InitZhentLeaderBackup()
THEN
PROC_SetOnStage(S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, 0);

PROC
PROC_LOW_Guildhall_SetupZhentLeaderBackup()
AND
DB_LOW_Guildhall_ZhentRepresentative(_CurrentRepresentative)
THEN
NOT DB_LOW_Guildhall_ZhentRepresentative(_CurrentRepresentative);
NOT DB_GLO_DefeatCounter(_CurrentRepresentative, "LOW_Guildhall_ZhentBetrayal_Zhent");
NOT DB_LOW_Guildhall_CombatPositions(S_LOW_Guildhall_ZhentLeader_CombatStartPoint_9431524b-e12d-4b91-a976-743021cf59a4, _CurrentRepresentative);
DB_LOW_Guildhall_ZhentRepresentative(S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8);
DB_GLO_DefeatCounter(S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_LOW_Guildhall_CombatPositions(S_LOW_Guildhall_ZhentLeader_CombatStartPoint_9431524b-e12d-4b91-a976-743021cf59a4, S_LOW_Guildhall_Zhent_LeaderBackup_35352384-a2ea-464b-96e0-1c6554b2f6b8);
//END_REGION

//REGION Zhent Rugan
// If Rugan survived Act 1 without needing to be saved, he will be among his Zhent colleagues.
PROC
PROC_LOW_Guildhall_SetupRugan()
AND
NOT QRY_LOW_Guildhall_RuganDied()
AND
NOT DB_GlobalFlag((FLAG)PLA_ZhentDungeon_State_AgentFreed_c76fac51-f641-3c4b-9710-8b1fb93db25f)
THEN
TeleportTo(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, (TRIGGER)S_LOW_Guildhall_Zhent_Trigger_Rugan_fc93bd08-325c-45dd-a6bd-35c1079aa866, "");
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, (DIALOGRESOURCE)LOW_Guildhall_Zhent_Agent001_c4a83e2d-fb77-4e89-594b-e196aa8e0ce4);
SetFaction(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, (FACTION)ACT3_LOW_Guildhall_Zhent_0a9246a5-88ee-4b47-85d4-c86aba7d62dd);
RequestSetSwarmGroup(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "LOW_Guildhall_Zhentarim");
DB_GLO_DefeatCounter(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "LOW_Guildhall_ZhentBetrayal_Zhent");
DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Rugan_CombatStartPoint_b1ebf88a-6582-48ae-abf1-0f8d3bbec504, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_Bar_001_7ad48adf-5594-4b9b-b6cf-7cd6c9fc4479, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);

IF
FlagSet((FLAG)LOW_Guildhall_Zhent_Agent001_OffDuty_753e16d5-eda1-ba9f-d110-4765195cfc60, _, _)
THEN
SetFaction(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, (FACTION)ACT3_LOW_Guildhall_Members_d0c91116-2d9a-4846-a6e9-50c06fc20321);
RequestSetSwarmGroup(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "");
NOT DB_GLO_DefeatCounter(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "LOW_Guildhall_ZhentBetrayal_Zhent");
NOT DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_Zhent_Rugan_CombatStartPoint_b1ebf88a-6582-48ae-abf1-0f8d3bbec504, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
PROC_SetAnubisConfig(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "LOW_Guildhall_Zhent_Agent_001");
//END_REGION

//REGION Guild Bursar Uktar
PROC
PROC_LOW_Guildhall_InitBursar()
THEN
DB_Inclusion_NPCDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74);
TeleportTo((CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74, (TRIGGER)S_LOW_Guildhall_BursarInitialPos_c6e828e4-b5ac-4974-bd8b-6e6a3eae9033);

// Talking to Uktar while he's still in 9Fs office will start the 9F dialog
QRY
QRY_SelectCustomDialog((CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74, _Player)
AND
NOT DB_GlobalFlag((FLAG)LOW_Guildhall_Event_BursarDoneSpeakingWith9F_a5f37c27-89df-45a7-a649-c5e951fcd393)
AND
NOT DB_GlobalFlag((FLAG)END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, NULL_00000000-0000-0000-0000-000000000000, _Player, NULL_00000000-0000-0000-0000-000000000000);

// Uktar returns to his spot at Guildhall state > PostHeist, if he hasn't already
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", _State)
AND
DB_State_Priority(_, "LOW_Guildhall_State", _State, _Priority)
AND
_Priority > 10
AND
NOT DB_GlobalFlag((FLAG)LOW_Guildhall_Event_BursarDoneSpeakingWith9F_a5f37c27-89df-45a7-a649-c5e951fcd393)
THEN
SetFlag((FLAG)LOW_Guildhall_Event_BursarDoneSpeakingWith9F_a5f37c27-89df-45a7-a649-c5e951fcd393);

// remove Uktar from getting included to 9F dialog after he returns to his spot
IF
FlagSet((FLAG)LOW_Guildhall_Event_BursarDoneSpeakingWith9F_a5f37c27-89df-45a7-a649-c5e951fcd393, _, _)
THEN
NOT DB_Inclusion_NPCDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (CHARACTER)S_LOW_Guildhall_Bursar_f571691c-9d96-4e7c-a605-c11201021c74);

IF
FlagSet(_Flag, _, _Dialog)
AND
DB_DialogPlayers(_Dialog, _Player, 1)
AND
DB_LOW_Guildhall_Bursar_GiveKeyFlag(_Flag, _QuestStep)
THEN
QuestUpdate((CHARACTER)_Player, "HIDDEN_CTY_Boosters", _QuestStep);

//END_REGION

//REGION Nine-fingers dialog
// 9F dialog houses an OM moment, so special dialog start required. Uktar's inclusion will be done automatically when needed, as well as any OM for Jaheira/Minsc
QRY
QRY_SelectCustomDialog((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, _Player)
AND
NOT DB_GlobalFlag((FLAG)END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, NULL_00000000-0000-0000-0000-000000000000, _Player, NULL_00000000-0000-0000-0000-000000000000);

// Set TG when players find out Minsc is the Stone Lord.
IF
FlagSet((FLAG)GLO_Minsc_Knows_MinscIsStoneLord_891f3591-4121-810a-aa9d-9fb1c8cd47cd,_ , _)
THEN
PROC_TopicalGreeting_UnlockTopic((FLAG)TG_LOW_Guildhall_MinscIsStoneLord_414dd72a-ddee-48d5-8550-07e135ad385b);
//END_REGION

//REGION Mol
PROC
PROC_LOW_Guildhall_InitMol()
AND
QRY_LOW_Guildhall_MolSurvivedAct2()
THEN
PROC_LOW_Guildhall_SetupMol();

PROC
PROC_LOW_Guildhall_InitMol()
AND
NOT QRY_LOW_Guildhall_MolSurvivedAct2()
THEN
PROC_LOW_Guildhall_MolNotHere();

PROC
PROC_LOW_Guildhall_MolNotHere()
THEN
PROC_SetOnStage(S_LOW_HouseOfHope_MolContract_5fa7c7b9-cdf0-42ef-b75a-96b1f34073c3, 0);

PROC
PROC_LOW_Guildhall_SetupMol()
THEN
PROC_SetOnStage((CHARACTER)S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, 0);
PROC_SetOnStage((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
TeleportTo((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (TRIGGER)S_LOW_Guildhall_Point_FetchersBrat_001_aee7c92e-f8b8-4092-ac5e-667a21fc274a);
PROC_RemoveDialog((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_Dialogs((CHARACTER)S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, (DIALOGRESOURCE)LOW_Guildhall_ThiefHideoutLeader_172a259c-8587-2d5c-2b38-665d790d491d);
DB_HasItemEvent((ITEM)S_LOW_HouseOfHope_MolContract_5fa7c7b9-cdf0-42ef-b75a-96b1f34073c3, (FLAG)LOW_Guildhall_State_HasMolsContract_d781d435-91ea-454a-807c-a89a418d52f7);
DB_GiveItemToEvent((ITEM)S_LOW_HouseOfHope_MolContract_5fa7c7b9-cdf0-42ef-b75a-96b1f34073c3, (FLAG)LOW_Guildhall_Event_GiveMolsContract_a6aa3925-964e-4646-9186-c9c90a7ef344);

PROC
PROC_LOW_Guildhall_SetupMol()
AND
NOT DB_GlobalFlag((FLAG)HAV_MolsDeal_State_MolLeftWithHarpers_149b5a39-392c-4c0a-bb64-796f0123ddcf)
THEN
Transform(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, Child_Tieflings_Mol_82d1b94d-5b32-4e32-b65c-34255e65aa1f, (SHAPESHIFTRULE)Disguise_ceccc4eb-d774-4cd5-9147-12322b81b763);


QRY
QRY_LOW_Guildhall_MolSurvivedAct2()
AND
NOT DB_PermaDefeated(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925)
THEN
DB_NOOP(1);

IF
MovedFromTo(S_COL_NecromancerLab_MolEyepatch_fa9baba1-f855-449c-8327-9728a493b193, _, S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, _)
THEN
Transform(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, Child_Tieflings_Mol_Eyepatch_7df301e7-35f4-426e-8334-2b697e33711d,(SHAPESHIFTRULE)Disguise_ceccc4eb-d774-4cd5-9147-12322b81b763);
PROC_LOW_Guildhall_RemoveEyePatch();

PROC
PROC_LOW_Guildhall_RemoveEyePatch()
AND
DB_CurrentLevel(_CurrentLevel)
AND
DB_GLO_MadMonk_AsylumPos(_CurrentLevel, _Trigger)
THEN
PROC_TeleportToAndOffStage(S_COL_NecromancerLab_MolEyepatch_fa9baba1-f855-449c-8327-9728a493b193, _Trigger);
//END_REGION

//REGION Oskar
PROC
PROC_LOW_Guildhall_SetupOskar()
AND
NOT DB_LOW_Guildhall_OskarIsOnStage(1)
THEN
PROC_LOW_Guildhall_SwapOskar();

// swap between Oskar and Blades Bakstir
PROC
PROC_LOW_Guildhall_SwapOskar()
AND
NOT DB_LOW_Guildhall_OskarIsOnStage(1)
AND
QRY_Debug_LOW_Guildhall_ResetSwapTracker()
THEN
DB_LOW_Guildhall_OskarIsOnStage(1);
TeleportTo((CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, S_LOW_OskarsGuildhallPosition_7a0c868f-e4a0-4c24-b764-6dfd116bd253);
PROC_SetOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd,1);
PROC_SetOnStage(S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, 0);
SetCanJoinCombat(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 0);
DB_Debug_LOW_Guildhall_SwapTracker(1);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Painter_69e0c08e-47d5-4be8-9285-7e6a465e0b65, (CHARACTER)S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd);

PROC
PROC_LOW_Guildhall_SwapOskar()
AND
DB_LOW_Guildhall_OskarIsOnStage(1)
AND
NOT DB_Debug_LOW_Guildhall_SwapTracker(1)
THEN
NOT DB_LOW_Guildhall_OskarIsOnStage(1);
PROC_SetOnStage(S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, 1);
PROC_SetOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 0);
DB_ItemOwnerShipTriggers("CTY_Main_A", (TRIGGER)S_LOW_Guildhall_Ownership_Painter_69e0c08e-47d5-4be8-9285-7e6a465e0b65, (CHARACTER)S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d);
//END_REGION

//REGION S_LOW_Guildhall_Visitor_005 / S_LOW_Guildhall_Visitor_006
QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, (CHARACTER)_Player)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_Visitor_005_252a7ff8-2451-af7a-55fc-06502cc6f6b1, S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, _Player);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, (CHARACTER)_Player)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_Visitor_005_252a7ff8-2451-af7a-55fc-06502cc6f6b1, S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, _Player);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, (CHARACTER)_Player)
AND
NOT QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_Visitor_005_252a7ff8-2451-af7a-55fc-06502cc6f6b1, S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, NULL_00000000-0000-0000-0000-000000000000, _Player);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, (CHARACTER)_Player)
AND
NOT QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_Guildhall_Visitor_005_bf4caace-8ed0-42c4-8b17-a297b80fff9a, S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356)
THEN
DB_SelectedDialog((DIALOGRESOURCE)LOW_Guildhall_Visitor_005_252a7ff8-2451-af7a-55fc-06502cc6f6b1, NULL_00000000-0000-0000-0000-000000000000, S_LOW_Guildhall_Visitor_006_227941fa-8264-4a8f-b3b6-2ae0f7ec3356, _Player);
//END_REGION

//REGION Counting House clues
IF
GameBookInterfaceClosed(S_LOW_Guildhall_CountingHouseLetter_3d997a31-fda5-4780-90f0-b00fe43d1734, _Player)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_HasRead_CountingHouseLetter")
AND
QRY_StartDialog_Fixed(LOW_Guildhall_PAD_FoundCountingHouseAmbushNote_4c460f94-2ad8-c4c6-3e25-a4c97615f20a, _Player)
THEN
DB_NOOP(1);
//END_REGION

//REGION Set up Guildhall during Zhent Betrayal (State DuringCoup)
// Players found the heist at the Counting House
// Set flag if flag wasn't set yet for debug reasons
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PostHeist")
AND
NOT DB_GlobalFlag((FLAG)LOW_CountingHouse_State_RobbersEscaped_16197488-9cc2-48e2-94ae-36225025d4d8)
THEN
SetFlag((FLAG)LOW_CountingHouse_State_RobbersEscaped_16197488-9cc2-48e2-94ae-36225025d4d8);

// Zhent leader escaped from Abandoned Cistern which triggers the Zhent takeover over the Guildhall
IF
FlagSet((FLAG)LOW_MinscHideout_State_ZhentLeaderEscaped_0a08b808-b6e2-4923-936c-c12f2774ce61, _, _)
AND
NOT DB_State_Current(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_LOW_Guildhall_ZhentLeader(_Leader)
THEN
SetCombatGroupID(_Leader, "");
LeaveCombat(_Leader);
PROC_SetOnStage(_Leader, 0);
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup");

// Zhent leader died, alternative respresentative will arrive at Guildhall
IF
DB_PermaDefeated(_Leader)
AND
DB_LOW_Guildhall_ZhentLeader((CHARACTER)_Leader)
AND
NOT DB_GlobalFlag(LOW_Guildhall_State_DuringCoup_6dba56a5-8220-41f4-8849-085e38b80d4e)
THEN
PROC_LOW_Guildhall_SetupZhentLeaderBackup();
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup");

// Zhent takeover of Guildhall begins
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
TeleportTo(_Leader, (TRIGGER)S_LOW_Guildhall_Entrance_a78a0b7b-489a-4743-9e6e-4c88f24cc2ca, "LOW_Guildhall_ZhentBetrayal_LeaderArrived");
PROC_SetOnStage(_Leader, 1);

// QRY to count the total number of members in DB_GLO_DefeatCounter
QRY
QRY_LOW_Guildhall_CountMembers((STRING)_)
AND
DB_QRYRTN_LOW_Guildhall_CountMembers(_Count)
THEN
NOT DB_QRYRTN_LOW_Guildhall_CountMembers(_Count);

QRY
QRY_LOW_Guildhall_CountMembers((STRING)_)
THEN
DB_QRYRTN_LOW_Guildhall_CountMembers(0);

QRY
QRY_LOW_Guildhall_CountMembers((STRING)_Side)
AND
DB_GLO_DefeatCounter(_, _Side)
AND
DB_QRYRTN_LOW_Guildhall_CountMembers(_Count)
AND
IntegerSum(_Count, 1, _NewCount)
THEN
NOT DB_QRYRTN_LOW_Guildhall_CountMembers(_Count);
DB_QRYRTN_LOW_Guildhall_CountMembers(_NewCount);

// Zhent leader arrived and assesses the situation
IF
EntityEvent((CHARACTER)_Leader, "LOW_Guildhall_ZhentBetrayal_LeaderArrived")
AND
QRY_GLO_DefeatCounter_Count("LOW_Guildhall_ZhentBetrayal_Zhent", "PermaDefeated")
AND
DB_QRYRTN_GLO_DefeatCounter_Count(_ZhentDefeatCount)
AND
QRY_LOW_Guildhall_CountMembers("LOW_Guildhall_ZhentBetrayal_Zhent")
AND
DB_QRYRTN_LOW_Guildhall_CountMembers(_ZhentTotalCount)
AND
IntegerSubtract(_ZhentTotalCount, _ZhentDefeatCount, _ZhentCount)
AND
QRY_GLO_DefeatCounter_Count("LOW_Guildhall_ZhentBetrayal_Guild", "PermaDefeated")
AND
DB_QRYRTN_GLO_DefeatCounter_Count(_GuildDefeatCount)
AND
QRY_LOW_Guildhall_CountMembers("LOW_Guildhall_ZhentBetrayal_Guild")
AND
DB_QRYRTN_LOW_Guildhall_CountMembers(_GuildTotalCount)
AND
IntegerSubtract(_GuildTotalCount, _GuildDefeatCount, _GuildCount)
THEN
PROC_LOW_Guildhall_ZhentLeaderAssesSituation(_Leader, _ZhentCount, _GuildCount);

// All the Zhent are dead: Zhent leader flees
PROC
PROC_LOW_Guildhall_ZhentLeaderAssesSituation((CHARACTER)_Leader, (INTEGER)_ZhentCount, (INTEGER)_GuildCount)
AND
_ZhentCount == 0
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverCancelled_AllMenDead", _AD)
AND
QRY_OnlyOnce("LOW_Guildhall_ZhentLeaderAssesSituation")
AND
NOT QRY_StartDialog(_AD, _Leader)
THEN
PROC_LOW_Guildhall_ZhentLeaderFlees();

IF
AutomatedDialogEnded((DIALOGRESOURCE)_AD, _)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverCancelled_AllMenDead", _AD)
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
PROC_LOW_Guildhall_ZhentLeaderFlees();

// Most of the Zhent are dead, the chance of winning against the remaining guild is slim: Zhent leader flees
PROC
PROC_LOW_Guildhall_ZhentLeaderAssesSituation((CHARACTER)_Leader, (INTEGER)_ZhentCount, (INTEGER)_GuildCount)
AND
IntegerSum(_ZhentCount, 3, _ZhentCountWithMargin)
AND
_ZhentCountWithMargin < _GuildCount
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverCancelled_MostMenDead", _AD)
AND
QRY_OnlyOnce("LOW_Guildhall_ZhentLeaderAssesSituation")
AND
NOT QRY_StartDialog(_AD, _Leader)
THEN
PROC_LOW_Guildhall_ZhentLeaderFlees();

IF
AutomatedDialogEnded((DIALOGRESOURCE)_AD, _)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverCancelled_MostMenDead", _AD)
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
PROC_LOW_Guildhall_ZhentLeaderFlees();

// There are no Guild left: Easy takeover
PROC
PROC_LOW_Guildhall_ZhentLeaderAssesSituation((CHARACTER)_Leader, (INTEGER)_ZhentCount, (INTEGER)_GuildCount)
AND
_GuildCount == 0
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverEasy", _AD)
AND
QRY_OnlyOnce("LOW_Guildhall_ZhentLeaderAssesSituation")
AND
NOT QRY_StartDialog(_AD, _Leader)
THEN
PROC_LOW_Guildhall_ZhentEasyTakeover();

IF
AutomatedDialogEnded((DIALOGRESOURCE)_AD, _)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverEasy", _AD)
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
PROC_LOW_Guildhall_ZhentEasyTakeover();

// In every other situation: Takeover combat is prepared
PROC
PROC_LOW_Guildhall_ZhentLeaderAssesSituation((CHARACTER)_Leader, (INTEGER)_ZhentCount, (INTEGER)_GuildCount)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverStarts", _AD)
AND
QRY_OnlyOnce("LOW_Guildhall_ZhentLeaderAssesSituation")
AND
NOT QRY_StartDialog(_AD, _Leader)
THEN
PROC_LOW_Guildhall_ZhentCoupFightPosition();

IF
AutomatedDialogEnded((DIALOGRESOURCE)_AD, _)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "AD_TakeoverStarts", _AD)
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
PROC_LOW_Guildhall_ZhentCoupFightPosition();

PROC
PROC_LOW_Guildhall_ZhentLeaderFlees()
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled");

PROC
PROC_LOW_Guildhall_ZhentEasyTakeover()
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled");

// all combatants move into position after hearing the Zhent representative calling for a coup
PROC
PROC_LOW_Guildhall_ZhentCoupFightPosition()
AND
QRY_OnlyOnce("LOW_Guildhall_ZhentBetrayalPosition")
AND
DB_LOW_Guildhall_CombatPositions(_Trigger, _Character)
AND
NOT DB_PermaDefeated(_Character)
THEN
PROC_CharacterMoveTo(_Character, _Trigger, "Run", "LOW_Guildhall_ZhentBetrayalPositioned");

// Guild combatants added to combat group
PROC
PROC_LOW_Guildhall_ZhentCoupFightPosition()
AND
DB_GLO_DefeatCounter(_Combatant, "LOW_Guildhall_ZhentBetrayal_Guild")
THEN
SetCombatGroupID(_Combatant, "d92371be-2327-2b10-0b04-6af5f93a3862");

// Zhent combatants added to combat group
PROC
PROC_LOW_Guildhall_ZhentCoupFightPosition()
AND
DB_GLO_DefeatCounter(_Combatant, "LOW_Guildhall_ZhentBetrayal_Zhent")
THEN
SetCombatGroupID(_Combatant, "40886268-0556-48c3-a866-ebe3f21e246d");

// Zhent leader is in position and will scan players to start dialog
IF
EntityEvent((CHARACTER)_Leader, "LOW_Guildhall_ZhentBetrayalPositioned")
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "Default", _Dialog)
THEN
PROC_RemoveDialog(_Leader);
DB_Dialogs(_Leader, _Dialog);
DB_SpotPlayers(_Leader, "LOW_Guildhall_ZhentBetrayal_ZhentLookingForPlayers", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_CustomRadius(_Leader, "LOW_Guildhall_ZhentBetrayal_ZhentLookingForPlayers", 8.0);
PROC_TriggerRegisterForPlayers((TRIGGER)S_LOW_Guildhall_StartCoupCombat_37664a50-c84d-4b7d-b200-a9fab39e4ee7);

PROC
PROC_SpotPlayers_Spotted(_Leader, "LOW_Guildhall_ZhentBetrayal_ZhentLookingForPlayers", _Player)
AND
DB_LOW_Guildhall_ZhentRepresentativeDialogs(_Leader, "Default", _Dialog)
AND
QRY_StartDialog(_Dialog, _Leader, _Player)
THEN
PROC_SpotPlayers_CleanupSpotting("LOW_Guildhall_ZhentBetrayal_9FLookingForPlayers");

// Ninefinges is in position and scans for players to start dialog
IF
EntityEvent((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, "LOW_Guildhall_ZhentBetrayalPositioned")
THEN
DB_SpotPlayers(S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, "LOW_Guildhall_ZhentBetrayal_9FLookingForPlayers", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_CustomRadius(S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, "LOW_Guildhall_ZhentBetrayal_9FLookingForPlayers", 8.0);
PROC_DefineSingleOriginMoment((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (TAG)REALLY_MINSC_aeb694fc-83fb-452d-819a-b97ba442dc42, NULL_00000000-0000-0000-0000-000000000000, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_COM_db0f86d4-7c39-25e9-d2e2-7d5a5340ee27, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_OOM_8ff4dc80-87cb-561c-6701-6e7431ad3d12);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_COM_db0f86d4-7c39-25e9-d2e2-7d5a5340ee27, _, _)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_OOM_8ff4dc80-87cb-561c-6701-6e7431ad3d12, _, _)
THEN
DB_NOOP(1);

PROC
PROC_SpotPlayers_Spotted(_NineFingers, "LOW_Guildhall_ZhentBetrayal_9FLookingForPlayers", _Player)
AND
QRY_StartDialog((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, _NineFingers, NULL_00000000-0000-0000-0000-000000000000, _Player)
THEN
PROC_SpotPlayers_CleanupSpotting("LOW_Guildhall_ZhentBetrayal_ZhentLookingForPlayers");

// Player chooses to side with Zhent after dialog
PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Player, (FLAG)LOW_Guildhall_Event_PickSideZhent_d2db099b-9bf8-4f51-bac4-cb3c1732884e)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithZhent(_Player);

// Player chooses to side with Guild after dialog
PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Player, (FLAG)LOW_Guildhall_Event_PickSideGuild_474bf19e-0cbe-47dd-98b1-5231e3b2f004)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithGuild(_Player);

// Players get too close to the tense situation between Zhent and Guild
// One of the Zhent sees the player, which starts the combat with the player against the Zhent
IF
DB_InRegion((CHARACTER)_Player, (TRIGGER)S_LOW_Guildhall_StartCoupCombat_37664a50-c84d-4b7d-b200-a9fab39e4ee7)
AND
DB_Sees(_Combatant, _Player)
AND
DB_LOW_Guildhall_FinalPositions("Zhent", _, _Combatant)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithGuild(_Player);

// Players get too close to the tense situation between Zhent and Guild
// The Zhent don't see the player, combat starts with player neutral to either Zhent or Guild
IF
DB_InRegion((CHARACTER)_Player, (TRIGGER)S_LOW_Guildhall_StartCoupCombat_37664a50-c84d-4b7d-b200-a9fab39e4ee7)
AND
DB_GLO_DefeatCounter(_Combatant, "LOW_Guildhall_ZhentBetrayal_Zhent")
AND
NOT DB_PermaDefeated(_Combatant)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithGuild(_Player);

// Players attack the Zhent while combat has not yet started during Guildhall coup
IF
AttackedBy((CHARACTER)_ZhentCombatant, (CHARACTER)_Player, _, _, _, _, _)
AND
DB_GLO_DefeatCounter(_ZhentCombatant, "LOW_Guildhall_ZhentBetrayal_Zhent")
AND
DB_State_Current(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithGuild(_Player);

// Players attack the Guild while combat has not yet started during Guildhall coup
IF
AttackedBy((CHARACTER)_GuildCombatant, (CHARACTER)_Player, _, _, _, _, _)
AND
DB_GLO_DefeatCounter(_GuildCombatant, "LOW_Guildhall_ZhentBetrayal_Guild")
AND
DB_State_Current(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat")
THEN
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithZhent(_Player);

// Initiate fight between Zhent and Guild, with player on Guild side
PROC
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithGuild((CHARACTER)_Player)
AND
DB_GLO_DefeatCounter(_ZhentCombatant, "LOW_Guildhall_ZhentBetrayal_Zhent")
AND
NOT DB_PermaDefeated(_ZhentCombatant)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat_FirstCombatant")
THEN
SetFlag((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5);
PROC_SetRelationMutual((FACTION)ACT3_LOW_Guildhall_Zhent_0a9246a5-88ee-4b47-85d4-c86aba7d62dd, (FACTION)ACT3_LOW_Guildhall_Guards_69c279fa-5480-40e1-aa84-3b498f7736b8, 0);
SetHostileAndEnterCombat((FACTION)ACT3_LOW_Guildhall_Zhent_0a9246a5-88ee-4b47-85d4-c86aba7d62dd, (FACTION)Hero_a1542c81-6895-929e-4522-10ce218bb360, _ZhentCombatant, _Player);
PROC_LOW_Guildhall_StartCoupCombat_Cleanup();

// Initiate fight between Zhent and Guild, with player on Zhent side
PROC
PROC_LOW_Guildhall_DuringCoup_PlayerSidesWithZhent((CHARACTER)_Player)
AND
DB_GLO_DefeatCounter(_GuildCombatant, "LOW_Guildhall_ZhentBetrayal_Guild")
AND
NOT DB_PermaDefeated(_GuildCombatant)
AND
QRY_OnlyOnce("LOW_Guildhall_StartCoupCombat_FirstCombatant")
THEN
SetFlag((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366);
PROC_SetRelationMutual((FACTION)ACT3_LOW_Guildhall_Zhent_0a9246a5-88ee-4b47-85d4-c86aba7d62dd, (FACTION)ACT3_LOW_Guildhall_Guards_69c279fa-5480-40e1-aa84-3b498f7736b8, 0);
SetHostileAndEnterCombat((FACTION)ACT3_LOW_Guildhall_Guards_69c279fa-5480-40e1-aa84-3b498f7736b8, (FACTION)Hero_a1542c81-6895-929e-4522-10ce218bb360, _GuildCombatant, _Player);
PROC_LOW_Guildhall_StartCoupCombat_Cleanup();

// Clean up any potential remaining coup combat start triggers and setup
PROC
PROC_LOW_Guildhall_StartCoupCombat_Cleanup()
AND
DB_LOW_Guildhall_CombatPositions(_, _Combatant)
THEN
PROC_ClearStoryMove(_Combatant);

PROC
PROC_LOW_Guildhall_StartCoupCombat_Cleanup()
THEN
PROC_TriggerUnregisterForPlayers((TRIGGER)S_LOW_Guildhall_StartCoupCombat_37664a50-c84d-4b7d-b200-a9fab39e4ee7);
PROC_SpotPlayers_CleanupSpotting("LOW_Guildhall_ZhentBetrayal_ZhentLookingForPlayers");
PROC_SpotPlayers_CleanupSpotting("LOW_Guildhall_ZhentBetrayal_9FLookingForPlayers");
PROC_ClearOriginMoment((DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_COM_db0f86d4-7c39-25e9-d2e2-7d5a5340ee27);
PROC_ClearOriginMoment((DIALOGRESOURCE)LOW_Guildhall_NineFingers_OM_Minsc_DuringCoup_OOM_8ff4dc80-87cb-561c-6701-6e7431ad3d12);

//Coup Zhent defeated
IF
FlagSet((FLAG)LOW_Guildhall_State_CoupZhentDefeated_e02bbc9a-fcdb-4003-a601-1550c65fb03a, _, _)
AND
NOT DB_PermaDefeated((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled");

IF
FlagSet((FLAG)LOW_Guildhall_State_CoupZhentDefeated_e02bbc9a-fcdb-4003-a601-1550c65fb03a, _, _)
AND
DB_PermaDefeated((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled");

PROC
PROC_StateSet_PermaDefeated((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd)
AND
DB_GlobalFlag((FLAG)LOW_Guildhall_State_CoupZhentDefeated_e02bbc9a-fcdb-4003-a601-1550c65fb03a)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled");

//Coup guild defeated
IF
FlagSet((FLAG)LOW_Guildhall_State_CoupGuildDefeated_f4cef481-df6b-4773-bd26-3539f414c539, _, _)
AND
DB_LOW_Guildhall_ZhentLeader(_Leader)
AND
NOT DB_PermaDefeated(_Leader)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled");

IF
FlagSet((FLAG)LOW_Guildhall_State_CoupGuildDefeated_f4cef481-df6b-4773-bd26-3539f414c539, _, _)
AND
DB_LOW_Guildhall_ZhentLeader(_Leader)
AND
DB_PermaDefeated(_Leader)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled");

PROC
PROC_StateSet_PermaDefeated((CHARACTER)_Leader)
AND
DB_LOW_Guildhall_ZhentLeader(_Leader)
AND
DB_GlobalFlag((FLAG)LOW_Guildhall_State_CoupGuildDefeated_f4cef481-df6b-4773-bd26-3539f414c539)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled");

//END_REGION

//REGION Combat ADs for leaders
// Set combat ADs for Ninefingers
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
THEN
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (DIALOGRESOURCE)LOW_Guildhall_AD_Ninefingers_Combat_01_faf9a88c-2026-cc7d-6637-7965d5cade3d, 1);
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (DIALOGRESOURCE)LOW_Guildhall_AD_Ninefingers_Combat_02_d6927075-be91-621a-871d-38736a729d63, 2);
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (DIALOGRESOURCE)LOW_Guildhall_AD_Ninefingers_Combat_03_2b3b0687-57e7-8900-7dae-d179a1e34987, 3);
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (DIALOGRESOURCE)LOW_Guildhall_AD_Ninefingers_Combat_04_070b2395-b2f4-d2a7-c1c5-2fde9bb7ccc1, 4);
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (DIALOGRESOURCE)LOW_Guildhall_AD_Ninefingers_Combat_05_89738266-d2d2-1ba5-7dc3-ed98acdaee0e, 5);

// Set combat ADs for Roah
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_LOW_Guildhall_ZhentLeader(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615)
THEN
DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_Combat_01_7c50102f-9f71-f240-cb91-030818af3d16, 1);
DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_Combat_02_61578b90-b6f8-9ed3-1f3e-610c5b8f46ef, 2);
DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_Combat_03_096b2bbf-c549-9c53-4e11-efcfc2237c4a, 3);
DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, (DIALOGRESOURCE)LOW_Guildhall_AD_Roah_Combat_04_a3ac1ab8-31c2-b43e-89ea-959a6feaabf9, 4);

// Set combat ADs for Boss Friol
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup")
AND
DB_LOW_Guildhall_ZhentLeader(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9)
THEN
DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, (DIALOGRESOURCE)LOW_Guildhall_AD_Friol_Combat_01_668cd3b5-0889-ca80-0d79-7a00f421f38f, 1);
DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, (DIALOGRESOURCE)LOW_Guildhall_AD_Friol_Combat_02_f71a9e0d-765c-00ff-7a1e-90121a7391ca, 2);
DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, (DIALOGRESOURCE)LOW_Guildhall_AD_Friol_Combat_03_c09366ed-4740-2884-953f-4d802d8d0a95, 3);
DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, (DIALOGRESOURCE)LOW_Guildhall_AD_Friol_Combat_04_04cc9f23-cdd8-7d24-11b3-7705792c33f8, 4);

// Unset combat ADs for Ninefingers
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled")
AND
DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, _Dialog, _Turn)
THEN
NOT DB_CombatReact_AD_OnTurn(LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, _Dialog, _Turn);

// Unset combat ADs for Roah
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled")
AND
DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, _Dialog, _Turn)
THEN
NOT DB_CombatReact_AD_OnTurn(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, _Dialog, _Turn);

// Unset combat ADs for Boss Friol
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled")
AND
DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, _Dialog, _Turn)
THEN
NOT DB_CombatReact_AD_OnTurn(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, _Dialog, _Turn);

//END_REGION

//REGION Set up Guildhall after Coup (State PostCoup)
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", "LOW_Guildhall_State_PostCoup_ZhentControlled")
AND
DB_LOW_Guildhall_FinalPositions("Guild", _, _Character)
THEN
Die(_Character, DEATHTYPE.DoT, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", "LOW_Guildhall_State_PostCoup_GuildControlled")
AND
DB_LOW_Guildhall_FinalPositions("Zhent", _, _Character)
THEN
Die(_Character, DEATHTYPE.DoT, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", "LOW_Guildhall_State_PostCoup_PlayerControlled")
AND
DB_LOW_Guildhall_FinalPositions("Zhent", _, _Character)
THEN
Die(_Character, DEATHTYPE.DoT, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PreHeist", "LOW_Guildhall_State_PostCoup_PlayerControlled")
THEN
Die(S_LOW_Guildhall_Leader_29de84e5-b1c0-44a1-8531-f45f5461ca1b, DEATHTYPE.DoT, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", _, "LOW_Guildhall_State_PostCoup_ZhentControlled")
THEN
PROC_LOW_Guildhall_CoupResolved();

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", _, "LOW_Guildhall_State_PostCoup_GuildControlled")
THEN
PROC_LOW_Guildhall_CoupResolved();

PROC
PROC_State_Changed(_, "LOW_Guildhall_State", _, "LOW_Guildhall_State_PostCoup_PlayerControlled")
THEN
PROC_LOW_Guildhall_CoupResolved();
PROC_LOW_Guildhall_PlayerTakeoverResponse();

PROC
PROC_LOW_Guildhall_CoupResolved()
THEN
PROC_TopicalGreeting_UnlockTopic((FLAG)TG_LOW_GuildhallCoupResolved_099299c4-9101-49e0-a08c-7cd30fee8de7);
PROC_LOW_Guildhall_MoveToFinalPositions();

PROC
PROC_LOW_Guildhall_MoveToFinalPositions()
AND
DB_LOW_Guildhall_FinalPositions(_, _Point, _Character)
AND
NOT DB_PermaDefeated(_Character)
THEN
PROC_CharacterMoveTo(_Character, _Point, "Walk", "");

// Set up dialog and Minsc origin moment for Nine-fingers after Zhent attack
PROC
PROC_State_Changed(_, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled")
AND
NOT DB_PermaDefeated(S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd)
AND
DB_GlobalFlag((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5)
AND
QRY_OnlyOnce("LOW_Guildhall_NineFingersSetupAfterZhentAttack")
THEN
DB_Dialogs((CHARACTER)S_LOW_Guildhall_NineFingers_ef1b7a12-6439-470a-885c-fa47851728cd, (DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb);
PROC_DefineSingleOriginMoment((DIALOGRESOURCE)LOW_Guildhall_NineFingers_ef2cc5d5-b568-918e-a1d9-f95ef3b485eb, (TAG)REALLY_MINSC_aeb694fc-83fb-452d-819a-b97ba442dc42, NULL_00000000-0000-0000-0000-000000000000, (DIALOGRESOURCE)LOW_Guildhall_Ninefingers_OM_Minsc_COM_OOM_dcd969dc-5a4a-7ab9-915d-93254b05b88b, (DIALOGRESOURCE)LOW_Guildhall_Ninefingers_OM_Minsc_OOM_76086ae3-42dd-a56a-eaf9-d8f75f3877ba);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)LOW_Guildhall_Ninefingers_OM_Minsc_COM_OOM_dcd969dc-5a4a-7ab9-915d-93254b05b88b, _, _)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)LOW_Guildhall_Ninefingers_OM_Minsc_OOM_76086ae3-42dd-a56a-eaf9-d8f75f3877ba, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LOW_Guildhall_PlayerTakeoverResponse()
THEN
DB_OneShotPlayerTrigger((TRIGGER)S_LOW_Guildhall_PlayerTakeoverResponseTrigger_dc2f29f8-1433-49e1-a3a7-92d5a0ab8c22);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Player, (TRIGGER)S_LOW_Guildhall_PlayerTakeoverResponseTrigger_dc2f29f8-1433-49e1-a3a7-92d5a0ab8c22)
AND
QRY_StartDialog((DIALOGRESOURCE)LOW_Guildhall_PAD_PlayerTakeoverResponse_59839f27-4904-b001-74c9-281a183f1b58, _Player)
THEN
DB_NOOP(1);
//END_REGION

//REGION Crane boulder traps
// Boulder directly attacked
IF
AttackedBy((ITEM)_Boulder, (CHARACTER)_AttackOwner, _, _, _, _, _)
AND
DB_LOW_Guildhall_Bouldertrap(_Boulder, _)
THEN
PROC_LOW_Guildhall_BoulderFalls(_Boulder, _AttackOwner);

IF
DestroyedBy((ITEM)_BoulderConnection, (CHARACTER)_AttackOwner, _, _)
AND
DB_LOW_Guildhall_Bouldertrap(_Boulder, _BoulderConnection)
THEN
PROC_LOW_Guildhall_BoulderFalls(_Boulder, _AttackOwner);

PROC
PROC_LOW_Guildhall_BoulderFalls((ITEM)_Boulder, (CHARACTER)_Attacker)
AND
DB_LOW_Guildhall_Bouldertrap(_Boulder, _BoulderConnection)
THEN
SetGravity(_Boulder, GRAVITYTYPE.Enabled);
PlaySound(_Boulder, "SE_S_CHA_OUTSIDE_Fissure_Boulder_Fall");
//END_REGION

//REGION DB_LOW_Guildhall_Inhabitants check TODO: delete when no longer needed
IF
DB_LOW_Guildhall_Inhabitants(_, _)
THEN
DB_NOOP(1);
//END_REGION

//REGION Give Zhent shipment to Slick Inatra
IF
FlagSet((FLAG)PLA_ZhentShipment_Event_GiveChest_e1023d4c-bfab-420d-a660-9c0e5eff06f0, S_LOW_Guildhall_Zhent_Mercenary_001_5ac9c7ec-d26f-404e-bd17-e9d3dad000c4, _DialogID)
AND
DB_DialogPlayers(_DialogID, _Player, 1)
THEN
QuestUpdate((CHARACTER)_Player, "HIDDEN_CTY_Boosters", "LOW_Guildhall_DeliveredZhentShipment");
//END_REGION

//REGION Doozy the Dunce leaves when you find his ring
PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)LOW_Guildhall_Event_Member_005_Leaves_809e7412-ec2d-55dc-ace8-037be33e35a3)
THEN
PROC_RemoveDialog((CHARACTER)S_LOW_Guildhall_Member_005_b34e82a2-f774-4f73-b808-c2e79cabdb2a);
PROC_DisappearOutOfSightTo((CHARACTER)S_LOW_Guildhall_Member_005_b34e82a2-f774-4f73-b808-c2e79cabdb2a, S_LOW_Guildhall_Entrance_a78a0b7b-489a-4743-9e6e-4c88f24cc2ca, "Run", 0, "");
//END_REGION

//REGION Debug

IF
FlagSet((FLAG)Debug_LOW_Guildhall_Rugan_8c7f1267-c035-4856-87da-abd0ca3668ca, _, _)
THEN
PROC_GlobalSetFlagAndCache((FLAG)PLA_ZhentDungeon_State_Zhent01Arrived_444dcaeb-3de2-4199-a066-5e85eabdb0ed);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentShipment_State_ChestLost_a672d90e-72fa-4ce3-8152-6969e39ab521);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentShipment_Rugan_Knows_Thief_26f50a78-b9bf-43f2-bedd-d7d7347a9128);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentDungeon_State_AgentFreed_c76fac51-f641-3c4b-9710-8b1fb93db25f);
PROC_GlobalSetFlagAndCache((FLAG)PLA_ZhentShipment_State_Talked_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c);
PROC_LOW_Guildhall_SetupRugan();

IF
TextEvent("Guildhall_Rugan_Friendly")
THEN
PROC_GlobalSetFlagAndCache((FLAG)PLA_ZhentDungeon_State_Zhent01Arrived_444dcaeb-3de2-4199-a066-5e85eabdb0ed);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentShipment_State_ChestLost_a672d90e-72fa-4ce3-8152-6969e39ab521);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentShipment_Rugan_Knows_Thief_26f50a78-b9bf-43f2-bedd-d7d7347a9128);
PROC_GlobalClearFlagAndCache((FLAG)PLA_ZhentDungeon_State_AgentFreed_c76fac51-f641-3c4b-9710-8b1fb93db25f);
PROC_GlobalSetFlagAndCache((FLAG)PLA_ZhentShipment_State_Talked_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c);
PROC_LOW_Guildhall_SetupRugan();

IF
FlagSet((FLAG)Debug_LOW_Guildhall_SetState_PreCoup_fb844753-a3de-4e07-a936-4a61ee3340e0, _, _)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PreCoup");

IF
FlagSet((FLAG)Debug_LOW_Guildhall_SetState_DuringCoup_c086c8d0-2974-4e88-be14-0e4ea7024383, _, _)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup");

IF
FlagSet((FLAG)Debug_LOW_Guildhall_SetState_GuildControlled_02890b25-1e87-436c-b5f3-7e4b9e6e66a6, _, _)
THEN
PROC_GlobalSetFlagAndCache((FLAG)LOW_Guildhall_State_SidedWithNineFingers_9a6c3448-67c8-e23a-ed28-7b3cfba65bf5);
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_GuildControlled");

IF
FlagSet((FLAG)Debug_LOW_Guildhall_SetState_ZhentControlled_f24b6996-79c5-4ec8-88f3-8ba5a29ad0de, _, _)
THEN
PROC_GlobalSetFlagAndCache((FLAG)LOW_Guildhall_State_BetrayedNineFingers_2467deb6-1692-46b0-291f-fb52416b8366);
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_ZhentControlled");

IF
FlagSet((FLAG)Debug_LOW_Guildhall_SetState_PlayerControlled_792bbebe-4156-44a9-b076-557faed2020e, _, _)
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_PostCoup_PlayerControlled");

IF
TextEvent("Guildhall_ZhentBetrayal")
THEN
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup");

IF
TextEvent("Debug_Guildhall_ZhentBetrayal")
AND
DB_LOW_Guildhall_ZhentRepresentative(_Leader)
THEN
SetFlag(LOW_MinscHideout_State_ZhentLeaderEscaped_0a08b808-b6e2-4923-936c-c12f2774ce61);
PROC_State_Progress(S_LOW_Guildhall_SUB_adf8c225-5a74-4c9b-86ea-198aca6fabae, "LOW_Guildhall_State", "LOW_Guildhall_State_DuringCoup");

IF
TextEvent("Debug_Guildhall_ZhentBetrayal")
AND
DB_LOW_Guildhall_CombatPositions(_Trigger, _Character)
THEN
TeleportTo(_Character, _Trigger);

IF
TextEvent("Debug_Guildhall_ZhentBetrayal")
AND
DB_Players(_Player)
THEN
TeleportTo(_Player, S_LOW_Guildhall_Entrance_a78a0b7b-489a-4743-9e6e-4c88f24cc2ca);

QRY
QRY_Debug_LOW_Guildhall_ResetSwapTracker()
THEN
NOT DB_Debug_LOW_Guildhall_SwapTracker(1);

// Swap Oskar with S_LOW_Guildhall_Member_008
IF
TextEvent("Guildhall_Swap_Oskar")
THEN
PROC_Debug_LOW_Guildhall_Swap_Oskar();

IF
FlagSet((FLAG)Debug_LOW_Guildhall_Swap_Oskar_9504f184-eed4-44b1-a67f-47eaf456dde5, _, _)
THEN
PROC_Debug_LOW_Guildhall_Swap_Oskar();
ClearFlag((FLAG)Debug_LOW_Guildhall_Swap_Oskar_9504f184-eed4-44b1-a67f-47eaf456dde5);

PROC
PROC_Debug_LOW_Guildhall_Swap_Oskar()
AND
QRY_Debug_LOW_Guildhall_ResetSwapTracker()
AND
IsOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 1)
THEN
PROC_SetOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 0);
PROC_SetOnStage(S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, 1);
DB_Debug_LOW_Guildhall_SwapTracker(1);

PROC
PROC_Debug_LOW_Guildhall_Swap_Oskar()
AND
NOT DB_Debug_LOW_Guildhall_SwapTracker(1)
AND
IsOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 0)
THEN
PROC_SetOnStage(S_GLO_DoubtingArtist_3ae152be-8ff6-420c-81a0-68d6a55cd5bd, 1);
PROC_SetOnStage(S_LOW_Guildhall_Member_008_81611144-c02a-411f-9d87-661fc1ceac2d, 0);

// Swap Mol with S_LOW_Guildhall_FetchersBrat_001
IF
TextEvent("Guildhall_Swap_Mol")
THEN
PROC_Debug_LOW_Guildhall_Swap_Mol();

IF
FlagSet((FLAG)Debug_LOW_Guildhall_Swap_Mol_f137b115-bc8f-4eb6-b0be-2f86440210ab, _, _)
THEN
PROC_Debug_LOW_Guildhall_Swap_Mol();
ClearFlag((FLAG)Debug_LOW_Guildhall_Swap_Mol_f137b115-bc8f-4eb6-b0be-2f86440210ab);

PROC
PROC_Debug_LOW_Guildhall_Swap_Mol()
AND
QRY_Debug_LOW_Guildhall_ResetSwapTracker()
AND
IsOnStage(S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, 1)
THEN
PROC_SetOnStage(S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, 0);
PROC_SetOnStage(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 1);
PROC_LOW_Guildhall_SetupMol();
DB_Debug_LOW_Guildhall_SwapTracker(1);

PROC
PROC_Debug_LOW_Guildhall_Swap_Mol()
AND
NOT DB_Debug_LOW_Guildhall_SwapTracker(1)
AND
IsOnStage(S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, 0)
THEN
PROC_SetOnStage(S_LOW_Guildhall_FetchersBrat_001_721084d3-de1a-4213-93db-c7f93cf9d632, 1);
PROC_SetOnStage(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, 0);

// Get Mol's contract
IF
FlagSet((FLAG)Debug_LOW_Guildhall_Mol_GetContract_9ac49df0-2838-4103-9a76-b58582d06524, _, _)
AND
GetHostCharacter(_Player)
THEN
ToInventory(S_LOW_HouseOfHope_MolContract_5fa7c7b9-cdf0-42ef-b75a-96b1f34073c3, _Player);
ClearFlag((FLAG)Debug_LOW_Guildhall_Mol_GetContract_9ac49df0-2838-4103-9a76-b58582d06524);

// Reset Mol's dialog
IF
FlagSet((FLAG)Debug_LOW_Guildhall_Mol_ResetDialog_2aa510e3-ce55-4a86-93b1-d8e823ae8085, _, _)
THEN
ClearFlag((FLAG)LOW_Guildhall_State_MolWillNotHelpInEND_0679c4ff-799b-cbe2-b5b2-2abcbe35d9d9);
ClearFlag((FLAG)LOW_Guildhall_State_MolHelpsPlayerInEND_5c4d5b0f-a9bb-4fe0-8003-2af9213a64b0);
ClearFlag((FLAG)LOW_Guildhall_ThiefHideoutLeader_KnowsRaphaelDead_6fa72d7b-dd9d-bdeb-c13e-cf159315964e);
ClearFlag((FLAG)Debug_LOW_Guildhall_Mol_ResetDialog_2aa510e3-ce55-4a86-93b1-d8e823ae8085);

// Swap Roah with Boss Friol
IF
TextEvent("Guildhall_Swap_ZhentLeader")
THEN
PROC_Debug_LOW_Guildhall_Swap_ZhentLeader();

IF
FlagSet((FLAG)Debug_LOW_Guildhall_Swap_ZhentLeader_8cefa86d-7792-42c2-ac1a-082fdbf8c9b5, _, _)
THEN
PROC_Debug_LOW_Guildhall_Swap_ZhentLeader();
ClearFlag((FLAG)Debug_LOW_Guildhall_Swap_ZhentLeader_8cefa86d-7792-42c2-ac1a-082fdbf8c9b5);

PROC
PROC_Debug_LOW_Guildhall_Swap_ZhentLeader()
AND
QRY_Debug_LOW_Guildhall_ResetSwapTracker()
AND
DB_LOW_Guildhall_ZhentLeader(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615)
THEN
PROC_SetOnStage(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, 0);
NOT DB_LOW_Guildhall_ZhentRepresentative(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
DB_LOW_Guildhall_ZhentRepresentative(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
NOT DB_LOW_Guildhall_ZhentLeader(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
DB_LOW_Guildhall_ZhentLeader(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
NOT DB_GLO_DefeatCounter(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615, "LOW_Guildhall_ZhentBetrayal_Zhent");
NOT DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_ZhentLeader_CombatStartPoint_9431524b-e12d-4b91-a976-743021cf59a4, S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
NOT DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_Leader_29de84e5-b1c0-44a1-8531-f45f5461ca1b, S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
PROC_LOW_Guildhall_SetupZhentLeader();
DB_Debug_LOW_Guildhall_SwapTracker(1);

PROC
PROC_Debug_LOW_Guildhall_Swap_ZhentLeader()
AND
NOT DB_Debug_LOW_Guildhall_SwapTracker(1)
AND
DB_LOW_Guildhall_ZhentLeader(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9)
THEN
PROC_SetOnStage(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, 0);
NOT DB_LOW_Guildhall_ZhentRepresentative(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
DB_LOW_Guildhall_ZhentRepresentative(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
NOT DB_LOW_Guildhall_ZhentLeader(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
DB_LOW_Guildhall_ZhentLeader(S_GOB_Quartermaster_646936f3-8d8d-484e-9361-cd1ed484c615);
NOT DB_GLO_DefeatCounter(S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9, "LOW_Guildhall_ZhentBetrayal_Zhent");
NOT DB_LOW_Guildhall_CombatPositions((TRIGGER)S_LOW_Guildhall_ZhentLeader_CombatStartPoint_9431524b-e12d-4b91-a976-743021cf59a4, S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
NOT DB_LOW_Guildhall_FinalPositions("Zhent", (TRIGGER)S_LOW_Guildhall_Leader_29de84e5-b1c0-44a1-8531-f45f5461ca1b, S_LOW_Guildhall_Zhent_Leader_b7e51fc3-0788-44f2-add7-1714f2b9b6d9);
PROC_LOW_Guildhall_SetupZhentLeader();

IF
TextEvent("Guildhall_ZhentLeaderBackup")
THEN
PROC_LOW_Guildhall_SetupZhentLeaderBackup();
//END_REGION

//REGION Gossip flags
IF
FlagSet(LOW_Guildhall_HasMet_NineFingers_0054cec3-9588-4427-d6dd-fc02da69c5b1, _, _)
THEN
ClearFlag((FLAG)LOW_Guildhall_State_NotMetNineFingers_311941fa-c871-4fa5-80df-d2c7914eed44);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3b"
