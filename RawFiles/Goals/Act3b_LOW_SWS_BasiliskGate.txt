Version 1
SubGoalCombiner SGC_AND
INITSECTION
SetHitpointsPercentage(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c,5.0);
ApplyStatus(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c,"UNCONSCIOUS",-1.0);

DB_LOW_SWS_BasiliskGate_CriminalVignette((CHARACTER)S_LOW_SWS_BasiliskGate_Civilian_000_f2aaa9c2-3b19-422f-93ac-bbceeb8100d2,(DIALOGRESOURCE)LOW_SWS_BasiliskGate_Civilian_000_28107abb-9a2c-7c5a-4764-d3d04974e681);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_Civilian_001_23f48ec8-e686-4f60-b12b-e6075045dd31,LOW_SWS_BasiliskGate_Civilian_001_171c89aa-5ef1-8934-3e43-b534f2de414b);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_Civilian_002_2e746867-2f83-477a-b14e-24b84ecd480a,LOW_SWS_BasiliskGate_Civilian_002_6679ba8b-d773-ac72-7b7e-5e0a490ce470);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c,LOW_SWS_BasiliskGate_Criminal_db9d8b17-46cb-f870-1ade-56d592eb2a95);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_FF_000_eae7283e-c73a-4355-af03-0963ee189af1,LOW_SWS_BasiliskGate_FF_000_f9e9c27e-a028-74b6-050c-b0eee718cd66);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_FF_001_0f84f1c1-2321-47f9-be8b-46df8f5f1dec,LOW_SWS_BasiliskGate_FF_001_f4d5da51-52f5-42bb-44e2-1cd9d866adfb);
DB_LOW_SWS_BasiliskGate_CriminalVignette(S_LOW_SWS_BasiliskGate_FF_002_436652ca-46ca-4e7c-bdf4-df75a40720ea,LOW_SWS_BasiliskGate_FF_002_2959ed2f-954c-a841-a60f-42345a9f088b);

DB_LOW_SWS_BasiliskGate_Guards((CHARACTER)S_LOW_SWS_BasiliskGate_FF_000_eae7283e-c73a-4355-af03-0963ee189af1);
DB_LOW_SWS_BasiliskGate_Guards((CHARACTER)S_LOW_SWS_BasiliskGate_FF_001_0f84f1c1-2321-47f9-be8b-46df8f5f1dec);
DB_LOW_SWS_BasiliskGate_Guards((CHARACTER)S_LOW_SWS_BasiliskGate_FF_002_436652ca-46ca-4e7c-bdf4-df75a40720ea);

DB_LOW_SWS_BasiliskGate_Civs((CHARACTER)S_LOW_SWS_BasiliskGate_Civilian_000_f2aaa9c2-3b19-422f-93ac-bbceeb8100d2);
DB_LOW_SWS_BasiliskGate_Civs((CHARACTER)S_LOW_SWS_BasiliskGate_Civilian_001_23f48ec8-e686-4f60-b12b-e6075045dd31);
DB_LOW_SWS_BasiliskGate_Civs((CHARACTER)S_LOW_SWS_BasiliskGate_Civilian_002_2e746867-2f83-477a-b14e-24b84ecd480a);

DB_GLO_DefeatCounter(S_LOW_SWS_BasiliskGate_SW_489effa9-e6a0-43bd-9685-3a2ef877e8c6,"LOW_SWS_BasiliskGate");

PROC_SelfHealing_Disable(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c);
KBSECTION
//INIT

IF
DB_LOW_SWS_BasiliskGate_CriminalVignette(_Character,_Dialog)
THEN
DB_Dialogs(_Character,_Dialog);

QRY
QRY_CorpseLooting_ShouldMakeOwned(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c)
AND
DB_LOW_SWS_BasiliskGate_Guards(_Guard)
AND
NOT DB_Defeated(_Guard)
THEN
DB_NOOP(1);

QRY
QRY_DialogShouldIgnoreMutingStatusses(LOW_SWS_BasiliskGate_Criminal_db9d8b17-46cb-f870-1ade-56d592eb2a95,_,S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c)
THEN
DB_NOOP(1);

IF
StatusApplied(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c,"UNCONSCIOUS",_,_)
THEN
SetFlag(LOW_SWS_BasiliskGate_CriminalKnockedOut_b9cf3fc2-de97-40c8-bbab-cd59b19337c1,NULL_00000000-0000-0000-0000-000000000000,0);

PROC
PROC_LOW_SWS_Transition()
THEN
TriggerSetCrowdBehaviour(CCT_BsG_Anger_01_cfa23660-8062-4ea6-b238-24a6e61873c1,CROWDBEHAVIOUR.Disperse);


//REGION Combat

IF
EnteredCombat(_Guard,_)
AND
DB_LOW_SWS_BasiliskGate_Guards((CHARACTER)_Guard)
THEN
PROC_LOW_SWS_BasiliskGate_DisperseCivs();

PROC
PROC_LOW_SWS_BasiliskGate_DisperseCivs()
AND
DB_LOW_SWS_BasiliskGate_Civs(_Civ)
THEN
PROC_DisappearOutOfSight(_Civ,"Run",1,"");

PROC
PROC_LOW_SWS_BasiliskGate_DisperseCivs()
THEN
TriggerSetCrowdBehaviour(CCT_BsG_Anger_01_cfa23660-8062-4ea6-b238-24a6e61873c1,CROWDBEHAVIOUR.Flee);

//END_REGION Combat


//REGION Guards killed

IF
DB_LOW_SWS_BasiliskGate_Guards(_Guard)
THEN
PROC_CharacterDisableCrime(_Guard,"DangerousMonsterReaction");
PROC_CharacterDisableCrime(_Guard,"DangerousMonsterReactionFallback");
DB_GLO_DefeatCounter(_Guard,"LOW_SWS_BasiliskGate");

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("LOW_SWS_BasiliskGate")
THEN
DB_LOW_SWS_BasiliskGate_NoGuards(1);

IF
DB_LOW_SWS_BasiliskGate_NoGuards(1)
THEN
PROC_LOW_SWS_BasiliskGate_DisperseCivs();

IF
Deactivated(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c)
AND
DB_LOW_SWS_BasiliskGate_NoGuards(1)
THEN
SetOnStage(S_LOW_SWS_BasiliskGate_Criminal_c21a2d99-f10d-4211-8d6a-d04851bb177c,0);
PROC_LOW_SWS_BasiliskGate_DisperseCivs();

//END_REGION Guards killed

//REGION Dismiss on Long rest after interaction

IF
DialogStarted(_Dialog,_)
AND
DB_LOW_SWS_BasiliskGate_CriminalVignette(_,_Dialog)
THEN
DB_LOW_SWS_BasiliskGate_CriminalVignette_ScheduleRemove(1);

PROC
PROC_LongRest()
AND
NOT DB_LOW_SWS_BasiliskGate_NoGuards(1)
AND
DB_LOW_SWS_BasiliskGate_CriminalVignette_ScheduleRemove(1)
THEN
DB_ExecuteInLevel("BasiliskGate_CriminalVignette_ScheduleRemove","CTY_Main_A");

PROC
PROC_ExecuteInLevel("BasiliskGate_CriminalVignette_ScheduleRemove","CTY_Main_A")
AND
DB_LOW_SWS_BasiliskGate_CriminalVignette(_Character,_Dialog)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Character);
SetOnStage(_Character,0);
NOT DB_LOW_SWS_BasiliskGate_CriminalVignette(_Character,_Dialog);

PROC
PROC_ExecuteInLevel("BasiliskGate_CriminalVignette_ScheduleRemove","CTY_Main_A")
THEN
NOT DB_LOW_SWS_BasiliskGate_CriminalVignette_ScheduleRemove(1);
TriggerDespawnCrowd(CCT_BsG_Anger_01_cfa23660-8062-4ea6-b238-24a6e61873c1);
TriggerSetCrowdSpawningEnable(CCT_BsG_Anger_01_cfa23660-8062-4ea6-b238-24a6e61873c1,0);

IF
Died(_Character)
AND
DB_LOW_SWS_BasiliskGate_CriminalVignette(_Character,_Dialog)
THEN
NOT DB_LOW_SWS_BasiliskGate_CriminalVignette(_Character,_Dialog);

//END_REGION Dismiss on Long rest after interaction
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3b_LOW_SteelWatchStreets"
