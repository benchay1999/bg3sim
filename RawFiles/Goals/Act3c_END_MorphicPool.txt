Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialog_AddAllNearbyPlayersAtStart((DIALOGRESOURCE)END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52);
DB_DropMutingStatussesDialog(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52);
DB_AddCharactersInTriggerToDialog((DIALOGRESOURCE)END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52,(TRIGGER)S_END_MorphicPoolArrivalDialogBox_98e163e7-fc61-431a-8ad4-1e2ab698e064, 1, 1, 1);
PROC_TriggerRegisterForPlayers(S_END_MorphicPoolArrivalDialogBox_98e163e7-fc61-431a-8ad4-1e2ab698e064);

PROC_TriggerRegisterForPlayers(S_END_MorphicPartyBanterBox_7cf1a87e-5888-403c-9403-faaf8a4b9591);

PROC_RemoveMutingStatusses(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
PROC_CharacterFullRestore(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
SetOnStage(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1);
DB_CrimeType_CustomWarning((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"Assault",(DIALOGRESOURCE)END_MorphicPool_GortashAttacked_a67caad0-8543-7981-a1ef-08a001c0da6c);
DB_PermaDefeatedFlag(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769);

DB_END_General_EmperorADs(END_MorphicPool_EmperorAD_Arrival_08aee88a-f3e8-e953-60bf-bd3315b5599f);

DB_OneShotPlayerTrigger(S_END_NearNetherbrainPoolBox_49aa0cac-17aa-476d-8844-db78966ff698);

/*
//REGION Falling Stalactite
DB_END_MorphicPool_FallingStalactiteCount(1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_001_923f844c-d2c4-45f0-b399-4691de96c4f5, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_002_94e0e696-f23d-4f5e-8249-2c69c4c7b992, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_003_428c81a9-c022-4eae-b6da-2f7a0ec55038, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_004_a40381d9-d291-4d08-b978-730bc900fdd1, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_005_8d173ce7-f153-4eae-81e6-46465005b017, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_006_c1d60c64-0a6a-41d3-899f-f338b04f03c0, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_007_04b0ab97-29ba-4e87-a196-146178bc6195, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_008_60cc278f-3f3e-4fae-a43b-a666b8226bf9, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_009_1e12a7e8-8418-4156-9c0a-043dc11dba24, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_010_bfdce0e6-f44c-42fd-8f03-b7449a8042e3, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_011_9fea3ec2-5220-468e-85d2-c24b18598eac, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_012_3ff66828-820c-406b-96a5-d06a7d0e4d41, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_013_7d3f747a-d46a-4fd8-a62c-e006cb650f3f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_014_0301c44e-985a-45cb-8f46-1b105cede489, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_015_1017d7bd-05cf-4377-8eb8-8df13da1d072, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_016_c8837de8-60b2-4182-8657-f7ba2981d0af, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_017_91d66cdd-fed9-42b6-b6d8-8d9951bea2dd, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_018_9983d86f-5624-446a-a137-b7b6a341a77e, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_019_7366b4ce-d5e7-485e-8b38-eb320dc91793, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_020_c0ff1a3d-7625-4ed1-abfc-1caff37e707e, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_021_4e540c45-d6b4-4002-9364-a4de6928b409, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_022_7d520a15-11f3-4e41-864a-9396588e416f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_023_8d0f31de-985d-404f-9206-e151e4de322e, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_024_042006db-4643-42f5-b1ec-5c1c64d8e4bc, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_025_1e162c3e-9ecc-46eb-977c-f70c24f532c5, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_026_baf870f2-53ff-4a4f-b664-240efbe92f05, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_027_769c08ac-07f5-4ac2-82c1-f93fef3a3177, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_028_a2ecfa5f-364a-4622-9782-83397d0c7029, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_029_df35f47e-80fe-4565-9595-1a7ed4452e8f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_030_e5371d43-d05e-4511-8cf8-c5ca37fd298c, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_031_a2145a2b-44b6-472b-a99f-045b95e732b7, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_032_4d094f37-9ab5-4d1a-85fc-ec1d878b197f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_033_ba17f3e1-0029-40fc-995f-082d3497694c, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_034_479ce265-ff12-462e-b4d5-09426381e360, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_A_035_bd5a8486-03fe-49ec-9874-b64b81895f8e, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_001_1f2457de-969d-4360-80ce-6f36314ea7f3, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_002_9e7cfb6f-7dcd-4c84-88aa-5697b40b31a4, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_003_ac242bf5-8dd1-40bf-8b56-4b2d5dd7710e, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_004_54714adf-9b2c-421e-bd95-161fcaed90e0, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_005_734cef39-a60d-47a6-8866-6ac419f1fa3f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_006_496e8028-0731-4abb-8139-3976e75679f9, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_007_ca8adc3d-936d-413c-8132-a1531d686693, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_008_ab3edfe1-8b38-45e3-bc76-e67903d10250, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_009_03f281f2-98aa-4e79-bcdc-5426aa71f0b1, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_010_9a24c016-0c1a-44d3-a800-e38bcbee991f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_011_ea8a57ee-bc48-4fee-913d-7f0fb8145c64, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_012_15161cae-fd74-4f38-ba5a-62a67f723109, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_013_9583d0e3-7eec-4ad7-af75-9f17a2f92972, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_014_1521859f-abbe-4522-a31d-b282e8a52dc3, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_015_ebc3845d-b513-4e96-a508-833937208d9f, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_016_8b2a6ddf-cb69-4da5-91a2-da90cf0304e4, 1);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_A_017_5be6173c-af81-4bfb-b4d4-0e5050e6ad3a, 1);

DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_001_a5630008-a7d3-4970-9e73-3cc57edf42c4, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_002_ff9a67bf-bc07-423e-98f8-b1ebea1f7c65, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_003_90c7b390-cf6d-4e10-bef2-7cb3efb78802, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_004_ce9ed45d-dddf-4952-af19-8c2716564845, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_005_69aabfe7-efc9-4139-91dc-ac27303eb040, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_006_e10f3b2b-9779-420b-90ba-37470748c540, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_007_dc1b7454-ba2f-4731-bb0c-8f7f0457a848, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_008_eaec58b8-637e-41e0-82bf-db632e1642ec, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_009_1df62ee3-af5f-4a0d-a364-eb02f85b0670, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_010_5f4248e0-746b-49d3-a115-e3bd0d76c6e3, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_011_7808b4f8-eea7-47a6-b73c-6cfb23791e99, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_012_1eadfc25-3970-4d3e-bec7-9a6fd793adc9, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_013_8d3e65bd-0c35-49ba-a4eb-c2e29e1218ea, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_014_694f4da5-ec2a-46dd-a8dc-287e5f5cd743, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_015_0b4a5c92-7399-458f-bb52-1d3e20aa4950, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_016_a7a4d61e-c140-4a21-a56b-2d7f5d95f66a, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_017_c0421994-5f7b-4ed0-b4a9-1db95c3017f3, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_018_194bb018-b937-4cf8-9fdb-0b780e38e737, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_019_37fb1fee-a8c8-40dc-974a-da7b21685ed4, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_020_25076a81-8026-4bac-9700-8aa81e353fae, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_021_6a83b955-7f58-4490-bd09-60f4e23beda6, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_022_c43ab797-f105-4d4b-8b0b-6ec6bc3733a7, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_023_4a790cec-f268-478f-b504-cad7c901009a, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_024_7edb9829-3075-4902-809c-f5c3a29b14a1, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_025_49aed6b4-ceec-4281-aa4b-d1a553446238, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_026_9488ce76-48b8-4949-a5af-8a4bebac9539, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_027_f2b2bece-62c1-4a82-ae97-704d04b0ec35, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_028_36409f58-5aef-403a-af51-1247e093afb0, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_029_ae72270e-6eb0-4e62-ac5a-06a462b59880, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_030_21366f06-8013-450e-920e-98280aa3a354, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_031_589fb8f0-1e2f-4a50-9a62-67b1b53ae6cf, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_032_3a6df128-6215-451e-93c4-fa65c11cf434, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_033_c9974a73-4bb5-4db6-b087-8d430550ef3c, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_034_f912594e-fcc1-4a9a-bc76-6cb5b0f58007, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteSmall_B_035_ca544353-122f-41ed-8221-79ce97653dba, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_001_1d605e6f-38c3-4f50-a9c4-c086bacaf462, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_002_b571c322-b2ef-419b-ba86-a968c9b563db, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_003_fb29441b-34da-4bc7-a23a-d0ef5966648a, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_004_4bac1517-2935-450e-8c4f-666da20dcd13, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_005_c0a60ea7-a966-4a61-9605-2931cd6e155e, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_006_0b4755f7-b223-4669-8ac7-0d345761a1ba, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_007_6d83e45a-5bde-4c9e-82ac-43660f9ec1d9, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_008_ee6d8e13-ddfc-4961-b5de-97f8a7cbd803, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_009_c62d4c36-9ad4-417b-bc6f-1dbde5b666bf, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_010_e612a727-b10f-4452-937a-48a7e4a88f43, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_011_9967f33b-d06d-4135-a74f-0d178fa83fd5, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_012_50ca7bed-6953-43a2-a070-3241969c283b, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_013_4b427e77-d7ed-4b7b-8c6f-e46f4c8dc6ea, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_014_e3ff1c62-b026-4d06-a7de-351159fde195, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_015_122900d3-ae9a-4956-b1a8-ebd727649924, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_016_41e9800b-8fb9-4faa-8268-99be44f134a8, 2);
DB_END_MorphicPool_FallingStalactite(S_END_BrainquakeStalactiteMedium_B_017_8817d55f-7f70-4e60-b95d-62ec5eb8085b, 2);
//END_REGION
*/
//REGION Dead Smuggler
DB_GLO_CharacterCorpseDialog((CHARACTER)S_END_DeadSmuggler_a50663a2-2bdf-4465-81ef-84958d498e91, (DIALOGRESOURCE)END_MorphicPool_SWD_DeadSmuggler_5f00d5a3-7e20-edd6-11c9-ac255d3f2c27);
DB_HasItemEvent(S_END_DeadSmugglerSiblingToken_d95b9ad2-d8d3-4cd5-9ed4-818845836ccb, END_MorphicPool_State_HasDeadSmugglerToken_104abece-95d5-4d04-b2d0-f6f741718ce5);
DB_END_MorphicPool_LastDeadSmugglerTokenHolder((CHARACTER)NULL_00000000-0000-0000-0000-000000000000);
//END_REGION
//REGION Brainquakes
DB_END_MorphicPool_BrainquakeTriggers((TRIGGER)S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0,(TRIGGER)S_END_MorphicBrainQuakePoint_001_ccf3653c-9405-466a-98c9-6e71f8f26990, 1000, 1.0);
DB_END_MorphicPool_BrainquakeTriggers((TRIGGER)S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0,(TRIGGER)S_END_MorphicBrainQuakePoint_002_d480e334-8da0-48e9-8638-2c28fa3ddbaf, 1000, 1.0);
DB_END_MorphicPool_BrainquakeTriggers((TRIGGER)S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd,(TRIGGER)S_END_MorphicBrainQuakePoint_003_79f45084-7b92-42bf-97e4-8bc850eebc4a, 1000, 1.0);
DB_END_MorphicPool_BrainquakeTriggers((TRIGGER)S_END_MorphicBrainQuakeBox_001_2e4a8e36-056a-439b-b082-dc6604e7a414,(TRIGGER)S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, 500, 0.5);
DB_END_MorphicPool_BrainquakeTriggers((TRIGGER)S_END_MorphicBrainQuakeBox_002_637bdaf6-e090-44cc-840a-d1c9a0b8b803,(TRIGGER)S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, 300, 0.5);
DB_END_MorphicPool_BrainQuakeStunTime(3.0);

DB_OneShotPlayerTrigger(S_END_MorphicBrainQuakeBox_001_2e4a8e36-056a-439b-b082-dc6604e7a414);
DB_OneShotPlayerTrigger(S_END_MorphicBrainQuakeBox_002_637bdaf6-e090-44cc-840a-d1c9a0b8b803);
//
//END_REGION
//REGION Mind Meld AD
DB_END_MorphicPool_MindMeldADTriggers((TRIGGER)S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0);
DB_END_MorphicPool_MindMeldADTriggers(S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0);
DB_END_MorphicPool_MindMeldADTriggers(S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd);

DB_OneShotPlayerTrigger((TRIGGER)S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0);
DB_OneShotPlayerTrigger((TRIGGER)S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0);
DB_OneShotPlayerTrigger((TRIGGER)S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd);

DB_END_MorphicPool_MindMeldTarget((CHARACTER)NULL_00000000-0000-0000-0000-000000000000);
//END_REGION
//REGION Rapid Mind Meld AD
DB_END_MorphicPool_RapidMindMeldADHelper((ITEM)S_END_RapidMindMeldHelper_001_51d9a5c5-5f12-4dfe-9fdf-a67cafb828c3, (DIALOGRESOURCE)END_MorphicPool_AD_RadpidMindMeld_001_701dda11-0747-d5a1-dfa5-7b8e461f20fc);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_002_249ab374-3062-4779-8d33-e778c265951b, END_MorphicPool_AD_RadpidMindMeld_002_2d4adeba-2077-f261-ea1e-8e4034b4c086);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_003_656204d5-b5e4-48ac-b905-8c73b27ccae4, END_MorphicPool_AD_RadpidMindMeld_003_3d67e6e8-a497-ee85-953d-e40de5b61744);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_004_c6245802-72a4-483b-ba86-51f06aad0647, END_MorphicPool_AD_RadpidMindMeld_004_d27fc9c0-29eb-2649-83e8-c9b692654917);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_005_f5d143e6-abf4-41a4-b4fc-6e0cc4000856, END_MorphicPool_AD_RadpidMindMeld_005_e60f00ec-1f14-b811-87a5-76fc80c2d468);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_006_ffc5bec1-be4d-4f4b-88b6-02c6c6800b6d, END_MorphicPool_AD_RadpidMindMeld_006_4938202c-4606-87a3-12ff-1bc318516375);

DB_END_MorphicPool_AvailableRapidMindMeldADHelper((ITEM)NULL_00000000-0000-0000-0000-000000000000,(DIALOGRESOURCE)NULL_00000000-0000-0000-0000-000000000000, 0);
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(-1);

PROC_TriggerRegisterForPlayers((TRIGGER)S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);
DB_END_MorphicPool_ActiveRapidMindMeldAD(NULL_00000000-0000-0000-0000-000000000000);
DB_END_MorphicPool_ActiveRapidMindMeldStartTime(5000);
PROC_END_MorphicPool_SetMaxRapidMindMeldDistance();

PROC_TriggerRegisterForPlayers((TRIGGER)S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b);
TriggerRegisterForCharacter(S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
//END_REGION
//REGION Scurrying Intellect Devourers
DB_END_MorphicPool_ScurryIntDev((CHARACTER)S_END_ScurryIntDev_001_2bd27e80-128d-426d-a1a7-11ace1b256fe);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_002_73d0452d-87ce-406c-b2d1-24c858b81ff9);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_003_bfbaf4ad-3d83-428b-a8cc-2b77311ff82d);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_004_72be384d-5c2e-41b5-a5be-9c59abca4cfd);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_005_408442a3-9347-4aba-b303-177be901b6b5);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_006_eceb1daf-5786-4bbd-bc40-b0931e7448fc);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_007_aa5963eb-801d-4ef8-aef6-becd4886f0e8);
//END_REGION
//REGION Intellect Devourer Ambush
DB_AmbushTrigger((TRIGGER)S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, (TRIGGER)S_END_DetectIntDevAmbushSphere_3a8a657f-3b12-4b1b-ae9b-026d2c05571a, (DIFFICULTYCLASS)Act3_Hard_6298329e-255c-4826-9209-e911873b64e7);

//Intellect Devourers
DB_END_MorphicPool_IntDevAmbusher((CHARACTER)S_END_IntDevAmbusher_001_6ca2a617-1d3e-47eb-ab0a-40e5e098f4dc);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_002_8851683e-3f1b-48c1-bc3d-b33800d89903);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_003_fb213097-bd03-4629-9176-15b7e9274f19);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_004_a6b8d7f0-65af-4e1f-8944-2b84d51a3664);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_005_6d5abddd-f46d-4013-8e0d-c9d75c9c4dfc);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_006_7ed487b7-5447-4589-a49e-eb58c3695d02);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_007_28f653b3-7947-4f92-be55-e4b3a7790e54);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_008_e20f908c-b1dc-40da-aa39-8e620a049053);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_009_fd043ae0-25ce-4a49-86d2-4a190e56f56e);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_010_289c0d51-f179-41e0-bffa-5982b32345e2);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_011_dba0b561-3d99-4648-a4ff-d951dc250500);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_012_4141b977-0634-4f88-bae0-501c62f5a10b);

//Intellect Detonators
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDetonatorAmbusher_001_95f3dc04-2a03-49a9-979a-db3568e9c18e);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDetonatorAmbusher_002_7dc37f86-6fcc-4f6c-9c4c-ad15e95ab774);

/////////Second Wave//
DB_END_MorphicPool_IntDevAmbusher_SecondWave((CHARACTER)S_END_IntDetonatorAmbusher_Wave2_001_4c50a0a8-3434-4345-a183-0d24461dcaef);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_002_df0f2f33-c053-4bf8-9e50-be470c93edbb);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_003_4149b2ca-0262-4f70-8167-3cdab602ead7);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_004_bd194cf7-8e32-45e8-99dd-90c2d75d4627);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_001_98c94496-e48e-469d-bc29-b8e770c8768d);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_002_4b2e32e4-d40e-49a7-8c2f-c2524228efcb);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_003_70cd97b5-074a-41df-98bf-a14de3c226d7);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_004_a7dd9352-8a7a-4932-8b2e-612ff66e58a2);

PROC_TriggerRegisterForPlayers(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007);
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("END_MorphicPool_IntDevAmbusherDefeat",(FLAG)END_MorphicPool_State_IntDevAmbushersDefeated_1eba2903-19c1-4d39-beb6-7ba2769eaa74);
//END_REGION
//REGION Confronting Netherbrain
DB_AddCharactersInTriggerToDialog((DIALOGRESOURCE)END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf,(TRIGGER)S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81, 1, 1, 1, 1);
SetOnStage(S_END_FakeNetherbrain_000_4a97b2f5-5633-4988-8036-a73866e28834,0);
PROC_TriggerRegisterForPlayers(S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06);
DB_DialogStarted_IgnoreStopConditions(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
DB_DropMutingStatussesDialog(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
DB_DialogBlockTradeButton(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
SetOnStage(S_END_ToHighHallVines_11f19d26-e595-46c0-9de8-a34cbcc1ff82,0);
//END_REGION

PROC_END_MorphicPool_Setup();
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);
KBSECTION
//REGION DEBUG
IF
TextEvent("end_brainref")
AND
IsOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, _Int)
THEN
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(_Int);

PROC
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(0)
THEN
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 1);
SetForceUpdate(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 1);

PROC
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(1)
THEN
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);
SetForceUpdate(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);

IF
TextEvent("end_readyboat")
THEN
SetFlag(END_MorphicPool_State_UnlockedAccess_b65fedb8-ed89-4ccf-b20f-3338474bda18);

IF
TextEvent("end_gotomorphicpool")
AND
GetHostCharacter(_Player)
THEN
SetFlag(Debug_Teleport_END_MorphicPool_89dceaa3-e98a-44b6-909c-9bf651208477, _Player);

IF
TextEvent("end_gotobrainarena")
AND
GetHostCharacter(_Player)
THEN
SetFlag(Debug_Teleport_END_NetherbrainArena_d8d292a5-18df-4e8b-a8b0-d6c59e875897, _Player);

IF
TextEvent("end_emperorbrainarena")
AND
GetHostCharacter(_Player)
THEN
SetFlag(END_IllithidOptions_State_SafePassage_b97872a1-59cc-40cd-8963-e06be614adc0);
SetFlag(END_EmperorPrelude_State_GaveStones_18e3be1a-c1c0-437e-ad0a-a1426d8830f4);
PROC_TeleportPartiesTo(S_END_ToMorphicPoolPoint_d1e450c1-1b10-49d1-8faa-29761e032059, "END_MorphicPool_Arrived");

IF
TextEvent("end_tomorphicambush")
AND
DB_Players(_Player)
THEN
PROC_TeleportPartiesTo(S_END_DEBUG_AmbushPoint_7612ac88-4737-4b65-8d98-a23187fd4cce, "");

IF
TextEvent("end_tomorphicnetherbrain")
AND
DB_Players(_Player)
THEN
PROC_TeleportPartiesTo(S_END_DEBUG_NetherbrainPoint_29627d76-0ab0-4622-a64f-fbc7a58c2df3, "");

IF
TextEvent("end_testbrainad")
AND
GetHostCharacter(_Player)
THEN
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Player);
PROC_TryStartAD(END_MorphicPool_AD_Netherbrain_83cc2429-e2e7-88bc-a1e9-3db36832dc4a,S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
TextEvent("end_morphicpoolarrival")
AND
GetHostCharacter(_Player)
AND
NOT QRY_StartDialogCustom(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52,S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, _Player, 0, 0, 0, 0)
THEN
DebugText(_Player, "Dialog Failed");

IF
TextEvent("end_morphicpoolquake")
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8,S_END_MorphicBrainQuakePoint_003_79f45084-7b92-42bf-97e4-8bc850eebc4a,"Debug","END_Main","");

IF
TextEvent("end_morphicpoolquakestop")
AND
DB_LoopEffect(_, _fxHandle,_,_,VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, _,_)
THEN
PROC_StopLoopEffect(_fxHandle);

IF
TextEvent("end_bringthegortash")
THEN
PROC_GlobalSetFlagAndCache(WYR_KillDirectorGortash_State_AgreedToMeetInUndercity_1375d542-cf0a-49fd-927b-5c6bbce13ce4);
PROC_END_MorphicPool_SetupGortash();

IF
FlagSet(Debug_END_MorphicPool_GortashPact_1f85c5c2-fa36-4443-b457-58df642f72fb, _, _)
THEN
PROC_END_MorphicPool_SetupGortash();
//END_REGION
//REGION Boat Passage to Morphic Pool
IF
LevelLoaded("END_Main")
AND
DB_END_ToMorphicPool_BoatUser(_Player)
AND
QRY_StartDialogCustom(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52,S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, _Player, 0, 0, 0, 0)
THEN
NOT DB_END_ToMorphicPool_BoatUser(_Player);
PROC_NotifyWhenReadyToMoveOn(_Player, "END_MorphicPool_ArrivalEmperorAD");

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52, _ID)
THEN
SetLevelStartingDialog(_ID, 1);

PROC
PROC_ReadyToMoveOn(_Player, "END_MorphicPool_ArrivalEmperorAD")
THEN
PROC_EmperorAD(_Player, END_MorphicPool_EmperorAD_Arrival_08aee88a-f3e8-e953-60bf-bd3315b5599f);
DB_AutoSaveTrigger(S_END_MorphicPoolAutoSave_9dd078a6-4654-4954-9623-f7329693a303);
//END_REGION
//REGION Setup
PROC
PROC_END_MorphicPool_Setup()
THEN
CreateSurface(S_END_DeadSmugglerSibling_f5499fbc-61ed-4c7c-93e8-63bec48b75c5,"SurfaceFire",2.0, 3.0);
SetFlag(END_General_State_CurrentlyInMorphicPool_06208edf-4c61-44a2-932b-b158d9ddd2f0);

PROC
PROC_END_MorphicPool_Setup()
AND
DB_END_MorphicPool_IntDevAmbusher(_IntDev)
THEN
SetOnStage(_IntDev, 0);

PROC
PROC_END_MorphicPool_Setup()
AND
DB_END_MorphicPool_ScurryIntDev(_IntDev)
THEN
DB_SpotPlayers(_IntDev, "END_MorphicPool_ScurryIntDevSpotter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_Setup()
AND
NOT DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769)
AND
DB_GlobalFlag(WYR_KillDirectorGortash_State_AgreedToMeetInUndercity_1375d542-cf0a-49fd-927b-5c6bbce13ce4)
THEN
PROC_END_MorphicPool_SetupGortash();

PROC
PROC_END_MorphicPool_SetupGortash()
THEN
SetFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67);
PROC_RemoveDialog(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
TemplateAddTo(GRN_Bomb_A_278271f9-3fbc-4cf7-a5dc-b36527f521b2, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 4, 0);
TemplateAddTo(CONS_Potion_Healing_A_Supreme_7d78f227-e8d4-486d-8121-25cf0bee751d, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 1, 0);
TemplateRemoveFrom(PUZ_Trap_Gortash_PhaseOptimizer_f36d0687-46e4-4899-930e-8f635e50948e, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 4);
Equip(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,(ITEM)S_END_ExtraTorch_002_59051ea8-0342-44ce-a14b-08ffa7c77476, 1, 0, 1);
TeleportTo(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,S_END_MorphicGortashPoint_6bf2ed03-4bc6-4383-b17a-1b8fc71c8082);
DB_Dialogs(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,END_MorphicPool_Gortash_0fba9e82-9eb1-c5dd-1150-54dec5a192c2);
SetFaction(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,(FACTION)ACT3_END_Gortash_0fa1d8b6-b035-43e4-bb4d-15bf1404ed58);
DB_SpotPlayers((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_SetupGortash()
AND
TemplateIsInInventory((ITEMROOT)MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 0)
THEN
DB_END_MorphicPool_AddingGortashGloves(1);
TemplateAddTo(MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 1, 0);

IF
TemplateAddedTo(MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, _Glove, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _)
AND
DB_END_MorphicPool_AddingGortashGloves(1)
THEN
NOT DB_END_MorphicPool_AddingGortashGloves(1);
Equip((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (ITEM)_Glove, 1, 0, 0);
SetCanBePickpocketed(_Glove, 0);
SetIsTradable(_Glove, TRADABLETYPE.NonTradable);
SetIsDroppedOnDeath(_Glove, 1);

//END_REGION
//REGION Scurrying Intellect Devourers
PROC
PROC_SpotPlayers_Spotted(_Char,"END_MorphicPool_ScurryIntDevSpotter",_Player)
AND
DB_END_MorphicPool_ScurryIntDev(_Char)
AND
DB_Players(_Player)
THEN
PROC_CharacterMoveTo(_Char, S_END_ScurryToPoint_0f9e4c10-1f03-4d16-9a75-d62d5d9e5167, "Sprint", "END_ScurryIntDevRunTo");
NOT DB_END_MorphicPool_ScurryIntDev(_Char);

IF
AttackedBy(_Char, _, _, _, _, _, _)
AND
DB_END_MorphicPool_ScurryIntDev((CHARACTER)_Char)
THEN
PROC_CharacterMoveTo(_Char, S_END_ScurryToPoint_0f9e4c10-1f03-4d16-9a75-d62d5d9e5167, "Sprint", "END_ScurryIntDevRunTo");
NOT DB_END_MorphicPool_ScurryIntDev(_Char);

IF
EntityEvent(_Char, "END_ScurryIntDevRunTo")
THEN
PROC_DisappearOutOfSightTo((CHARACTER)_Char,S_END_ScurryDisappearPoint_defb2a9b-ab7c-426f-bcf3-83048cf2bdfe,"Run",1,"END_ScurryIntDevLeft");

PROC
PROC_LaunchAmbush((TRIGGER)S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, (CHARACTER)_)
AND
DB_END_MorphicPool_ScurryIntDev(_Char)
THEN
PROC_DisappearOutOfSight(_Char,"Run",1,"END_ScurryIntDevLeft");
NOT DB_END_MorphicPool_ScurryIntDev(_Char);
//END_REGION
//REGION Brainquakes
PROC
PROC_OneShotTriggerEntered(_Player, _OneShotTrigger)
AND
DB_END_MorphicPool_BrainquakeTriggers(_OneShotTrigger, _VFXSourcePoint, _BaseTime, _StunTime)
AND
DB_END_MorphicPool_BrainQuakeStunTime(_OldStunTime)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f)
THEN
NOT DB_END_MorphicPool_BrainquakeTriggers(_OneShotTrigger, _VFXSourcePoint, _BaseTime, _StunTime);
NOT DB_END_MorphicPool_BrainQuakeStunTime(_OldStunTime);
DB_END_MorphicPool_BrainQuakeStunTime(_StunTime);
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun(_BaseTime);
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX((CHARACTER)_Player, (TRIGGER)_VFXSourcePoint, 5000);
//PROC_END_MorphicPool_FallingStalactite();

PROC
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX((CHARACTER)_Player, (TRIGGER)_VFXSourcePoint, (INTEGER)_Time)
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8,_VFXSourcePoint,"END_MorphicPool_Brainquake","END_Main","", 1.5);
PROC_ShakeCameraForTime((CHARACTER)_Player, _Time, VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, 1);
RealtimeObjectTimerLaunch(_VFXSourcePoint, "END_MorphicPool_BrainquakeTimer", _Time);

PROC
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX((CHARACTER)_, (TRIGGER)_VFXSourcePoint, (INTEGER)_Time)
AND
_VFXSourcePoint != S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, "END_MorphicPool_Brainquake", "END_Main","", 1.0);
RealtimeObjectTimerLaunch( S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, "END_MorphicPool_BrainquakeTimer", _Time);

IF
ObjectTimerFinished(_Source, "END_MorphicPool_BrainquakeTimer")
THEN
PROC_StopLoopEffect(_Source, "END_MorphicPool_Brainquake");
PROC_END_MorphicPool_RemoveNetherbrainSlow();

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_BaseTime)
AND
DB_PartyMembers(_PartyMember)
AND
NOT DB_Defeated(_PartyMember)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun((CHARACTER)_PartyMember, _BaseTime);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_BaseTime)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67)
AND
NOT DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun((CHARACTER)S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _BaseTime);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_BaseTime)
AND
DB_END_MorphicPool_IntDevAmbusher(_IntDev)
AND
NOT DB_PermaDefeated(_IntDev)
AND
IsOnStage(_IntDev, 1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(_IntDev, _BaseTime);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_BaseTime)
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_IntDev)
AND
NOT DB_PermaDefeated(_IntDev)
AND
IsOnStage(_IntDev, 1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(_IntDev, _BaseTime);

PROC
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun((CHARACTER)_Char, (INTEGER)_BaseTime)
AND
Random(_BaseTime, _RandomTime)
AND
IntegerToReal(_BaseTime, _RealBaseTime)
AND
RealProduct(_RealBaseTime, 1.5, _RealBuffer)
AND
RealToInteger(_RealBuffer, _Buffer)
AND
IntegerSum(_RandomTime, _Buffer, _OffsetDelay)
AND
NOT DB_END_MorphicPool_BrainquakeTarget(_Char)
THEN
DB_END_MorphicPool_BrainquakeTarget(_Char);
RealtimeObjectTimerLaunch(_Char, "END_MorphicPool_NetherSlow_Timer", _RandomTime);
RealtimeObjectTimerLaunch(_Char, "END_MorphicPool_NetherStun_Timer", _OffsetDelay);

IF
ObjectTimerFinished(_Char,"END_MorphicPool_NetherSlow_Timer")
THEN
DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Char);

IF
ObjectTimerFinished(_Char,"END_MorphicPool_NetherSlow_Timer")
AND
HasActiveStatus(_Char, "END_NETHERBRAIN_SLOW", 0)
THEN
ApplyStatus(_Char, "END_NETHERBRAIN_SLOW", -1.0, 1);

IF
ObjectTimerFinished(_Char,"END_MorphicPool_NetherStun_Timer")
THEN
DB_END_MorphicPool_BrainquakeStunTimerFinished(_Char);
RequestPassiveRoll((CHARACTER)_Char, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, "SavingThrow", "Constitution", (DIFFICULTYCLASS)Act3_Hard_6298329e-255c-4826-9209-e911873b64e7, 0, "END_MorphicPool_MindStun");

IF
DB_END_MorphicPool_BrainquakeTarget(_Char)
AND
DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Char)
AND
DB_END_MorphicPool_BrainquakeStunTimerFinished(_Char)
THEN
NOT DB_END_MorphicPool_BrainquakeTarget(_Char);
NOT DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Char);
NOT DB_END_MorphicPool_BrainquakeStunTimerFinished(_Char);

IF
RollResult("END_MorphicPool_MindStun", _Char, _, 0, _, _)
AND
DB_END_MorphicPool_BrainQuakeStunTime(_Time)
THEN
ApplyStatus(_Char,"STUNNED",_Time, 1);
DB_END_MorphicPool_StunnedCharacter(_Char);

IF
StatusRemoved(_Char, "STUNNED", _, _)
AND
DB_END_MorphicPool_StunnedCharacter((CHARACTER)_Char)
AND
DB_Players(_Char)
AND
QRY_OnlyOnce("END_MorphicPool_BrainquakeStunnedVB")
THEN
RealtimeObjectTimerLaunch(_Char, "END_MorphicPool_StunnedVBTimer", 7000);

IF
ObjectTimerFinished(_Char, "END_MorphicPool_StunnedVBTimer")
THEN
StartVoiceBark(END_MorphicPool_VB_BrainquakeStunned_a1a16144-5b18-0d05-8c46-257f6fae01c5, (CHARACTER)_Char);

IF
DB_OnlyOnce("END_MorphicPool_BrainquakeStunnedVB")
AND
DB_END_MorphicPool_StunnedCharacter(_Char)
THEN
NOT DB_END_MorphicPool_StunnedCharacter(_Char);

//Removal is handled this way because this status is also applied in S_END_NearingSlowBox, meaning issues would occur with the temporary
//status applied with brainquake confliced with the infinite status in the region trigger
PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_PartyMembers(_Char)
AND
NOT DB_InRegion(_Char, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
HasActiveStatus(_Char, "END_NETHERBRAIN_SLOW", 1)
THEN
RemoveStatus(_Char, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
NOT DB_InRegion(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
HasActiveStatus(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_NETHERBRAIN_SLOW", 1)
THEN
RemoveStatus(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_END_MorphicPool_IntDevAmbusher(_IntDev)
AND
HasActiveStatus(_IntDev, "END_NETHERBRAIN_SLOW", 1)
THEN
RemoveStatus(_IntDev, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_IntDev)
AND
HasActiveStatus(_IntDev, "END_NETHERBRAIN_SLOW", 1)
THEN
RemoveStatus(_IntDev, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_BrainquakeTriggers(_OneShotTrigger, _VFXSourcePoint, _BaseTime, _StunTime)
THEN
PROC_TriggerUnregisterForPlayers(_OneShotTrigger);
NOT DB_END_MorphicPool_BrainquakeTriggers(_OneShotTrigger, _VFXSourcePoint, _BaseTime, _StunTime);

/* Some spice, though their weight will need to be adjusted so that a player doesn't get pelted for 30+ damage randomly
IF
DB_END_MorphicPool_FallingStalactite(_Item, _)
THEN
SetOnStage(_Item, 0);

PROC
PROC_END_MorphicPool_FallingStalactite()
AND
DB_END_MorphicPool_FallingStalactiteCount(_Count)
AND
DB_END_MorphicPool_FallingStalactite(_Item, _Count)
AND
Random(3000, _RandomInt)
AND
IntegerSum(_RandomInt, 500, _RandomTime)
THEN
RealtimeObjectTimerLaunch(_Item, "END_MorphicPool_FallingStalactite", _RandomTime);

IF
ObjectTimerFinished(_Item, "END_MorphicPool_FallingStalactite")
THEN
SetOnStage(_Item, 1);
SetForceUpdate(_Item, 1);

IF
DestroyedBy(_Item, _, _, _)
AND
DB_END_MorphicPool_FallingStalactite(_Item, _)
THEN
SetForceUpdate(_Item, 0);

PROC
PROC_END_MorphicPool_FallingStalactite()
AND
DB_END_MorphicPool_FallingStalactiteCount(_OldCount)
AND
IntegerSum(_OldCount, 1, _NewCount)
THEN
NOT DB_END_MorphicPool_FallingStalactiteCount(_OldCount);
DB_END_MorphicPool_FallingStalactiteCount(_NewCount);
*/
//END_REGION
//REGION Mind Meld AD
PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
PROC_TriggerUnregisterForPlayers((TRIGGER)S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);
PROC_TriggerUnregisterForPlayers(S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06);
PROC_TriggerUnregisterForPlayers(S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_MindMeldADTriggers(_Trigger)
THEN
PROC_TriggerUnregisterForPlayers(_Trigger);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_RapidMindMeldADHelper(_Helper, _)
THEN
PROC_ForceStopDialog(_Helper);

PROC
PROC_OneShotTriggerEntered(_Player, _Trigger)
AND
DB_END_MorphicPool_MindMeldADTriggers(_Trigger)
THEN
NOT DB_END_MorphicPool_MindMeldADTriggers(_Trigger);
PROC_END_MorphicPool_TryMindMeldAD(_Player);

PROC
PROC_END_MorphicPool_TryMindMeldAD((CHARACTER)_Player)
AND
DB_END_MorphicPool_MindMeldTarget(_LastPlayer)
AND
_LastPlayer != _Player
THEN
NOT DB_END_MorphicPool_MindMeldTarget(_LastPlayer);
DB_END_MorphicPool_MindMeldTarget(_Player);

PROC
PROC_END_MorphicPool_TryMindMeldAD((CHARACTER)_Player)
AND
DB_END_MorphicPool_MindMeldTarget(_Player)
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Player);
PROC_TryStartAD(END_MorphicPool_AD_Netherbrain_83cc2429-e2e7-88bc-a1e9-3db36832dc4a,S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
DB_GlobalFlag(END_MorphicPool_Event_MoveBrainADHelper_23e6f31f-7c0a-4f66-968f-16b28e6a44dd)
AND
DB_END_MorphicPool_MindMeldTarget((CHARACTER)_Player)
THEN
ClearFlag(END_MorphicPool_Event_MoveBrainADHelper_23e6f31f-7c0a-4f66-968f-16b28e6a44dd);
PROC_END_MorphicPool_TeleportADHelper(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Player);
//END_REGION
//REGION Rapid Mind Meld AD
PROC
PROC_END_MorphicPool_SetMaxRapidMindMeldDistance()
AND
GetDistanceTo(S_END_RapidMindMeldDistancePoint_002_4a5f8b52-7f8a-40b9-858d-dd1680e6f4f5, S_END_RapidMindMeldDistancePoint_001_192407cf-59ac-485c-9730-1f89472393f3, _Distance)
THEN
DB_END_MorphicPool_RapidMindMeldMaxDistance(_Distance);

IF
DB_InRegion(_Player, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f)
THEN
PROC_END_MorphicPool_RapidMindMeldADCleanup();
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Player, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Helper, _Dialog, _Index)
THEN
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Helper, _Dialog, _Index);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Count)
THEN
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Count);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
THEN
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(-1);

PROC
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Player, (TRIGGER)_Area)
AND
DB_END_MorphicPool_RapidMindMeldADHelper(_Helper, _Dialog)
AND
NOT DB_END_MorphicPool_ActiveRapidMindMeldAD(_Dialog)
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Count)
AND
IntegerSum(_Count, 1, _NewCount)
THEN
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Helper, _Dialog, _NewCount);
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Count);
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_NewCount);

PROC
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Player, (TRIGGER)_Area)
AND
DB_InRegion(_Player, _Area)
AND
SysCount("DB_END_MorphicPool_AvailableRapidMindMeldADHelper", 3, _Count)
AND
Random(_Count, _Index)
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Helper, _Dialog, _Index)
THEN
DB_END_MorphicPool_ActiveRapidMindMeldAD(_Dialog);
PROC_END_MorphicPool_TeleportADHelper(_Helper, _Player);
PROC_ForceStopDialog(_Helper);
PROC_TryStartAD(_Dialog, _Helper);
PROC_END_MorphicPool_RapidMindMeldADTimerStart(_Player);

//REGION TeleportADHelper calculations
//Clean up
PROC
PROC_END_MorphicPool_TeleportADHelper(_, _)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Value)
THEN
NOT DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Value);

PROC
PROC_END_MorphicPool_TeleportADHelper(_, _)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Value)
THEN
NOT DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Value);

PROC
PROC_END_MorphicPool_TeleportADHelper((GUIDSTRING)_Speaker, (GUIDSTRING)_Player)
AND
Random(100, _RandomX)
AND
Random(100, _RandomZ)
AND
Random(100, _RandomY)
AND
IntegerToReal(_RandomX, _RealX)
AND
IntegerToReal(_RandomZ, _RealZ)
AND
IntegerToReal(_RandomY, _RealY)
AND
RealDivide(_RealX, 100.0, _NormX)
AND
RealDivide(_RealZ, 100.0, _NormZ)
AND
RealDivide(_RealY, 100.0, _NormY)
AND
Random(4,_Direction)
AND
QRY_END_RapidMindMeld_DetermineRandomOffset(_Direction,_NormX,_NormZ,2.0,1.0)
AND
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_DistDirX,_DistDirZ)
AND
RealProduct(_NormY, 1.0, _ScaledY) //Distance range Y
AND
RealSum(_ScaledY,-0.5,_DistY) //Offset Y
AND
GetPosition(_Player, _X, _Y, _Z)
AND
RealSum(_X, _DistDirX, _NewX)
AND
RealSum(_Z, _DistDirZ, _NewZ)
AND
RealSum(_Y, _DistY, _NewY)
THEN
TeleportToPosition(_Speaker, _NewX, _NewY, _NewZ, "", 0,0,0,0,0);
NOT DB_QRYRTN_END_RapidMindMeld_RandomOffset(_DistDirX,_DistDirZ);

//Determine random offset according to four directions
QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(0,(REAL)_NormX,(REAL)_NormZ,(REAL)_OffsetXZ,(REAL)_RangeXZ)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_NormX,_OffsetXZ,_RangeXZ,1.0) //positive offset X
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_X)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_NormZ,_OffsetXZ,_RangeXZ) //-1.0 to 1.0 Z
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Z)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_X,_Z);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(1,(REAL)_NormX,(REAL)_NormZ,(REAL)_OffsetXZ,(REAL)_RangeXZ)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_NormX,_OffsetXZ,_RangeXZ,-1.0) //negative offset X
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_X)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_NormZ,_OffsetXZ,_RangeXZ) //-1.0 to 1.0 Z
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Z)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_X,_Z);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(2,(REAL)_NormX,(REAL)_NormZ,(REAL)_OffsetXZ,(REAL)_RangeXZ)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_NormX,_OffsetXZ,_RangeXZ) //-1.0 to 1.0 X
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_X)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_NormZ,_OffsetXZ,_RangeXZ,1.0) //positive offset Z
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Z)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_X,_Z);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(3,(REAL)_NormX,(REAL)_NormZ,(REAL)_OffsetXZ,(REAL)_RangeXZ)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_NormX,_OffsetXZ,_RangeXZ) //-1.0 to 1.0 X
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_X)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_NormZ,_OffsetXZ,_RangeXZ,-1.0) //negative offset Z
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Z)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_X,_Z);

//Calculations with offset (-/+offset to -/+maxrange)
QRY
QRY_END_RapidMindMeld_CalcWithOffset((REAL)_Random,(REAL)_Offset,(REAL)_Range,(REAL)_Direction)
AND
RealProduct(_Random,_Range,_Scaled) //Random varies from 0.0 to 1.0, Scaled varies from 0 to Range
AND
RealSum(_Scaled,_Offset,_ScaledOffset) //ScaledOffset varies from Offset to MaxRange(=Offset+Direction)
AND
RealProduct(_ScaledOffset,_Direction,_Value) //Value varies from -MaxRange to -Offset and +Offset to +MaxRange
THEN
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Value);

//Calculations without offset (-maxrange to +maxrange)
QRY
QRY_END_RapidMindMeld_CalcWithoutOffset((REAL)_Random,(REAL)_Offset,(REAL)_Range)
AND
RealSum(_Offset,_Range,_MaxRange)
AND
RealSubtract(_Random,0.5,_RandomSub) //Random varies from 0.0 to 1.0, RandomSub varies from -0.5 to 0.5
AND
RealProduct(_RandomSub,2.0,_RandomNorm) //RandomNorm varies from -1.0 to 1.0
AND
RealProduct(_RandomNorm,_MaxRange,_Value) //Value varies from -MaxRange to +MaxRange
THEN
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Value);

//END_REGION

PROC
PROC_END_MorphicPool_RapidMindMeldADTimerStart((CHARACTER)_Player)
AND
NOT DB_END_BrainBattle_RapidMindMeld(1)
AND
QRY_END_MorphicPool_GetTimeDifference(_Player)
AND
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_AdjustedTime)
//AND
//ConcatenateInteger("Next AD: ", _AdjustedTime, _DebugTime)
THEN
ObjectTimerLaunch(_Player, "END_MorphicPool_RapidMindMeldAD", _AdjustedTime, 1);
//DebugText(_Player, _DebugTime);
NOT DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_AdjustedTime);

PROC
PROC_END_MorphicPool_RapidMindMeldADTimerStart((CHARACTER)_Player)
AND
DB_END_BrainBattle_RapidMindMeld(1)
THEN
RealtimeObjectTimerLaunch(_Player, "END_MorphicPool_RapidMindMeldAD", 770);

IF
ObjectTimerFinished(_Player, "END_MorphicPool_RapidMindMeldAD")
AND
NOT DB_END_BrainBattle_RapidMindMeld(1)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f)
THEN
PROC_END_MorphicPool_RapidMindMeldADCleanup();
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Player, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);

QRY
QRY_END_MorphicPool_GetTimeDifference((CHARACTER)_Player)
AND
GetDistanceTo(_Player, S_END_RapidMindMeldDistancePoint_001_192407cf-59ac-485c-9730-1f89472393f3, _PlayerDistance)
AND
DB_END_MorphicPool_RapidMindMeldMaxDistance(_MaxDistance)
AND
RealDivide(_PlayerDistance, _MaxDistance, _NormalizedDistance)
AND
DB_END_MorphicPool_ActiveRapidMindMeldStartTime(_MaxTime)
AND
IntegerToReal(_MaxTime, _RealMaxTime)
AND
RealProduct(_NormalizedDistance, _RealMaxTime, _RealAdjustedTime)
AND
RealToInteger(_RealAdjustedTime, _AdjustedTime)
THEN
PROC_END_MorphicPool_SetAdjustedTime(_AdjustedTime);

PROC
PROC_END_MorphicPool_SetAdjustedTime((INTEGER)_AdjustedTime)
AND
_AdjustedTime > 770
THEN
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_AdjustedTime);

PROC
PROC_END_MorphicPool_SetAdjustedTime((INTEGER)_AdjustedTime)
AND
_AdjustedTime <= 770
THEN
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(770);

IF
AutomatedDialogEnded(_Dialog, _ID)
AND
DB_END_MorphicPool_ActiveRapidMindMeldAD(_Dialog)
THEN
NOT DB_END_MorphicPool_ActiveRapidMindMeldAD(_Dialog);

IF
EnteredTrigger(_Player, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("END_MorphicPool_PsionicSuppressVB")
THEN
StartVoiceBark((VOICEBARKRESOURCE)END_MorphicPool_VB_PsionicSupression_8fb3d8ea-8874-5fb7-7c56-8202c111d5c4, _Player);

IF
DB_InRegion(_Char, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
NOT DB_Defeated(_Char)
AND
HasActiveStatus(_Char, "END_NETHERBRAIN_SLOW", 0)
THEN
ApplyStatus(_Char, "END_NETHERBRAIN_SLOW", -1.0, 1);

IF
LeftTrigger(_Char, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
THEN
RemoveStatus(_Char, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_StateSet_Defeated(_Char)
AND
HasActiveStatus(_Char, "END_NETHERBRAIN_SLOW", 1)
THEN
RemoveStatus(_Char, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

//END_REGION
//REGION Intellect Devourer Ambush
IF
DB_END_MorphicPool_IntDevAmbusher(_IntDev)
THEN
DB_GLO_DefeatCounter(_IntDev,"END_MorphicPool_IntDevAmbusherDefeat");
DB_AmbushTrigger_Ambusher_Appear(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, _IntDev, _IntDev, 1, UTIL_Spawn_01_510ff37e-0618-40e4-8ce0-236e3dc9c291,"");

PROC
PROC_LaunchAmbush((TRIGGER)S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, (CHARACTER)_Player)
THEN
DB_END_MorphicPool_AmbushInitiator(_Player);
PROC_END_MorphicPool_NetherbrainAmbushAD((DIALOGRESOURCE)END_MorphicPool_AD_NetherbrainIntDevAmbushStart_7af65a87-81be-cc25-80e4-c401b261dfa1);

PROC
PROC_END_MorphicPool_NetherbrainAmbushAD((DIALOGRESOURCE)_Dialog)
AND
DB_END_MorphicPool_AmbushInitiator(_Player)
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Player);
PROC_TryStartAD(_Dialog, S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
WentOnStage(_Char, 1)
AND
DB_END_MorphicPool_IntDevAmbusher((CHARACTER)_Char)
AND
DB_END_MorphicPool_AmbushInitiator(_Player)
THEN
DB_GLO_DefeatCounter(_Char,"END_MorphicPool_IntDevAmbushStartWave2Counter");
SetCombatGroupAndEnterCombat(_Char, "END_MorphicPool_IntDevAmbusherGroup", _Player);

IF
DB_END_MorphicPool_IntDevAmbusher_SecondWave((CHARACTER)_IntDev)
THEN
DB_GLO_DefeatCounter(_IntDev,"END_MorphicPool_IntDevAmbusherDefeat");
PROC_SetOnStage(_IntDev,0);

PROC
PROC_GLO_DefeatCounter_Notify("END_MorphicPool_IntDevAmbushStartWave2Counter",_,_,8)
AND
QRY_OnlyOnce("END_MorphicPool_IntDevAmbushWave2Counter_OnlyOnce")
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_IntDev)
AND
GetPosition(_IntDev,_X,_Y,_Z)
THEN
AppearAtPosition(_IntDev,_X,_Y,_Z,1,UTIL_Spawn_01_510ff37e-0618-40e4-8ce0-236e3dc9c291,"");
PROC_END_MorphicPool_NetherbrainAmbushAD((DIALOGRESOURCE)END_MorphicPool_AD_NetherbrainIntDevAmbushMid_0fb7733e-dc35-65af-9cf0-da320feedd77);

PROC
PROC_GLO_DefeatCounter_AllDefeated("END_MorphicPool_IntDevAmbusherDefeat")
THEN
PROC_END_MorphicPool_AmbushEnded();

PROC
PROC_END_MorphicPool_AmbushEnded()
AND
DB_END_MorphicPool_AmbushInitiator(_Player)
AND
QRY_GetClosestAvailableCharacterTo(_Player, 0)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_ClosestAvatar, _Player, _, 1)
THEN
NOT DB_END_MorphicPool_AmbushInitiator(_Player);
PROC_NotifyWhenReadyToMoveOn(_ClosestAvatar, "END_MorphicPool_EmperorADObservation");

PROC
PROC_ReadyToMoveOn(_Player, "END_MorphicPool_EmperorADObservation")
THEN
PROC_EmperorAD(_Player, END_MorphicPool_EmperorAD_Observations_4dcfb95a-727e-bd78-8b05-d3fbff68aa7b);

//If players are still in combat with the Int Devs when they start dialog with the Netherbrain, they'll run away
PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_IntDevAmbusher(_Char)
AND
NOT DB_PermaDefeated(_Char)
THEN
PROC_DisappearOutOfSight(_Char, "Run", 0, "");

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Char)
AND
NOT DB_PermaDefeated(_Char)
THEN
PROC_DisappearOutOfSight(_Char, "Run", 0, "");

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
THEN
PROC_CancelAmbush(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007);
//END_REGION
//REGION Dead Smuggler
IF
FlagSet(END_MorphicPool_State_HasDeadSmugglerToken_104abece-95d5-4d04-b2d0-f6f741718ce5, _Player, _)
AND
DB_Players((CHARACTER)_Player)
AND
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_LastOwner)
AND
_LastOwner != _Player
THEN
NOT DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_LastOwner);
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Player);

IF
AddedTo(S_END_DeadSmugglerSiblingToken_d95b9ad2-d8d3-4cd5-9ed4-818845836ccb, S_END_DeadSmugglerSibling_f5499fbc-61ed-4c7c-93e8-63bec48b75c5, _)
AND
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Player)
AND
DB_Players(_Player)
AND
DB_GlobalFlag(END_MorphicPool_Knows_DeadSmugglerSibling_f04df54e-7938-4f58-a9e0-7a90ada764d3)
AND
QRY_OnlyOnce("END_MorphicPool_DeadSmugglerToken")
THEN
StartVoiceBark(END_MorphicPool_VB_DeadSmugglerResolve_63526504-c1e0-6be0-ef50-2338b37b27de, _Player);
NOT DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Player);

//END_REGION
//REGION Player Banter
IF
DB_InRegion(_Player,(TRIGGER)S_END_MorphicPartyBanterBox_7cf1a87e-5888-403c-9403-faaf8a4b9591)
AND
DB_Players(_Player)
AND
NOT DB_CantTalk(_Player)
AND
NOT DB_END_MorphicPool_BrainquakeTarget(_Player)
AND
QRY_OnlyOnce("END_MorphicPool_PartyBanterOnce")
THEN
StartVoiceBark((VOICEBARKRESOURCE)END_MorphicPool_VB_PartyBanter_4f81d15e-5bf2-f22b-fe51-a0e7a73d5dee, _Player);

IF
EnteredTrigger((CHARACTER)_Player,(TRIGGER)S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
DB_Players(_Player)
AND
QRY_OnlyOnce("END_MorphicPool_EnteredSlowVBOnce")
THEN
StartVoiceBark((VOICEBARKRESOURCE)END_MorphicPool_VB_MorphicBanter_af1c219b-7a44-3898-8353-e22e9e9903b7, _Player);
//END_REGION
//REGION Gortash
IF
RelationChanged(ACT3_END_Gortash_0fa1d8b6-b035-43e4-bb4d-15bf1404ed58,Hero_a1542c81-6895-929e-4522-10ce218bb360,0,0)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f)
THEN
SetFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);
SetFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f);

//If case of being one-shot
PROC
PROC_StateSet_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0) //Ignore if his dead is due to NetherbrainConfrontation
THEN
SetFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);
SetFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f);

IF
AddedTo(S_WYR_CrownController_Gortash_383be300-d328-4152-86df-4927482d1fd7, _Player, _)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67)
AND
DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2)
THEN
ClearFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);

PROC
PROC_SpotPlayers_Spotted(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer", _Player)
AND
DB_Players(_Player)
THEN
SetFlag(END_MorphicPool_State_SpottedPlayer_cd1494d6-6bcd-422a-a347-6caa927e52d1);
PROC_TryStartAD(END_MorphicPool_AD_GortashCallout_cbb0a688-43f3-23d2-8142-7b3bbcba4140,S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
DB_InRegion(_Player, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b)
AND
DB_Players(_Player)
AND
NOT DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_GortashBetrayed_d5c1ac33-f72a-4b52-992c-430ae7f8adf2)
THEN
SetFlag(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6);

IF
FlagSet(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6, _, _)
AND
NOT DB_GlobalFlag(END_MorphicPool_HasMet_Gortash_1538bf6c-960d-4eff-932c-b0ef81c57379)
THEN
PROC_GlobalSetFlagAndCache(END_MorphicPool_Event_GortashIgnored_6dda4ed2-77ac-0748-fc2a-4a88950a8a9f);
PROC_TryStartAD(END_MorphicPool_AD_GortashCallout_cbb0a688-43f3-23d2-8142-7b3bbcba4140,S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
DB_GlobalFlag(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6)
AND
QRY_OnlyOnce("END_MorphicPool_GortashMoveTo")
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer");
PROC_NotifyWhenReadyToMoveOn(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"END_MorphicPool_GortashReadyMove");

PROC
PROC_ReadyToMoveOn(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac,"END_MorphicPool_GortashReadyMove")
THEN
PROC_RemoveDialog(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

QRY
QRY_CRIME_KeepingAnEyeOut_Block(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _ID)
AND
DB_CurrentLevel("END_Main")
THEN
DB_NOOP(1);

PROC
PROC_END_MorphicPool_TeleportToAstralPrism()
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67)
AND
DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac)
THEN
TeleportTo(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_DeadGortashAstralPoint_0945cc01-26b5-4c22-b923-0cb6f8361a9f);

//END_REGION
//REGION Confronting Netherbrain
PROC
PROC_OneShotTriggerEntered(_Player, S_END_NearNetherbrainPoolBox_49aa0cac-17aa-476d-8844-db78966ff698)
THEN
SetFlag(END_MorphicPool_State_NearNetherbrainPool_35f89ccc-2a9a-4663-b24a-a68bf764376c);

IF
FlagSet(END_MorphicPool_Knows_Netherbrain_c982a948-cbe7-4bdf-9410-490cca5dd83b, _, _)
THEN
SetStoryDisplayName(S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, "END_NetherbrainName");

IF
FlagSet(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f, _, _)
THEN
PROC_END_MorphicPool_PostConfrontationCleanUp();

IF
DB_InRegion(_Player, S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06)
AND
DB_Players(_Player)
AND
NOT DB_Defeated(_Player)
AND
DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2)
AND
QRY_OnlyOnce("END_MorphicPool_StonesNotReady")
THEN
StartVoiceBark(END_MorphicPool_VB_MissingStone_1760c0b0-ff94-740c-09cc-6d93e353c7ed, _Player);

IF
DB_InRegion(_Player, S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06)
AND
DB_Players(_Player)
AND
NOT DB_Defeated(_Player)
AND
NOT DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2) //Will not start till combat with Gortash has ended and stone is looted
AND
QRY_OnlyOnce("END_MorphicPool_ConfrontationStart")
THEN
PROC_END_MorphicPool_ConfrontationReadyAllPlayers();
SetFlag(END_MorphicPool_Knows_Netherbrain_c982a948-cbe7-4bdf-9410-490cca5dd83b);
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player);

PROC
PROC_END_MorphicPool_ConfrontationReadyAllPlayers()
AND
DB_PartyMembers(_Player)
THEN
PROC_ForceStopDialog(_Player); //In case a player is in a dialog (speaking with dead, Gortash)

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player)
AND
DB_END_General_MainDialogAnchor(_Player)
AND
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Player)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

//Fetch nearest Avatar
PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player)
AND
QRY_GetClosestAvailableCharacterTo(_Player, 0)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_ClosestAvatar, _, _, _)
AND
NOT DB_END_MorphicPool_ConfrontationStarted(1)
AND
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_ClosestAvatar)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

//Player that initiated the dialog
PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player)
AND
NOT DB_END_MorphicPool_ConfrontationStarted(1)
AND
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Player)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

//Try Nearest Player
PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player)
AND
QRY_END_MorphicPool_GetNearestAvailablePlayer(_Player)
AND
DB_QRYRTN_END_MorphicPool_NearestPlayer(_NearestPlayer, _Dist)
AND
NOT DB_END_MorphicPool_ConfrontationStarted(1)
AND
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Player)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

//Try Any Player
PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_)
AND
DB_Players(_Player)
AND
NOT DB_END_MorphicPool_ConfrontationStarted(1)
AND
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Player)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

QRY
QRY_END_MorphicPool_GetNearestAvailablePlayer((CHARACTER)_Char)
AND
DB_Players(_Player)
AND
NOT DB_CantTalk_IgnoreStatusesCombat(_Player)
AND
GetDistanceTo(_Player, _Char, _Dist)
THEN
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Player, _Dist);

IF
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Player1, _Dist1)
AND
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Player2, _Dist2)
AND
_Player2 != _Player1
AND
_Dist2 >= _Dist1
THEN
NOT DB_QRYRTN_END_MorphicPool_NearestPlayer(_Player2, _Dist2);

//Something bad happened and no one was available!
PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Player)
AND
NOT DB_END_MorphicPool_ConfrontationStarted(1)
THEN
DB_END_MorphicPool_ConfrontationSpeaker(_Player);
SetFlag(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0);
PROC_END_MorphicPool_PostConfrontationCleanUp();
PROC_END_MorphicPool_TeleportToAstralPrism();


//All player party members have active speaking roles
PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, _ID)
AND
DB_Players(_Player)
AND
NOT DB_DialogPlayers(_ID,_Player,_)
THEN
PROC_DialogAddSpeakingActor(_ID, _Player, 1, 1);

QRY
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Player)
AND
QRY_StartDialogCustom((DIALOGRESOURCE)END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf,
    S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7,
    _Player,
	S_END_MindBattleHelper_be50f7cd-c14a-4131-82d3-29337f3a4759,
    S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b,
    0,0,0,0)
THEN
DB_END_MorphicPool_ConfrontationSpeaker(_Player);

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, _ID)
AND
NOT DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769)
AND
NOT DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67)
THEN
DB_DialogDeath(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
PROC_DialogAddSpeakingActor(_ID, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
FlagSet(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0, _, _)
THEN
Die(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, DEATHTYPE.Physical, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, 0, 1, 0.0);

IF
DialogEnded(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, _)
THEN
PROC_END_MorphicPool_TeleportToAstralPrism();

PROC
PROC_END_MorphicPool_TeleportToAstralPrism()
AND
NOT DB_GlobalFlag(END_MorphicPool_State_ThrallOfTheAbsoluteInProgress_e0289178-9766-4917-bdde-3dd3845d37b5)
THEN
PROC_TeleportPartiesTo(S_END_ToAstralPlanePoint_66edc6ed-1584-47ac-983c-c6119ea7ddd4, "END_IllithidOptions_PlayersArrived");
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "Act3c"
