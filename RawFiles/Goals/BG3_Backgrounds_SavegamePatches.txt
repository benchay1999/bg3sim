Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
// Act 1 Background Goals

//REGION GUS-309259

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("WLD_Main_A")
AND
NOT DB_PermaDefeated(S_CRA_Escape_Mindflayer_d5385cd0-f371-43dc-a0a2-50381fc50ea4)
THEN
DB_BUGFIX_Marker("GUS-309259");
DB_GLO_Backgrounds_ChainAfterDefeated(S_CRA_Escape_Mindflayer_d5385cd0-f371-43dc-a0a2-50381fc50ea4, "Act1_HauntedOne_PinnedMindFlayer");

//END_REGION

//REGION GUS-309689

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("WLD_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309689");
DB_GLO_Backgrounds_ChainAfterGlobalFlagPartyWide((FLAG)FOR_UnfortunateGnome_State_Freed_c829895d-aba7-46e5-bc10-eb2516c8ddd6, "Act1_FolkHero_UnfortunateGnome");

//END_REGION

//Act 2 Background Goals

//REGION GUS-309777

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("SCL_Main_A")
AND
DB_PermaDefeated((CHARACTER)S_TWN_Tollhouse_TollhouseMaster_3b460226-8ca2-4bbc-9bd7-8bb947aa2c06)
AND
DB_PermaDefeated((CHARACTER)S_TWN_Hospital_Surgeon_e58b8b34-038b-4858-b817-c2a8096a9381)
AND
DB_PermaDefeated((CHARACTER)S_TWN_Distillery_Brewer_4d9e3db3-9a78-4f4b-8101-1dd73c0f3be5)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309777");
PROC_GLO_Backgrounds_CompleteGoal(_Player, "Act2_Soldier_ThormFamilyMembersKilled");

//END_REGION

//REGION GUS-309660

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("SCL_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309660");
NOT DB_GLO_Backgrounds_Goal((TAG)URCHIN_2faee476-d77b-42a7-a4c6-2b9ac934673c, "Act2_Urchin_MolRescuedFromColony", 9b74678c-88df-497a-99e9-28c243aeb4dd);
DB_GLO_Backgrounds_Goal((TAG)URCHIN_2faee476-d77b-42a7-a4c6-2b9ac934673c, "Act2_Urchin_MolFateDiscovered", 9b74678c-88df-497a-99e9-28c243aeb4dd);

//END_REGION

//REGION GUSX-10902

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("SCL_Main_A")
AND
NOT DB_LevelUnreachable("SCL_Main_A")
THEN
NOT DB_GLO_Backgrounds_ChainAfterGlobalFlagInDialog((FLAG)SCL_Pixie_State_Dead_379ba580-46dc-db81-dae1-581117e54e03, "Act2_HauntedOne_PixieKilled");
DB_GLO_Backgrounds_ChainAfterGlobalFlagPartyWide((FLAG)SCL_Pixie_State_Dead_379ba580-46dc-db81-dae1-581117e54e03, "Act2_HauntedOne_PixieKilled");

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("SCL_Main_A")
AND
DB_GlobalFlag((FLAG)SCL_Pixie_State_Dead_379ba580-46dc-db81-dae1-581117e54e03)
AND
DB_Players(_Player)
AND 
NOT DB_BUGFIX_Marker("GUSX-10902")
THEN
DB_BUGFIX_Marker("GUSX-10902");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act2_HauntedOne_PixieKilled");

//Act 3 Background Goals

//REGION GUS-309787

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
NOT DB_LevelLoadedOnce("CTY_Main_A")
AND
DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769)
AND
NOT DB_GlobalFlag((FLAG)END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309787");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_Soldier_GortashExecuted");

//END_REGION

//REGION GUS-309573

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
NOT DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
THEN
DB_BUGFIX_Marker("GUS-309573");
DB_GLO_Backgrounds_Goal((TAG)ACOLYTE_906d1961-e9c6-4170-b775-62797a0efe1c, "Act3_Acolyte_BurnedKerriPortraitTrue", 05b954ce-0050-4f4c-ab00-9e3f14588faa);

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
DB_GlobalFlag((FLAG)LOW_OskarsBeloved_State_PortraitDestroyedRevocation_52748963-091f-4be5-994a-bb95da0d98ac)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309573");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_Acolyte_BurnedKerriPortraitTrue");

//END_REGION

//REGION GUS-309523

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309523");
DB_GLO_Backgrounds_ChainAfterGlobalFlagInDialog((FLAG)WYR_SharessCaress_NymphRoom_State_Rewarded_d4544fdc-6991-42eb-83d3-865cd7050877, "Act3_Acolyte_ServicedBySharessCaress");
DB_GLO_Backgrounds_ChainAfterCharacterFlag((FLAG)WYR_DapperDrow_State_HiredBoth_4dc060ee-1076-ba53-8663-e436665b4800, "Act3_Acolyte_ServicedBySharessCaress");
DB_GLO_Backgrounds_ChainAfterCharacterFlag((FLAG)WYR_DapperDrow_State_HiredSister_390a05d9-0313-095d-1356-1884bdf6273e, "Act3_Acolyte_ServicedBySharessCaress");
DB_GLO_Backgrounds_ChainAfterCharacterFlag((FLAG)WYR_DapperDrow_State_HiredBrother_e0d6ad5e-c5d4-9d8c-8c6f-997694d6f7b8, "Act3_Acolyte_ServicedBySharessCaress");

//END_REGION

//REGION GUS-309518

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
NOT DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101)
THEN
DB_BUGFIX_Marker("GUS-309518");
DB_GLO_Backgrounds_ChainAfterDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "Act3_HauntedOne_OrinKilled");

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309518");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_HauntedOne_OrinKilled");

//END_REGION

//REGION GUS-309514

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309514");
DB_GLO_Backgrounds_Goal((TAG)HAUNTED_ONE_ce00b3b6-238e-4524-851b-3d1f2d2b1189, "Act3_HauntedOne_SarevokKilled", 12e0e4ff-9eab-48a8-950e-2e831c6ba1c1);

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
DB_GlobalFlag(LOW_MurderTribunal_Sarevok_State_Dead_e9d30711-af25-4ba9-813e-cc7c131b17b6)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309514-2");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_HauntedOne_SarevokKilled");

//END_REGION

//REGION

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_State_Current(S_WYR_SkeletalDragon_67770922-5e0a-40c5-b3f0-67e8eb50493a, _, "DeadAgain")
AND
DB_Players(_Player)
THEN
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_FolkHero_JaheiraFamilyKept"); //Was misnamed in the DB, sticking with the naming.

//END_REGION

//REGION GUS-309509

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
NOT DB_GLO_Backgrounds_Blocked("Act3_GuildArtisan_CommissionedStatue")
THEN
DB_BUGFIX_Marker("GUS-309509");
NOT DB_GLO_Backgrounds_ChainAfterGoal("Act3_HauntedOne_BoughtStatue", "Act3_GuildArtisan_CommissionedStatue");
DB_GLO_Backgrounds_ChainAfterGoal("Act3_GuildArtisan_CommissionedStatue", "Act3_HauntedOne_BoughtStatue");

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("BGO_Main_A")
AND
DB_GLO_Backgrounds_Blocked("Act3_GuildArtisan_CommissionedStatue")
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309509");
PROC_GLO_Backgrounds_CompleteGoal(_Player, "Act3_HauntedOne_BoughtStatue");

//END_REGION

//Act 3b Background Goals

//REGION GUS-309765

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("CTY_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309765-1");
NOT DB_GLO_Backgrounds_ChainAfterGlobalFlagInDialog((FLAG)LOW_JaheirasHouse_State_JaheiraMetFamily_9486cabf-8113-47f8-a03f-4a9aba46d140, "Act3_Urchin_JaheiraKeptFamily");
DB_GLO_Backgrounds_ChainAfterGlobalFlagPartyWide((FLAG)LOW_JaheirasHouse_State_JaheiraMetFamily_9486cabf-8113-47f8-a03f-4a9aba46d140, "Act3_Urchin_JaheiraKeptFamily");

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("CTY_Main_A")
AND
DB_GlobalFlag((FLAG)LOW_JaheirasHouse_State_JaheiraMetFamily_9486cabf-8113-47f8-a03f-4a9aba46d140)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUS-309765-2");
PROC_GLO_Backgrounds_CompleteGoal((CHARACTER)_Player, "Act3_Urchin_JaheiraKeptFamily");

//END_REGION

//REGION GUS-309604

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 6")
AND
DB_LevelLoadedOnce("CTY_Main_A")
THEN
DB_BUGFIX_Marker("GUS-309604");
NOT DB_GLO_Backgrounds_ChainAfterGlobalFlagInDialog((FLAG)LOW_BhaalTemple_Knows_TempleIsBhaalTemple_b1525a1c-829e-4c05-bc39-c161e30ac235, "Act3_Acolyte_BhaalTempleFound");

//END_REGION

//REGION GUSX-10844

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("SCL_Main_A")
AND
DB_GlobalFlag((FLAG)GLO_Isobel_KnowsKethericFather_93182f99-8977-42bb-a3c5-094a7a686068)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUSX-10844");
PROC_GLO_Backgrounds_CompleteGoal(_Player, "Act2_Noble_KethericStoryLearned");

PROC
PROC_ApplySavegamePatches()
AND
QRY_BG3_SaveGameIsOlderThan("Release Patch 8")
AND
DB_LevelLoadedOnce("SCL_Main_A")
AND
DB_GlobalFlag((FLAG)MOO_KethericsChambers_Knows_KethericsWife_265c4b21-25cb-4ea2-b9fe-0f37d035b886)
AND
DB_Players(_Player)
THEN
DB_BUGFIX_Marker("GUSX-10844");
PROC_GLO_Backgrounds_CompleteGoal(_Player, "Act2_Noble_KethericStoryLearned");


//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
