Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Astarion

//AstarionHungerA
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerA_ec01fb84-d9ef-47b6-8b32-6620edd67d50,"ReadyCheck_ToCrecheFromGoblinCamp",1,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerA_ec01fb84-d9ef-47b6-8b32-6620edd67d50,"ReadyCheck_ToCrecheFromPlains",1,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerA_ec01fb84-d9ef-47b6-8b32-6620edd67d50,"ReadyCheck_ToSCLFromUnderdark",1,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_AstarionHungerA_ec01fb84-d9ef-47b6-8b32-6620edd67d50,(CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

//AstarionHungerC_Bite
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerC_Bite_fe3fd3a0-70d1-4bc4-8a7f-4614f89ac23d,"ReadyCheck_ToCrecheFromGoblinCamp",1,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerC_Bite_fe3fd3a0-70d1-4bc4-8a7f-4614f89ac23d,"ReadyCheck_ToCrecheFromPlains",1,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_AstarionHungerC_Bite_fe3fd3a0-70d1-4bc4-8a7f-4614f89ac23d,"ReadyCheck_ToSCLFromUnderdark",1,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_AstarionHungerC_Bite_fe3fd3a0-70d1-4bc4-8a7f-4614f89ac23d,(CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

//Astarion_ScarReading_Fallback
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Astarion_ScarReading_Fallback_bd01fc04-00ce-4e32-bbee-aa248728a116,"ReadyCheck_ToSCL02FromCRE",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Astarion_ScarReading_Fallback_bd01fc04-00ce-4e32-bbee-aa248728a116,"ReadyCheck_ToBGFromSCL",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Astarion_ScarReading_Fallback_bd01fc04-00ce-4e32-bbee-aa248728a116,(CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

//Astarion_CazadorNightmare_SecondDream
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87,"ReadyCheck_ToBGFromSCL",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87,(CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

//Astarion_RaphaelsRevelation
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Astarion_RaphaelsRevelation_3a3b2dca-7e94-47af-b81f-93194944c633,"ReadyCheck_ToBGFromSCL",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87,(CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

//END_REGION

//REGION Daisy

//DaisyDream1
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f,"ReadyCheck_ToCrecheFromGoblinCamp",2,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f,"ReadyCheck_ToCrecheFromPlains",2,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f,"ReadyCheck_ToSCLFromUnderdark",2,1);

//InfernalBoxAppears
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_InfernalBoxAppears_47942a99-c44e-4e90-a0a2-6956bed9dc5b,"ReadyCheck_ToCrecheFromGoblinCamp",10,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_InfernalBoxAppears_47942a99-c44e-4e90-a0a2-6956bed9dc5b,"ReadyCheck_ToCrecheFromPlains",10,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_InfernalBoxAppears_47942a99-c44e-4e90-a0a2-6956bed9dc5b,"ReadyCheck_ToSCLFromUnderdark",10,1);

//END_REGION

//REGION Dark Urge

//DarkUrge_MurderOfAlfira
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d,"ReadyCheck_ToCrecheFromGoblinCamp",11,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d,"ReadyCheck_ToCrecheFromPlains",11,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d,"ReadyCheck_ToSCLFromUnderdark",11,1);
DB_FallbackCamp_ResurrectDarkUrge((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d);

//DarkUrge_ButlerIntro
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToCrecheFromGoblinCamp",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToCrecheFromPlains",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToSCLFromUnderdark",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToGoblinCampFromCreche",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToPlainsFromCreche",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToWLDFromSCL",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248,"ReadyCheck_ToBGFromSCL",2,0);
DB_FallbackCamp_ResurrectDarkUrge((FLAG)NIGHT_DarkUrge_ButlerIntro_e3dc106b-02f0-41ef-9642-ed7ccf971248);

//DarkUrge_KilledIsobel
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_KilledIsobel_c46aba07-a156-4bcd-a2da-3411651f28c2,"ReadyCheck_ToBGFromSCL",0,0);
DB_FallbackCamp_ResurrectDarkUrge((FLAG)NIGHT_DarkUrge_KilledIsobel_c46aba07-a156-4bcd-a2da-3411651f28c2);

//DarkUrge_SkippedTempleFinale
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_DarkUrge_SkippedTempleFinale_aa87947e-9ae0-4a2d-a3ed-fb2c9ca6be5c,"ReadyCheck_ToWYRFromLOW",0,0);
DB_FallbackCamp_ResurrectDarkUrge((FLAG)NIGHT_DarkUrge_SkippedTempleFinale_aa87947e-9ae0-4a2d-a3ed-fb2c9ca6be5c);

//END_REGION

//REGION Gale

//Gale_TressymJoin
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_TressymJoin_7ca98d47-e9fa-4f87-8728-8e56c4ee652d,"ReadyCheck_ToCrecheFromGoblinCamp",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_TressymJoin_7ca98d47-e9fa-4f87-8728-8e56c4ee652d,"ReadyCheck_ToCrecheFromPlains",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_TressymJoin_7ca98d47-e9fa-4f87-8728-8e56c4ee652d,"ReadyCheck_ToSCLFromUnderdark",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Gale_TressymJoin_7ca98d47-e9fa-4f87-8728-8e56c4ee652d,(CHARACTER)S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

//Gale_ElminsterVisit
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_ORI_Gale_ElminsterVisit_a58e9b3e-b458-48be-b32a-a88a2c65bed5,"ReadyCheck_ToBGFromSCL",0,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_ORI_Gale_ElminsterVisit_a58e9b3e-b458-48be-b32a-a88a2c65bed5,(CHARACTER)S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

//NIGHT_Gale_Fallback_AskFirstMagicItem
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_Fallback_AskFirstMagicItem_7ee4663c-cabf-4b57-b092-99e6b6eadbac,"ReadyCheck_ToCrecheFromGoblinCamp",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_Fallback_AskFirstMagicItem_7ee4663c-cabf-4b57-b092-99e6b6eadbac,"ReadyCheck_ToCrecheFromPlains",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Gale_Fallback_AskFirstMagicItem_7ee4663c-cabf-4b57-b092-99e6b6eadbac,"ReadyCheck_ToSCLFromUnderdark",0,1);

//END_REGION

//REGION Karlach

//PaladinsOfTyr_Forced
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9,"ReadyCheck_ToCrecheFromGoblinCamp",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9,"ReadyCheck_ToCrecheFromPlains",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9,"ReadyCheck_ToSCLFromUnderdark",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9,(CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c);

//FacingDeath
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Karlach_FacingDeath_2b3b736e-2a59-40df-a4ae-a3dd450c6b18,"ReadyCheck_ToBGFromSCL",0,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Karlach_FacingDeath_2b3b736e-2a59-40df-a4ae-a3dd450c6b18,(CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c);
//END_REGION

//REGION Lae'zel

//Laezel_PostCrecheDestruction
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostCrecheDestruction_d8518d06-c176-4d5c-932d-c7b55d0802ab,"ReadyCheck_ToSCL02FromCRE",3,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostCrecheDestruction_d8518d06-c176-4d5c-932d-c7b55d0802ab,"ReadyCheck_ToGoblinCampFromCreche",3,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostCrecheDestruction_d8518d06-c176-4d5c-932d-c7b55d0802ab,"ReadyCheck_ToPlainsFromCreche",3,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Laezel_PostCrecheDestruction_d8518d06-c176-4d5c-932d-c7b55d0802ab,(CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);

//Laezel_VlaakithBetrayal
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VlaakithBetrayal_bdaa7b4d-e60f-477d-a870-197bd3f4f83e,"ReadyCheck_ToSCL02FromCRE",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VlaakithBetrayal_bdaa7b4d-e60f-477d-a870-197bd3f4f83e,"ReadyCheck_ToGoblinCampFromCreche",2,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VlaakithBetrayal_bdaa7b4d-e60f-477d-a870-197bd3f4f83e,"ReadyCheck_ToPlainsFromCreche",2,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Laezel_VlaakithBetrayal_bdaa7b4d-e60f-477d-a870-197bd3f4f83e,(CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);

//Laezel_PostZaithisk
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostZaithisk_8b11150d-e948-448e-99d1-104d0164a0df,"ReadyCheck_ToSCL02FromCRE",1,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostZaithisk_8b11150d-e948-448e-99d1-104d0164a0df,"ReadyCheck_ToGoblinCampFromCreche",1,0);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_PostZaithisk_8b11150d-e948-448e-99d1-104d0164a0df,"ReadyCheck_ToPlainsFromCreche",1,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Laezel_PostZaithisk_8b11150d-e948-448e-99d1-104d0164a0df,(CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);

//Laezel_VossCampConfrontation
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VossCampConfrontation_d6828c76-0e03-4aa1-b980-886fcf49f8a9,"ReadyCheck_ToSCL02FromCRE",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VossCampConfrontation_d6828c76-0e03-4aa1-b980-886fcf49f8a9,"ReadyCheck_ToGoblinCampFromCreche",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Laezel_VossCampConfrontation_d6828c76-0e03-4aa1-b980-886fcf49f8a9,"ReadyCheck_ToPlainsFromCreche",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Laezel_VossCampConfrontation_d6828c76-0e03-4aa1-b980-886fcf49f8a9,(CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);

//END_REGION

//REGION Shadowheart

DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_NightsongShadowheartVisit_5cf06d9e-44ce-4431-a1c6-839bfdad5f79,"ReadyCheck_ToBGFromSCL",0,0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_NightsongShadowheartVisit_5cf06d9e-44ce-4431-a1c6-839bfdad5f79,(CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

//END_REGION

//REGION Wyll

//Wyll_MizorasJudgement
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2,"ReadyCheck_ToCrecheFromGoblinCamp",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2,"ReadyCheck_ToCrecheFromPlains",0,1);
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2,"ReadyCheck_ToSCLFromUnderdark",0,1);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2,(CHARACTER)S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

//END_REGION

//REGION Halsin / Minthara

//Halsin_Minthara_CFM_Confrontation
DB_CampNight_ForceOnLevelSwap((FLAG)NIGHT_Halsin_Minthara_Confrontation_69cd72c7-2d7c-4044-a500-9bad71ddd007, "ReadyCheck_ToBGFromSCL", 0, 0);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Halsin_Minthara_Confrontation_69cd72c7-2d7c-4044-a500-9bad71ddd007,(CHARACTER)S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_CampNight_ResurrectWhenForced((FLAG)NIGHT_Halsin_Minthara_Confrontation_69cd72c7-2d7c-4044-a500-9bad71ddd007,(CHARACTER)S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
//END_REGION

PROC_FallbackCamp_DefineTeleporterCamps();
KBSECTION
//REGION General

PROC
PROC_FallbackCamp_DefineTeleporterCamps()
THEN
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToCrecheFromGoblinCamp","WLDMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToCrecheFromPlains","WLDMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToGoblinCampFromCreche","CREMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToPlainsFromCreche","CREMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToSCLFromUnderdark","WLDDUNSHA");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToBGFromSCL","SCLMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToSCL02FromCRE","CREMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToCREFromSCL02","SCLMAIN");
DB_FallbackCamp_TeleporterCampPairings("ReadyCheck_ToWLDFromSCL","SCLMAIN");

//Fallback: Withers to camp
PROC
PROC_FallbackCamp_CheckSpecialConditions((STRING)_ReadyCheckID)
AND
DB_Act1a_MainQuestFallback_BlockTeleport(_ReadyCheckID)
AND
NOT DB_InCamp((CHARACTER)S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805)
THEN
PROC_GLO_Jergal_MoveToCamp();
DB_Camp_RequiredTalks(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);



//Fallback: Raphael Intro
PROC
PROC_FallbackCamp_CheckSpecialConditions((STRING)_ReadyCheckID)
AND
DB_Act1a_MainQuestFallback_BlockTeleport(_ReadyCheckID)
AND
NOT DB_GLO_MonitorIntro_HadIntro(1)
THEN
DB_GLO_Monitor_DismissToCamp(1);
DB_Camp_RequiredTalks(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
SetFlag(CAMP_MonitorIntro_ForcedEncounter_532bba9f-d7e8-cf36-db86-87bf8c4d22c8);

//End night, clean up
PROC
PROC_FallbackCamp_LeftCamp((STRING)_)
AND
DB_GLO_Monitor_DismissToCamp(1)
THEN
DB_GLO_MonitorIntro_HadIntro(1);
NOT DB_GLO_Monitor_DismissToCamp(1);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
PROC_Poof(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);

//END_REGION

//REGION Astarion

//AstarionHungerA
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_AstarionHungerA_ec01fb84-d9ef-47b6-8b32-6620edd67d50)
AND
DB_Avatars((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
NOT DB_GlobalFlag((FLAG)GEN_SoloPlayer_29e32f83-2001-0dbc-7df9-3ca2b3bc4349)
THEN
DB_NOOP(1);

//AstarionHungerC_Bite
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_AstarionHungerC_Bite_fe3fd3a0-70d1-4bc4-8a7f-4614f89ac23d)
AND
DB_Players((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
NOT DB_Avatars((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
THEN
DB_NOOP(1);

//Astarion_ScarReading_Fallback
//Camp night added upon entering act 2
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Astarion_ScarReading_Fallback_bd01fc04-00ce-4e32-bbee-aa248728a116)
AND
DB_GlobalFlag((FLAG)ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5)
AND
DB_GlobalFlag((FLAG)ORI_Astarion_Knows_CazadorMaster_7236c69b-fe20-afdb-a6fa-15c1fb9fb6ae)
AND
DB_Players((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
NOT DB_Avatars((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
THEN
DB_NOOP(1);

IF
TextEvent("fallbackcamp_ScarReading")
THEN
SetFlag((FLAG)ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5);
SetFlag((FLAG)ORI_Astarion_Knows_CazadorMaster_7236c69b-fe20-afdb-a6fa-15c1fb9fb6ae);

//Astarion_CazadorNightmare_SecondDream
//Camp night added upon entering act 2
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87)
AND
DB_Avatars((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
NOT QRY_FallbackCamp_CanTriggerRaphaelsRevelation()
THEN
DB_NOOP(1);

//!!! Blocks RaphaelsRevelation !!!
IF
TextEvent("fallbackcamp_CazadorNightmare")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Astarion_CazadorNightmare");
ClearFlag((FLAG)ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5);
ClearFlag((FLAG)SHA_Orthon_State_DefeatedOnce_8dd589d6-90fc-4a3b-b369-10440bd56520);

//Astarion_RaphaelsRevelation
//Camp night added upon entering act 2
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Astarion_RaphaelsRevelation_3a3b2dca-7e94-47af-b81f-93194944c633)
AND
DB_Players((CHARACTER)S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255)
AND
QRY_FallbackCamp_CanTriggerRaphaelsRevelation()
THEN
DB_NOOP(1);

QRY
QRY_FallbackCamp_CanTriggerRaphaelsRevelation()
AND
DB_GlobalFlag((FLAG)ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5)
AND
DB_GlobalFlag((FLAG)SHA_Orthon_State_DefeatedOnce_8dd589d6-90fc-4a3b-b369-10440bd56520)
THEN
DB_NOOP(1);

//!!! Blocks CazadorNightmare !!!
IF
TextEvent("fallbackcamp_RaphaelsRevelation")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Astarion_RaphaelsRevelation");
SetFlag((FLAG)ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5);
SetFlag((FLAG)SHA_Orthon_State_DefeatedOnce_8dd589d6-90fc-4a3b-b369-10440bd56520);

//END_REGION

//REGION Daisy

//Fallback: Infernal Box
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_InfernalBoxAppears_47942a99-c44e-4e90-a0a2-6956bed9dc5b)
AND
NOT DB_GlobalFlag(GLO_InfernalBox_State_TeamHasBox_d8b25e35-ec84-45e5-8395-5ce6faa36fbd)
THEN
DB_NOOP(1);

IF
TextEvent("fallbackcamp_InfernalBoxAppears")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: InfernalBoxAppears");
ClearFlag((FLAG)GLO_InfernalBox_State_TeamHasBox_d8b25e35-ec84-45e5-8395-5ce6faa36fbd);

//DaisyDream1
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f)
THEN
DB_NOOP(1);

PROC
PROC_FallbackCamp_OnCampNightQueued((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f)
THEN
NOT DB_CampNight_IVB((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f,(VOICEBARKRESOURCE)CAMP_Daisy1_IVB_dc0d3343-7256-e2a6-c211-14680236c139,(CHARACTER)NULL_00000000-0000-0000-0000-000000000000);
NOT DB_CampNight_CFM((FLAG)NIGHT_DaisyDream1_52669b07-9584-4c9d-8219-49679811fd4f,(DIALOGRESOURCE)CAMP_Daisy1_CRD_Laezel_BeforeDream_1375618b-f1e6-7f74-4748-beabc24cdc96);

//END_REGION

//REGION Dark Urge

// Fallback: Dark Urge: Murder of Alfira
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d)
AND
DB_ORI_DarkUrge(_DarkUrge)
AND
DB_Avatars(_DarkUrge)
THEN
DB_NOOP(1);

IF
TextEvent("fallbackcamp_ButlerIntro")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: DarkUrge_ButlerIntro");
SetFlag((FLAG)NIGHT_DarkUrge_MurderOfAlfira_b0e97b06-b2f8-4376-829f-23d4b4bcf78d);

IF
TextEvent("fallbackcamp_KilledIsobel")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: DarkUrge_KilledIsobel");
SetFlag((FLAG)ORI_DarkUrge_KilledIsobel_Requirement_b19523f2-d4bf-42f7-9834-2d19e04b2119);

IF
TextEvent("fallbackcamp_SkippedTempleFinale")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: DarkUrge_SkippedTempleFinale");
SetFlag((FLAG)ORI_DarkUrge_State_MissedTempleFinale_640cb288-0b40-434a-b13c-0c871d931bcc);

//Dark Urge needs special handling because they're not a pre-determined character
PROC
PROC_FallbackCamp_EnsureResurrections()
AND
DB_FallbackCamp_ResurrectDarkUrge(_NightFlag)
AND
DB_Camp_QueuedNight(_NightFlag)
AND
DB_ORI_DarkUrge(_DarkUrge)
THEN
Resurrect(_DarkUrge);

//END_REGION

//REGION Gale

//Gale_TressymJoin
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Gale_TressymJoin_7ca98d47-e9fa-4f87-8728-8e56c4ee652d)
AND
DB_Avatars((CHARACTER)S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604)
THEN
DB_NOOP(1);

//Gale_ElminsterVisit
IF
TextEvent("fallbackcamp_ElminsterVisit")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Gale_ElminsterVisit");
SetFlag((FLAG)ORI_Gale_State_GotOneMagicItem_6fec5439-a66e-4aff-b62b-69f88648c34d);
SysCompleteGoal("ORI_Gale_Elminster_Setup");
PROC_ORI_Gale_Elminster_SetupBackupMorningCFM();

//END_REGION

//REGION Karlach

//PaladinsOfTyr_Forced
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9)
AND
NOT DB_Avatars((CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c)
AND
DB_PartOfTheTeam((CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c)
AND
NOT DB_GlobalFlag((FLAG)ORI_Karlach_Knows_InfernalEngineExists_9b6d609a-2081-b5de-7dd6-12c425a8bc17)
THEN
DB_NOOP(1);

IF
FlagSet((FLAG)PLA_PaladinsOfTyr_Event_BlockActChange_530b707f-4af2-52bb-6d7b-e3971e6bae54, _, _)
AND
DB_FallbackCamp_QueuedLevelswap((CHARACTER)_Player,(STRING)_ReadyCheckID,(STRING)_CurrentLevel)
THEN
NOT DB_FallbackCamp_QueuedLevelswap(_Player,_ReadyCheckID,_CurrentLevel);

IF
FlagSet((FLAG)PLA_PaladinsOfTyr_Event_BlockActChange_530b707f-4af2-52bb-6d7b-e3971e6bae54, _, _)
AND
DB_WaypointTravel_RegionswapDestination(_Trigger,_WaypointID)
THEN
NOT DB_WaypointTravel_RegionswapDestination(_Trigger,_WaypointID);

IF
FlagSet((FLAG)PLA_PaladinsOfTyr_Event_BlockActChange_530b707f-4af2-52bb-6d7b-e3971e6bae54, _, _)
THEN
SetFlag((FLAG)ORI_Karlach_State_PromisedToDealWithPaladins_41e9f88c-0f3e-427a-911f-5df379642fe4, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag((FLAG)PLA_PaladinsOfTyr_Event_BlockActChange_530b707f-4af2-52bb-6d7b-e3971e6bae54, NULL_00000000-0000-0000-0000-000000000000);

// Cancel any relationship dialogues to avoid softlocking players.
IF
DB_Camp_QueuedNight((FLAG)NIGHT_PaladinsOfTyr_Forced_3a1be30d-8a75-4bee-b717-0b2e4d7bd1e9)
AND
DB_HandlingRelationshipDialog((CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, _Dialog, _Flag, _, _, _)
AND
_Dialog != CAMP_Karlach_CRD_PaladinsOfTyrAndEngine_d2af9413-43fa-05a3-bd83-0d7164aa5100
THEN
PROC_CancelRelationshipDialog((CHARACTER)S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, _Dialog, _Flag);

//END_REGION

//REGION Lae'zel

//Laezel_VossCampConfrontation
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Laezel_VossCampConfrontation_d6828c76-0e03-4aa1-b980-886fcf49f8a9)
AND
DB_PartOfTheTeam((CHARACTER)S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12)
AND
DB_GlobalFlag((FLAG)ORI_Laezel_State_BetrayedByVlaakith_175d8487-99dc-4009-9b45-6e9f29708cd7)
THEN
DB_NOOP(1);

IF
TextEvent("fallbackcamp_PostCrecheDestruction")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Laezel_PostCrecheDestruction");
SetFlag((FLAG)ORI_Laezel_State_CrecheExploded_31ee1ed3-b163-4d1a-84f3-d37521900a87);

IF
TextEvent("fallbackcamp_VlaakithBetrayal")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Laezel_VlaakithBetrayal");
SetFlag((FLAG)ORI_Laezel_State_BetrayedByVlaakith_175d8487-99dc-4009-9b45-6e9f29708cd7);

IF
TextEvent("fallbackcamp_PostZaithisk")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: Laezel_PostZaithisk");
SetFlag((FLAG)CRE_GithInfirmary_State_UsedDevice_a56d58c6-2a81-4a80-a4f6-4f73f254b40c);

//END_REGION

//REGION Shadowheart

IF
ReadyCheckPassed("ReadyCheck_ToBGFromSCL")
AND
DB_GlobalFlag((FLAG)ORI_Shadowheart_State_EnemyOfSharPath_055bbe0f-05f5-444b-a7e2-0f66edd2178c)
AND
DB_PartOfTheTeam((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679)
AND
NOT DB_GlobalFlag((FLAG)CAMP_Shadowheart_State_HadNightsongMeeting_10b74e80-a963-420f-8c2a-d518b6aae143)
AND
NOT DB_PermaDefeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b)
AND
NOT DB_InCamp(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b)
AND
QRY_OnlyOnce("NIGHT_NightsongShadowheartVisit_InviteNightsong")
THEN
PROC_SceneOver("SCE_IsobelNightsongReunion_Scene_MainReunion");

IF
TextEvent("fallbackcamp_NightsongShadowheartVisit")
AND
GetHostCharacter(_Player)
THEN
DebugText(_Player,"Preparing forced night: NightsongShadowheartVisit");
SetFlag((FLAG)SCE_Epilogue_State_HasStarted_9b4bae0b-6464-4b0e-a0e3-41201c0c3c9e);
PROC_SCE_StartSetupDebrief();
PROC_GLO_Nightsong_GiveNightsongEquipment();
PROC_CharacterFullRestore((CHARACTER)S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_State_Progress(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "SHA_Nightsong", "SHA_State_Nightsong_KethericDefeated");
PROC_SCE_NightsongIsobelReunion_MoveNightsongToCamp();
RemoveStatus(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b,"SHA_NIGHTSONG_SOULCAGE",NULL_00000000-0000-0000-0000-000000000000);
PROC_SceneOver("SHA_NightsongPrison_MeetingNightsong");
PROC_SceneOver("SCE_IsobelNightsongReunion_Scene_MainReunion");

//END_REGION

//REGION Wyll

//Wyll_MizorasJudgement
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2)
AND
DB_PartOfTheTeam((CHARACTER)S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d)
AND
NOT DB_GlobalFlag((FLAG)CAMP_MizorasJudgement_Event_Judged_c6d2140f-312d-65d4-e66e-92de4258b3f4)
AND
NOT DB_GlobalFlag((FLAG)GLO_Karlach_State_Dead_26f3c3b0-a9c8-40d6-8950-67c9b8e134e2)
THEN
//If Karlach isn't dead by this point, peaceful resolution is assumed in the dialogue
PROC_GlobalSetFlagAndCache(ORI_WyllConfrontation_State_ResolvedPeacefuly_fa3b8420-26bc-361d-8fbf-c6da37353446);

//Wyll_MizorasJudgement
QRY
QRY_FallbackCamp_CampNightMeetsRequirements((FLAG)NIGHT_Wyll_MizorasJudgement_ad448187-17b4-45a1-9acc-eb8b016e1dd2)
AND
DB_PartOfTheTeam((CHARACTER)S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d)
AND
NOT DB_GlobalFlag((FLAG)CAMP_MizorasJudgement_Event_Judged_c6d2140f-312d-65d4-e66e-92de4258b3f4)
AND
DB_GlobalFlag((FLAG)GLO_Karlach_State_Dead_26f3c3b0-a9c8-40d6-8950-67c9b8e134e2)
THEN
DB_NOOP(1);

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ModWrapper_Gustav"
